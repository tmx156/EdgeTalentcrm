/*! For license information please see main.25d032b5.js.LICENSE.txt */
(()=>{var e={43:(e,t,s)=>{"use strict";e.exports=s(202)},153:(e,t,s)=>{"use strict";var n=s(43),a=Symbol.for("react.element"),r=Symbol.for("react.fragment"),l=Object.prototype.hasOwnProperty,o=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,s){var n,r={},c=null,d=null;for(n in void 0!==s&&(c=""+s),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(d=t.ref),t)l.call(t,n)&&!i.hasOwnProperty(n)&&(r[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===r[n]&&(r[n]=t[n]);return{$$typeof:a,type:e,key:c,ref:d,props:r,_owner:o.current}}t.Fragment=r,t.jsx=c,t.jsxs=c},202:(e,t)=>{"use strict";var s=Symbol.for("react.element"),n=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),i=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),h=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,g={};function f(e,t,s){this.props=e,this.context=t,this.refs=g,this.updater=s||p}function b(){}function y(e,t,s){this.props=e,this.context=t,this.refs=g,this.updater=s||p}f.prototype.isReactComponent={},f.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},f.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},b.prototype=f.prototype;var v=y.prototype=new b;v.constructor=y,x(v,f.prototype),v.isPureReactComponent=!0;var j=Array.isArray,w=Object.prototype.hasOwnProperty,N={current:null},k={key:!0,ref:!0,__self:!0,__source:!0};function S(e,t,n){var a,r={},l=null,o=null;if(null!=t)for(a in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(l=""+t.key),t)w.call(t,a)&&!k.hasOwnProperty(a)&&(r[a]=t[a]);var i=arguments.length-2;if(1===i)r.children=n;else if(1<i){for(var c=Array(i),d=0;d<i;d++)c[d]=arguments[d+2];r.children=c}if(e&&e.defaultProps)for(a in i=e.defaultProps)void 0===r[a]&&(r[a]=i[a]);return{$$typeof:s,type:e,key:l,ref:o,props:r,_owner:N.current}}function C(e){return"object"===typeof e&&null!==e&&e.$$typeof===s}var _=/\/+/g;function E(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function T(e,t,a,r,l){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var i=!1;if(null===e)i=!0;else switch(o){case"string":case"number":i=!0;break;case"object":switch(e.$$typeof){case s:case n:i=!0}}if(i)return l=l(i=e),e=""===r?"."+E(i,0):r,j(l)?(a="",null!=e&&(a=e.replace(_,"$&/")+"/"),T(l,t,a,"",function(e){return e})):null!=l&&(C(l)&&(l=function(e,t){return{$$typeof:s,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(l,a+(!l.key||i&&i.key===l.key?"":(""+l.key).replace(_,"$&/")+"/")+e)),t.push(l)),1;if(i=0,r=""===r?".":r+":",j(e))for(var c=0;c<e.length;c++){var d=r+E(o=e[c],c);i+=T(o,t,a,d,l)}else if(d=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=h&&e[h]||e["@@iterator"])?e:null}(e),"function"===typeof d)for(e=d.call(e),c=0;!(o=e.next()).done;)i+=T(o=o.value,t,a,d=r+E(o,c++),l);else if("object"===o)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return i}function P(e,t,s){if(null==e)return e;var n=[],a=0;return T(e,n,"","",function(e){return t.call(s,e,a++)}),n}function A(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var D={current:null},L={transition:null},M={ReactCurrentDispatcher:D,ReactCurrentBatchConfig:L,ReactCurrentOwner:N};function R(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:P,forEach:function(e,t,s){P(e,function(){t.apply(this,arguments)},s)},count:function(e){var t=0;return P(e,function(){t++}),t},toArray:function(e){return P(e,function(e){return e})||[]},only:function(e){if(!C(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=f,t.Fragment=a,t.Profiler=l,t.PureComponent=y,t.StrictMode=r,t.Suspense=d,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=M,t.act=R,t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var a=x({},e.props),r=e.key,l=e.ref,o=e._owner;if(null!=t){if(void 0!==t.ref&&(l=t.ref,o=N.current),void 0!==t.key&&(r=""+t.key),e.type&&e.type.defaultProps)var i=e.type.defaultProps;for(c in t)w.call(t,c)&&!k.hasOwnProperty(c)&&(a[c]=void 0===t[c]&&void 0!==i?i[c]:t[c])}var c=arguments.length-2;if(1===c)a.children=n;else if(1<c){i=Array(c);for(var d=0;d<c;d++)i[d]=arguments[d+2];a.children=i}return{$$typeof:s,type:e.type,key:r,ref:l,props:a,_owner:o}},t.createContext=function(e){return(e={$$typeof:i,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=S,t.createFactory=function(e){var t=S.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=C,t.lazy=function(e){return{$$typeof:m,_payload:{_status:-1,_result:e},_init:A}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=L.transition;L.transition={};try{e()}finally{L.transition=t}},t.unstable_act=R,t.useCallback=function(e,t){return D.current.useCallback(e,t)},t.useContext=function(e){return D.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return D.current.useDeferredValue(e)},t.useEffect=function(e,t){return D.current.useEffect(e,t)},t.useId=function(){return D.current.useId()},t.useImperativeHandle=function(e,t,s){return D.current.useImperativeHandle(e,t,s)},t.useInsertionEffect=function(e,t){return D.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return D.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return D.current.useMemo(e,t)},t.useReducer=function(e,t,s){return D.current.useReducer(e,t,s)},t.useRef=function(e){return D.current.useRef(e)},t.useState=function(e){return D.current.useState(e)},t.useSyncExternalStore=function(e,t,s){return D.current.useSyncExternalStore(e,t,s)},t.useTransition=function(){return D.current.useTransition()},t.version="18.3.1"},234:(e,t)=>{"use strict";function s(e,t){var s=e.length;e.push(t);e:for(;0<s;){var n=s-1>>>1,a=e[n];if(!(0<r(a,t)))break e;e[n]=t,e[s]=a,s=n}}function n(e){return 0===e.length?null:e[0]}function a(e){if(0===e.length)return null;var t=e[0],s=e.pop();if(s!==t){e[0]=s;e:for(var n=0,a=e.length,l=a>>>1;n<l;){var o=2*(n+1)-1,i=e[o],c=o+1,d=e[c];if(0>r(i,s))c<a&&0>r(d,i)?(e[n]=d,e[c]=s,n=c):(e[n]=i,e[o]=s,n=o);else{if(!(c<a&&0>r(d,s)))break e;e[n]=d,e[c]=s,n=c}}}return t}function r(e,t){var s=e.sortIndex-t.sortIndex;return 0!==s?s:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var l=performance;t.unstable_now=function(){return l.now()}}else{var o=Date,i=o.now();t.unstable_now=function(){return o.now()-i}}var c=[],d=[],u=1,m=null,h=3,p=!1,x=!1,g=!1,f="function"===typeof setTimeout?setTimeout:null,b="function"===typeof clearTimeout?clearTimeout:null,y="undefined"!==typeof setImmediate?setImmediate:null;function v(e){for(var t=n(d);null!==t;){if(null===t.callback)a(d);else{if(!(t.startTime<=e))break;a(d),t.sortIndex=t.expirationTime,s(c,t)}t=n(d)}}function j(e){if(g=!1,v(e),!x)if(null!==n(c))x=!0,L(w);else{var t=n(d);null!==t&&M(j,t.startTime-e)}}function w(e,s){x=!1,g&&(g=!1,b(C),C=-1),p=!0;var r=h;try{for(v(s),m=n(c);null!==m&&(!(m.expirationTime>s)||e&&!T());){var l=m.callback;if("function"===typeof l){m.callback=null,h=m.priorityLevel;var o=l(m.expirationTime<=s);s=t.unstable_now(),"function"===typeof o?m.callback=o:m===n(c)&&a(c),v(s)}else a(c);m=n(c)}if(null!==m)var i=!0;else{var u=n(d);null!==u&&M(j,u.startTime-s),i=!1}return i}finally{m=null,h=r,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var N,k=!1,S=null,C=-1,_=5,E=-1;function T(){return!(t.unstable_now()-E<_)}function P(){if(null!==S){var e=t.unstable_now();E=e;var s=!0;try{s=S(!0,e)}finally{s?N():(k=!1,S=null)}}else k=!1}if("function"===typeof y)N=function(){y(P)};else if("undefined"!==typeof MessageChannel){var A=new MessageChannel,D=A.port2;A.port1.onmessage=P,N=function(){D.postMessage(null)}}else N=function(){f(P,0)};function L(e){S=e,k||(k=!0,N())}function M(e,s){C=f(function(){e(t.unstable_now())},s)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){x||p||(x=!0,L(w))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):_=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(e){switch(h){case 1:case 2:case 3:var t=3;break;default:t=h}var s=h;h=t;try{return e()}finally{h=s}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var s=h;h=e;try{return t()}finally{h=s}},t.unstable_scheduleCallback=function(e,a,r){var l=t.unstable_now();switch("object"===typeof r&&null!==r?r="number"===typeof(r=r.delay)&&0<r?l+r:l:r=l,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:u++,callback:a,priorityLevel:e,startTime:r,expirationTime:o=r+o,sortIndex:-1},r>l?(e.sortIndex=r,s(d,e),null===n(c)&&e===n(d)&&(g?(b(C),C=-1):g=!0,M(j,r-l))):(e.sortIndex=o,s(c,e),x||p||(x=!0,L(w))),e},t.unstable_shouldYield=T,t.unstable_wrapCallback=function(e){var t=h;return function(){var s=h;h=t;try{return e.apply(this,arguments)}finally{h=s}}}},391:(e,t,s)=>{"use strict";var n=s(950);t.createRoot=n.createRoot,t.hydrateRoot=n.hydrateRoot},579:(e,t,s)=>{"use strict";e.exports=s(153)},634:(e,t,s)=>{(()=>{var t={296:(e,t,s)=>{var n=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,r=/^0b[01]+$/i,l=/^0o[0-7]+$/i,o=parseInt,i="object"==typeof s.g&&s.g&&s.g.Object===Object&&s.g,c="object"==typeof self&&self&&self.Object===Object&&self,d=i||c||Function("return this")(),u=Object.prototype.toString,m=Math.max,h=Math.min,p=function(){return d.Date.now()};function x(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function g(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==u.call(e)}(e))return NaN;if(x(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=x(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(n,"");var s=r.test(e);return s||l.test(e)?o(e.slice(2),s?2:8):a.test(e)?NaN:+e}e.exports=function(e,t,s){var n,a,r,l,o,i,c=0,d=!1,u=!1,f=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function b(t){var s=n,r=a;return n=a=void 0,c=t,l=e.apply(r,s)}function y(e){var s=e-i;return void 0===i||s>=t||s<0||u&&e-c>=r}function v(){var e=p();if(y(e))return j(e);o=setTimeout(v,function(e){var s=t-(e-i);return u?h(s,r-(e-c)):s}(e))}function j(e){return o=void 0,f&&n?b(e):(n=a=void 0,l)}function w(){var e=p(),s=y(e);if(n=arguments,a=this,i=e,s){if(void 0===o)return function(e){return c=e,o=setTimeout(v,t),d?b(e):l}(i);if(u)return o=setTimeout(v,t),b(i)}return void 0===o&&(o=setTimeout(v,t)),l}return t=g(t)||0,x(s)&&(d=!!s.leading,r=(u="maxWait"in s)?m(g(s.maxWait)||0,t):r,f="trailing"in s?!!s.trailing:f),w.cancel=function(){void 0!==o&&clearTimeout(o),c=0,n=i=a=o=void 0},w.flush=function(){return void 0===o?l:j(p())},w}},96:(e,t,s)=>{var n="Expected a function",a=/^\s+|\s+$/g,r=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,o=/^0o[0-7]+$/i,i=parseInt,c="object"==typeof s.g&&s.g&&s.g.Object===Object&&s.g,d="object"==typeof self&&self&&self.Object===Object&&self,u=c||d||Function("return this")(),m=Object.prototype.toString,h=Math.max,p=Math.min,x=function(){return u.Date.now()};function g(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function f(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==m.call(e)}(e))return NaN;if(g(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=g(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(a,"");var s=l.test(e);return s||o.test(e)?i(e.slice(2),s?2:8):r.test(e)?NaN:+e}e.exports=function(e,t,s){var a=!0,r=!0;if("function"!=typeof e)throw new TypeError(n);return g(s)&&(a="leading"in s?!!s.leading:a,r="trailing"in s?!!s.trailing:r),function(e,t,s){var a,r,l,o,i,c,d=0,u=!1,m=!1,b=!0;if("function"!=typeof e)throw new TypeError(n);function y(t){var s=a,n=r;return a=r=void 0,d=t,o=e.apply(n,s)}function v(e){var s=e-c;return void 0===c||s>=t||s<0||m&&e-d>=l}function j(){var e=x();if(v(e))return w(e);i=setTimeout(j,function(e){var s=t-(e-c);return m?p(s,l-(e-d)):s}(e))}function w(e){return i=void 0,b&&a?y(e):(a=r=void 0,o)}function N(){var e=x(),s=v(e);if(a=arguments,r=this,c=e,s){if(void 0===i)return function(e){return d=e,i=setTimeout(j,t),u?y(e):o}(c);if(m)return i=setTimeout(j,t),y(c)}return void 0===i&&(i=setTimeout(j,t)),o}return t=f(t)||0,g(s)&&(u=!!s.leading,l=(m="maxWait"in s)?h(f(s.maxWait)||0,t):l,b="trailing"in s?!!s.trailing:b),N.cancel=function(){void 0!==i&&clearTimeout(i),d=0,a=c=r=i=void 0},N.flush=function(){return void 0===i?o:w(x())},N}(e,t,{leading:a,maxWait:t,trailing:r})}},703:(e,t,s)=>{"use strict";var n=s(414);function a(){}function r(){}r.resetWarningCache=a,e.exports=function(){function e(e,t,s,a,r,l){if(l!==n){var o=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw o.name="Invariant Violation",o}}function t(){return e}e.isRequired=e;var s={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:r,resetWarningCache:a};return s.PropTypes=s,s}},697:(e,t,s)=>{e.exports=s(703)()},414:e=>{"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"}},n={};function a(e){var s=n[e];if(void 0!==s)return s.exports;var r=n[e]={exports:{}};return t[e](r,r.exports,a),r.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};(()=>{"use strict";a.r(r),a.d(r,{LazyLoadComponent:()=>q,LazyLoadImage:()=>te,trackWindowScroll:()=>L});const e=s(43);var t=a.n(e),n=a(697);function l(){return"undefined"!=typeof window&&"IntersectionObserver"in window&&"isIntersecting"in window.IntersectionObserverEntry.prototype}function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function i(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}function c(e,t,s){return(t=u(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function d(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,u(n.key),n)}}function u(e){var t=function(e){if("object"!==o(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!==o(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===o(t)?t:String(t)}function m(e,t){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},m(e,t)}function h(e){return h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},h(e)}var p=function(e){e.forEach(function(e){e.isIntersecting&&e.target.onVisible()})},x={},g=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&m(e,t)}(g,e);var s,n,a,r,u=(a=g,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=h(a);if(r){var s=h(this).constructor;e=Reflect.construct(t,arguments,s)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===o(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function g(e){var t;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,g),(t=u.call(this,e)).supportsObserver=!e.scrollPosition&&e.useIntersectionObserver&&l(),t.supportsObserver){var s=e.threshold;t.observer=function(e){return x[e]=x[e]||new IntersectionObserver(p,{rootMargin:e+"px"}),x[e]}(s)}return t}return s=g,n=[{key:"componentDidMount",value:function(){this.placeholder&&this.observer&&(this.placeholder.onVisible=this.props.onVisible,this.observer.observe(this.placeholder)),this.supportsObserver||this.updateVisibility()}},{key:"componentWillUnmount",value:function(){this.observer&&this.placeholder&&this.observer.unobserve(this.placeholder)}},{key:"componentDidUpdate",value:function(){this.supportsObserver||this.updateVisibility()}},{key:"getPlaceholderBoundingBox",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props.scrollPosition,t=this.placeholder.getBoundingClientRect(),s=this.placeholder.style,n=parseInt(s.getPropertyValue("margin-left"),10)||0,a=parseInt(s.getPropertyValue("margin-top"),10)||0;return{bottom:e.y+t.bottom+a,left:e.x+t.left+n,right:e.x+t.right+n,top:e.y+t.top+a}}},{key:"isPlaceholderInViewport",value:function(){if("undefined"==typeof window||!this.placeholder)return!1;var e=this.props,t=e.scrollPosition,s=e.threshold,n=this.getPlaceholderBoundingBox(t),a=t.y+window.innerHeight,r=t.x,l=t.x+window.innerWidth,o=t.y;return Boolean(o-s<=n.bottom&&a+s>=n.top&&r-s<=n.right&&l+s>=n.left)}},{key:"updateVisibility",value:function(){this.isPlaceholderInViewport()&&this.props.onVisible()}},{key:"render",value:function(){var e=this,s=this.props,n=s.className,a=s.height,r=s.placeholder,l=s.style,o=s.width;if(r&&"function"!=typeof r.type)return t().cloneElement(r,{ref:function(t){return e.placeholder=t}});var d=function(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?i(Object(s),!0).forEach(function(t){c(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):i(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}({display:"inline-block"},l);return void 0!==o&&(d.width=o),void 0!==a&&(d.height=a),t().createElement("span",{className:n,ref:function(t){return e.placeholder=t},style:d},r)}}],n&&d(s.prototype,n),Object.defineProperty(s,"prototype",{writable:!1}),g}(t().Component);g.propTypes={onVisible:n.PropTypes.func.isRequired,className:n.PropTypes.string,height:n.PropTypes.oneOfType([n.PropTypes.number,n.PropTypes.string]),placeholder:n.PropTypes.element,threshold:n.PropTypes.number,useIntersectionObserver:n.PropTypes.bool,scrollPosition:n.PropTypes.shape({x:n.PropTypes.number.isRequired,y:n.PropTypes.number.isRequired}),width:n.PropTypes.oneOfType([n.PropTypes.number,n.PropTypes.string])},g.defaultProps={className:"",placeholder:null,threshold:100,useIntersectionObserver:!0};const f=g;var b=a(296),y=a.n(b),v=a(96),j=a.n(v),w=function(e){var t=getComputedStyle(e,null);return t.getPropertyValue("overflow")+t.getPropertyValue("overflow-y")+t.getPropertyValue("overflow-x")};const N=function(e){if(!(e instanceof HTMLElement))return window;for(var t=e;t&&t instanceof HTMLElement;){if(/(scroll|auto)/.test(w(t)))return t;t=t.parentNode}return window};function k(e){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k(e)}var S=["delayMethod","delayTime"];function C(){return C=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},C.apply(this,arguments)}function _(e,t){return _=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},_(e,t)}function E(e,t){if(t&&("object"===k(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return T(e)}function T(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function P(e){return P=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},P(e)}var A=function(){return"undefined"==typeof window?0:window.scrollX||window.pageXOffset},D=function(){return"undefined"==typeof window?0:window.scrollY||window.pageYOffset};const L=function(e){var s=function(s){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_(e,t)}(c,s);var n,a,r,o,i=(r=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=P(r);if(o){var s=P(this).constructor;e=Reflect.construct(t,arguments,s)}else e=t.apply(this,arguments);return E(this,e)});function c(e){var s;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(s=i.call(this,e)).useIntersectionObserver=e.useIntersectionObserver&&l(),s.useIntersectionObserver)return E(s);var n=s.onChangeScroll.bind(T(s));return"debounce"===e.delayMethod?s.delayedScroll=y()(n,e.delayTime):"throttle"===e.delayMethod&&(s.delayedScroll=j()(n,e.delayTime)),s.state={scrollPosition:{x:A(),y:D()}},s.baseComponentRef=t().createRef(),s}return n=c,(a=[{key:"componentDidMount",value:function(){this.addListeners()}},{key:"componentWillUnmount",value:function(){this.removeListeners()}},{key:"componentDidUpdate",value:function(){"undefined"==typeof window||this.useIntersectionObserver||N(this.baseComponentRef.current)!==this.scrollElement&&(this.removeListeners(),this.addListeners())}},{key:"addListeners",value:function(){"undefined"==typeof window||this.useIntersectionObserver||(this.scrollElement=N(this.baseComponentRef.current),this.scrollElement.addEventListener("scroll",this.delayedScroll,{passive:!0}),window.addEventListener("resize",this.delayedScroll,{passive:!0}),this.scrollElement!==window&&window.addEventListener("scroll",this.delayedScroll,{passive:!0}))}},{key:"removeListeners",value:function(){"undefined"==typeof window||this.useIntersectionObserver||(this.scrollElement.removeEventListener("scroll",this.delayedScroll),window.removeEventListener("resize",this.delayedScroll),this.scrollElement!==window&&window.removeEventListener("scroll",this.delayedScroll))}},{key:"onChangeScroll",value:function(){this.useIntersectionObserver||this.setState({scrollPosition:{x:A(),y:D()}})}},{key:"render",value:function(){var s=this.props,n=(s.delayMethod,s.delayTime,function(e,t){if(null==e)return{};var s,n,a=function(e,t){if(null==e)return{};var s,n,a={},r=Object.keys(e);for(n=0;n<r.length;n++)s=r[n],t.indexOf(s)>=0||(a[s]=e[s]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)s=r[n],t.indexOf(s)>=0||Object.prototype.propertyIsEnumerable.call(e,s)&&(a[s]=e[s])}return a}(s,S)),a=this.useIntersectionObserver?null:this.state.scrollPosition;return t().createElement(e,C({forwardRef:this.baseComponentRef,scrollPosition:a},n))}}])&&function(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(a=function(e){if("object"!==k(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!==k(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===k(a)?a:String(a)),n)}var a}(n.prototype,a),Object.defineProperty(n,"prototype",{writable:!1}),c}(t().Component);return s.propTypes={delayMethod:n.PropTypes.oneOf(["debounce","throttle"]),delayTime:n.PropTypes.number,useIntersectionObserver:n.PropTypes.bool},s.defaultProps={delayMethod:"throttle",delayTime:300,useIntersectionObserver:!0},s};function M(e){return M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},M(e)}function R(e,t){return R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},R(e,t)}function F(e){return F=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},F(e)}var I=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&R(e,t)}(o,e);var s,n,a,r,l=(a=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=F(a);if(r){var s=F(this).constructor;e=Reflect.construct(t,arguments,s)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===M(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function o(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),l.call(this,e)}return s=o,(n=[{key:"render",value:function(){return t().createElement(f,this.props)}}])&&function(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(a=function(e){if("object"!==M(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!==M(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===M(a)?a:String(a)),n)}var a}(s.prototype,n),Object.defineProperty(s,"prototype",{writable:!1}),o}(t().Component);const O=L(I);function B(e){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},B(e)}function U(e,t){return U=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},U(e,t)}function z(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function V(e){return V=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},V(e)}var W=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&U(e,t)}(i,e);var s,n,a,r,o=(a=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=V(a);if(r){var s=V(this).constructor;e=Reflect.construct(t,arguments,s)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===B(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return z(e)}(this,e)});function i(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),t=o.call(this,e);var s=e.afterLoad,n=e.beforeLoad,a=e.scrollPosition,r=e.visibleByDefault;return t.state={visible:r},r&&(n(),s()),t.onVisible=t.onVisible.bind(z(t)),t.isScrollTracked=Boolean(a&&Number.isFinite(a.x)&&a.x>=0&&Number.isFinite(a.y)&&a.y>=0),t}return s=i,(n=[{key:"componentDidUpdate",value:function(e,t){t.visible!==this.state.visible&&this.props.afterLoad()}},{key:"onVisible",value:function(){this.props.beforeLoad(),this.setState({visible:!0})}},{key:"render",value:function(){if(this.state.visible)return this.props.children;var e=this.props,s=e.className,n=e.delayMethod,a=e.delayTime,r=e.height,o=e.placeholder,i=e.scrollPosition,c=e.style,d=e.threshold,u=e.useIntersectionObserver,m=e.width;return this.isScrollTracked||u&&l()?t().createElement(f,{className:s,height:r,onVisible:this.onVisible,placeholder:o,scrollPosition:i,style:c,threshold:d,useIntersectionObserver:u,width:m}):t().createElement(O,{className:s,delayMethod:n,delayTime:a,height:r,onVisible:this.onVisible,placeholder:o,style:c,threshold:d,width:m})}}])&&function(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(a=function(e){if("object"!==B(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!==B(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===B(a)?a:String(a)),n)}var a}(s.prototype,n),Object.defineProperty(s,"prototype",{writable:!1}),i}(t().Component);W.propTypes={afterLoad:n.PropTypes.func,beforeLoad:n.PropTypes.func,useIntersectionObserver:n.PropTypes.bool,visibleByDefault:n.PropTypes.bool},W.defaultProps={afterLoad:function(){return{}},beforeLoad:function(){return{}},useIntersectionObserver:!0,visibleByDefault:!1};const q=W;function H(e){return H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},H(e)}var Y=["afterLoad","beforeLoad","delayMethod","delayTime","effect","placeholder","placeholderSrc","scrollPosition","threshold","useIntersectionObserver","visibleByDefault","wrapperClassName","wrapperProps"];function G(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}function $(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?G(Object(s),!0).forEach(function(t){Q(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):G(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}function Q(e,t,s){return(t=J(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function K(){return K=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},K.apply(this,arguments)}function J(e){var t=function(e){if("object"!==H(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!==H(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===H(t)?t:String(t)}function X(e,t){return X=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},X(e,t)}function Z(e){return Z=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Z(e)}var ee=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&X(e,t)}(o,e);var s,n,a,r,l=(a=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,t=Z(a);if(r){var s=Z(this).constructor;e=Reflect.construct(t,arguments,s)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===H(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=l.call(this,e)).state={loaded:!1},t}return s=o,(n=[{key:"onImageLoad",value:function(){var e=this;return this.state.loaded?null:function(t){e.props.onLoad(t),e.props.afterLoad(),e.setState({loaded:!0})}}},{key:"getImg",value:function(){var e=this.props,s=(e.afterLoad,e.beforeLoad,e.delayMethod,e.delayTime,e.effect,e.placeholder,e.placeholderSrc,e.scrollPosition,e.threshold,e.useIntersectionObserver,e.visibleByDefault,e.wrapperClassName,e.wrapperProps,function(e,t){if(null==e)return{};var s,n,a=function(e,t){if(null==e)return{};var s,n,a={},r=Object.keys(e);for(n=0;n<r.length;n++)s=r[n],t.indexOf(s)>=0||(a[s]=e[s]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)s=r[n],t.indexOf(s)>=0||Object.prototype.propertyIsEnumerable.call(e,s)&&(a[s]=e[s])}return a}(e,Y));return t().createElement("img",K({},s,{onLoad:this.onImageLoad()}))}},{key:"getLazyLoadImage",value:function(){var e=this.props,s=e.beforeLoad,n=e.className,a=e.delayMethod,r=e.delayTime,l=e.height,o=e.placeholder,i=e.scrollPosition,c=e.style,d=e.threshold,u=e.useIntersectionObserver,m=e.visibleByDefault,h=e.width;return t().createElement(q,{beforeLoad:s,className:n,delayMethod:a,delayTime:r,height:l,placeholder:o,scrollPosition:i,style:c,threshold:d,useIntersectionObserver:u,visibleByDefault:m,width:h},this.getImg())}},{key:"getWrappedLazyLoadImage",value:function(e){var s=this.props,n=s.effect,a=s.height,r=s.placeholderSrc,l=s.width,o=s.wrapperClassName,i=s.wrapperProps,c=this.state.loaded,d=c?" lazy-load-image-loaded":"",u=c||!r?{}:{backgroundImage:"url(".concat(r,")"),backgroundSize:"100% 100%"};return t().createElement("span",K({className:o+" lazy-load-image-background "+n+d,style:$($({},u),{},{color:"transparent",display:"inline-block",height:a,width:l})},i),e)}},{key:"render",value:function(){var e=this.props,t=e.effect,s=e.placeholderSrc,n=e.visibleByDefault,a=e.wrapperClassName,r=e.wrapperProps,l=this.getLazyLoadImage();return(t||s)&&!n||a||r?this.getWrappedLazyLoadImage(l):l}}])&&function(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,J(n.key),n)}}(s.prototype,n),Object.defineProperty(s,"prototype",{writable:!1}),o}(t().Component);ee.propTypes={onLoad:n.PropTypes.func,afterLoad:n.PropTypes.func,beforeLoad:n.PropTypes.func,delayMethod:n.PropTypes.string,delayTime:n.PropTypes.number,effect:n.PropTypes.string,placeholderSrc:n.PropTypes.string,threshold:n.PropTypes.number,useIntersectionObserver:n.PropTypes.bool,visibleByDefault:n.PropTypes.bool,wrapperClassName:n.PropTypes.string,wrapperProps:n.PropTypes.object},ee.defaultProps={onLoad:function(){},afterLoad:function(){return{}},beforeLoad:function(){return{}},delayMethod:"throttle",delayTime:300,effect:"",placeholderSrc:null,threshold:100,useIntersectionObserver:!0,visibleByDefault:!1,wrapperClassName:""};const te=ee})(),e.exports=r})()},730:(e,t,s)=>{"use strict";var n=s(43),a=s(853);function r(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,s=1;s<arguments.length;s++)t+="&args[]="+encodeURIComponent(arguments[s]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var l=new Set,o={};function i(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(o[e]=t,e=0;e<t.length;e++)l.add(t[e])}var d=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),u=Object.prototype.hasOwnProperty,m=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,h={},p={};function x(e,t,s,n,a,r,l){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=n,this.attributeNamespace=a,this.mustUseProperty=s,this.propertyName=e,this.type=t,this.sanitizeURL=r,this.removeEmptyString=l}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){g[e]=new x(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];g[t]=new x(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){g[e]=new x(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){g[e]=new x(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){g[e]=new x(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){g[e]=new x(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){g[e]=new x(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){g[e]=new x(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){g[e]=new x(e,5,!1,e.toLowerCase(),null,!1,!1)});var f=/[\-:]([a-z])/g;function b(e){return e[1].toUpperCase()}function y(e,t,s,n){var a=g.hasOwnProperty(t)?g[t]:null;(null!==a?0!==a.type:n||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,s,n){if(null===t||"undefined"===typeof t||function(e,t,s,n){if(null!==s&&0===s.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!n&&(null!==s?!s.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,s,n))return!0;if(n)return!1;if(null!==s)switch(s.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,s,a,n)&&(s=null),n||null===a?function(e){return!!u.call(p,e)||!u.call(h,e)&&(m.test(e)?p[e]=!0:(h[e]=!0,!1))}(t)&&(null===s?e.removeAttribute(t):e.setAttribute(t,""+s)):a.mustUseProperty?e[a.propertyName]=null===s?3!==a.type&&"":s:(t=a.attributeName,n=a.attributeNamespace,null===s?e.removeAttribute(t):(s=3===(a=a.type)||4===a&&!0===s?"":""+s,n?e.setAttributeNS(n,t,s):e.setAttribute(t,s))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(f,b);g[t]=new x(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(f,b);g[t]=new x(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(f,b);g[t]=new x(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){g[e]=new x(e,1,!1,e.toLowerCase(),null,!1,!1)}),g.xlinkHref=new x("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){g[e]=new x(e,1,!1,e.toLowerCase(),null,!0,!0)});var v=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,j=Symbol.for("react.element"),w=Symbol.for("react.portal"),N=Symbol.for("react.fragment"),k=Symbol.for("react.strict_mode"),S=Symbol.for("react.profiler"),C=Symbol.for("react.provider"),_=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),T=Symbol.for("react.suspense"),P=Symbol.for("react.suspense_list"),A=Symbol.for("react.memo"),D=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var L=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var M=Symbol.iterator;function R(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=M&&e[M]||e["@@iterator"])?e:null}var F,I=Object.assign;function O(e){if(void 0===F)try{throw Error()}catch(s){var t=s.stack.trim().match(/\n( *(at )?)/);F=t&&t[1]||""}return"\n"+F+e}var B=!1;function U(e,t){if(!e||B)return"";B=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var n=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){n=c}e.call(t.prototype)}else{try{throw Error()}catch(c){n=c}e()}}catch(c){if(c&&n&&"string"===typeof c.stack){for(var a=c.stack.split("\n"),r=n.stack.split("\n"),l=a.length-1,o=r.length-1;1<=l&&0<=o&&a[l]!==r[o];)o--;for(;1<=l&&0<=o;l--,o--)if(a[l]!==r[o]){if(1!==l||1!==o)do{if(l--,0>--o||a[l]!==r[o]){var i="\n"+a[l].replace(" at new "," at ");return e.displayName&&i.includes("<anonymous>")&&(i=i.replace("<anonymous>",e.displayName)),i}}while(1<=l&&0<=o);break}}}finally{B=!1,Error.prepareStackTrace=s}return(e=e?e.displayName||e.name:"")?O(e):""}function z(e){switch(e.tag){case 5:return O(e.type);case 16:return O("Lazy");case 13:return O("Suspense");case 19:return O("SuspenseList");case 0:case 2:case 15:return e=U(e.type,!1);case 11:return e=U(e.type.render,!1);case 1:return e=U(e.type,!0);default:return""}}function V(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case N:return"Fragment";case w:return"Portal";case S:return"Profiler";case k:return"StrictMode";case T:return"Suspense";case P:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case _:return(e.displayName||"Context")+".Consumer";case C:return(e._context.displayName||"Context")+".Provider";case E:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case A:return null!==(t=e.displayName||null)?t:V(e.type)||"Memo";case D:t=e._payload,e=e._init;try{return V(e(t))}catch(s){}}return null}function W(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return V(t);case 8:return t===k?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function q(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function H(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function Y(e){e._valueTracker||(e._valueTracker=function(e){var t=H(e)?"checked":"value",s=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof s&&"function"===typeof s.get&&"function"===typeof s.set){var a=s.get,r=s.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(e){n=""+e,r.call(this,e)}}),Object.defineProperty(e,t,{enumerable:s.enumerable}),{getValue:function(){return n},setValue:function(e){n=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function G(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var s=t.getValue(),n="";return e&&(n=H(e)?e.checked?"true":"false":e.value),(e=n)!==s&&(t.setValue(e),!0)}function $(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Q(e,t){var s=t.checked;return I({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=s?s:e._wrapperState.initialChecked})}function K(e,t){var s=null==t.defaultValue?"":t.defaultValue,n=null!=t.checked?t.checked:t.defaultChecked;s=q(null!=t.value?t.value:s),e._wrapperState={initialChecked:n,initialValue:s,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function J(e,t){null!=(t=t.checked)&&y(e,"checked",t,!1)}function X(e,t){J(e,t);var s=q(t.value),n=t.type;if(null!=s)"number"===n?(0===s&&""===e.value||e.value!=s)&&(e.value=""+s):e.value!==""+s&&(e.value=""+s);else if("submit"===n||"reset"===n)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,s):t.hasOwnProperty("defaultValue")&&ee(e,t.type,q(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Z(e,t,s){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!("submit"!==n&&"reset"!==n||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,s||t===e.value||(e.value=t),e.defaultValue=t}""!==(s=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==s&&(e.name=s)}function ee(e,t,s){"number"===t&&$(e.ownerDocument)===e||(null==s?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+s&&(e.defaultValue=""+s))}var te=Array.isArray;function se(e,t,s,n){if(e=e.options,t){t={};for(var a=0;a<s.length;a++)t["$"+s[a]]=!0;for(s=0;s<e.length;s++)a=t.hasOwnProperty("$"+e[s].value),e[s].selected!==a&&(e[s].selected=a),a&&n&&(e[s].defaultSelected=!0)}else{for(s=""+q(s),t=null,a=0;a<e.length;a++){if(e[a].value===s)return e[a].selected=!0,void(n&&(e[a].defaultSelected=!0));null!==t||e[a].disabled||(t=e[a])}null!==t&&(t.selected=!0)}}function ne(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(r(91));return I({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ae(e,t){var s=t.value;if(null==s){if(s=t.children,t=t.defaultValue,null!=s){if(null!=t)throw Error(r(92));if(te(s)){if(1<s.length)throw Error(r(93));s=s[0]}t=s}null==t&&(t=""),s=t}e._wrapperState={initialValue:q(s)}}function re(e,t){var s=q(t.value),n=q(t.defaultValue);null!=s&&((s=""+s)!==e.value&&(e.value=s),null==t.defaultValue&&e.defaultValue!==s&&(e.defaultValue=s)),null!=n&&(e.defaultValue=""+n)}function le(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function oe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ie(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?oe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,de,ue=(de=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,s,n){MSApp.execUnsafeLocalFunction(function(){return de(e,t)})}:de);function me(e,t){if(t){var s=e.firstChild;if(s&&s===e.lastChild&&3===s.nodeType)return void(s.nodeValue=t)}e.textContent=t}var he={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pe=["Webkit","ms","Moz","O"];function xe(e,t,s){return null==t||"boolean"===typeof t||""===t?"":s||"number"!==typeof t||0===t||he.hasOwnProperty(e)&&he[e]?(""+t).trim():t+"px"}function ge(e,t){for(var s in e=e.style,t)if(t.hasOwnProperty(s)){var n=0===s.indexOf("--"),a=xe(s,t[s],n);"float"===s&&(s="cssFloat"),n?e.setProperty(s,a):e[s]=a}}Object.keys(he).forEach(function(e){pe.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),he[t]=he[e]})});var fe=I({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function be(e,t){if(t){if(fe[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(r(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(r(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(r(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(r(62))}}function ye(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ve=null;function je(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,Ne=null,ke=null;function Se(e){if(e=ya(e)){if("function"!==typeof we)throw Error(r(280));var t=e.stateNode;t&&(t=ja(t),we(e.stateNode,e.type,t))}}function Ce(e){Ne?ke?ke.push(e):ke=[e]:Ne=e}function _e(){if(Ne){var e=Ne,t=ke;if(ke=Ne=null,Se(e),t)for(e=0;e<t.length;e++)Se(t[e])}}function Ee(e,t){return e(t)}function Te(){}var Pe=!1;function Ae(e,t,s){if(Pe)return e(t,s);Pe=!0;try{return Ee(e,t,s)}finally{Pe=!1,(null!==Ne||null!==ke)&&(Te(),_e())}}function De(e,t){var s=e.stateNode;if(null===s)return null;var n=ja(s);if(null===n)return null;s=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(n=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!n;break e;default:e=!1}if(e)return null;if(s&&"function"!==typeof s)throw Error(r(231,t,typeof s));return s}var Le=!1;if(d)try{var Me={};Object.defineProperty(Me,"passive",{get:function(){Le=!0}}),window.addEventListener("test",Me,Me),window.removeEventListener("test",Me,Me)}catch(de){Le=!1}function Re(e,t,s,n,a,r,l,o,i){var c=Array.prototype.slice.call(arguments,3);try{t.apply(s,c)}catch(d){this.onError(d)}}var Fe=!1,Ie=null,Oe=!1,Be=null,Ue={onError:function(e){Fe=!0,Ie=e}};function ze(e,t,s,n,a,r,l,o,i){Fe=!1,Ie=null,Re.apply(Ue,arguments)}function Ve(e){var t=e,s=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(s=t.return),e=t.return}while(e)}return 3===t.tag?s:null}function We(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function qe(e){if(Ve(e)!==e)throw Error(r(188))}function He(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ve(e)))throw Error(r(188));return t!==e?null:e}for(var s=e,n=t;;){var a=s.return;if(null===a)break;var l=a.alternate;if(null===l){if(null!==(n=a.return)){s=n;continue}break}if(a.child===l.child){for(l=a.child;l;){if(l===s)return qe(a),e;if(l===n)return qe(a),t;l=l.sibling}throw Error(r(188))}if(s.return!==n.return)s=a,n=l;else{for(var o=!1,i=a.child;i;){if(i===s){o=!0,s=a,n=l;break}if(i===n){o=!0,n=a,s=l;break}i=i.sibling}if(!o){for(i=l.child;i;){if(i===s){o=!0,s=l,n=a;break}if(i===n){o=!0,n=l,s=a;break}i=i.sibling}if(!o)throw Error(r(189))}}if(s.alternate!==n)throw Error(r(190))}if(3!==s.tag)throw Error(r(188));return s.stateNode.current===s?e:t}(e))?Ye(e):null}function Ye(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ye(e);if(null!==t)return t;e=e.sibling}return null}var Ge=a.unstable_scheduleCallback,$e=a.unstable_cancelCallback,Qe=a.unstable_shouldYield,Ke=a.unstable_requestPaint,Je=a.unstable_now,Xe=a.unstable_getCurrentPriorityLevel,Ze=a.unstable_ImmediatePriority,et=a.unstable_UserBlockingPriority,tt=a.unstable_NormalPriority,st=a.unstable_LowPriority,nt=a.unstable_IdlePriority,at=null,rt=null;var lt=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(ot(e)/it|0)|0},ot=Math.log,it=Math.LN2;var ct=64,dt=4194304;function ut(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function mt(e,t){var s=e.pendingLanes;if(0===s)return 0;var n=0,a=e.suspendedLanes,r=e.pingedLanes,l=268435455&s;if(0!==l){var o=l&~a;0!==o?n=ut(o):0!==(r&=l)&&(n=ut(r))}else 0!==(l=s&~a)?n=ut(l):0!==r&&(n=ut(r));if(0===n)return 0;if(0!==t&&t!==n&&0===(t&a)&&((a=n&-n)>=(r=t&-t)||16===a&&0!==(4194240&r)))return t;if(0!==(4&n)&&(n|=16&s),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=n;0<t;)a=1<<(s=31-lt(t)),n|=e[s],t&=~a;return n}function ht(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function pt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function xt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function gt(e){for(var t=[],s=0;31>s;s++)t.push(e);return t}function ft(e,t,s){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-lt(t)]=s}function bt(e,t){var s=e.entangledLanes|=t;for(e=e.entanglements;s;){var n=31-lt(s),a=1<<n;a&t|e[n]&t&&(e[n]|=t),s&=~a}}var yt=0;function vt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var jt,wt,Nt,kt,St,Ct=!1,_t=[],Et=null,Tt=null,Pt=null,At=new Map,Dt=new Map,Lt=[],Mt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Rt(e,t){switch(e){case"focusin":case"focusout":Et=null;break;case"dragenter":case"dragleave":Tt=null;break;case"mouseover":case"mouseout":Pt=null;break;case"pointerover":case"pointerout":At.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Dt.delete(t.pointerId)}}function Ft(e,t,s,n,a,r){return null===e||e.nativeEvent!==r?(e={blockedOn:t,domEventName:s,eventSystemFlags:n,nativeEvent:r,targetContainers:[a]},null!==t&&(null!==(t=ya(t))&&wt(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,null!==a&&-1===t.indexOf(a)&&t.push(a),e)}function It(e){var t=ba(e.target);if(null!==t){var s=Ve(t);if(null!==s)if(13===(t=s.tag)){if(null!==(t=We(s)))return e.blockedOn=t,void St(e.priority,function(){Nt(s)})}else if(3===t&&s.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===s.tag?s.stateNode.containerInfo:null)}e.blockedOn=null}function Ot(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var s=Qt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==s)return null!==(t=ya(s))&&wt(t),e.blockedOn=s,!1;var n=new(s=e.nativeEvent).constructor(s.type,s);ve=n,s.target.dispatchEvent(n),ve=null,t.shift()}return!0}function Bt(e,t,s){Ot(e)&&s.delete(t)}function Ut(){Ct=!1,null!==Et&&Ot(Et)&&(Et=null),null!==Tt&&Ot(Tt)&&(Tt=null),null!==Pt&&Ot(Pt)&&(Pt=null),At.forEach(Bt),Dt.forEach(Bt)}function zt(e,t){e.blockedOn===t&&(e.blockedOn=null,Ct||(Ct=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,Ut)))}function Vt(e){function t(t){return zt(t,e)}if(0<_t.length){zt(_t[0],e);for(var s=1;s<_t.length;s++){var n=_t[s];n.blockedOn===e&&(n.blockedOn=null)}}for(null!==Et&&zt(Et,e),null!==Tt&&zt(Tt,e),null!==Pt&&zt(Pt,e),At.forEach(t),Dt.forEach(t),s=0;s<Lt.length;s++)(n=Lt[s]).blockedOn===e&&(n.blockedOn=null);for(;0<Lt.length&&null===(s=Lt[0]).blockedOn;)It(s),null===s.blockedOn&&Lt.shift()}var Wt=v.ReactCurrentBatchConfig,qt=!0;function Ht(e,t,s,n){var a=yt,r=Wt.transition;Wt.transition=null;try{yt=1,Gt(e,t,s,n)}finally{yt=a,Wt.transition=r}}function Yt(e,t,s,n){var a=yt,r=Wt.transition;Wt.transition=null;try{yt=4,Gt(e,t,s,n)}finally{yt=a,Wt.transition=r}}function Gt(e,t,s,n){if(qt){var a=Qt(e,t,s,n);if(null===a)qn(e,t,n,$t,s),Rt(e,n);else if(function(e,t,s,n,a){switch(t){case"focusin":return Et=Ft(Et,e,t,s,n,a),!0;case"dragenter":return Tt=Ft(Tt,e,t,s,n,a),!0;case"mouseover":return Pt=Ft(Pt,e,t,s,n,a),!0;case"pointerover":var r=a.pointerId;return At.set(r,Ft(At.get(r)||null,e,t,s,n,a)),!0;case"gotpointercapture":return r=a.pointerId,Dt.set(r,Ft(Dt.get(r)||null,e,t,s,n,a)),!0}return!1}(a,e,t,s,n))n.stopPropagation();else if(Rt(e,n),4&t&&-1<Mt.indexOf(e)){for(;null!==a;){var r=ya(a);if(null!==r&&jt(r),null===(r=Qt(e,t,s,n))&&qn(e,t,n,$t,s),r===a)break;a=r}null!==a&&n.stopPropagation()}else qn(e,t,n,null,s)}}var $t=null;function Qt(e,t,s,n){if($t=null,null!==(e=ba(e=je(n))))if(null===(t=Ve(e)))e=null;else if(13===(s=t.tag)){if(null!==(e=We(t)))return e;e=null}else if(3===s){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return $t=e,null}function Kt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Xe()){case Ze:return 1;case et:return 4;case tt:case st:return 16;case nt:return 536870912;default:return 16}default:return 16}}var Jt=null,Xt=null,Zt=null;function es(){if(Zt)return Zt;var e,t,s=Xt,n=s.length,a="value"in Jt?Jt.value:Jt.textContent,r=a.length;for(e=0;e<n&&s[e]===a[e];e++);var l=n-e;for(t=1;t<=l&&s[n-t]===a[r-t];t++);return Zt=a.slice(e,1<t?1-t:void 0)}function ts(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function ss(){return!0}function ns(){return!1}function as(e){function t(t,s,n,a,r){for(var l in this._reactName=t,this._targetInst=n,this.type=s,this.nativeEvent=a,this.target=r,this.currentTarget=null,e)e.hasOwnProperty(l)&&(t=e[l],this[l]=t?t(a):a[l]);return this.isDefaultPrevented=(null!=a.defaultPrevented?a.defaultPrevented:!1===a.returnValue)?ss:ns,this.isPropagationStopped=ns,this}return I(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=ss)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=ss)},persist:function(){},isPersistent:ss}),t}var rs,ls,os,is={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},cs=as(is),ds=I({},is,{view:0,detail:0}),us=as(ds),ms=I({},ds,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ks,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==os&&(os&&"mousemove"===e.type?(rs=e.screenX-os.screenX,ls=e.screenY-os.screenY):ls=rs=0,os=e),rs)},movementY:function(e){return"movementY"in e?e.movementY:ls}}),hs=as(ms),ps=as(I({},ms,{dataTransfer:0})),xs=as(I({},ds,{relatedTarget:0})),gs=as(I({},is,{animationName:0,elapsedTime:0,pseudoElement:0})),fs=I({},is,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),bs=as(fs),ys=as(I({},is,{data:0})),vs={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},js={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ws={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ns(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=ws[e])&&!!t[e]}function ks(){return Ns}var Ss=I({},ds,{key:function(e){if(e.key){var t=vs[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=ts(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?js[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ks,charCode:function(e){return"keypress"===e.type?ts(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?ts(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Cs=as(Ss),_s=as(I({},ms,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Es=as(I({},ds,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ks})),Ts=as(I({},is,{propertyName:0,elapsedTime:0,pseudoElement:0})),Ps=I({},ms,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),As=as(Ps),Ds=[9,13,27,32],Ls=d&&"CompositionEvent"in window,Ms=null;d&&"documentMode"in document&&(Ms=document.documentMode);var Rs=d&&"TextEvent"in window&&!Ms,Fs=d&&(!Ls||Ms&&8<Ms&&11>=Ms),Is=String.fromCharCode(32),Os=!1;function Bs(e,t){switch(e){case"keyup":return-1!==Ds.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Us(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var zs=!1;var Vs={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ws(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Vs[e.type]:"textarea"===t}function qs(e,t,s,n){Ce(n),0<(t=Yn(t,"onChange")).length&&(s=new cs("onChange","change",null,s,n),e.push({event:s,listeners:t}))}var Hs=null,Ys=null;function Gs(e){On(e,0)}function $s(e){if(G(va(e)))return e}function Qs(e,t){if("change"===e)return t}var Ks=!1;if(d){var Js;if(d){var Xs="oninput"in document;if(!Xs){var Zs=document.createElement("div");Zs.setAttribute("oninput","return;"),Xs="function"===typeof Zs.oninput}Js=Xs}else Js=!1;Ks=Js&&(!document.documentMode||9<document.documentMode)}function en(){Hs&&(Hs.detachEvent("onpropertychange",tn),Ys=Hs=null)}function tn(e){if("value"===e.propertyName&&$s(Ys)){var t=[];qs(t,Ys,e,je(e)),Ae(Gs,t)}}function sn(e,t,s){"focusin"===e?(en(),Ys=s,(Hs=t).attachEvent("onpropertychange",tn)):"focusout"===e&&en()}function nn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return $s(Ys)}function an(e,t){if("click"===e)return $s(t)}function rn(e,t){if("input"===e||"change"===e)return $s(t)}var ln="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function on(e,t){if(ln(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var s=Object.keys(e),n=Object.keys(t);if(s.length!==n.length)return!1;for(n=0;n<s.length;n++){var a=s[n];if(!u.call(t,a)||!ln(e[a],t[a]))return!1}return!0}function cn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function dn(e,t){var s,n=cn(e);for(e=0;n;){if(3===n.nodeType){if(s=e+n.textContent.length,e<=t&&s>=t)return{node:n,offset:t-e};e=s}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=cn(n)}}function un(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?un(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function mn(){for(var e=window,t=$();t instanceof e.HTMLIFrameElement;){try{var s="string"===typeof t.contentWindow.location.href}catch(n){s=!1}if(!s)break;t=$((e=t.contentWindow).document)}return t}function hn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function pn(e){var t=mn(),s=e.focusedElem,n=e.selectionRange;if(t!==s&&s&&s.ownerDocument&&un(s.ownerDocument.documentElement,s)){if(null!==n&&hn(s))if(t=n.start,void 0===(e=n.end)&&(e=t),"selectionStart"in s)s.selectionStart=t,s.selectionEnd=Math.min(e,s.value.length);else if((e=(t=s.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var a=s.textContent.length,r=Math.min(n.start,a);n=void 0===n.end?r:Math.min(n.end,a),!e.extend&&r>n&&(a=n,n=r,r=a),a=dn(s,r);var l=dn(s,n);a&&l&&(1!==e.rangeCount||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==l.node||e.focusOffset!==l.offset)&&((t=t.createRange()).setStart(a.node,a.offset),e.removeAllRanges(),r>n?(e.addRange(t),e.extend(l.node,l.offset)):(t.setEnd(l.node,l.offset),e.addRange(t)))}for(t=[],e=s;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof s.focus&&s.focus(),s=0;s<t.length;s++)(e=t[s]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var xn=d&&"documentMode"in document&&11>=document.documentMode,gn=null,fn=null,bn=null,yn=!1;function vn(e,t,s){var n=s.window===s?s.document:9===s.nodeType?s:s.ownerDocument;yn||null==gn||gn!==$(n)||("selectionStart"in(n=gn)&&hn(n)?n={start:n.selectionStart,end:n.selectionEnd}:n={anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},bn&&on(bn,n)||(bn=n,0<(n=Yn(fn,"onSelect")).length&&(t=new cs("onSelect","select",null,t,s),e.push({event:t,listeners:n}),t.target=gn)))}function jn(e,t){var s={};return s[e.toLowerCase()]=t.toLowerCase(),s["Webkit"+e]="webkit"+t,s["Moz"+e]="moz"+t,s}var wn={animationend:jn("Animation","AnimationEnd"),animationiteration:jn("Animation","AnimationIteration"),animationstart:jn("Animation","AnimationStart"),transitionend:jn("Transition","TransitionEnd")},Nn={},kn={};function Sn(e){if(Nn[e])return Nn[e];if(!wn[e])return e;var t,s=wn[e];for(t in s)if(s.hasOwnProperty(t)&&t in kn)return Nn[e]=s[t];return e}d&&(kn=document.createElement("div").style,"AnimationEvent"in window||(delete wn.animationend.animation,delete wn.animationiteration.animation,delete wn.animationstart.animation),"TransitionEvent"in window||delete wn.transitionend.transition);var Cn=Sn("animationend"),_n=Sn("animationiteration"),En=Sn("animationstart"),Tn=Sn("transitionend"),Pn=new Map,An="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Dn(e,t){Pn.set(e,t),i(t,[e])}for(var Ln=0;Ln<An.length;Ln++){var Mn=An[Ln];Dn(Mn.toLowerCase(),"on"+(Mn[0].toUpperCase()+Mn.slice(1)))}Dn(Cn,"onAnimationEnd"),Dn(_n,"onAnimationIteration"),Dn(En,"onAnimationStart"),Dn("dblclick","onDoubleClick"),Dn("focusin","onFocus"),Dn("focusout","onBlur"),Dn(Tn,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),i("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),i("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),i("onBeforeInput",["compositionend","keypress","textInput","paste"]),i("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Rn="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Fn=new Set("cancel close invalid load scroll toggle".split(" ").concat(Rn));function In(e,t,s){var n=e.type||"unknown-event";e.currentTarget=s,function(e,t,s,n,a,l,o,i,c){if(ze.apply(this,arguments),Fe){if(!Fe)throw Error(r(198));var d=Ie;Fe=!1,Ie=null,Oe||(Oe=!0,Be=d)}}(n,t,void 0,e),e.currentTarget=null}function On(e,t){t=0!==(4&t);for(var s=0;s<e.length;s++){var n=e[s],a=n.event;n=n.listeners;e:{var r=void 0;if(t)for(var l=n.length-1;0<=l;l--){var o=n[l],i=o.instance,c=o.currentTarget;if(o=o.listener,i!==r&&a.isPropagationStopped())break e;In(a,o,c),r=i}else for(l=0;l<n.length;l++){if(i=(o=n[l]).instance,c=o.currentTarget,o=o.listener,i!==r&&a.isPropagationStopped())break e;In(a,o,c),r=i}}}if(Oe)throw e=Be,Oe=!1,Be=null,e}function Bn(e,t){var s=t[xa];void 0===s&&(s=t[xa]=new Set);var n=e+"__bubble";s.has(n)||(Wn(t,e,2,!1),s.add(n))}function Un(e,t,s){var n=0;t&&(n|=4),Wn(s,e,n,t)}var zn="_reactListening"+Math.random().toString(36).slice(2);function Vn(e){if(!e[zn]){e[zn]=!0,l.forEach(function(t){"selectionchange"!==t&&(Fn.has(t)||Un(t,!1,e),Un(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[zn]||(t[zn]=!0,Un("selectionchange",!1,t))}}function Wn(e,t,s,n){switch(Kt(t)){case 1:var a=Ht;break;case 4:a=Yt;break;default:a=Gt}s=a.bind(null,t,s,e),a=void 0,!Le||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(a=!0),n?void 0!==a?e.addEventListener(t,s,{capture:!0,passive:a}):e.addEventListener(t,s,!0):void 0!==a?e.addEventListener(t,s,{passive:a}):e.addEventListener(t,s,!1)}function qn(e,t,s,n,a){var r=n;if(0===(1&t)&&0===(2&t)&&null!==n)e:for(;;){if(null===n)return;var l=n.tag;if(3===l||4===l){var o=n.stateNode.containerInfo;if(o===a||8===o.nodeType&&o.parentNode===a)break;if(4===l)for(l=n.return;null!==l;){var i=l.tag;if((3===i||4===i)&&((i=l.stateNode.containerInfo)===a||8===i.nodeType&&i.parentNode===a))return;l=l.return}for(;null!==o;){if(null===(l=ba(o)))return;if(5===(i=l.tag)||6===i){n=r=l;continue e}o=o.parentNode}}n=n.return}Ae(function(){var n=r,a=je(s),l=[];e:{var o=Pn.get(e);if(void 0!==o){var i=cs,c=e;switch(e){case"keypress":if(0===ts(s))break e;case"keydown":case"keyup":i=Cs;break;case"focusin":c="focus",i=xs;break;case"focusout":c="blur",i=xs;break;case"beforeblur":case"afterblur":i=xs;break;case"click":if(2===s.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":i=hs;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":i=ps;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":i=Es;break;case Cn:case _n:case En:i=gs;break;case Tn:i=Ts;break;case"scroll":i=us;break;case"wheel":i=As;break;case"copy":case"cut":case"paste":i=bs;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":i=_s}var d=0!==(4&t),u=!d&&"scroll"===e,m=d?null!==o?o+"Capture":null:o;d=[];for(var h,p=n;null!==p;){var x=(h=p).stateNode;if(5===h.tag&&null!==x&&(h=x,null!==m&&(null!=(x=De(p,m))&&d.push(Hn(p,x,h)))),u)break;p=p.return}0<d.length&&(o=new i(o,c,null,s,a),l.push({event:o,listeners:d}))}}if(0===(7&t)){if(i="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||s===ve||!(c=s.relatedTarget||s.fromElement)||!ba(c)&&!c[pa])&&(i||o)&&(o=a.window===a?a:(o=a.ownerDocument)?o.defaultView||o.parentWindow:window,i?(i=n,null!==(c=(c=s.relatedTarget||s.toElement)?ba(c):null)&&(c!==(u=Ve(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(i=null,c=n),i!==c)){if(d=hs,x="onMouseLeave",m="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(d=_s,x="onPointerLeave",m="onPointerEnter",p="pointer"),u=null==i?o:va(i),h=null==c?o:va(c),(o=new d(x,p+"leave",i,s,a)).target=u,o.relatedTarget=h,x=null,ba(a)===n&&((d=new d(m,p+"enter",c,s,a)).target=h,d.relatedTarget=u,x=d),u=x,i&&c)e:{for(m=c,p=0,h=d=i;h;h=Gn(h))p++;for(h=0,x=m;x;x=Gn(x))h++;for(;0<p-h;)d=Gn(d),p--;for(;0<h-p;)m=Gn(m),h--;for(;p--;){if(d===m||null!==m&&d===m.alternate)break e;d=Gn(d),m=Gn(m)}d=null}else d=null;null!==i&&$n(l,o,i,d,!1),null!==c&&null!==u&&$n(l,u,c,d,!0)}if("select"===(i=(o=n?va(n):window).nodeName&&o.nodeName.toLowerCase())||"input"===i&&"file"===o.type)var g=Qs;else if(Ws(o))if(Ks)g=rn;else{g=nn;var f=sn}else(i=o.nodeName)&&"input"===i.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(g=an);switch(g&&(g=g(e,n))?qs(l,g,s,a):(f&&f(e,o,n),"focusout"===e&&(f=o._wrapperState)&&f.controlled&&"number"===o.type&&ee(o,"number",o.value)),f=n?va(n):window,e){case"focusin":(Ws(f)||"true"===f.contentEditable)&&(gn=f,fn=n,bn=null);break;case"focusout":bn=fn=gn=null;break;case"mousedown":yn=!0;break;case"contextmenu":case"mouseup":case"dragend":yn=!1,vn(l,s,a);break;case"selectionchange":if(xn)break;case"keydown":case"keyup":vn(l,s,a)}var b;if(Ls)e:{switch(e){case"compositionstart":var y="onCompositionStart";break e;case"compositionend":y="onCompositionEnd";break e;case"compositionupdate":y="onCompositionUpdate";break e}y=void 0}else zs?Bs(e,s)&&(y="onCompositionEnd"):"keydown"===e&&229===s.keyCode&&(y="onCompositionStart");y&&(Fs&&"ko"!==s.locale&&(zs||"onCompositionStart"!==y?"onCompositionEnd"===y&&zs&&(b=es()):(Xt="value"in(Jt=a)?Jt.value:Jt.textContent,zs=!0)),0<(f=Yn(n,y)).length&&(y=new ys(y,e,null,s,a),l.push({event:y,listeners:f}),b?y.data=b:null!==(b=Us(s))&&(y.data=b))),(b=Rs?function(e,t){switch(e){case"compositionend":return Us(t);case"keypress":return 32!==t.which?null:(Os=!0,Is);case"textInput":return(e=t.data)===Is&&Os?null:e;default:return null}}(e,s):function(e,t){if(zs)return"compositionend"===e||!Ls&&Bs(e,t)?(e=es(),Zt=Xt=Jt=null,zs=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Fs&&"ko"!==t.locale?null:t.data}}(e,s))&&(0<(n=Yn(n,"onBeforeInput")).length&&(a=new ys("onBeforeInput","beforeinput",null,s,a),l.push({event:a,listeners:n}),a.data=b))}On(l,t)})}function Hn(e,t,s){return{instance:e,listener:t,currentTarget:s}}function Yn(e,t){for(var s=t+"Capture",n=[];null!==e;){var a=e,r=a.stateNode;5===a.tag&&null!==r&&(a=r,null!=(r=De(e,s))&&n.unshift(Hn(e,r,a)),null!=(r=De(e,t))&&n.push(Hn(e,r,a))),e=e.return}return n}function Gn(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function $n(e,t,s,n,a){for(var r=t._reactName,l=[];null!==s&&s!==n;){var o=s,i=o.alternate,c=o.stateNode;if(null!==i&&i===n)break;5===o.tag&&null!==c&&(o=c,a?null!=(i=De(s,r))&&l.unshift(Hn(s,i,o)):a||null!=(i=De(s,r))&&l.push(Hn(s,i,o))),s=s.return}0!==l.length&&e.push({event:t,listeners:l})}var Qn=/\r\n?/g,Kn=/\u0000|\uFFFD/g;function Jn(e){return("string"===typeof e?e:""+e).replace(Qn,"\n").replace(Kn,"")}function Xn(e,t,s){if(t=Jn(t),Jn(e)!==t&&s)throw Error(r(425))}function Zn(){}var ea=null,ta=null;function sa(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var na="function"===typeof setTimeout?setTimeout:void 0,aa="function"===typeof clearTimeout?clearTimeout:void 0,ra="function"===typeof Promise?Promise:void 0,la="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ra?function(e){return ra.resolve(null).then(e).catch(oa)}:na;function oa(e){setTimeout(function(){throw e})}function ia(e,t){var s=t,n=0;do{var a=s.nextSibling;if(e.removeChild(s),a&&8===a.nodeType)if("/$"===(s=a.data)){if(0===n)return e.removeChild(a),void Vt(t);n--}else"$"!==s&&"$?"!==s&&"$!"!==s||n++;s=a}while(s);Vt(t)}function ca(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function da(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var s=e.data;if("$"===s||"$!"===s||"$?"===s){if(0===t)return e;t--}else"/$"===s&&t++}e=e.previousSibling}return null}var ua=Math.random().toString(36).slice(2),ma="__reactFiber$"+ua,ha="__reactProps$"+ua,pa="__reactContainer$"+ua,xa="__reactEvents$"+ua,ga="__reactListeners$"+ua,fa="__reactHandles$"+ua;function ba(e){var t=e[ma];if(t)return t;for(var s=e.parentNode;s;){if(t=s[pa]||s[ma]){if(s=t.alternate,null!==t.child||null!==s&&null!==s.child)for(e=da(e);null!==e;){if(s=e[ma])return s;e=da(e)}return t}s=(e=s).parentNode}return null}function ya(e){return!(e=e[ma]||e[pa])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function va(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(r(33))}function ja(e){return e[ha]||null}var wa=[],Na=-1;function ka(e){return{current:e}}function Sa(e){0>Na||(e.current=wa[Na],wa[Na]=null,Na--)}function Ca(e,t){Na++,wa[Na]=e.current,e.current=t}var _a={},Ea=ka(_a),Ta=ka(!1),Pa=_a;function Aa(e,t){var s=e.type.contextTypes;if(!s)return _a;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var a,r={};for(a in s)r[a]=t[a];return n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=r),r}function Da(e){return null!==(e=e.childContextTypes)&&void 0!==e}function La(){Sa(Ta),Sa(Ea)}function Ma(e,t,s){if(Ea.current!==_a)throw Error(r(168));Ca(Ea,t),Ca(Ta,s)}function Ra(e,t,s){var n=e.stateNode;if(t=t.childContextTypes,"function"!==typeof n.getChildContext)return s;for(var a in n=n.getChildContext())if(!(a in t))throw Error(r(108,W(e)||"Unknown",a));return I({},s,n)}function Fa(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||_a,Pa=Ea.current,Ca(Ea,e),Ca(Ta,Ta.current),!0}function Ia(e,t,s){var n=e.stateNode;if(!n)throw Error(r(169));s?(e=Ra(e,t,Pa),n.__reactInternalMemoizedMergedChildContext=e,Sa(Ta),Sa(Ea),Ca(Ea,e)):Sa(Ta),Ca(Ta,s)}var Oa=null,Ba=!1,Ua=!1;function za(e){null===Oa?Oa=[e]:Oa.push(e)}function Va(){if(!Ua&&null!==Oa){Ua=!0;var e=0,t=yt;try{var s=Oa;for(yt=1;e<s.length;e++){var n=s[e];do{n=n(!0)}while(null!==n)}Oa=null,Ba=!1}catch(a){throw null!==Oa&&(Oa=Oa.slice(e+1)),Ge(Ze,Va),a}finally{yt=t,Ua=!1}}return null}var Wa=[],qa=0,Ha=null,Ya=0,Ga=[],$a=0,Qa=null,Ka=1,Ja="";function Xa(e,t){Wa[qa++]=Ya,Wa[qa++]=Ha,Ha=e,Ya=t}function Za(e,t,s){Ga[$a++]=Ka,Ga[$a++]=Ja,Ga[$a++]=Qa,Qa=e;var n=Ka;e=Ja;var a=32-lt(n)-1;n&=~(1<<a),s+=1;var r=32-lt(t)+a;if(30<r){var l=a-a%5;r=(n&(1<<l)-1).toString(32),n>>=l,a-=l,Ka=1<<32-lt(t)+a|s<<a|n,Ja=r+e}else Ka=1<<r|s<<a|n,Ja=e}function er(e){null!==e.return&&(Xa(e,1),Za(e,1,0))}function tr(e){for(;e===Ha;)Ha=Wa[--qa],Wa[qa]=null,Ya=Wa[--qa],Wa[qa]=null;for(;e===Qa;)Qa=Ga[--$a],Ga[$a]=null,Ja=Ga[--$a],Ga[$a]=null,Ka=Ga[--$a],Ga[$a]=null}var sr=null,nr=null,ar=!1,rr=null;function lr(e,t){var s=Ac(5,null,null,0);s.elementType="DELETED",s.stateNode=t,s.return=e,null===(t=e.deletions)?(e.deletions=[s],e.flags|=16):t.push(s)}function or(e,t){switch(e.tag){case 5:var s=e.type;return null!==(t=1!==t.nodeType||s.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,sr=e,nr=ca(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,sr=e,nr=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(s=null!==Qa?{id:Ka,overflow:Ja}:null,e.memoizedState={dehydrated:t,treeContext:s,retryLane:1073741824},(s=Ac(18,null,null,0)).stateNode=t,s.return=e,e.child=s,sr=e,nr=null,!0);default:return!1}}function ir(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function cr(e){if(ar){var t=nr;if(t){var s=t;if(!or(e,t)){if(ir(e))throw Error(r(418));t=ca(s.nextSibling);var n=sr;t&&or(e,t)?lr(n,s):(e.flags=-4097&e.flags|2,ar=!1,sr=e)}}else{if(ir(e))throw Error(r(418));e.flags=-4097&e.flags|2,ar=!1,sr=e}}}function dr(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;sr=e}function ur(e){if(e!==sr)return!1;if(!ar)return dr(e),ar=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!sa(e.type,e.memoizedProps)),t&&(t=nr)){if(ir(e))throw mr(),Error(r(418));for(;t;)lr(e,t),t=ca(t.nextSibling)}if(dr(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(r(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var s=e.data;if("/$"===s){if(0===t){nr=ca(e.nextSibling);break e}t--}else"$"!==s&&"$!"!==s&&"$?"!==s||t++}e=e.nextSibling}nr=null}}else nr=sr?ca(e.stateNode.nextSibling):null;return!0}function mr(){for(var e=nr;e;)e=ca(e.nextSibling)}function hr(){nr=sr=null,ar=!1}function pr(e){null===rr?rr=[e]:rr.push(e)}var xr=v.ReactCurrentBatchConfig;function gr(e,t,s){if(null!==(e=s.ref)&&"function"!==typeof e&&"object"!==typeof e){if(s._owner){if(s=s._owner){if(1!==s.tag)throw Error(r(309));var n=s.stateNode}if(!n)throw Error(r(147,e));var a=n,l=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===l?t.ref:(t=function(e){var t=a.refs;null===e?delete t[l]:t[l]=e},t._stringRef=l,t)}if("string"!==typeof e)throw Error(r(284));if(!s._owner)throw Error(r(290,e))}return e}function fr(e,t){throw e=Object.prototype.toString.call(t),Error(r(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function br(e){return(0,e._init)(e._payload)}function yr(e){function t(t,s){if(e){var n=t.deletions;null===n?(t.deletions=[s],t.flags|=16):n.push(s)}}function s(s,n){if(!e)return null;for(;null!==n;)t(s,n),n=n.sibling;return null}function n(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function a(e,t){return(e=Lc(e,t)).index=0,e.sibling=null,e}function l(t,s,n){return t.index=n,e?null!==(n=t.alternate)?(n=n.index)<s?(t.flags|=2,s):n:(t.flags|=2,s):(t.flags|=1048576,s)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function i(e,t,s,n){return null===t||6!==t.tag?((t=Ic(s,e.mode,n)).return=e,t):((t=a(t,s)).return=e,t)}function c(e,t,s,n){var r=s.type;return r===N?u(e,t,s.props.children,n,s.key):null!==t&&(t.elementType===r||"object"===typeof r&&null!==r&&r.$$typeof===D&&br(r)===t.type)?((n=a(t,s.props)).ref=gr(e,t,s),n.return=e,n):((n=Mc(s.type,s.key,s.props,null,e.mode,n)).ref=gr(e,t,s),n.return=e,n)}function d(e,t,s,n){return null===t||4!==t.tag||t.stateNode.containerInfo!==s.containerInfo||t.stateNode.implementation!==s.implementation?((t=Oc(s,e.mode,n)).return=e,t):((t=a(t,s.children||[])).return=e,t)}function u(e,t,s,n,r){return null===t||7!==t.tag?((t=Rc(s,e.mode,n,r)).return=e,t):((t=a(t,s)).return=e,t)}function m(e,t,s){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Ic(""+t,e.mode,s)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case j:return(s=Mc(t.type,t.key,t.props,null,e.mode,s)).ref=gr(e,null,t),s.return=e,s;case w:return(t=Oc(t,e.mode,s)).return=e,t;case D:return m(e,(0,t._init)(t._payload),s)}if(te(t)||R(t))return(t=Rc(t,e.mode,s,null)).return=e,t;fr(e,t)}return null}function h(e,t,s,n){var a=null!==t?t.key:null;if("string"===typeof s&&""!==s||"number"===typeof s)return null!==a?null:i(e,t,""+s,n);if("object"===typeof s&&null!==s){switch(s.$$typeof){case j:return s.key===a?c(e,t,s,n):null;case w:return s.key===a?d(e,t,s,n):null;case D:return h(e,t,(a=s._init)(s._payload),n)}if(te(s)||R(s))return null!==a?null:u(e,t,s,n,null);fr(e,s)}return null}function p(e,t,s,n,a){if("string"===typeof n&&""!==n||"number"===typeof n)return i(t,e=e.get(s)||null,""+n,a);if("object"===typeof n&&null!==n){switch(n.$$typeof){case j:return c(t,e=e.get(null===n.key?s:n.key)||null,n,a);case w:return d(t,e=e.get(null===n.key?s:n.key)||null,n,a);case D:return p(e,t,s,(0,n._init)(n._payload),a)}if(te(n)||R(n))return u(t,e=e.get(s)||null,n,a,null);fr(t,n)}return null}function x(a,r,o,i){for(var c=null,d=null,u=r,x=r=0,g=null;null!==u&&x<o.length;x++){u.index>x?(g=u,u=null):g=u.sibling;var f=h(a,u,o[x],i);if(null===f){null===u&&(u=g);break}e&&u&&null===f.alternate&&t(a,u),r=l(f,r,x),null===d?c=f:d.sibling=f,d=f,u=g}if(x===o.length)return s(a,u),ar&&Xa(a,x),c;if(null===u){for(;x<o.length;x++)null!==(u=m(a,o[x],i))&&(r=l(u,r,x),null===d?c=u:d.sibling=u,d=u);return ar&&Xa(a,x),c}for(u=n(a,u);x<o.length;x++)null!==(g=p(u,a,x,o[x],i))&&(e&&null!==g.alternate&&u.delete(null===g.key?x:g.key),r=l(g,r,x),null===d?c=g:d.sibling=g,d=g);return e&&u.forEach(function(e){return t(a,e)}),ar&&Xa(a,x),c}function g(a,o,i,c){var d=R(i);if("function"!==typeof d)throw Error(r(150));if(null==(i=d.call(i)))throw Error(r(151));for(var u=d=null,x=o,g=o=0,f=null,b=i.next();null!==x&&!b.done;g++,b=i.next()){x.index>g?(f=x,x=null):f=x.sibling;var y=h(a,x,b.value,c);if(null===y){null===x&&(x=f);break}e&&x&&null===y.alternate&&t(a,x),o=l(y,o,g),null===u?d=y:u.sibling=y,u=y,x=f}if(b.done)return s(a,x),ar&&Xa(a,g),d;if(null===x){for(;!b.done;g++,b=i.next())null!==(b=m(a,b.value,c))&&(o=l(b,o,g),null===u?d=b:u.sibling=b,u=b);return ar&&Xa(a,g),d}for(x=n(a,x);!b.done;g++,b=i.next())null!==(b=p(x,a,g,b.value,c))&&(e&&null!==b.alternate&&x.delete(null===b.key?g:b.key),o=l(b,o,g),null===u?d=b:u.sibling=b,u=b);return e&&x.forEach(function(e){return t(a,e)}),ar&&Xa(a,g),d}return function e(n,r,l,i){if("object"===typeof l&&null!==l&&l.type===N&&null===l.key&&(l=l.props.children),"object"===typeof l&&null!==l){switch(l.$$typeof){case j:e:{for(var c=l.key,d=r;null!==d;){if(d.key===c){if((c=l.type)===N){if(7===d.tag){s(n,d.sibling),(r=a(d,l.props.children)).return=n,n=r;break e}}else if(d.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===D&&br(c)===d.type){s(n,d.sibling),(r=a(d,l.props)).ref=gr(n,d,l),r.return=n,n=r;break e}s(n,d);break}t(n,d),d=d.sibling}l.type===N?((r=Rc(l.props.children,n.mode,i,l.key)).return=n,n=r):((i=Mc(l.type,l.key,l.props,null,n.mode,i)).ref=gr(n,r,l),i.return=n,n=i)}return o(n);case w:e:{for(d=l.key;null!==r;){if(r.key===d){if(4===r.tag&&r.stateNode.containerInfo===l.containerInfo&&r.stateNode.implementation===l.implementation){s(n,r.sibling),(r=a(r,l.children||[])).return=n,n=r;break e}s(n,r);break}t(n,r),r=r.sibling}(r=Oc(l,n.mode,i)).return=n,n=r}return o(n);case D:return e(n,r,(d=l._init)(l._payload),i)}if(te(l))return x(n,r,l,i);if(R(l))return g(n,r,l,i);fr(n,l)}return"string"===typeof l&&""!==l||"number"===typeof l?(l=""+l,null!==r&&6===r.tag?(s(n,r.sibling),(r=a(r,l)).return=n,n=r):(s(n,r),(r=Ic(l,n.mode,i)).return=n,n=r),o(n)):s(n,r)}}var vr=yr(!0),jr=yr(!1),wr=ka(null),Nr=null,kr=null,Sr=null;function Cr(){Sr=kr=Nr=null}function _r(e){var t=wr.current;Sa(wr),e._currentValue=t}function Er(e,t,s){for(;null!==e;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==n&&(n.childLanes|=t)):null!==n&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===s)break;e=e.return}}function Tr(e,t){Nr=e,Sr=kr=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(yo=!0),e.firstContext=null)}function Pr(e){var t=e._currentValue;if(Sr!==e)if(e={context:e,memoizedValue:t,next:null},null===kr){if(null===Nr)throw Error(r(308));kr=e,Nr.dependencies={lanes:0,firstContext:e}}else kr=kr.next=e;return t}var Ar=null;function Dr(e){null===Ar?Ar=[e]:Ar.push(e)}function Lr(e,t,s,n){var a=t.interleaved;return null===a?(s.next=s,Dr(t)):(s.next=a.next,a.next=s),t.interleaved=s,Mr(e,n)}function Mr(e,t){e.lanes|=t;var s=e.alternate;for(null!==s&&(s.lanes|=t),s=e,e=e.return;null!==e;)e.childLanes|=t,null!==(s=e.alternate)&&(s.childLanes|=t),s=e,e=e.return;return 3===s.tag?s.stateNode:null}var Rr=!1;function Fr(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ir(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Or(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Br(e,t,s){var n=e.updateQueue;if(null===n)return null;if(n=n.shared,0!==(2&Ei)){var a=n.pending;return null===a?t.next=t:(t.next=a.next,a.next=t),n.pending=t,Mr(e,s)}return null===(a=n.interleaved)?(t.next=t,Dr(n)):(t.next=a.next,a.next=t),n.interleaved=t,Mr(e,s)}function Ur(e,t,s){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&s))){var n=t.lanes;s|=n&=e.pendingLanes,t.lanes=s,bt(e,s)}}function zr(e,t){var s=e.updateQueue,n=e.alternate;if(null!==n&&s===(n=n.updateQueue)){var a=null,r=null;if(null!==(s=s.firstBaseUpdate)){do{var l={eventTime:s.eventTime,lane:s.lane,tag:s.tag,payload:s.payload,callback:s.callback,next:null};null===r?a=r=l:r=r.next=l,s=s.next}while(null!==s);null===r?a=r=t:r=r.next=t}else a=r=t;return s={baseState:n.baseState,firstBaseUpdate:a,lastBaseUpdate:r,shared:n.shared,effects:n.effects},void(e.updateQueue=s)}null===(e=s.lastBaseUpdate)?s.firstBaseUpdate=t:e.next=t,s.lastBaseUpdate=t}function Vr(e,t,s,n){var a=e.updateQueue;Rr=!1;var r=a.firstBaseUpdate,l=a.lastBaseUpdate,o=a.shared.pending;if(null!==o){a.shared.pending=null;var i=o,c=i.next;i.next=null,null===l?r=c:l.next=c,l=i;var d=e.alternate;null!==d&&((o=(d=d.updateQueue).lastBaseUpdate)!==l&&(null===o?d.firstBaseUpdate=c:o.next=c,d.lastBaseUpdate=i))}if(null!==r){var u=a.baseState;for(l=0,d=c=i=null,o=r;;){var m=o.lane,h=o.eventTime;if((n&m)===m){null!==d&&(d=d.next={eventTime:h,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var p=e,x=o;switch(m=t,h=s,x.tag){case 1:if("function"===typeof(p=x.payload)){u=p.call(h,u,m);break e}u=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(m="function"===typeof(p=x.payload)?p.call(h,u,m):p)||void 0===m)break e;u=I({},u,m);break e;case 2:Rr=!0}}null!==o.callback&&0!==o.lane&&(e.flags|=64,null===(m=a.effects)?a.effects=[o]:m.push(o))}else h={eventTime:h,lane:m,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===d?(c=d=h,i=u):d=d.next=h,l|=m;if(null===(o=o.next)){if(null===(o=a.shared.pending))break;o=(m=o).next,m.next=null,a.lastBaseUpdate=m,a.shared.pending=null}}if(null===d&&(i=u),a.baseState=i,a.firstBaseUpdate=c,a.lastBaseUpdate=d,null!==(t=a.shared.interleaved)){a=t;do{l|=a.lane,a=a.next}while(a!==t)}else null===r&&(a.shared.lanes=0);Fi|=l,e.lanes=l,e.memoizedState=u}}function Wr(e,t,s){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var n=e[t],a=n.callback;if(null!==a){if(n.callback=null,n=s,"function"!==typeof a)throw Error(r(191,a));a.call(n)}}}var qr={},Hr=ka(qr),Yr=ka(qr),Gr=ka(qr);function $r(e){if(e===qr)throw Error(r(174));return e}function Qr(e,t){switch(Ca(Gr,t),Ca(Yr,e),Ca(Hr,qr),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ie(null,"");break;default:t=ie(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Sa(Hr),Ca(Hr,t)}function Kr(){Sa(Hr),Sa(Yr),Sa(Gr)}function Jr(e){$r(Gr.current);var t=$r(Hr.current),s=ie(t,e.type);t!==s&&(Ca(Yr,e),Ca(Hr,s))}function Xr(e){Yr.current===e&&(Sa(Hr),Sa(Yr))}var Zr=ka(0);function el(e){for(var t=e;null!==t;){if(13===t.tag){var s=t.memoizedState;if(null!==s&&(null===(s=s.dehydrated)||"$?"===s.data||"$!"===s.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var tl=[];function sl(){for(var e=0;e<tl.length;e++)tl[e]._workInProgressVersionPrimary=null;tl.length=0}var nl=v.ReactCurrentDispatcher,al=v.ReactCurrentBatchConfig,rl=0,ll=null,ol=null,il=null,cl=!1,dl=!1,ul=0,ml=0;function hl(){throw Error(r(321))}function pl(e,t){if(null===t)return!1;for(var s=0;s<t.length&&s<e.length;s++)if(!ln(e[s],t[s]))return!1;return!0}function xl(e,t,s,n,a,l){if(rl=l,ll=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,nl.current=null===e||null===e.memoizedState?Xl:Zl,e=s(n,a),dl){l=0;do{if(dl=!1,ul=0,25<=l)throw Error(r(301));l+=1,il=ol=null,t.updateQueue=null,nl.current=eo,e=s(n,a)}while(dl)}if(nl.current=Jl,t=null!==ol&&null!==ol.next,rl=0,il=ol=ll=null,cl=!1,t)throw Error(r(300));return e}function gl(){var e=0!==ul;return ul=0,e}function fl(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===il?ll.memoizedState=il=e:il=il.next=e,il}function bl(){if(null===ol){var e=ll.alternate;e=null!==e?e.memoizedState:null}else e=ol.next;var t=null===il?ll.memoizedState:il.next;if(null!==t)il=t,ol=e;else{if(null===e)throw Error(r(310));e={memoizedState:(ol=e).memoizedState,baseState:ol.baseState,baseQueue:ol.baseQueue,queue:ol.queue,next:null},null===il?ll.memoizedState=il=e:il=il.next=e}return il}function yl(e,t){return"function"===typeof t?t(e):t}function vl(e){var t=bl(),s=t.queue;if(null===s)throw Error(r(311));s.lastRenderedReducer=e;var n=ol,a=n.baseQueue,l=s.pending;if(null!==l){if(null!==a){var o=a.next;a.next=l.next,l.next=o}n.baseQueue=a=l,s.pending=null}if(null!==a){l=a.next,n=n.baseState;var i=o=null,c=null,d=l;do{var u=d.lane;if((rl&u)===u)null!==c&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),n=d.hasEagerState?d.eagerState:e(n,d.action);else{var m={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};null===c?(i=c=m,o=n):c=c.next=m,ll.lanes|=u,Fi|=u}d=d.next}while(null!==d&&d!==l);null===c?o=n:c.next=i,ln(n,t.memoizedState)||(yo=!0),t.memoizedState=n,t.baseState=o,t.baseQueue=c,s.lastRenderedState=n}if(null!==(e=s.interleaved)){a=e;do{l=a.lane,ll.lanes|=l,Fi|=l,a=a.next}while(a!==e)}else null===a&&(s.lanes=0);return[t.memoizedState,s.dispatch]}function jl(e){var t=bl(),s=t.queue;if(null===s)throw Error(r(311));s.lastRenderedReducer=e;var n=s.dispatch,a=s.pending,l=t.memoizedState;if(null!==a){s.pending=null;var o=a=a.next;do{l=e(l,o.action),o=o.next}while(o!==a);ln(l,t.memoizedState)||(yo=!0),t.memoizedState=l,null===t.baseQueue&&(t.baseState=l),s.lastRenderedState=l}return[l,n]}function wl(){}function Nl(e,t){var s=ll,n=bl(),a=t(),l=!ln(n.memoizedState,a);if(l&&(n.memoizedState=a,yo=!0),n=n.queue,Rl(Cl.bind(null,s,n,e),[e]),n.getSnapshot!==t||l||null!==il&&1&il.memoizedState.tag){if(s.flags|=2048,Pl(9,Sl.bind(null,s,n,a,t),void 0,null),null===Ti)throw Error(r(349));0!==(30&rl)||kl(s,t,a)}return a}function kl(e,t,s){e.flags|=16384,e={getSnapshot:t,value:s},null===(t=ll.updateQueue)?(t={lastEffect:null,stores:null},ll.updateQueue=t,t.stores=[e]):null===(s=t.stores)?t.stores=[e]:s.push(e)}function Sl(e,t,s,n){t.value=s,t.getSnapshot=n,_l(t)&&El(e)}function Cl(e,t,s){return s(function(){_l(t)&&El(e)})}function _l(e){var t=e.getSnapshot;e=e.value;try{var s=t();return!ln(e,s)}catch(n){return!0}}function El(e){var t=Mr(e,1);null!==t&&sc(t,e,1,-1)}function Tl(e){var t=fl();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:yl,lastRenderedState:e},t.queue=e,e=e.dispatch=Gl.bind(null,ll,e),[t.memoizedState,e]}function Pl(e,t,s,n){return e={tag:e,create:t,destroy:s,deps:n,next:null},null===(t=ll.updateQueue)?(t={lastEffect:null,stores:null},ll.updateQueue=t,t.lastEffect=e.next=e):null===(s=t.lastEffect)?t.lastEffect=e.next=e:(n=s.next,s.next=e,e.next=n,t.lastEffect=e),e}function Al(){return bl().memoizedState}function Dl(e,t,s,n){var a=fl();ll.flags|=e,a.memoizedState=Pl(1|t,s,void 0,void 0===n?null:n)}function Ll(e,t,s,n){var a=bl();n=void 0===n?null:n;var r=void 0;if(null!==ol){var l=ol.memoizedState;if(r=l.destroy,null!==n&&pl(n,l.deps))return void(a.memoizedState=Pl(t,s,r,n))}ll.flags|=e,a.memoizedState=Pl(1|t,s,r,n)}function Ml(e,t){return Dl(8390656,8,e,t)}function Rl(e,t){return Ll(2048,8,e,t)}function Fl(e,t){return Ll(4,2,e,t)}function Il(e,t){return Ll(4,4,e,t)}function Ol(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Bl(e,t,s){return s=null!==s&&void 0!==s?s.concat([e]):null,Ll(4,4,Ol.bind(null,t,e),s)}function Ul(){}function zl(e,t){var s=bl();t=void 0===t?null:t;var n=s.memoizedState;return null!==n&&null!==t&&pl(t,n[1])?n[0]:(s.memoizedState=[e,t],e)}function Vl(e,t){var s=bl();t=void 0===t?null:t;var n=s.memoizedState;return null!==n&&null!==t&&pl(t,n[1])?n[0]:(e=e(),s.memoizedState=[e,t],e)}function Wl(e,t,s){return 0===(21&rl)?(e.baseState&&(e.baseState=!1,yo=!0),e.memoizedState=s):(ln(s,t)||(s=xt(),ll.lanes|=s,Fi|=s,e.baseState=!0),t)}function ql(e,t){var s=yt;yt=0!==s&&4>s?s:4,e(!0);var n=al.transition;al.transition={};try{e(!1),t()}finally{yt=s,al.transition=n}}function Hl(){return bl().memoizedState}function Yl(e,t,s){var n=tc(e);if(s={lane:n,action:s,hasEagerState:!1,eagerState:null,next:null},$l(e))Ql(t,s);else if(null!==(s=Lr(e,t,s,n))){sc(s,e,n,ec()),Kl(s,t,n)}}function Gl(e,t,s){var n=tc(e),a={lane:n,action:s,hasEagerState:!1,eagerState:null,next:null};if($l(e))Ql(t,a);else{var r=e.alternate;if(0===e.lanes&&(null===r||0===r.lanes)&&null!==(r=t.lastRenderedReducer))try{var l=t.lastRenderedState,o=r(l,s);if(a.hasEagerState=!0,a.eagerState=o,ln(o,l)){var i=t.interleaved;return null===i?(a.next=a,Dr(t)):(a.next=i.next,i.next=a),void(t.interleaved=a)}}catch(c){}null!==(s=Lr(e,t,a,n))&&(sc(s,e,n,a=ec()),Kl(s,t,n))}}function $l(e){var t=e.alternate;return e===ll||null!==t&&t===ll}function Ql(e,t){dl=cl=!0;var s=e.pending;null===s?t.next=t:(t.next=s.next,s.next=t),e.pending=t}function Kl(e,t,s){if(0!==(4194240&s)){var n=t.lanes;s|=n&=e.pendingLanes,t.lanes=s,bt(e,s)}}var Jl={readContext:Pr,useCallback:hl,useContext:hl,useEffect:hl,useImperativeHandle:hl,useInsertionEffect:hl,useLayoutEffect:hl,useMemo:hl,useReducer:hl,useRef:hl,useState:hl,useDebugValue:hl,useDeferredValue:hl,useTransition:hl,useMutableSource:hl,useSyncExternalStore:hl,useId:hl,unstable_isNewReconciler:!1},Xl={readContext:Pr,useCallback:function(e,t){return fl().memoizedState=[e,void 0===t?null:t],e},useContext:Pr,useEffect:Ml,useImperativeHandle:function(e,t,s){return s=null!==s&&void 0!==s?s.concat([e]):null,Dl(4194308,4,Ol.bind(null,t,e),s)},useLayoutEffect:function(e,t){return Dl(4194308,4,e,t)},useInsertionEffect:function(e,t){return Dl(4,2,e,t)},useMemo:function(e,t){var s=fl();return t=void 0===t?null:t,e=e(),s.memoizedState=[e,t],e},useReducer:function(e,t,s){var n=fl();return t=void 0!==s?s(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=Yl.bind(null,ll,e),[n.memoizedState,e]},useRef:function(e){return e={current:e},fl().memoizedState=e},useState:Tl,useDebugValue:Ul,useDeferredValue:function(e){return fl().memoizedState=e},useTransition:function(){var e=Tl(!1),t=e[0];return e=ql.bind(null,e[1]),fl().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,s){var n=ll,a=fl();if(ar){if(void 0===s)throw Error(r(407));s=s()}else{if(s=t(),null===Ti)throw Error(r(349));0!==(30&rl)||kl(n,t,s)}a.memoizedState=s;var l={value:s,getSnapshot:t};return a.queue=l,Ml(Cl.bind(null,n,l,e),[e]),n.flags|=2048,Pl(9,Sl.bind(null,n,l,s,t),void 0,null),s},useId:function(){var e=fl(),t=Ti.identifierPrefix;if(ar){var s=Ja;t=":"+t+"R"+(s=(Ka&~(1<<32-lt(Ka)-1)).toString(32)+s),0<(s=ul++)&&(t+="H"+s.toString(32)),t+=":"}else t=":"+t+"r"+(s=ml++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Zl={readContext:Pr,useCallback:zl,useContext:Pr,useEffect:Rl,useImperativeHandle:Bl,useInsertionEffect:Fl,useLayoutEffect:Il,useMemo:Vl,useReducer:vl,useRef:Al,useState:function(){return vl(yl)},useDebugValue:Ul,useDeferredValue:function(e){return Wl(bl(),ol.memoizedState,e)},useTransition:function(){return[vl(yl)[0],bl().memoizedState]},useMutableSource:wl,useSyncExternalStore:Nl,useId:Hl,unstable_isNewReconciler:!1},eo={readContext:Pr,useCallback:zl,useContext:Pr,useEffect:Rl,useImperativeHandle:Bl,useInsertionEffect:Fl,useLayoutEffect:Il,useMemo:Vl,useReducer:jl,useRef:Al,useState:function(){return jl(yl)},useDebugValue:Ul,useDeferredValue:function(e){var t=bl();return null===ol?t.memoizedState=e:Wl(t,ol.memoizedState,e)},useTransition:function(){return[jl(yl)[0],bl().memoizedState]},useMutableSource:wl,useSyncExternalStore:Nl,useId:Hl,unstable_isNewReconciler:!1};function to(e,t){if(e&&e.defaultProps){for(var s in t=I({},t),e=e.defaultProps)void 0===t[s]&&(t[s]=e[s]);return t}return t}function so(e,t,s,n){s=null===(s=s(n,t=e.memoizedState))||void 0===s?t:I({},t,s),e.memoizedState=s,0===e.lanes&&(e.updateQueue.baseState=s)}var no={isMounted:function(e){return!!(e=e._reactInternals)&&Ve(e)===e},enqueueSetState:function(e,t,s){e=e._reactInternals;var n=ec(),a=tc(e),r=Or(n,a);r.payload=t,void 0!==s&&null!==s&&(r.callback=s),null!==(t=Br(e,r,a))&&(sc(t,e,a,n),Ur(t,e,a))},enqueueReplaceState:function(e,t,s){e=e._reactInternals;var n=ec(),a=tc(e),r=Or(n,a);r.tag=1,r.payload=t,void 0!==s&&null!==s&&(r.callback=s),null!==(t=Br(e,r,a))&&(sc(t,e,a,n),Ur(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var s=ec(),n=tc(e),a=Or(s,n);a.tag=2,void 0!==t&&null!==t&&(a.callback=t),null!==(t=Br(e,a,n))&&(sc(t,e,n,s),Ur(t,e,n))}};function ao(e,t,s,n,a,r,l){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(n,r,l):!t.prototype||!t.prototype.isPureReactComponent||(!on(s,n)||!on(a,r))}function ro(e,t,s){var n=!1,a=_a,r=t.contextType;return"object"===typeof r&&null!==r?r=Pr(r):(a=Da(t)?Pa:Ea.current,r=(n=null!==(n=t.contextTypes)&&void 0!==n)?Aa(e,a):_a),t=new t(s,r),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=no,e.stateNode=t,t._reactInternals=e,n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=r),t}function lo(e,t,s,n){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(s,n),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(s,n),t.state!==e&&no.enqueueReplaceState(t,t.state,null)}function oo(e,t,s,n){var a=e.stateNode;a.props=s,a.state=e.memoizedState,a.refs={},Fr(e);var r=t.contextType;"object"===typeof r&&null!==r?a.context=Pr(r):(r=Da(t)?Pa:Ea.current,a.context=Aa(e,r)),a.state=e.memoizedState,"function"===typeof(r=t.getDerivedStateFromProps)&&(so(e,t,r,s),a.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof a.getSnapshotBeforeUpdate||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||(t=a.state,"function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),t!==a.state&&no.enqueueReplaceState(a,a.state,null),Vr(e,s,a,n),a.state=e.memoizedState),"function"===typeof a.componentDidMount&&(e.flags|=4194308)}function io(e,t){try{var s="",n=t;do{s+=z(n),n=n.return}while(n);var a=s}catch(r){a="\nError generating stack: "+r.message+"\n"+r.stack}return{value:e,source:t,stack:a,digest:null}}function co(e,t,s){return{value:e,source:null,stack:null!=s?s:null,digest:null!=t?t:null}}function uo(e,t){try{console.error(t.value)}catch(s){setTimeout(function(){throw s})}}var mo="function"===typeof WeakMap?WeakMap:Map;function ho(e,t,s){(s=Or(-1,s)).tag=3,s.payload={element:null};var n=t.value;return s.callback=function(){qi||(qi=!0,Hi=n),uo(0,t)},s}function po(e,t,s){(s=Or(-1,s)).tag=3;var n=e.type.getDerivedStateFromError;if("function"===typeof n){var a=t.value;s.payload=function(){return n(a)},s.callback=function(){uo(0,t)}}var r=e.stateNode;return null!==r&&"function"===typeof r.componentDidCatch&&(s.callback=function(){uo(0,t),"function"!==typeof n&&(null===Yi?Yi=new Set([this]):Yi.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),s}function xo(e,t,s){var n=e.pingCache;if(null===n){n=e.pingCache=new mo;var a=new Set;n.set(t,a)}else void 0===(a=n.get(t))&&(a=new Set,n.set(t,a));a.has(s)||(a.add(s),e=Sc.bind(null,e,t,s),t.then(e,e))}function go(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function fo(e,t,s,n,a){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,s.flags|=131072,s.flags&=-52805,1===s.tag&&(null===s.alternate?s.tag=17:((t=Or(-1,1)).tag=2,Br(s,t,1))),s.lanes|=1),e):(e.flags|=65536,e.lanes=a,e)}var bo=v.ReactCurrentOwner,yo=!1;function vo(e,t,s,n){t.child=null===e?jr(t,null,s,n):vr(t,e.child,s,n)}function jo(e,t,s,n,a){s=s.render;var r=t.ref;return Tr(t,a),n=xl(e,t,s,n,r,a),s=gl(),null===e||yo?(ar&&s&&er(t),t.flags|=1,vo(e,t,n,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,qo(e,t,a))}function wo(e,t,s,n,a){if(null===e){var r=s.type;return"function"!==typeof r||Dc(r)||void 0!==r.defaultProps||null!==s.compare||void 0!==s.defaultProps?((e=Mc(s.type,null,n,t,t.mode,a)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=r,No(e,t,r,n,a))}if(r=e.child,0===(e.lanes&a)){var l=r.memoizedProps;if((s=null!==(s=s.compare)?s:on)(l,n)&&e.ref===t.ref)return qo(e,t,a)}return t.flags|=1,(e=Lc(r,n)).ref=t.ref,e.return=t,t.child=e}function No(e,t,s,n,a){if(null!==e){var r=e.memoizedProps;if(on(r,n)&&e.ref===t.ref){if(yo=!1,t.pendingProps=n=r,0===(e.lanes&a))return t.lanes=e.lanes,qo(e,t,a);0!==(131072&e.flags)&&(yo=!0)}}return Co(e,t,s,n,a)}function ko(e,t,s){var n=t.pendingProps,a=n.children,r=null!==e?e.memoizedState:null;if("hidden"===n.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ca(Li,Di),Di|=s;else{if(0===(1073741824&s))return e=null!==r?r.baseLanes|s:s,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ca(Li,Di),Di|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=null!==r?r.baseLanes:s,Ca(Li,Di),Di|=n}else null!==r?(n=r.baseLanes|s,t.memoizedState=null):n=s,Ca(Li,Di),Di|=n;return vo(e,t,a,s),t.child}function So(e,t){var s=t.ref;(null===e&&null!==s||null!==e&&e.ref!==s)&&(t.flags|=512,t.flags|=2097152)}function Co(e,t,s,n,a){var r=Da(s)?Pa:Ea.current;return r=Aa(t,r),Tr(t,a),s=xl(e,t,s,n,r,a),n=gl(),null===e||yo?(ar&&n&&er(t),t.flags|=1,vo(e,t,s,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,qo(e,t,a))}function _o(e,t,s,n,a){if(Da(s)){var r=!0;Fa(t)}else r=!1;if(Tr(t,a),null===t.stateNode)Wo(e,t),ro(t,s,n),oo(t,s,n,a),n=!0;else if(null===e){var l=t.stateNode,o=t.memoizedProps;l.props=o;var i=l.context,c=s.contextType;"object"===typeof c&&null!==c?c=Pr(c):c=Aa(t,c=Da(s)?Pa:Ea.current);var d=s.getDerivedStateFromProps,u="function"===typeof d||"function"===typeof l.getSnapshotBeforeUpdate;u||"function"!==typeof l.UNSAFE_componentWillReceiveProps&&"function"!==typeof l.componentWillReceiveProps||(o!==n||i!==c)&&lo(t,l,n,c),Rr=!1;var m=t.memoizedState;l.state=m,Vr(t,n,l,a),i=t.memoizedState,o!==n||m!==i||Ta.current||Rr?("function"===typeof d&&(so(t,s,d,n),i=t.memoizedState),(o=Rr||ao(t,s,o,n,m,i,c))?(u||"function"!==typeof l.UNSAFE_componentWillMount&&"function"!==typeof l.componentWillMount||("function"===typeof l.componentWillMount&&l.componentWillMount(),"function"===typeof l.UNSAFE_componentWillMount&&l.UNSAFE_componentWillMount()),"function"===typeof l.componentDidMount&&(t.flags|=4194308)):("function"===typeof l.componentDidMount&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=i),l.props=n,l.state=i,l.context=c,n=o):("function"===typeof l.componentDidMount&&(t.flags|=4194308),n=!1)}else{l=t.stateNode,Ir(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:to(t.type,o),l.props=c,u=t.pendingProps,m=l.context,"object"===typeof(i=s.contextType)&&null!==i?i=Pr(i):i=Aa(t,i=Da(s)?Pa:Ea.current);var h=s.getDerivedStateFromProps;(d="function"===typeof h||"function"===typeof l.getSnapshotBeforeUpdate)||"function"!==typeof l.UNSAFE_componentWillReceiveProps&&"function"!==typeof l.componentWillReceiveProps||(o!==u||m!==i)&&lo(t,l,n,i),Rr=!1,m=t.memoizedState,l.state=m,Vr(t,n,l,a);var p=t.memoizedState;o!==u||m!==p||Ta.current||Rr?("function"===typeof h&&(so(t,s,h,n),p=t.memoizedState),(c=Rr||ao(t,s,c,n,m,p,i)||!1)?(d||"function"!==typeof l.UNSAFE_componentWillUpdate&&"function"!==typeof l.componentWillUpdate||("function"===typeof l.componentWillUpdate&&l.componentWillUpdate(n,p,i),"function"===typeof l.UNSAFE_componentWillUpdate&&l.UNSAFE_componentWillUpdate(n,p,i)),"function"===typeof l.componentDidUpdate&&(t.flags|=4),"function"===typeof l.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof l.componentDidUpdate||o===e.memoizedProps&&m===e.memoizedState||(t.flags|=4),"function"!==typeof l.getSnapshotBeforeUpdate||o===e.memoizedProps&&m===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=p),l.props=n,l.state=p,l.context=i,n=c):("function"!==typeof l.componentDidUpdate||o===e.memoizedProps&&m===e.memoizedState||(t.flags|=4),"function"!==typeof l.getSnapshotBeforeUpdate||o===e.memoizedProps&&m===e.memoizedState||(t.flags|=1024),n=!1)}return Eo(e,t,s,n,r,a)}function Eo(e,t,s,n,a,r){So(e,t);var l=0!==(128&t.flags);if(!n&&!l)return a&&Ia(t,s,!1),qo(e,t,r);n=t.stateNode,bo.current=t;var o=l&&"function"!==typeof s.getDerivedStateFromError?null:n.render();return t.flags|=1,null!==e&&l?(t.child=vr(t,e.child,null,r),t.child=vr(t,null,o,r)):vo(e,t,o,r),t.memoizedState=n.state,a&&Ia(t,s,!0),t.child}function To(e){var t=e.stateNode;t.pendingContext?Ma(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Ma(0,t.context,!1),Qr(e,t.containerInfo)}function Po(e,t,s,n,a){return hr(),pr(a),t.flags|=256,vo(e,t,s,n),t.child}var Ao,Do,Lo,Mo,Ro={dehydrated:null,treeContext:null,retryLane:0};function Fo(e){return{baseLanes:e,cachePool:null,transitions:null}}function Io(e,t,s){var n,a=t.pendingProps,l=Zr.current,o=!1,i=0!==(128&t.flags);if((n=i)||(n=(null===e||null!==e.memoizedState)&&0!==(2&l)),n?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(l|=1),Ca(Zr,1&l),null===e)return cr(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(i=a.children,e=a.fallback,o?(a=t.mode,o=t.child,i={mode:"hidden",children:i},0===(1&a)&&null!==o?(o.childLanes=0,o.pendingProps=i):o=Fc(i,a,0,null),e=Rc(e,a,s,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Fo(s),t.memoizedState=Ro,e):Oo(t,i));if(null!==(l=e.memoizedState)&&null!==(n=l.dehydrated))return function(e,t,s,n,a,l,o){if(s)return 256&t.flags?(t.flags&=-257,Bo(e,t,o,n=co(Error(r(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(l=n.fallback,a=t.mode,n=Fc({mode:"visible",children:n.children},a,0,null),(l=Rc(l,a,o,null)).flags|=2,n.return=t,l.return=t,n.sibling=l,t.child=n,0!==(1&t.mode)&&vr(t,e.child,null,o),t.child.memoizedState=Fo(o),t.memoizedState=Ro,l);if(0===(1&t.mode))return Bo(e,t,o,null);if("$!"===a.data){if(n=a.nextSibling&&a.nextSibling.dataset)var i=n.dgst;return n=i,Bo(e,t,o,n=co(l=Error(r(419)),n,void 0))}if(i=0!==(o&e.childLanes),yo||i){if(null!==(n=Ti)){switch(o&-o){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}0!==(a=0!==(a&(n.suspendedLanes|o))?0:a)&&a!==l.retryLane&&(l.retryLane=a,Mr(e,a),sc(n,e,a,-1))}return xc(),Bo(e,t,o,n=co(Error(r(421))))}return"$?"===a.data?(t.flags|=128,t.child=e.child,t=_c.bind(null,e),a._reactRetry=t,null):(e=l.treeContext,nr=ca(a.nextSibling),sr=t,ar=!0,rr=null,null!==e&&(Ga[$a++]=Ka,Ga[$a++]=Ja,Ga[$a++]=Qa,Ka=e.id,Ja=e.overflow,Qa=t),t=Oo(t,n.children),t.flags|=4096,t)}(e,t,i,a,n,l,s);if(o){o=a.fallback,i=t.mode,n=(l=e.child).sibling;var c={mode:"hidden",children:a.children};return 0===(1&i)&&t.child!==l?((a=t.child).childLanes=0,a.pendingProps=c,t.deletions=null):(a=Lc(l,c)).subtreeFlags=14680064&l.subtreeFlags,null!==n?o=Lc(n,o):(o=Rc(o,i,s,null)).flags|=2,o.return=t,a.return=t,a.sibling=o,t.child=a,a=o,o=t.child,i=null===(i=e.child.memoizedState)?Fo(s):{baseLanes:i.baseLanes|s,cachePool:null,transitions:i.transitions},o.memoizedState=i,o.childLanes=e.childLanes&~s,t.memoizedState=Ro,a}return e=(o=e.child).sibling,a=Lc(o,{mode:"visible",children:a.children}),0===(1&t.mode)&&(a.lanes=s),a.return=t,a.sibling=null,null!==e&&(null===(s=t.deletions)?(t.deletions=[e],t.flags|=16):s.push(e)),t.child=a,t.memoizedState=null,a}function Oo(e,t){return(t=Fc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Bo(e,t,s,n){return null!==n&&pr(n),vr(t,e.child,null,s),(e=Oo(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Uo(e,t,s){e.lanes|=t;var n=e.alternate;null!==n&&(n.lanes|=t),Er(e.return,t,s)}function zo(e,t,s,n,a){var r=e.memoizedState;null===r?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:s,tailMode:a}:(r.isBackwards=t,r.rendering=null,r.renderingStartTime=0,r.last=n,r.tail=s,r.tailMode=a)}function Vo(e,t,s){var n=t.pendingProps,a=n.revealOrder,r=n.tail;if(vo(e,t,n.children,s),0!==(2&(n=Zr.current)))n=1&n|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Uo(e,s,t);else if(19===e.tag)Uo(e,s,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(Ca(Zr,n),0===(1&t.mode))t.memoizedState=null;else switch(a){case"forwards":for(s=t.child,a=null;null!==s;)null!==(e=s.alternate)&&null===el(e)&&(a=s),s=s.sibling;null===(s=a)?(a=t.child,t.child=null):(a=s.sibling,s.sibling=null),zo(t,!1,a,s,r);break;case"backwards":for(s=null,a=t.child,t.child=null;null!==a;){if(null!==(e=a.alternate)&&null===el(e)){t.child=a;break}e=a.sibling,a.sibling=s,s=a,a=e}zo(t,!0,s,null,r);break;case"together":zo(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Wo(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function qo(e,t,s){if(null!==e&&(t.dependencies=e.dependencies),Fi|=t.lanes,0===(s&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(r(153));if(null!==t.child){for(s=Lc(e=t.child,e.pendingProps),t.child=s,s.return=t;null!==e.sibling;)e=e.sibling,(s=s.sibling=Lc(e,e.pendingProps)).return=t;s.sibling=null}return t.child}function Ho(e,t){if(!ar)switch(e.tailMode){case"hidden":t=e.tail;for(var s=null;null!==t;)null!==t.alternate&&(s=t),t=t.sibling;null===s?e.tail=null:s.sibling=null;break;case"collapsed":s=e.tail;for(var n=null;null!==s;)null!==s.alternate&&(n=s),s=s.sibling;null===n?t||null===e.tail?e.tail=null:e.tail.sibling=null:n.sibling=null}}function Yo(e){var t=null!==e.alternate&&e.alternate.child===e.child,s=0,n=0;if(t)for(var a=e.child;null!==a;)s|=a.lanes|a.childLanes,n|=14680064&a.subtreeFlags,n|=14680064&a.flags,a.return=e,a=a.sibling;else for(a=e.child;null!==a;)s|=a.lanes|a.childLanes,n|=a.subtreeFlags,n|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=n,e.childLanes=s,t}function Go(e,t,s){var n=t.pendingProps;switch(tr(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Yo(t),null;case 1:case 17:return Da(t.type)&&La(),Yo(t),null;case 3:return n=t.stateNode,Kr(),Sa(Ta),Sa(Ea),sl(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(ur(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==rr&&(lc(rr),rr=null))),Do(e,t),Yo(t),null;case 5:Xr(t);var a=$r(Gr.current);if(s=t.type,null!==e&&null!=t.stateNode)Lo(e,t,s,n,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(null===t.stateNode)throw Error(r(166));return Yo(t),null}if(e=$r(Hr.current),ur(t)){n=t.stateNode,s=t.type;var l=t.memoizedProps;switch(n[ma]=t,n[ha]=l,e=0!==(1&t.mode),s){case"dialog":Bn("cancel",n),Bn("close",n);break;case"iframe":case"object":case"embed":Bn("load",n);break;case"video":case"audio":for(a=0;a<Rn.length;a++)Bn(Rn[a],n);break;case"source":Bn("error",n);break;case"img":case"image":case"link":Bn("error",n),Bn("load",n);break;case"details":Bn("toggle",n);break;case"input":K(n,l),Bn("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!l.multiple},Bn("invalid",n);break;case"textarea":ae(n,l),Bn("invalid",n)}for(var i in be(s,l),a=null,l)if(l.hasOwnProperty(i)){var c=l[i];"children"===i?"string"===typeof c?n.textContent!==c&&(!0!==l.suppressHydrationWarning&&Xn(n.textContent,c,e),a=["children",c]):"number"===typeof c&&n.textContent!==""+c&&(!0!==l.suppressHydrationWarning&&Xn(n.textContent,c,e),a=["children",""+c]):o.hasOwnProperty(i)&&null!=c&&"onScroll"===i&&Bn("scroll",n)}switch(s){case"input":Y(n),Z(n,l,!0);break;case"textarea":Y(n),le(n);break;case"select":case"option":break;default:"function"===typeof l.onClick&&(n.onclick=Zn)}n=a,t.updateQueue=n,null!==n&&(t.flags|=4)}else{i=9===a.nodeType?a:a.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=oe(s)),"http://www.w3.org/1999/xhtml"===e?"script"===s?((e=i.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof n.is?e=i.createElement(s,{is:n.is}):(e=i.createElement(s),"select"===s&&(i=e,n.multiple?i.multiple=!0:n.size&&(i.size=n.size))):e=i.createElementNS(e,s),e[ma]=t,e[ha]=n,Ao(e,t,!1,!1),t.stateNode=e;e:{switch(i=ye(s,n),s){case"dialog":Bn("cancel",e),Bn("close",e),a=n;break;case"iframe":case"object":case"embed":Bn("load",e),a=n;break;case"video":case"audio":for(a=0;a<Rn.length;a++)Bn(Rn[a],e);a=n;break;case"source":Bn("error",e),a=n;break;case"img":case"image":case"link":Bn("error",e),Bn("load",e),a=n;break;case"details":Bn("toggle",e),a=n;break;case"input":K(e,n),a=Q(e,n),Bn("invalid",e);break;case"option":default:a=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},a=I({},n,{value:void 0}),Bn("invalid",e);break;case"textarea":ae(e,n),a=ne(e,n),Bn("invalid",e)}for(l in be(s,a),c=a)if(c.hasOwnProperty(l)){var d=c[l];"style"===l?ge(e,d):"dangerouslySetInnerHTML"===l?null!=(d=d?d.__html:void 0)&&ue(e,d):"children"===l?"string"===typeof d?("textarea"!==s||""!==d)&&me(e,d):"number"===typeof d&&me(e,""+d):"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&"autoFocus"!==l&&(o.hasOwnProperty(l)?null!=d&&"onScroll"===l&&Bn("scroll",e):null!=d&&y(e,l,d,i))}switch(s){case"input":Y(e),Z(e,n,!1);break;case"textarea":Y(e),le(e);break;case"option":null!=n.value&&e.setAttribute("value",""+q(n.value));break;case"select":e.multiple=!!n.multiple,null!=(l=n.value)?se(e,!!n.multiple,l,!1):null!=n.defaultValue&&se(e,!!n.multiple,n.defaultValue,!0);break;default:"function"===typeof a.onClick&&(e.onclick=Zn)}switch(s){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Yo(t),null;case 6:if(e&&null!=t.stateNode)Mo(e,t,e.memoizedProps,n);else{if("string"!==typeof n&&null===t.stateNode)throw Error(r(166));if(s=$r(Gr.current),$r(Hr.current),ur(t)){if(n=t.stateNode,s=t.memoizedProps,n[ma]=t,(l=n.nodeValue!==s)&&null!==(e=sr))switch(e.tag){case 3:Xn(n.nodeValue,s,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Xn(n.nodeValue,s,0!==(1&e.mode))}l&&(t.flags|=4)}else(n=(9===s.nodeType?s:s.ownerDocument).createTextNode(n))[ma]=t,t.stateNode=n}return Yo(t),null;case 13:if(Sa(Zr),n=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ar&&null!==nr&&0!==(1&t.mode)&&0===(128&t.flags))mr(),hr(),t.flags|=98560,l=!1;else if(l=ur(t),null!==n&&null!==n.dehydrated){if(null===e){if(!l)throw Error(r(318));if(!(l=null!==(l=t.memoizedState)?l.dehydrated:null))throw Error(r(317));l[ma]=t}else hr(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Yo(t),l=!1}else null!==rr&&(lc(rr),rr=null),l=!0;if(!l)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=s,t):((n=null!==n)!==(null!==e&&null!==e.memoizedState)&&n&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&Zr.current)?0===Mi&&(Mi=3):xc())),null!==t.updateQueue&&(t.flags|=4),Yo(t),null);case 4:return Kr(),Do(e,t),null===e&&Vn(t.stateNode.containerInfo),Yo(t),null;case 10:return _r(t.type._context),Yo(t),null;case 19:if(Sa(Zr),null===(l=t.memoizedState))return Yo(t),null;if(n=0!==(128&t.flags),null===(i=l.rendering))if(n)Ho(l,!1);else{if(0!==Mi||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(i=el(e))){for(t.flags|=128,Ho(l,!1),null!==(n=i.updateQueue)&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=s,s=t.child;null!==s;)e=n,(l=s).flags&=14680066,null===(i=l.alternate)?(l.childLanes=0,l.lanes=e,l.child=null,l.subtreeFlags=0,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null):(l.childLanes=i.childLanes,l.lanes=i.lanes,l.child=i.child,l.subtreeFlags=0,l.deletions=null,l.memoizedProps=i.memoizedProps,l.memoizedState=i.memoizedState,l.updateQueue=i.updateQueue,l.type=i.type,e=i.dependencies,l.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),s=s.sibling;return Ca(Zr,1&Zr.current|2),t.child}e=e.sibling}null!==l.tail&&Je()>Vi&&(t.flags|=128,n=!0,Ho(l,!1),t.lanes=4194304)}else{if(!n)if(null!==(e=el(i))){if(t.flags|=128,n=!0,null!==(s=e.updateQueue)&&(t.updateQueue=s,t.flags|=4),Ho(l,!0),null===l.tail&&"hidden"===l.tailMode&&!i.alternate&&!ar)return Yo(t),null}else 2*Je()-l.renderingStartTime>Vi&&1073741824!==s&&(t.flags|=128,n=!0,Ho(l,!1),t.lanes=4194304);l.isBackwards?(i.sibling=t.child,t.child=i):(null!==(s=l.last)?s.sibling=i:t.child=i,l.last=i)}return null!==l.tail?(t=l.tail,l.rendering=t,l.tail=t.sibling,l.renderingStartTime=Je(),t.sibling=null,s=Zr.current,Ca(Zr,n?1&s|2:1&s),t):(Yo(t),null);case 22:case 23:return uc(),n=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==n&&(t.flags|=8192),n&&0!==(1&t.mode)?0!==(1073741824&Di)&&(Yo(t),6&t.subtreeFlags&&(t.flags|=8192)):Yo(t),null;case 24:case 25:return null}throw Error(r(156,t.tag))}function $o(e,t){switch(tr(t),t.tag){case 1:return Da(t.type)&&La(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Kr(),Sa(Ta),Sa(Ea),sl(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Xr(t),null;case 13:if(Sa(Zr),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(r(340));hr()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Sa(Zr),null;case 4:return Kr(),null;case 10:return _r(t.type._context),null;case 22:case 23:return uc(),null;default:return null}}Ao=function(e,t){for(var s=t.child;null!==s;){if(5===s.tag||6===s.tag)e.appendChild(s.stateNode);else if(4!==s.tag&&null!==s.child){s.child.return=s,s=s.child;continue}if(s===t)break;for(;null===s.sibling;){if(null===s.return||s.return===t)return;s=s.return}s.sibling.return=s.return,s=s.sibling}},Do=function(){},Lo=function(e,t,s,n){var a=e.memoizedProps;if(a!==n){e=t.stateNode,$r(Hr.current);var r,l=null;switch(s){case"input":a=Q(e,a),n=Q(e,n),l=[];break;case"select":a=I({},a,{value:void 0}),n=I({},n,{value:void 0}),l=[];break;case"textarea":a=ne(e,a),n=ne(e,n),l=[];break;default:"function"!==typeof a.onClick&&"function"===typeof n.onClick&&(e.onclick=Zn)}for(d in be(s,n),s=null,a)if(!n.hasOwnProperty(d)&&a.hasOwnProperty(d)&&null!=a[d])if("style"===d){var i=a[d];for(r in i)i.hasOwnProperty(r)&&(s||(s={}),s[r]="")}else"dangerouslySetInnerHTML"!==d&&"children"!==d&&"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&"autoFocus"!==d&&(o.hasOwnProperty(d)?l||(l=[]):(l=l||[]).push(d,null));for(d in n){var c=n[d];if(i=null!=a?a[d]:void 0,n.hasOwnProperty(d)&&c!==i&&(null!=c||null!=i))if("style"===d)if(i){for(r in i)!i.hasOwnProperty(r)||c&&c.hasOwnProperty(r)||(s||(s={}),s[r]="");for(r in c)c.hasOwnProperty(r)&&i[r]!==c[r]&&(s||(s={}),s[r]=c[r])}else s||(l||(l=[]),l.push(d,s)),s=c;else"dangerouslySetInnerHTML"===d?(c=c?c.__html:void 0,i=i?i.__html:void 0,null!=c&&i!==c&&(l=l||[]).push(d,c)):"children"===d?"string"!==typeof c&&"number"!==typeof c||(l=l||[]).push(d,""+c):"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&(o.hasOwnProperty(d)?(null!=c&&"onScroll"===d&&Bn("scroll",e),l||i===c||(l=[])):(l=l||[]).push(d,c))}s&&(l=l||[]).push("style",s);var d=l;(t.updateQueue=d)&&(t.flags|=4)}},Mo=function(e,t,s,n){s!==n&&(t.flags|=4)};var Qo=!1,Ko=!1,Jo="function"===typeof WeakSet?WeakSet:Set,Xo=null;function Zo(e,t){var s=e.ref;if(null!==s)if("function"===typeof s)try{s(null)}catch(n){kc(e,t,n)}else s.current=null}function ei(e,t,s){try{s()}catch(n){kc(e,t,n)}}var ti=!1;function si(e,t,s){var n=t.updateQueue;if(null!==(n=null!==n?n.lastEffect:null)){var a=n=n.next;do{if((a.tag&e)===e){var r=a.destroy;a.destroy=void 0,void 0!==r&&ei(t,s,r)}a=a.next}while(a!==n)}}function ni(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var s=t=t.next;do{if((s.tag&e)===e){var n=s.create;s.destroy=n()}s=s.next}while(s!==t)}}function ai(e){var t=e.ref;if(null!==t){var s=e.stateNode;e.tag,e=s,"function"===typeof t?t(e):t.current=e}}function ri(e){var t=e.alternate;null!==t&&(e.alternate=null,ri(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[ma],delete t[ha],delete t[xa],delete t[ga],delete t[fa])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function li(e){return 5===e.tag||3===e.tag||4===e.tag}function oi(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||li(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ii(e,t,s){var n=e.tag;if(5===n||6===n)e=e.stateNode,t?8===s.nodeType?s.parentNode.insertBefore(e,t):s.insertBefore(e,t):(8===s.nodeType?(t=s.parentNode).insertBefore(e,s):(t=s).appendChild(e),null!==(s=s._reactRootContainer)&&void 0!==s||null!==t.onclick||(t.onclick=Zn));else if(4!==n&&null!==(e=e.child))for(ii(e,t,s),e=e.sibling;null!==e;)ii(e,t,s),e=e.sibling}function ci(e,t,s){var n=e.tag;if(5===n||6===n)e=e.stateNode,t?s.insertBefore(e,t):s.appendChild(e);else if(4!==n&&null!==(e=e.child))for(ci(e,t,s),e=e.sibling;null!==e;)ci(e,t,s),e=e.sibling}var di=null,ui=!1;function mi(e,t,s){for(s=s.child;null!==s;)hi(e,t,s),s=s.sibling}function hi(e,t,s){if(rt&&"function"===typeof rt.onCommitFiberUnmount)try{rt.onCommitFiberUnmount(at,s)}catch(o){}switch(s.tag){case 5:Ko||Zo(s,t);case 6:var n=di,a=ui;di=null,mi(e,t,s),ui=a,null!==(di=n)&&(ui?(e=di,s=s.stateNode,8===e.nodeType?e.parentNode.removeChild(s):e.removeChild(s)):di.removeChild(s.stateNode));break;case 18:null!==di&&(ui?(e=di,s=s.stateNode,8===e.nodeType?ia(e.parentNode,s):1===e.nodeType&&ia(e,s),Vt(e)):ia(di,s.stateNode));break;case 4:n=di,a=ui,di=s.stateNode.containerInfo,ui=!0,mi(e,t,s),di=n,ui=a;break;case 0:case 11:case 14:case 15:if(!Ko&&(null!==(n=s.updateQueue)&&null!==(n=n.lastEffect))){a=n=n.next;do{var r=a,l=r.destroy;r=r.tag,void 0!==l&&(0!==(2&r)||0!==(4&r))&&ei(s,t,l),a=a.next}while(a!==n)}mi(e,t,s);break;case 1:if(!Ko&&(Zo(s,t),"function"===typeof(n=s.stateNode).componentWillUnmount))try{n.props=s.memoizedProps,n.state=s.memoizedState,n.componentWillUnmount()}catch(o){kc(s,t,o)}mi(e,t,s);break;case 21:mi(e,t,s);break;case 22:1&s.mode?(Ko=(n=Ko)||null!==s.memoizedState,mi(e,t,s),Ko=n):mi(e,t,s);break;default:mi(e,t,s)}}function pi(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var s=e.stateNode;null===s&&(s=e.stateNode=new Jo),t.forEach(function(t){var n=Ec.bind(null,e,t);s.has(t)||(s.add(t),t.then(n,n))})}}function xi(e,t){var s=t.deletions;if(null!==s)for(var n=0;n<s.length;n++){var a=s[n];try{var l=e,o=t,i=o;e:for(;null!==i;){switch(i.tag){case 5:di=i.stateNode,ui=!1;break e;case 3:case 4:di=i.stateNode.containerInfo,ui=!0;break e}i=i.return}if(null===di)throw Error(r(160));hi(l,o,a),di=null,ui=!1;var c=a.alternate;null!==c&&(c.return=null),a.return=null}catch(d){kc(a,t,d)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gi(t,e),t=t.sibling}function gi(e,t){var s=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(xi(t,e),fi(e),4&n){try{si(3,e,e.return),ni(3,e)}catch(g){kc(e,e.return,g)}try{si(5,e,e.return)}catch(g){kc(e,e.return,g)}}break;case 1:xi(t,e),fi(e),512&n&&null!==s&&Zo(s,s.return);break;case 5:if(xi(t,e),fi(e),512&n&&null!==s&&Zo(s,s.return),32&e.flags){var a=e.stateNode;try{me(a,"")}catch(g){kc(e,e.return,g)}}if(4&n&&null!=(a=e.stateNode)){var l=e.memoizedProps,o=null!==s?s.memoizedProps:l,i=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===i&&"radio"===l.type&&null!=l.name&&J(a,l),ye(i,o);var d=ye(i,l);for(o=0;o<c.length;o+=2){var u=c[o],m=c[o+1];"style"===u?ge(a,m):"dangerouslySetInnerHTML"===u?ue(a,m):"children"===u?me(a,m):y(a,u,m,d)}switch(i){case"input":X(a,l);break;case"textarea":re(a,l);break;case"select":var h=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!l.multiple;var p=l.value;null!=p?se(a,!!l.multiple,p,!1):h!==!!l.multiple&&(null!=l.defaultValue?se(a,!!l.multiple,l.defaultValue,!0):se(a,!!l.multiple,l.multiple?[]:"",!1))}a[ha]=l}catch(g){kc(e,e.return,g)}}break;case 6:if(xi(t,e),fi(e),4&n){if(null===e.stateNode)throw Error(r(162));a=e.stateNode,l=e.memoizedProps;try{a.nodeValue=l}catch(g){kc(e,e.return,g)}}break;case 3:if(xi(t,e),fi(e),4&n&&null!==s&&s.memoizedState.isDehydrated)try{Vt(t.containerInfo)}catch(g){kc(e,e.return,g)}break;case 4:default:xi(t,e),fi(e);break;case 13:xi(t,e),fi(e),8192&(a=e.child).flags&&(l=null!==a.memoizedState,a.stateNode.isHidden=l,!l||null!==a.alternate&&null!==a.alternate.memoizedState||(zi=Je())),4&n&&pi(e);break;case 22:if(u=null!==s&&null!==s.memoizedState,1&e.mode?(Ko=(d=Ko)||u,xi(t,e),Ko=d):xi(t,e),fi(e),8192&n){if(d=null!==e.memoizedState,(e.stateNode.isHidden=d)&&!u&&0!==(1&e.mode))for(Xo=e,u=e.child;null!==u;){for(m=Xo=u;null!==Xo;){switch(p=(h=Xo).child,h.tag){case 0:case 11:case 14:case 15:si(4,h,h.return);break;case 1:Zo(h,h.return);var x=h.stateNode;if("function"===typeof x.componentWillUnmount){n=h,s=h.return;try{t=n,x.props=t.memoizedProps,x.state=t.memoizedState,x.componentWillUnmount()}catch(g){kc(n,s,g)}}break;case 5:Zo(h,h.return);break;case 22:if(null!==h.memoizedState){ji(m);continue}}null!==p?(p.return=h,Xo=p):ji(m)}u=u.sibling}e:for(u=null,m=e;;){if(5===m.tag){if(null===u){u=m;try{a=m.stateNode,d?"function"===typeof(l=a.style).setProperty?l.setProperty("display","none","important"):l.display="none":(i=m.stateNode,o=void 0!==(c=m.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,i.style.display=xe("display",o))}catch(g){kc(e,e.return,g)}}}else if(6===m.tag){if(null===u)try{m.stateNode.nodeValue=d?"":m.memoizedProps}catch(g){kc(e,e.return,g)}}else if((22!==m.tag&&23!==m.tag||null===m.memoizedState||m===e)&&null!==m.child){m.child.return=m,m=m.child;continue}if(m===e)break e;for(;null===m.sibling;){if(null===m.return||m.return===e)break e;u===m&&(u=null),m=m.return}u===m&&(u=null),m.sibling.return=m.return,m=m.sibling}}break;case 19:xi(t,e),fi(e),4&n&&pi(e);case 21:}}function fi(e){var t=e.flags;if(2&t){try{e:{for(var s=e.return;null!==s;){if(li(s)){var n=s;break e}s=s.return}throw Error(r(160))}switch(n.tag){case 5:var a=n.stateNode;32&n.flags&&(me(a,""),n.flags&=-33),ci(e,oi(e),a);break;case 3:case 4:var l=n.stateNode.containerInfo;ii(e,oi(e),l);break;default:throw Error(r(161))}}catch(o){kc(e,e.return,o)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function bi(e,t,s){Xo=e,yi(e,t,s)}function yi(e,t,s){for(var n=0!==(1&e.mode);null!==Xo;){var a=Xo,r=a.child;if(22===a.tag&&n){var l=null!==a.memoizedState||Qo;if(!l){var o=a.alternate,i=null!==o&&null!==o.memoizedState||Ko;o=Qo;var c=Ko;if(Qo=l,(Ko=i)&&!c)for(Xo=a;null!==Xo;)i=(l=Xo).child,22===l.tag&&null!==l.memoizedState?wi(a):null!==i?(i.return=l,Xo=i):wi(a);for(;null!==r;)Xo=r,yi(r,t,s),r=r.sibling;Xo=a,Qo=o,Ko=c}vi(e)}else 0!==(8772&a.subtreeFlags)&&null!==r?(r.return=a,Xo=r):vi(e)}}function vi(e){for(;null!==Xo;){var t=Xo;if(0!==(8772&t.flags)){var s=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Ko||ni(5,t);break;case 1:var n=t.stateNode;if(4&t.flags&&!Ko)if(null===s)n.componentDidMount();else{var a=t.elementType===t.type?s.memoizedProps:to(t.type,s.memoizedProps);n.componentDidUpdate(a,s.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var l=t.updateQueue;null!==l&&Wr(t,l,n);break;case 3:var o=t.updateQueue;if(null!==o){if(s=null,null!==t.child)switch(t.child.tag){case 5:case 1:s=t.child.stateNode}Wr(t,o,s)}break;case 5:var i=t.stateNode;if(null===s&&4&t.flags){s=i;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&s.focus();break;case"img":c.src&&(s.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var d=t.alternate;if(null!==d){var u=d.memoizedState;if(null!==u){var m=u.dehydrated;null!==m&&Vt(m)}}}break;default:throw Error(r(163))}Ko||512&t.flags&&ai(t)}catch(h){kc(t,t.return,h)}}if(t===e){Xo=null;break}if(null!==(s=t.sibling)){s.return=t.return,Xo=s;break}Xo=t.return}}function ji(e){for(;null!==Xo;){var t=Xo;if(t===e){Xo=null;break}var s=t.sibling;if(null!==s){s.return=t.return,Xo=s;break}Xo=t.return}}function wi(e){for(;null!==Xo;){var t=Xo;try{switch(t.tag){case 0:case 11:case 15:var s=t.return;try{ni(4,t)}catch(i){kc(t,s,i)}break;case 1:var n=t.stateNode;if("function"===typeof n.componentDidMount){var a=t.return;try{n.componentDidMount()}catch(i){kc(t,a,i)}}var r=t.return;try{ai(t)}catch(i){kc(t,r,i)}break;case 5:var l=t.return;try{ai(t)}catch(i){kc(t,l,i)}}}catch(i){kc(t,t.return,i)}if(t===e){Xo=null;break}var o=t.sibling;if(null!==o){o.return=t.return,Xo=o;break}Xo=t.return}}var Ni,ki=Math.ceil,Si=v.ReactCurrentDispatcher,Ci=v.ReactCurrentOwner,_i=v.ReactCurrentBatchConfig,Ei=0,Ti=null,Pi=null,Ai=0,Di=0,Li=ka(0),Mi=0,Ri=null,Fi=0,Ii=0,Oi=0,Bi=null,Ui=null,zi=0,Vi=1/0,Wi=null,qi=!1,Hi=null,Yi=null,Gi=!1,$i=null,Qi=0,Ki=0,Ji=null,Xi=-1,Zi=0;function ec(){return 0!==(6&Ei)?Je():-1!==Xi?Xi:Xi=Je()}function tc(e){return 0===(1&e.mode)?1:0!==(2&Ei)&&0!==Ai?Ai&-Ai:null!==xr.transition?(0===Zi&&(Zi=xt()),Zi):0!==(e=yt)?e:e=void 0===(e=window.event)?16:Kt(e.type)}function sc(e,t,s,n){if(50<Ki)throw Ki=0,Ji=null,Error(r(185));ft(e,s,n),0!==(2&Ei)&&e===Ti||(e===Ti&&(0===(2&Ei)&&(Ii|=s),4===Mi&&oc(e,Ai)),nc(e,n),1===s&&0===Ei&&0===(1&t.mode)&&(Vi=Je()+500,Ba&&Va()))}function nc(e,t){var s=e.callbackNode;!function(e,t){for(var s=e.suspendedLanes,n=e.pingedLanes,a=e.expirationTimes,r=e.pendingLanes;0<r;){var l=31-lt(r),o=1<<l,i=a[l];-1===i?0!==(o&s)&&0===(o&n)||(a[l]=ht(o,t)):i<=t&&(e.expiredLanes|=o),r&=~o}}(e,t);var n=mt(e,e===Ti?Ai:0);if(0===n)null!==s&&$e(s),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(null!=s&&$e(s),1===t)0===e.tag?function(e){Ba=!0,za(e)}(ic.bind(null,e)):za(ic.bind(null,e)),la(function(){0===(6&Ei)&&Va()}),s=null;else{switch(vt(n)){case 1:s=Ze;break;case 4:s=et;break;case 16:default:s=tt;break;case 536870912:s=nt}s=Tc(s,ac.bind(null,e))}e.callbackPriority=t,e.callbackNode=s}}function ac(e,t){if(Xi=-1,Zi=0,0!==(6&Ei))throw Error(r(327));var s=e.callbackNode;if(wc()&&e.callbackNode!==s)return null;var n=mt(e,e===Ti?Ai:0);if(0===n)return null;if(0!==(30&n)||0!==(n&e.expiredLanes)||t)t=gc(e,n);else{t=n;var a=Ei;Ei|=2;var l=pc();for(Ti===e&&Ai===t||(Wi=null,Vi=Je()+500,mc(e,t));;)try{bc();break}catch(i){hc(e,i)}Cr(),Si.current=l,Ei=a,null!==Pi?t=0:(Ti=null,Ai=0,t=Mi)}if(0!==t){if(2===t&&(0!==(a=pt(e))&&(n=a,t=rc(e,a))),1===t)throw s=Ri,mc(e,0),oc(e,n),nc(e,Je()),s;if(6===t)oc(e,n);else{if(a=e.current.alternate,0===(30&n)&&!function(e){for(var t=e;;){if(16384&t.flags){var s=t.updateQueue;if(null!==s&&null!==(s=s.stores))for(var n=0;n<s.length;n++){var a=s[n],r=a.getSnapshot;a=a.value;try{if(!ln(r(),a))return!1}catch(o){return!1}}}if(s=t.child,16384&t.subtreeFlags&&null!==s)s.return=t,t=s;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(a)&&(2===(t=gc(e,n))&&(0!==(l=pt(e))&&(n=l,t=rc(e,l))),1===t))throw s=Ri,mc(e,0),oc(e,n),nc(e,Je()),s;switch(e.finishedWork=a,e.finishedLanes=n,t){case 0:case 1:throw Error(r(345));case 2:case 5:jc(e,Ui,Wi);break;case 3:if(oc(e,n),(130023424&n)===n&&10<(t=zi+500-Je())){if(0!==mt(e,0))break;if(((a=e.suspendedLanes)&n)!==n){ec(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=na(jc.bind(null,e,Ui,Wi),t);break}jc(e,Ui,Wi);break;case 4:if(oc(e,n),(4194240&n)===n)break;for(t=e.eventTimes,a=-1;0<n;){var o=31-lt(n);l=1<<o,(o=t[o])>a&&(a=o),n&=~l}if(n=a,10<(n=(120>(n=Je()-n)?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*ki(n/1960))-n)){e.timeoutHandle=na(jc.bind(null,e,Ui,Wi),n);break}jc(e,Ui,Wi);break;default:throw Error(r(329))}}}return nc(e,Je()),e.callbackNode===s?ac.bind(null,e):null}function rc(e,t){var s=Bi;return e.current.memoizedState.isDehydrated&&(mc(e,t).flags|=256),2!==(e=gc(e,t))&&(t=Ui,Ui=s,null!==t&&lc(t)),e}function lc(e){null===Ui?Ui=e:Ui.push.apply(Ui,e)}function oc(e,t){for(t&=~Oi,t&=~Ii,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var s=31-lt(t),n=1<<s;e[s]=-1,t&=~n}}function ic(e){if(0!==(6&Ei))throw Error(r(327));wc();var t=mt(e,0);if(0===(1&t))return nc(e,Je()),null;var s=gc(e,t);if(0!==e.tag&&2===s){var n=pt(e);0!==n&&(t=n,s=rc(e,n))}if(1===s)throw s=Ri,mc(e,0),oc(e,t),nc(e,Je()),s;if(6===s)throw Error(r(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,jc(e,Ui,Wi),nc(e,Je()),null}function cc(e,t){var s=Ei;Ei|=1;try{return e(t)}finally{0===(Ei=s)&&(Vi=Je()+500,Ba&&Va())}}function dc(e){null!==$i&&0===$i.tag&&0===(6&Ei)&&wc();var t=Ei;Ei|=1;var s=_i.transition,n=yt;try{if(_i.transition=null,yt=1,e)return e()}finally{yt=n,_i.transition=s,0===(6&(Ei=t))&&Va()}}function uc(){Di=Li.current,Sa(Li)}function mc(e,t){e.finishedWork=null,e.finishedLanes=0;var s=e.timeoutHandle;if(-1!==s&&(e.timeoutHandle=-1,aa(s)),null!==Pi)for(s=Pi.return;null!==s;){var n=s;switch(tr(n),n.tag){case 1:null!==(n=n.type.childContextTypes)&&void 0!==n&&La();break;case 3:Kr(),Sa(Ta),Sa(Ea),sl();break;case 5:Xr(n);break;case 4:Kr();break;case 13:case 19:Sa(Zr);break;case 10:_r(n.type._context);break;case 22:case 23:uc()}s=s.return}if(Ti=e,Pi=e=Lc(e.current,null),Ai=Di=t,Mi=0,Ri=null,Oi=Ii=Fi=0,Ui=Bi=null,null!==Ar){for(t=0;t<Ar.length;t++)if(null!==(n=(s=Ar[t]).interleaved)){s.interleaved=null;var a=n.next,r=s.pending;if(null!==r){var l=r.next;r.next=a,n.next=l}s.pending=n}Ar=null}return e}function hc(e,t){for(;;){var s=Pi;try{if(Cr(),nl.current=Jl,cl){for(var n=ll.memoizedState;null!==n;){var a=n.queue;null!==a&&(a.pending=null),n=n.next}cl=!1}if(rl=0,il=ol=ll=null,dl=!1,ul=0,Ci.current=null,null===s||null===s.return){Mi=1,Ri=t,Pi=null;break}e:{var l=e,o=s.return,i=s,c=t;if(t=Ai,i.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var d=c,u=i,m=u.tag;if(0===(1&u.mode)&&(0===m||11===m||15===m)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var p=go(o);if(null!==p){p.flags&=-257,fo(p,o,i,0,t),1&p.mode&&xo(l,d,t),c=d;var x=(t=p).updateQueue;if(null===x){var g=new Set;g.add(c),t.updateQueue=g}else x.add(c);break e}if(0===(1&t)){xo(l,d,t),xc();break e}c=Error(r(426))}else if(ar&&1&i.mode){var f=go(o);if(null!==f){0===(65536&f.flags)&&(f.flags|=256),fo(f,o,i,0,t),pr(io(c,i));break e}}l=c=io(c,i),4!==Mi&&(Mi=2),null===Bi?Bi=[l]:Bi.push(l),l=o;do{switch(l.tag){case 3:l.flags|=65536,t&=-t,l.lanes|=t,zr(l,ho(0,c,t));break e;case 1:i=c;var b=l.type,y=l.stateNode;if(0===(128&l.flags)&&("function"===typeof b.getDerivedStateFromError||null!==y&&"function"===typeof y.componentDidCatch&&(null===Yi||!Yi.has(y)))){l.flags|=65536,t&=-t,l.lanes|=t,zr(l,po(l,i,t));break e}}l=l.return}while(null!==l)}vc(s)}catch(v){t=v,Pi===s&&null!==s&&(Pi=s=s.return);continue}break}}function pc(){var e=Si.current;return Si.current=Jl,null===e?Jl:e}function xc(){0!==Mi&&3!==Mi&&2!==Mi||(Mi=4),null===Ti||0===(268435455&Fi)&&0===(268435455&Ii)||oc(Ti,Ai)}function gc(e,t){var s=Ei;Ei|=2;var n=pc();for(Ti===e&&Ai===t||(Wi=null,mc(e,t));;)try{fc();break}catch(a){hc(e,a)}if(Cr(),Ei=s,Si.current=n,null!==Pi)throw Error(r(261));return Ti=null,Ai=0,Mi}function fc(){for(;null!==Pi;)yc(Pi)}function bc(){for(;null!==Pi&&!Qe();)yc(Pi)}function yc(e){var t=Ni(e.alternate,e,Di);e.memoizedProps=e.pendingProps,null===t?vc(e):Pi=t,Ci.current=null}function vc(e){var t=e;do{var s=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(s=Go(s,t,Di)))return void(Pi=s)}else{if(null!==(s=$o(s,t)))return s.flags&=32767,void(Pi=s);if(null===e)return Mi=6,void(Pi=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Pi=t);Pi=t=e}while(null!==t);0===Mi&&(Mi=5)}function jc(e,t,s){var n=yt,a=_i.transition;try{_i.transition=null,yt=1,function(e,t,s,n){do{wc()}while(null!==$i);if(0!==(6&Ei))throw Error(r(327));s=e.finishedWork;var a=e.finishedLanes;if(null===s)return null;if(e.finishedWork=null,e.finishedLanes=0,s===e.current)throw Error(r(177));e.callbackNode=null,e.callbackPriority=0;var l=s.lanes|s.childLanes;if(function(e,t){var s=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<s;){var a=31-lt(s),r=1<<a;t[a]=0,n[a]=-1,e[a]=-1,s&=~r}}(e,l),e===Ti&&(Pi=Ti=null,Ai=0),0===(2064&s.subtreeFlags)&&0===(2064&s.flags)||Gi||(Gi=!0,Tc(tt,function(){return wc(),null})),l=0!==(15990&s.flags),0!==(15990&s.subtreeFlags)||l){l=_i.transition,_i.transition=null;var o=yt;yt=1;var i=Ei;Ei|=4,Ci.current=null,function(e,t){if(ea=qt,hn(e=mn())){if("selectionStart"in e)var s={start:e.selectionStart,end:e.selectionEnd};else e:{var n=(s=(s=e.ownerDocument)&&s.defaultView||window).getSelection&&s.getSelection();if(n&&0!==n.rangeCount){s=n.anchorNode;var a=n.anchorOffset,l=n.focusNode;n=n.focusOffset;try{s.nodeType,l.nodeType}catch(j){s=null;break e}var o=0,i=-1,c=-1,d=0,u=0,m=e,h=null;t:for(;;){for(var p;m!==s||0!==a&&3!==m.nodeType||(i=o+a),m!==l||0!==n&&3!==m.nodeType||(c=o+n),3===m.nodeType&&(o+=m.nodeValue.length),null!==(p=m.firstChild);)h=m,m=p;for(;;){if(m===e)break t;if(h===s&&++d===a&&(i=o),h===l&&++u===n&&(c=o),null!==(p=m.nextSibling))break;h=(m=h).parentNode}m=p}s=-1===i||-1===c?null:{start:i,end:c}}else s=null}s=s||{start:0,end:0}}else s=null;for(ta={focusedElem:e,selectionRange:s},qt=!1,Xo=t;null!==Xo;)if(e=(t=Xo).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Xo=e;else for(;null!==Xo;){t=Xo;try{var x=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==x){var g=x.memoizedProps,f=x.memoizedState,b=t.stateNode,y=b.getSnapshotBeforeUpdate(t.elementType===t.type?g:to(t.type,g),f);b.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var v=t.stateNode.containerInfo;1===v.nodeType?v.textContent="":9===v.nodeType&&v.documentElement&&v.removeChild(v.documentElement);break;default:throw Error(r(163))}}catch(j){kc(t,t.return,j)}if(null!==(e=t.sibling)){e.return=t.return,Xo=e;break}Xo=t.return}x=ti,ti=!1}(e,s),gi(s,e),pn(ta),qt=!!ea,ta=ea=null,e.current=s,bi(s,e,a),Ke(),Ei=i,yt=o,_i.transition=l}else e.current=s;if(Gi&&(Gi=!1,$i=e,Qi=a),l=e.pendingLanes,0===l&&(Yi=null),function(e){if(rt&&"function"===typeof rt.onCommitFiberRoot)try{rt.onCommitFiberRoot(at,e,void 0,128===(128&e.current.flags))}catch(t){}}(s.stateNode),nc(e,Je()),null!==t)for(n=e.onRecoverableError,s=0;s<t.length;s++)a=t[s],n(a.value,{componentStack:a.stack,digest:a.digest});if(qi)throw qi=!1,e=Hi,Hi=null,e;0!==(1&Qi)&&0!==e.tag&&wc(),l=e.pendingLanes,0!==(1&l)?e===Ji?Ki++:(Ki=0,Ji=e):Ki=0,Va()}(e,t,s,n)}finally{_i.transition=a,yt=n}return null}function wc(){if(null!==$i){var e=vt(Qi),t=_i.transition,s=yt;try{if(_i.transition=null,yt=16>e?16:e,null===$i)var n=!1;else{if(e=$i,$i=null,Qi=0,0!==(6&Ei))throw Error(r(331));var a=Ei;for(Ei|=4,Xo=e.current;null!==Xo;){var l=Xo,o=l.child;if(0!==(16&Xo.flags)){var i=l.deletions;if(null!==i){for(var c=0;c<i.length;c++){var d=i[c];for(Xo=d;null!==Xo;){var u=Xo;switch(u.tag){case 0:case 11:case 15:si(8,u,l)}var m=u.child;if(null!==m)m.return=u,Xo=m;else for(;null!==Xo;){var h=(u=Xo).sibling,p=u.return;if(ri(u),u===d){Xo=null;break}if(null!==h){h.return=p,Xo=h;break}Xo=p}}}var x=l.alternate;if(null!==x){var g=x.child;if(null!==g){x.child=null;do{var f=g.sibling;g.sibling=null,g=f}while(null!==g)}}Xo=l}}if(0!==(2064&l.subtreeFlags)&&null!==o)o.return=l,Xo=o;else e:for(;null!==Xo;){if(0!==(2048&(l=Xo).flags))switch(l.tag){case 0:case 11:case 15:si(9,l,l.return)}var b=l.sibling;if(null!==b){b.return=l.return,Xo=b;break e}Xo=l.return}}var y=e.current;for(Xo=y;null!==Xo;){var v=(o=Xo).child;if(0!==(2064&o.subtreeFlags)&&null!==v)v.return=o,Xo=v;else e:for(o=y;null!==Xo;){if(0!==(2048&(i=Xo).flags))try{switch(i.tag){case 0:case 11:case 15:ni(9,i)}}catch(w){kc(i,i.return,w)}if(i===o){Xo=null;break e}var j=i.sibling;if(null!==j){j.return=i.return,Xo=j;break e}Xo=i.return}}if(Ei=a,Va(),rt&&"function"===typeof rt.onPostCommitFiberRoot)try{rt.onPostCommitFiberRoot(at,e)}catch(w){}n=!0}return n}finally{yt=s,_i.transition=t}}return!1}function Nc(e,t,s){e=Br(e,t=ho(0,t=io(s,t),1),1),t=ec(),null!==e&&(ft(e,1,t),nc(e,t))}function kc(e,t,s){if(3===e.tag)Nc(e,e,s);else for(;null!==t;){if(3===t.tag){Nc(t,e,s);break}if(1===t.tag){var n=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof n.componentDidCatch&&(null===Yi||!Yi.has(n))){t=Br(t,e=po(t,e=io(s,e),1),1),e=ec(),null!==t&&(ft(t,1,e),nc(t,e));break}}t=t.return}}function Sc(e,t,s){var n=e.pingCache;null!==n&&n.delete(t),t=ec(),e.pingedLanes|=e.suspendedLanes&s,Ti===e&&(Ai&s)===s&&(4===Mi||3===Mi&&(130023424&Ai)===Ai&&500>Je()-zi?mc(e,0):Oi|=s),nc(e,t)}function Cc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=dt,0===(130023424&(dt<<=1))&&(dt=4194304)));var s=ec();null!==(e=Mr(e,t))&&(ft(e,t,s),nc(e,s))}function _c(e){var t=e.memoizedState,s=0;null!==t&&(s=t.retryLane),Cc(e,s)}function Ec(e,t){var s=0;switch(e.tag){case 13:var n=e.stateNode,a=e.memoizedState;null!==a&&(s=a.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(r(314))}null!==n&&n.delete(t),Cc(e,s)}function Tc(e,t){return Ge(e,t)}function Pc(e,t,s,n){this.tag=e,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ac(e,t,s,n){return new Pc(e,t,s,n)}function Dc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Lc(e,t){var s=e.alternate;return null===s?((s=Ac(e.tag,t,e.key,e.mode)).elementType=e.elementType,s.type=e.type,s.stateNode=e.stateNode,s.alternate=e,e.alternate=s):(s.pendingProps=t,s.type=e.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=14680064&e.flags,s.childLanes=e.childLanes,s.lanes=e.lanes,s.child=e.child,s.memoizedProps=e.memoizedProps,s.memoizedState=e.memoizedState,s.updateQueue=e.updateQueue,t=e.dependencies,s.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},s.sibling=e.sibling,s.index=e.index,s.ref=e.ref,s}function Mc(e,t,s,n,a,l){var o=2;if(n=e,"function"===typeof e)Dc(e)&&(o=1);else if("string"===typeof e)o=5;else e:switch(e){case N:return Rc(s.children,a,l,t);case k:o=8,a|=8;break;case S:return(e=Ac(12,s,t,2|a)).elementType=S,e.lanes=l,e;case T:return(e=Ac(13,s,t,a)).elementType=T,e.lanes=l,e;case P:return(e=Ac(19,s,t,a)).elementType=P,e.lanes=l,e;case L:return Fc(s,a,l,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case C:o=10;break e;case _:o=9;break e;case E:o=11;break e;case A:o=14;break e;case D:o=16,n=null;break e}throw Error(r(130,null==e?e:typeof e,""))}return(t=Ac(o,s,t,a)).elementType=e,t.type=n,t.lanes=l,t}function Rc(e,t,s,n){return(e=Ac(7,e,n,t)).lanes=s,e}function Fc(e,t,s,n){return(e=Ac(22,e,n,t)).elementType=L,e.lanes=s,e.stateNode={isHidden:!1},e}function Ic(e,t,s){return(e=Ac(6,e,null,t)).lanes=s,e}function Oc(e,t,s){return(t=Ac(4,null!==e.children?e.children:[],e.key,t)).lanes=s,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Bc(e,t,s,n,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=n,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function Uc(e,t,s,n,a,r,l,o,i){return e=new Bc(e,t,s,o,i),1===t?(t=1,!0===r&&(t|=8)):t=0,r=Ac(3,null,null,t),e.current=r,r.stateNode=e,r.memoizedState={element:n,isDehydrated:s,cache:null,transitions:null,pendingSuspenseBoundaries:null},Fr(r),e}function zc(e){if(!e)return _a;e:{if(Ve(e=e._reactInternals)!==e||1!==e.tag)throw Error(r(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Da(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(r(171))}if(1===e.tag){var s=e.type;if(Da(s))return Ra(e,s,t)}return t}function Vc(e,t,s,n,a,r,l,o,i){return(e=Uc(s,n,!0,e,0,r,0,o,i)).context=zc(null),s=e.current,(r=Or(n=ec(),a=tc(s))).callback=void 0!==t&&null!==t?t:null,Br(s,r,a),e.current.lanes=a,ft(e,a,n),nc(e,n),e}function Wc(e,t,s,n){var a=t.current,r=ec(),l=tc(a);return s=zc(s),null===t.context?t.context=s:t.pendingContext=s,(t=Or(r,l)).payload={element:e},null!==(n=void 0===n?null:n)&&(t.callback=n),null!==(e=Br(a,t,l))&&(sc(e,a,l,r),Ur(e,a,l)),l}function qc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Hc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var s=e.retryLane;e.retryLane=0!==s&&s<t?s:t}}function Yc(e,t){Hc(e,t),(e=e.alternate)&&Hc(e,t)}Ni=function(e,t,s){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ta.current)yo=!0;else{if(0===(e.lanes&s)&&0===(128&t.flags))return yo=!1,function(e,t,s){switch(t.tag){case 3:To(t),hr();break;case 5:Jr(t);break;case 1:Da(t.type)&&Fa(t);break;case 4:Qr(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,a=t.memoizedProps.value;Ca(wr,n._currentValue),n._currentValue=a;break;case 13:if(null!==(n=t.memoizedState))return null!==n.dehydrated?(Ca(Zr,1&Zr.current),t.flags|=128,null):0!==(s&t.child.childLanes)?Io(e,t,s):(Ca(Zr,1&Zr.current),null!==(e=qo(e,t,s))?e.sibling:null);Ca(Zr,1&Zr.current);break;case 19:if(n=0!==(s&t.childLanes),0!==(128&e.flags)){if(n)return Vo(e,t,s);t.flags|=128}if(null!==(a=t.memoizedState)&&(a.rendering=null,a.tail=null,a.lastEffect=null),Ca(Zr,Zr.current),n)break;return null;case 22:case 23:return t.lanes=0,ko(e,t,s)}return qo(e,t,s)}(e,t,s);yo=0!==(131072&e.flags)}else yo=!1,ar&&0!==(1048576&t.flags)&&Za(t,Ya,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;Wo(e,t),e=t.pendingProps;var a=Aa(t,Ea.current);Tr(t,s),a=xl(null,t,n,e,a,s);var l=gl();return t.flags|=1,"object"===typeof a&&null!==a&&"function"===typeof a.render&&void 0===a.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Da(n)?(l=!0,Fa(t)):l=!1,t.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,Fr(t),a.updater=no,t.stateNode=a,a._reactInternals=t,oo(t,n,e,s),t=Eo(null,t,n,!0,l,s)):(t.tag=0,ar&&l&&er(t),vo(null,t,a,s),t=t.child),t;case 16:n=t.elementType;e:{switch(Wo(e,t),e=t.pendingProps,n=(a=n._init)(n._payload),t.type=n,a=t.tag=function(e){if("function"===typeof e)return Dc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===E)return 11;if(e===A)return 14}return 2}(n),e=to(n,e),a){case 0:t=Co(null,t,n,e,s);break e;case 1:t=_o(null,t,n,e,s);break e;case 11:t=jo(null,t,n,e,s);break e;case 14:t=wo(null,t,n,to(n.type,e),s);break e}throw Error(r(306,n,""))}return t;case 0:return n=t.type,a=t.pendingProps,Co(e,t,n,a=t.elementType===n?a:to(n,a),s);case 1:return n=t.type,a=t.pendingProps,_o(e,t,n,a=t.elementType===n?a:to(n,a),s);case 3:e:{if(To(t),null===e)throw Error(r(387));n=t.pendingProps,a=(l=t.memoizedState).element,Ir(e,t),Vr(t,n,null,s);var o=t.memoizedState;if(n=o.element,l.isDehydrated){if(l={element:n,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=l,t.memoizedState=l,256&t.flags){t=Po(e,t,n,s,a=io(Error(r(423)),t));break e}if(n!==a){t=Po(e,t,n,s,a=io(Error(r(424)),t));break e}for(nr=ca(t.stateNode.containerInfo.firstChild),sr=t,ar=!0,rr=null,s=jr(t,null,n,s),t.child=s;s;)s.flags=-3&s.flags|4096,s=s.sibling}else{if(hr(),n===a){t=qo(e,t,s);break e}vo(e,t,n,s)}t=t.child}return t;case 5:return Jr(t),null===e&&cr(t),n=t.type,a=t.pendingProps,l=null!==e?e.memoizedProps:null,o=a.children,sa(n,a)?o=null:null!==l&&sa(n,l)&&(t.flags|=32),So(e,t),vo(e,t,o,s),t.child;case 6:return null===e&&cr(t),null;case 13:return Io(e,t,s);case 4:return Qr(t,t.stateNode.containerInfo),n=t.pendingProps,null===e?t.child=vr(t,null,n,s):vo(e,t,n,s),t.child;case 11:return n=t.type,a=t.pendingProps,jo(e,t,n,a=t.elementType===n?a:to(n,a),s);case 7:return vo(e,t,t.pendingProps,s),t.child;case 8:case 12:return vo(e,t,t.pendingProps.children,s),t.child;case 10:e:{if(n=t.type._context,a=t.pendingProps,l=t.memoizedProps,o=a.value,Ca(wr,n._currentValue),n._currentValue=o,null!==l)if(ln(l.value,o)){if(l.children===a.children&&!Ta.current){t=qo(e,t,s);break e}}else for(null!==(l=t.child)&&(l.return=t);null!==l;){var i=l.dependencies;if(null!==i){o=l.child;for(var c=i.firstContext;null!==c;){if(c.context===n){if(1===l.tag){(c=Or(-1,s&-s)).tag=2;var d=l.updateQueue;if(null!==d){var u=(d=d.shared).pending;null===u?c.next=c:(c.next=u.next,u.next=c),d.pending=c}}l.lanes|=s,null!==(c=l.alternate)&&(c.lanes|=s),Er(l.return,s,t),i.lanes|=s;break}c=c.next}}else if(10===l.tag)o=l.type===t.type?null:l.child;else if(18===l.tag){if(null===(o=l.return))throw Error(r(341));o.lanes|=s,null!==(i=o.alternate)&&(i.lanes|=s),Er(o,s,t),o=l.sibling}else o=l.child;if(null!==o)o.return=l;else for(o=l;null!==o;){if(o===t){o=null;break}if(null!==(l=o.sibling)){l.return=o.return,o=l;break}o=o.return}l=o}vo(e,t,a.children,s),t=t.child}return t;case 9:return a=t.type,n=t.pendingProps.children,Tr(t,s),n=n(a=Pr(a)),t.flags|=1,vo(e,t,n,s),t.child;case 14:return a=to(n=t.type,t.pendingProps),wo(e,t,n,a=to(n.type,a),s);case 15:return No(e,t,t.type,t.pendingProps,s);case 17:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:to(n,a),Wo(e,t),t.tag=1,Da(n)?(e=!0,Fa(t)):e=!1,Tr(t,s),ro(t,n,a),oo(t,n,a,s),Eo(null,t,n,!0,e,s);case 19:return Vo(e,t,s);case 22:return ko(e,t,s)}throw Error(r(156,t.tag))};var Gc="function"===typeof reportError?reportError:function(e){console.error(e)};function $c(e){this._internalRoot=e}function Qc(e){this._internalRoot=e}function Kc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Jc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Xc(){}function Zc(e,t,s,n,a){var r=s._reactRootContainer;if(r){var l=r;if("function"===typeof a){var o=a;a=function(){var e=qc(l);o.call(e)}}Wc(t,l,e,a)}else l=function(e,t,s,n,a){if(a){if("function"===typeof n){var r=n;n=function(){var e=qc(l);r.call(e)}}var l=Vc(t,n,e,0,null,!1,0,"",Xc);return e._reactRootContainer=l,e[pa]=l.current,Vn(8===e.nodeType?e.parentNode:e),dc(),l}for(;a=e.lastChild;)e.removeChild(a);if("function"===typeof n){var o=n;n=function(){var e=qc(i);o.call(e)}}var i=Uc(e,0,!1,null,0,!1,0,"",Xc);return e._reactRootContainer=i,e[pa]=i.current,Vn(8===e.nodeType?e.parentNode:e),dc(function(){Wc(t,i,s,n)}),i}(s,t,e,a,n);return qc(l)}Qc.prototype.render=$c.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(r(409));Wc(e,t,null,null)},Qc.prototype.unmount=$c.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;dc(function(){Wc(null,e,null,null)}),t[pa]=null}},Qc.prototype.unstable_scheduleHydration=function(e){if(e){var t=kt();e={blockedOn:null,target:e,priority:t};for(var s=0;s<Lt.length&&0!==t&&t<Lt[s].priority;s++);Lt.splice(s,0,e),0===s&&It(e)}},jt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var s=ut(t.pendingLanes);0!==s&&(bt(t,1|s),nc(t,Je()),0===(6&Ei)&&(Vi=Je()+500,Va()))}break;case 13:dc(function(){var t=Mr(e,1);if(null!==t){var s=ec();sc(t,e,1,s)}}),Yc(e,1)}},wt=function(e){if(13===e.tag){var t=Mr(e,134217728);if(null!==t)sc(t,e,134217728,ec());Yc(e,134217728)}},Nt=function(e){if(13===e.tag){var t=tc(e),s=Mr(e,t);if(null!==s)sc(s,e,t,ec());Yc(e,t)}},kt=function(){return yt},St=function(e,t){var s=yt;try{return yt=e,t()}finally{yt=s}},we=function(e,t,s){switch(t){case"input":if(X(e,s),t=s.name,"radio"===s.type&&null!=t){for(s=e;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<s.length;t++){var n=s[t];if(n!==e&&n.form===e.form){var a=ja(n);if(!a)throw Error(r(90));G(n),X(n,a)}}}break;case"textarea":re(e,s);break;case"select":null!=(t=s.value)&&se(e,!!s.multiple,t,!1)}},Ee=cc,Te=dc;var ed={usingClientEntryPoint:!1,Events:[ya,va,ja,Ce,_e,cc]},td={findFiberByHostInstance:ba,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},sd={bundleType:td.bundleType,version:td.version,rendererPackageName:td.rendererPackageName,rendererConfig:td.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:v.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=He(e))?null:e.stateNode},findFiberByHostInstance:td.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var nd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!nd.isDisabled&&nd.supportsFiber)try{at=nd.inject(sd),rt=nd}catch(de){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ed,t.createPortal=function(e,t){var s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Kc(t))throw Error(r(200));return function(e,t,s){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==n?null:""+n,children:e,containerInfo:t,implementation:s}}(e,t,null,s)},t.createRoot=function(e,t){if(!Kc(e))throw Error(r(299));var s=!1,n="",a=Gc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(s=!0),void 0!==t.identifierPrefix&&(n=t.identifierPrefix),void 0!==t.onRecoverableError&&(a=t.onRecoverableError)),t=Uc(e,1,!1,null,0,s,0,n,a),e[pa]=t.current,Vn(8===e.nodeType?e.parentNode:e),new $c(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(r(188));throw e=Object.keys(e).join(","),Error(r(268,e))}return e=null===(e=He(t))?null:e.stateNode},t.flushSync=function(e){return dc(e)},t.hydrate=function(e,t,s){if(!Jc(t))throw Error(r(200));return Zc(null,e,t,!0,s)},t.hydrateRoot=function(e,t,s){if(!Kc(e))throw Error(r(405));var n=null!=s&&s.hydratedSources||null,a=!1,l="",o=Gc;if(null!==s&&void 0!==s&&(!0===s.unstable_strictMode&&(a=!0),void 0!==s.identifierPrefix&&(l=s.identifierPrefix),void 0!==s.onRecoverableError&&(o=s.onRecoverableError)),t=Vc(t,null,e,1,null!=s?s:null,a,0,l,o),e[pa]=t.current,Vn(e),n)for(e=0;e<n.length;e++)a=(a=(s=n[e])._getVersion)(s._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[s,a]:t.mutableSourceEagerHydrationData.push(s,a);return new Qc(t)},t.render=function(e,t,s){if(!Jc(t))throw Error(r(200));return Zc(null,e,t,!1,s)},t.unmountComponentAtNode=function(e){if(!Jc(e))throw Error(r(40));return!!e._reactRootContainer&&(dc(function(){Zc(null,null,e,!1,function(){e._reactRootContainer=null,e[pa]=null})}),!0)},t.unstable_batchedUpdates=cc,t.unstable_renderSubtreeIntoContainer=function(e,t,s,n){if(!Jc(s))throw Error(r(200));if(null==e||void 0===e._reactInternals)throw Error(r(38));return Zc(e,t,s,!1,n)},t.version="18.3.1-next-f1338f8080-20240426"},853:(e,t,s)=>{"use strict";e.exports=s(234)},950:(e,t,s)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=s(730)}},t={};function s(n){var a=t[n];if(void 0!==a)return a.exports;var r=t[n]={exports:{}};return e[n](r,r.exports,s),r.exports}(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;s.t=function(n,a){if(1&a&&(n=this(n)),8&a)return n;if("object"===typeof n&&n){if(4&a&&n.__esModule)return n;if(16&a&&"function"===typeof n.then)return n}var r=Object.create(null);s.r(r);var l={};e=e||[null,t({}),t([]),t(t)];for(var o=2&a&&n;"object"==typeof o&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach(e=>l[e]=()=>n[e]);return l.default=()=>n,s.d(r,l),r}})(),s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e={};s.r(e),s.d(e,{hasBrowserEnv:()=>Qt,hasStandardBrowserEnv:()=>Jt,hasStandardBrowserWebWorkerEnv:()=>Xt,navigator:()=>Kt,origin:()=>Zt});var t={};s.r(t),s.d(t,{Decoder:()=>Ia,Encoder:()=>Ra,PacketType:()=>Ma,protocol:()=>La});var n,a=s(43),r=s.t(a,2),l=s(391);function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},o.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(n||(n={}));function i(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function c(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(s){}}}function d(e){let{pathname:t="/",search:s="",hash:n=""}=e;return s&&"?"!==s&&(t+="?"===s.charAt(0)?s:"?"+s),n&&"#"!==n&&(t+="#"===n.charAt(0)?n:"#"+n),t}function u(e){let t={};if(e){let s=e.indexOf("#");s>=0&&(t.hash=e.substr(s),e=e.substr(0,s));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}var m;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(m||(m={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function h(e,t,s){return void 0===s&&(s="/"),p(e,t,s,!1)}function p(e,t,s,n){let a=E(("string"===typeof t?u(t):t).pathname||"/",s);if(null==a)return null;let r=x(e);!function(e){e.sort((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let s=e.length===t.length&&e.slice(0,-1).every((e,s)=>e===t[s]);return s?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map(e=>e.childrenIndex),t.routesMeta.map(e=>e.childrenIndex)))}(r);let l=null;for(let o=0;null==l&&o<r.length;++o){let e=_(a);l=S(r[o],e,n)}return l}function x(e,t,s,n){void 0===t&&(t=[]),void 0===s&&(s=[]),void 0===n&&(n="");let a=(e,a,r)=>{let l={relativePath:void 0===r?e.path||"":r,caseSensitive:!0===e.caseSensitive,childrenIndex:a,route:e};l.relativePath.startsWith("/")&&(i(l.relativePath.startsWith(n),'Absolute route path "'+l.relativePath+'" nested under path "'+n+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),l.relativePath=l.relativePath.slice(n.length));let o=L([n,l.relativePath]),c=s.concat(l);e.children&&e.children.length>0&&(i(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+o+'".'),x(e.children,t,c,o)),(null!=e.path||e.index)&&t.push({path:o,score:k(o,e.index),routesMeta:c})};return e.forEach((e,t)=>{var s;if(""!==e.path&&null!=(s=e.path)&&s.includes("?"))for(let n of g(e.path))a(e,t,n);else a(e,t)}),t}function g(e){let t=e.split("/");if(0===t.length)return[];let[s,...n]=t,a=s.endsWith("?"),r=s.replace(/\?$/,"");if(0===n.length)return a?[r,""]:[r];let l=g(n.join("/")),o=[];return o.push(...l.map(e=>""===e?r:[r,e].join("/"))),a&&o.push(...l),o.map(t=>e.startsWith("/")&&""===t?"/":t)}const f=/^:[\w-]+$/,b=3,y=2,v=1,j=10,w=-2,N=e=>"*"===e;function k(e,t){let s=e.split("/"),n=s.length;return s.some(N)&&(n+=w),t&&(n+=y),s.filter(e=>!N(e)).reduce((e,t)=>e+(f.test(t)?b:""===t?v:j),n)}function S(e,t,s){void 0===s&&(s=!1);let{routesMeta:n}=e,a={},r="/",l=[];for(let o=0;o<n.length;++o){let e=n[o],i=o===n.length-1,c="/"===r?t:t.slice(r.length)||"/",d=C({path:e.relativePath,caseSensitive:e.caseSensitive,end:i},c),u=e.route;if(!d&&i&&s&&!n[n.length-1].route.index&&(d=C({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},c)),!d)return null;Object.assign(a,d.params),l.push({params:a,pathname:L([r,d.pathname]),pathnameBase:M(L([r,d.pathnameBase])),route:u}),"/"!==d.pathnameBase&&(r=L([r,d.pathnameBase]))}return l}function C(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[s,n]=function(e,t,s){void 0===t&&(t=!1);void 0===s&&(s=!0);c("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let n=[],a="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(e,t,s)=>(n.push({paramName:t,isOptional:null!=s}),s?"/?([^\\/]+)?":"/([^\\/]+)"));e.endsWith("*")?(n.push({paramName:"*"}),a+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):s?a+="\\/*$":""!==e&&"/"!==e&&(a+="(?:(?=\\/|$))");let r=new RegExp(a,t?void 0:"i");return[r,n]}(e.path,e.caseSensitive,e.end),a=t.match(s);if(!a)return null;let r=a[0],l=r.replace(/(.)\/+$/,"$1"),o=a.slice(1),i=n.reduce((e,t,s)=>{let{paramName:n,isOptional:a}=t;if("*"===n){let e=o[s]||"";l=r.slice(0,r.length-e.length).replace(/(.)\/+$/,"$1")}const i=o[s];return e[n]=a&&!i?void 0:(i||"").replace(/%2F/g,"/"),e},{});return{params:i,pathname:r,pathnameBase:l,pattern:e}}function _(e){try{return e.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(t){return c(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function E(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let s=t.endsWith("/")?t.length-1:t.length,n=e.charAt(s);return n&&"/"!==n?null:e.slice(s)||"/"}function T(e,t,s,n){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(n)+"].  Please separate it out to the `to."+s+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function P(e){return e.filter((e,t)=>0===t||e.route.path&&e.route.path.length>0)}function A(e,t){let s=P(e);return t?s.map((e,t)=>t===s.length-1?e.pathname:e.pathnameBase):s.map(e=>e.pathnameBase)}function D(e,t,s,n){let a;void 0===n&&(n=!1),"string"===typeof e?a=u(e):(a=o({},e),i(!a.pathname||!a.pathname.includes("?"),T("?","pathname","search",a)),i(!a.pathname||!a.pathname.includes("#"),T("#","pathname","hash",a)),i(!a.search||!a.search.includes("#"),T("#","search","hash",a)));let r,l=""===e||""===a.pathname,c=l?"/":a.pathname;if(null==c)r=s;else{let e=t.length-1;if(!n&&c.startsWith("..")){let t=c.split("/");for(;".."===t[0];)t.shift(),e-=1;a.pathname=t.join("/")}r=e>=0?t[e]:"/"}let d=function(e,t){void 0===t&&(t="/");let{pathname:s,search:n="",hash:a=""}="string"===typeof e?u(e):e,r=s?s.startsWith("/")?s:function(e,t){let s=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?s.length>1&&s.pop():"."!==e&&s.push(e)}),s.length>1?s.join("/"):"/"}(s,t):t;return{pathname:r,search:R(n),hash:F(a)}}(a,r),m=c&&"/"!==c&&c.endsWith("/"),h=(l||"."===c)&&s.endsWith("/");return d.pathname.endsWith("/")||!m&&!h||(d.pathname+="/"),d}const L=e=>e.join("/").replace(/\/\/+/g,"/"),M=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),R=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",F=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;function I(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}const O=["post","put","patch","delete"],B=(new Set(O),["get",...O]);new Set(B),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function U(){return U=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},U.apply(this,arguments)}const z=a.createContext(null);const V=a.createContext(null);const W=a.createContext(null);const q=a.createContext(null);const H=a.createContext({outlet:null,matches:[],isDataRoute:!1});const Y=a.createContext(null);function G(){return null!=a.useContext(q)}function $(){return G()||i(!1),a.useContext(q).location}function Q(e){a.useContext(W).static||a.useLayoutEffect(e)}function K(){let{isDataRoute:e}=a.useContext(H);return e?function(){let{router:e}=oe(re.UseNavigateStable),t=ce(le.UseNavigateStable),s=a.useRef(!1);Q(()=>{s.current=!0});let n=a.useCallback(function(n,a){void 0===a&&(a={}),s.current&&("number"===typeof n?e.navigate(n):e.navigate(n,U({fromRouteId:t},a)))},[e,t]);return n}():function(){G()||i(!1);let e=a.useContext(z),{basename:t,future:s,navigator:n}=a.useContext(W),{matches:r}=a.useContext(H),{pathname:l}=$(),o=JSON.stringify(A(r,s.v7_relativeSplatPath)),c=a.useRef(!1);return Q(()=>{c.current=!0}),a.useCallback(function(s,a){if(void 0===a&&(a={}),!c.current)return;if("number"===typeof s)return void n.go(s);let r=D(s,JSON.parse(o),l,"path"===a.relative);null==e&&"/"!==t&&(r.pathname="/"===r.pathname?t:L([t,r.pathname])),(a.replace?n.replace:n.push)(r,a.state,a)},[t,n,o,l,e])}()}function J(){let{matches:e}=a.useContext(H),t=e[e.length-1];return t?t.params:{}}function X(e,t){let{relative:s}=void 0===t?{}:t,{future:n}=a.useContext(W),{matches:r}=a.useContext(H),{pathname:l}=$(),o=JSON.stringify(A(r,n.v7_relativeSplatPath));return a.useMemo(()=>D(e,JSON.parse(o),l,"path"===s),[e,o,l,s])}function Z(e,t,s,r){G()||i(!1);let{navigator:l}=a.useContext(W),{matches:o}=a.useContext(H),c=o[o.length-1],d=c?c.params:{},m=(c&&c.pathname,c?c.pathnameBase:"/");c&&c.route;let p,x=$();if(t){var g;let e="string"===typeof t?u(t):t;"/"===m||(null==(g=e.pathname)?void 0:g.startsWith(m))||i(!1),p=e}else p=x;let f=p.pathname||"/",b=f;if("/"!==m){let e=m.replace(/^\//,"").split("/");b="/"+f.replace(/^\//,"").split("/").slice(e.length).join("/")}let y=h(e,{pathname:b});let v=ae(y&&y.map(e=>Object.assign({},e,{params:Object.assign({},d,e.params),pathname:L([m,l.encodeLocation?l.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?m:L([m,l.encodeLocation?l.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])})),o,s,r);return t&&v?a.createElement(q.Provider,{value:{location:U({pathname:"/",search:"",hash:"",state:null,key:"default"},p),navigationType:n.Pop}},v):v}function ee(){let e=function(){var e;let t=a.useContext(Y),s=ie(le.UseRouteError),n=ce(le.UseRouteError);if(void 0!==t)return t;return null==(e=s.errors)?void 0:e[n]}(),t=I(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),s=e instanceof Error?e.stack:null,n="rgba(200,200,200, 0.5)",r={padding:"0.5rem",backgroundColor:n};return a.createElement(a.Fragment,null,a.createElement("h2",null,"Unexpected Application Error!"),a.createElement("h3",{style:{fontStyle:"italic"}},t),s?a.createElement("pre",{style:r},s):null,null)}const te=a.createElement(ee,null);class se extends a.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?a.createElement(H.Provider,{value:this.props.routeContext},a.createElement(Y.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function ne(e){let{routeContext:t,match:s,children:n}=e,r=a.useContext(z);return r&&r.static&&r.staticContext&&(s.route.errorElement||s.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=s.route.id),a.createElement(H.Provider,{value:t},n)}function ae(e,t,s,n){var r;if(void 0===t&&(t=[]),void 0===s&&(s=null),void 0===n&&(n=null),null==e){var l;if(!s)return null;if(s.errors)e=s.matches;else{if(!(null!=(l=n)&&l.v7_partialHydration&&0===t.length&&!s.initialized&&s.matches.length>0))return null;e=s.matches}}let o=e,c=null==(r=s)?void 0:r.errors;if(null!=c){let e=o.findIndex(e=>e.route.id&&void 0!==(null==c?void 0:c[e.route.id]));e>=0||i(!1),o=o.slice(0,Math.min(o.length,e+1))}let d=!1,u=-1;if(s&&n&&n.v7_partialHydration)for(let a=0;a<o.length;a++){let e=o[a];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(u=a),e.route.id){let{loaderData:t,errors:n}=s,a=e.route.loader&&void 0===t[e.route.id]&&(!n||void 0===n[e.route.id]);if(e.route.lazy||a){d=!0,o=u>=0?o.slice(0,u+1):[o[0]];break}}}return o.reduceRight((e,n,r)=>{let l,i=!1,m=null,h=null;var p;s&&(l=c&&n.route.id?c[n.route.id]:void 0,m=n.route.errorElement||te,d&&(u<0&&0===r?(p="route-fallback",!1||de[p]||(de[p]=!0),i=!0,h=null):u===r&&(i=!0,h=n.route.hydrateFallbackElement||null)));let x=t.concat(o.slice(0,r+1)),g=()=>{let t;return t=l?m:i?h:n.route.Component?a.createElement(n.route.Component,null):n.route.element?n.route.element:e,a.createElement(ne,{match:n,routeContext:{outlet:e,matches:x,isDataRoute:null!=s},children:t})};return s&&(n.route.ErrorBoundary||n.route.errorElement||0===r)?a.createElement(se,{location:s.location,revalidation:s.revalidation,component:m,error:l,children:g(),routeContext:{outlet:null,matches:x,isDataRoute:!0}}):g()},null)}var re=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(re||{}),le=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(le||{});function oe(e){let t=a.useContext(z);return t||i(!1),t}function ie(e){let t=a.useContext(V);return t||i(!1),t}function ce(e){let t=function(){let e=a.useContext(H);return e||i(!1),e}(),s=t.matches[t.matches.length-1];return s.route.id||i(!1),s.route.id}const de={};function ue(e,t){null==e||e.v7_startTransition,void 0===(null==e?void 0:e.v7_relativeSplatPath)&&(!t||t.v7_relativeSplatPath),t&&(t.v7_fetcherPersist,t.v7_normalizeFormMethod,t.v7_partialHydration,t.v7_skipActionErrorRevalidation)}r.startTransition;function me(e){let{to:t,replace:s,state:n,relative:r}=e;G()||i(!1);let{future:l,static:o}=a.useContext(W),{matches:c}=a.useContext(H),{pathname:d}=$(),u=K(),m=D(t,A(c,l.v7_relativeSplatPath),d,"path"===r),h=JSON.stringify(m);return a.useEffect(()=>u(JSON.parse(h),{replace:s,state:n,relative:r}),[u,h,r,s,n]),null}function he(e){i(!1)}function pe(e){let{basename:t="/",children:s=null,location:r,navigationType:l=n.Pop,navigator:o,static:c=!1,future:d}=e;G()&&i(!1);let m=t.replace(/^\/*/,"/"),h=a.useMemo(()=>({basename:m,navigator:o,static:c,future:U({v7_relativeSplatPath:!1},d)}),[m,d,o,c]);"string"===typeof r&&(r=u(r));let{pathname:p="/",search:x="",hash:g="",state:f=null,key:b="default"}=r,y=a.useMemo(()=>{let e=E(p,m);return null==e?null:{location:{pathname:e,search:x,hash:g,state:f,key:b},navigationType:l}},[m,p,x,g,f,b,l]);return null==y?null:a.createElement(W.Provider,{value:h},a.createElement(q.Provider,{children:s,value:y}))}function xe(e){let{children:t,location:s}=e;return Z(ge(t),s)}new Promise(()=>{});a.Component;function ge(e,t){void 0===t&&(t=[]);let s=[];return a.Children.forEach(e,(e,n)=>{if(!a.isValidElement(e))return;let r=[...t,n];if(e.type===a.Fragment)return void s.push.apply(s,ge(e.props.children,r));e.type!==he&&i(!1),e.props.index&&e.props.children&&i(!1);let l={id:e.props.id||r.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(l.children=ge(e.props.children,r)),s.push(l)}),s}var fe=s(950),be=s.t(fe,2);function ye(){return ye=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},ye.apply(this,arguments)}function ve(e,t){if(null==e)return{};var s,n,a={},r=Object.keys(e);for(n=0;n<r.length;n++)s=r[n],t.indexOf(s)>=0||(a[s]=e[s]);return a}function je(e){return void 0===e&&(e=""),new URLSearchParams("string"===typeof e||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,s)=>{let n=e[s];return t.concat(Array.isArray(n)?n.map(e=>[s,e]):[[s,n]])},[]))}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);const we=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"];try{window.__reactRouterVersion="6"}catch(ey){}new Map;const Ne=r.startTransition;be.flushSync,r.useId;function ke(e){let{basename:t,children:s,future:n,history:r}=e,[l,o]=a.useState({action:r.action,location:r.location}),{v7_startTransition:i}=n||{},c=a.useCallback(e=>{i&&Ne?Ne(()=>o(e)):o(e)},[o,i]);return a.useLayoutEffect(()=>r.listen(c),[r,c]),a.useEffect(()=>ue(n),[n]),a.createElement(pe,{basename:t,children:s,location:l.location,navigationType:l.action,navigator:r,future:n})}const Se="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement,Ce=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,_e=a.forwardRef(function(e,t){let s,{onClick:n,relative:r,reloadDocument:l,replace:o,state:c,target:u,to:m,preventScrollReset:h,viewTransition:p}=e,x=ve(e,we),{basename:g}=a.useContext(W),f=!1;if("string"===typeof m&&Ce.test(m)&&(s=m,Se))try{let e=new URL(window.location.href),t=m.startsWith("//")?new URL(e.protocol+m):new URL(m),s=E(t.pathname,g);t.origin===e.origin&&null!=s?m=s+t.search+t.hash:f=!0}catch(ey){}let b=function(e,t){let{relative:s}=void 0===t?{}:t;G()||i(!1);let{basename:n,navigator:r}=a.useContext(W),{hash:l,pathname:o,search:c}=X(e,{relative:s}),d=o;return"/"!==n&&(d="/"===o?n:L([n,o])),r.createHref({pathname:d,search:c,hash:l})}(m,{relative:r}),y=function(e,t){let{target:s,replace:n,state:r,preventScrollReset:l,relative:o,viewTransition:i}=void 0===t?{}:t,c=K(),u=$(),m=X(e,{relative:o});return a.useCallback(t=>{if(function(e,t){return 0===e.button&&(!t||"_self"===t)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)}(t,s)){t.preventDefault();let s=void 0!==n?n:d(u)===d(m);c(e,{replace:s,state:r,preventScrollReset:l,relative:o,viewTransition:i})}},[u,c,m,n,r,s,e,l,o,i])}(m,{replace:o,state:c,target:u,preventScrollReset:h,relative:r,viewTransition:p});return a.createElement("a",ye({},x,{href:s||b,onClick:f||l?n:function(e){n&&n(e),e.defaultPrevented||y(e)},ref:t,target:u}))});var Ee,Te;function Pe(e){let t=a.useRef(je(e)),s=a.useRef(!1),n=$(),r=a.useMemo(()=>function(e,t){let s=je(e);return t&&t.forEach((e,n)=>{s.has(n)||t.getAll(n).forEach(e=>{s.append(n,e)})}),s}(n.search,s.current?null:t.current),[n.search]),l=K(),o=a.useCallback((e,t)=>{const n=je("function"===typeof e?e(r):e);s.current=!0,l("?"+n,t)},[l,r]);return[r,o]}(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(Ee||(Ee={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(Te||(Te={}));function Ae(){return Ae=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)({}).hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},Ae.apply(null,arguments)}var De;!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(De||(De={}));var Le=function(e){return e};var Me="beforeunload",Re="popstate";function Fe(e){e.preventDefault(),e.returnValue=""}function Ie(){var e=[];return{get length(){return e.length},push:function(t){return e.push(t),function(){e=e.filter(function(e){return e!==t})}},call:function(t){e.forEach(function(e){return e&&e(t)})}}}function Oe(){return Math.random().toString(36).substr(2,8)}function Be(e){var t=e.pathname,s=void 0===t?"/":t,n=e.search,a=void 0===n?"":n,r=e.hash,l=void 0===r?"":r;return a&&"?"!==a&&(s+="?"===a.charAt(0)?a:"?"+a),l&&"#"!==l&&(s+="#"===l.charAt(0)?l:"#"+l),s}function Ue(e){var t={};if(e){var s=e.indexOf("#");s>=0&&(t.hash=e.substr(s),e=e.substr(0,s));var n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function ze(e){return ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ze(e)}function Ve(e){var t=function(e,t){if("object"!=ze(e)||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var n=s.call(e,t||"default");if("object"!=ze(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==ze(t)?t:t+""}function We(e,t,s){return(t=Ve(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function qe(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}function He(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?qe(Object(s),!0).forEach(function(t){We(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):qe(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}function Ye(e,t){return function(){return e.apply(t,arguments)}}const{toString:Ge}=Object.prototype,{getPrototypeOf:$e}=Object,{iterator:Qe,toStringTag:Ke}=Symbol,Je=(e=>t=>{const s=Ge.call(t);return e[s]||(e[s]=s.slice(8,-1).toLowerCase())})(Object.create(null)),Xe=e=>(e=e.toLowerCase(),t=>Je(t)===e),Ze=e=>t=>typeof t===e,{isArray:et}=Array,tt=Ze("undefined");const st=Xe("ArrayBuffer");const nt=Ze("string"),at=Ze("function"),rt=Ze("number"),lt=e=>null!==e&&"object"===typeof e,ot=e=>{if("object"!==Je(e))return!1;const t=$e(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Ke in e)&&!(Qe in e)},it=Xe("Date"),ct=Xe("File"),dt=Xe("Blob"),ut=Xe("FileList"),mt=Xe("URLSearchParams"),[ht,pt,xt,gt]=["ReadableStream","Request","Response","Headers"].map(Xe);function ft(e,t){let s,n,{allOwnKeys:a=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!==e&&"undefined"!==typeof e)if("object"!==typeof e&&(e=[e]),et(e))for(s=0,n=e.length;s<n;s++)t.call(null,e[s],s,e);else{const n=a?Object.getOwnPropertyNames(e):Object.keys(e),r=n.length;let l;for(s=0;s<r;s++)l=n[s],t.call(null,e[l],l,e)}}function bt(e,t){t=t.toLowerCase();const s=Object.keys(e);let n,a=s.length;for(;a-- >0;)if(n=s[a],t===n.toLowerCase())return n;return null}const yt="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:global,vt=e=>!tt(e)&&e!==yt;const jt=(wt="undefined"!==typeof Uint8Array&&$e(Uint8Array),e=>wt&&e instanceof wt);var wt;const Nt=Xe("HTMLFormElement"),kt=(e=>{let{hasOwnProperty:t}=e;return(e,s)=>t.call(e,s)})(Object.prototype),St=Xe("RegExp"),Ct=(e,t)=>{const s=Object.getOwnPropertyDescriptors(e),n={};ft(s,(s,a)=>{let r;!1!==(r=t(s,a,e))&&(n[a]=r||s)}),Object.defineProperties(e,n)};const _t=Xe("AsyncFunction"),Et=((e,t)=>{return e?setImmediate:t?(s="axios@".concat(Math.random()),n=[],yt.addEventListener("message",e=>{let{source:t,data:a}=e;t===yt&&a===s&&n.length&&n.shift()()},!1),e=>{n.push(e),yt.postMessage(s,"*")}):e=>setTimeout(e);var s,n})("function"===typeof setImmediate,at(yt.postMessage)),Tt="undefined"!==typeof queueMicrotask?queueMicrotask.bind(yt):"undefined"!==typeof process&&process.nextTick||Et,Pt={isArray:et,isArrayBuffer:st,isBuffer:function(e){return null!==e&&!tt(e)&&null!==e.constructor&&!tt(e.constructor)&&at(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"===typeof FormData&&e instanceof FormData||at(e.append)&&("formdata"===(t=Je(e))||"object"===t&&at(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!==typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&st(e.buffer),t},isString:nt,isNumber:rt,isBoolean:e=>!0===e||!1===e,isObject:lt,isPlainObject:ot,isReadableStream:ht,isRequest:pt,isResponse:xt,isHeaders:gt,isUndefined:tt,isDate:it,isFile:ct,isBlob:dt,isRegExp:St,isFunction:at,isStream:e=>lt(e)&&at(e.pipe),isURLSearchParams:mt,isTypedArray:jt,isFileList:ut,forEach:ft,merge:function e(){const{caseless:t}=vt(this)&&this||{},s={},n=(n,a)=>{const r=t&&bt(s,a)||a;ot(s[r])&&ot(n)?s[r]=e(s[r],n):ot(n)?s[r]=e({},n):et(n)?s[r]=n.slice():s[r]=n};for(let a=0,r=arguments.length;a<r;a++)arguments[a]&&ft(arguments[a],n);return s},extend:function(e,t,s){let{allOwnKeys:n}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return ft(t,(t,n)=>{s&&at(t)?e[n]=Ye(t,s):e[n]=t},{allOwnKeys:n}),e},trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,s,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),s&&Object.assign(e.prototype,s)},toFlatObject:(e,t,s,n)=>{let a,r,l;const o={};if(t=t||{},null==e)return t;do{for(a=Object.getOwnPropertyNames(e),r=a.length;r-- >0;)l=a[r],n&&!n(l,e,t)||o[l]||(t[l]=e[l],o[l]=!0);e=!1!==s&&$e(e)}while(e&&(!s||s(e,t))&&e!==Object.prototype);return t},kindOf:Je,kindOfTest:Xe,endsWith:(e,t,s)=>{e=String(e),(void 0===s||s>e.length)&&(s=e.length),s-=t.length;const n=e.indexOf(t,s);return-1!==n&&n===s},toArray:e=>{if(!e)return null;if(et(e))return e;let t=e.length;if(!rt(t))return null;const s=new Array(t);for(;t-- >0;)s[t]=e[t];return s},forEachEntry:(e,t)=>{const s=(e&&e[Qe]).call(e);let n;for(;(n=s.next())&&!n.done;){const s=n.value;t.call(e,s[0],s[1])}},matchAll:(e,t)=>{let s;const n=[];for(;null!==(s=e.exec(t));)n.push(s);return n},isHTMLForm:Nt,hasOwnProperty:kt,hasOwnProp:kt,reduceDescriptors:Ct,freezeMethods:e=>{Ct(e,(t,s)=>{if(at(e)&&-1!==["arguments","caller","callee"].indexOf(s))return!1;const n=e[s];at(n)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")}))})},toObjectSet:(e,t)=>{const s={},n=e=>{e.forEach(e=>{s[e]=!0})};return et(e)?n(e):n(String(e).split(t)),s},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,s){return t.toUpperCase()+s}),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:bt,global:yt,isContextDefined:vt,isSpecCompliantForm:function(e){return!!(e&&at(e.append)&&"FormData"===e[Ke]&&e[Qe])},toJSONObject:e=>{const t=new Array(10),s=(e,n)=>{if(lt(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[n]=e;const a=et(e)?[]:{};return ft(e,(e,t)=>{const r=s(e,n+1);!tt(r)&&(a[t]=r)}),t[n]=void 0,a}}return e};return s(e,0)},isAsyncFn:_t,isThenable:e=>e&&(lt(e)||at(e))&&at(e.then)&&at(e.catch),setImmediate:Et,asap:Tt,isIterable:e=>null!=e&&at(e[Qe])};function At(e,t,s,n,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),s&&(this.config=s),n&&(this.request=n),a&&(this.response=a,this.status=a.status?a.status:null)}Pt.inherits(At,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Pt.toJSONObject(this.config),code:this.code,status:this.status}}});const Dt=At.prototype,Lt={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{Lt[e]={value:e}}),Object.defineProperties(At,Lt),Object.defineProperty(Dt,"isAxiosError",{value:!0}),At.from=(e,t,s,n,a,r)=>{const l=Object.create(Dt);return Pt.toFlatObject(e,l,function(e){return e!==Error.prototype},e=>"isAxiosError"!==e),At.call(l,e.message,t,s,n,a),l.cause=e,l.name=e.name,r&&Object.assign(l,r),l};const Mt=At;function Rt(e){return Pt.isPlainObject(e)||Pt.isArray(e)}function Ft(e){return Pt.endsWith(e,"[]")?e.slice(0,-2):e}function It(e,t,s){return e?e.concat(t).map(function(e,t){return e=Ft(e),!s&&t?"["+e+"]":e}).join(s?".":""):t}const Ot=Pt.toFlatObject(Pt,{},null,function(e){return/^is[A-Z]/.test(e)});const Bt=function(e,t,s){if(!Pt.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const n=(s=Pt.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!Pt.isUndefined(t[e])})).metaTokens,a=s.visitor||c,r=s.dots,l=s.indexes,o=(s.Blob||"undefined"!==typeof Blob&&Blob)&&Pt.isSpecCompliantForm(t);if(!Pt.isFunction(a))throw new TypeError("visitor must be a function");function i(e){if(null===e)return"";if(Pt.isDate(e))return e.toISOString();if(Pt.isBoolean(e))return e.toString();if(!o&&Pt.isBlob(e))throw new Mt("Blob is not supported. Use a Buffer instead.");return Pt.isArrayBuffer(e)||Pt.isTypedArray(e)?o&&"function"===typeof Blob?new Blob([e]):Buffer.from(e):e}function c(e,s,a){let o=e;if(e&&!a&&"object"===typeof e)if(Pt.endsWith(s,"{}"))s=n?s:s.slice(0,-2),e=JSON.stringify(e);else if(Pt.isArray(e)&&function(e){return Pt.isArray(e)&&!e.some(Rt)}(e)||(Pt.isFileList(e)||Pt.endsWith(s,"[]"))&&(o=Pt.toArray(e)))return s=Ft(s),o.forEach(function(e,n){!Pt.isUndefined(e)&&null!==e&&t.append(!0===l?It([s],n,r):null===l?s:s+"[]",i(e))}),!1;return!!Rt(e)||(t.append(It(a,s,r),i(e)),!1)}const d=[],u=Object.assign(Ot,{defaultVisitor:c,convertValue:i,isVisitable:Rt});if(!Pt.isObject(e))throw new TypeError("data must be an object");return function e(s,n){if(!Pt.isUndefined(s)){if(-1!==d.indexOf(s))throw Error("Circular reference detected in "+n.join("."));d.push(s),Pt.forEach(s,function(s,r){!0===(!(Pt.isUndefined(s)||null===s)&&a.call(t,s,Pt.isString(r)?r.trim():r,n,u))&&e(s,n?n.concat(r):[r])}),d.pop()}}(e),t};function Ut(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function zt(e,t){this._pairs=[],e&&Bt(e,this,t)}const Vt=zt.prototype;Vt.append=function(e,t){this._pairs.push([e,t])},Vt.toString=function(e){const t=e?function(t){return e.call(this,t,Ut)}:Ut;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};const Wt=zt;function qt(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Ht(e,t,s){if(!t)return e;const n=s&&s.encode||qt;Pt.isFunction(s)&&(s={serialize:s});const a=s&&s.serialize;let r;if(r=a?a(t,s):Pt.isURLSearchParams(t)?t.toString():new Wt(t,s).toString(n),r){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+r}return e}const Yt=class{constructor(){this.handlers=[]}use(e,t,s){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!s&&s.synchronous,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Pt.forEach(this.handlers,function(t){null!==t&&e(t)})}},Gt={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},$t={isBrowser:!0,classes:{URLSearchParams:"undefined"!==typeof URLSearchParams?URLSearchParams:Wt,FormData:"undefined"!==typeof FormData?FormData:null,Blob:"undefined"!==typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},Qt="undefined"!==typeof window&&"undefined"!==typeof document,Kt="object"===typeof navigator&&navigator||void 0,Jt=Qt&&(!Kt||["ReactNative","NativeScript","NS"].indexOf(Kt.product)<0),Xt="undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"===typeof self.importScripts,Zt=Qt&&window.location.href||"http://localhost",es=He(He({},e),$t);const ts=function(e){function t(e,s,n,a){let r=e[a++];if("__proto__"===r)return!0;const l=Number.isFinite(+r),o=a>=e.length;if(r=!r&&Pt.isArray(n)?n.length:r,o)return Pt.hasOwnProp(n,r)?n[r]=[n[r],s]:n[r]=s,!l;n[r]&&Pt.isObject(n[r])||(n[r]=[]);return t(e,s,n[r],a)&&Pt.isArray(n[r])&&(n[r]=function(e){const t={},s=Object.keys(e);let n;const a=s.length;let r;for(n=0;n<a;n++)r=s[n],t[r]=e[r];return t}(n[r])),!l}if(Pt.isFormData(e)&&Pt.isFunction(e.entries)){const s={};return Pt.forEachEntry(e,(e,n)=>{t(function(e){return Pt.matchAll(/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0])}(e),n,s,0)}),s}return null};const ss={transitional:Gt,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const s=t.getContentType()||"",n=s.indexOf("application/json")>-1,a=Pt.isObject(e);a&&Pt.isHTMLForm(e)&&(e=new FormData(e));if(Pt.isFormData(e))return n?JSON.stringify(ts(e)):e;if(Pt.isArrayBuffer(e)||Pt.isBuffer(e)||Pt.isStream(e)||Pt.isFile(e)||Pt.isBlob(e)||Pt.isReadableStream(e))return e;if(Pt.isArrayBufferView(e))return e.buffer;if(Pt.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let r;if(a){if(s.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return Bt(e,new es.classes.URLSearchParams,Object.assign({visitor:function(e,t,s,n){return es.isNode&&Pt.isBuffer(e)?(this.append(t,e.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((r=Pt.isFileList(e))||s.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return Bt(r?{"files[]":e}:e,t&&new t,this.formSerializer)}}return a||n?(t.setContentType("application/json",!1),function(e,t,s){if(Pt.isString(e))try{return(t||JSON.parse)(e),Pt.trim(e)}catch(ey){if("SyntaxError"!==ey.name)throw ey}return(s||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||ss.transitional,s=t&&t.forcedJSONParsing,n="json"===this.responseType;if(Pt.isResponse(e)||Pt.isReadableStream(e))return e;if(e&&Pt.isString(e)&&(s&&!this.responseType||n)){const s=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(ey){if(s){if("SyntaxError"===ey.name)throw Mt.from(ey,Mt.ERR_BAD_RESPONSE,this,null,this.response);throw ey}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:es.classes.FormData,Blob:es.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Pt.forEach(["delete","get","head","post","put","patch"],e=>{ss.headers[e]={}});const ns=ss,as=Pt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),rs=Symbol("internals");function ls(e){return e&&String(e).trim().toLowerCase()}function os(e){return!1===e||null==e?e:Pt.isArray(e)?e.map(os):String(e)}function is(e,t,s,n,a){return Pt.isFunction(n)?n.call(this,t,s):(a&&(t=s),Pt.isString(t)?Pt.isString(n)?-1!==t.indexOf(n):Pt.isRegExp(n)?n.test(t):void 0:void 0)}class cs{constructor(e){e&&this.set(e)}set(e,t,s){const n=this;function a(e,t,s){const a=ls(t);if(!a)throw new Error("header name must be a non-empty string");const r=Pt.findKey(n,a);(!r||void 0===n[r]||!0===s||void 0===s&&!1!==n[r])&&(n[r||t]=os(e))}const r=(e,t)=>Pt.forEach(e,(e,s)=>a(e,s,t));if(Pt.isPlainObject(e)||e instanceof this.constructor)r(e,t);else if(Pt.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))r((e=>{const t={};let s,n,a;return e&&e.split("\n").forEach(function(e){a=e.indexOf(":"),s=e.substring(0,a).trim().toLowerCase(),n=e.substring(a+1).trim(),!s||t[s]&&as[s]||("set-cookie"===s?t[s]?t[s].push(n):t[s]=[n]:t[s]=t[s]?t[s]+", "+n:n)}),t})(e),t);else if(Pt.isObject(e)&&Pt.isIterable(e)){let s,n,a={};for(const t of e){if(!Pt.isArray(t))throw TypeError("Object iterator must return a key-value pair");a[n=t[0]]=(s=a[n])?Pt.isArray(s)?[...s,t[1]]:[s,t[1]]:t[1]}r(a,t)}else null!=e&&a(t,e,s);return this}get(e,t){if(e=ls(e)){const s=Pt.findKey(this,e);if(s){const e=this[s];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),s=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=s.exec(e);)t[n[1]]=n[2];return t}(e);if(Pt.isFunction(t))return t.call(this,e,s);if(Pt.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=ls(e)){const s=Pt.findKey(this,e);return!(!s||void 0===this[s]||t&&!is(0,this[s],s,t))}return!1}delete(e,t){const s=this;let n=!1;function a(e){if(e=ls(e)){const a=Pt.findKey(s,e);!a||t&&!is(0,s[a],a,t)||(delete s[a],n=!0)}}return Pt.isArray(e)?e.forEach(a):a(e),n}clear(e){const t=Object.keys(this);let s=t.length,n=!1;for(;s--;){const a=t[s];e&&!is(0,this[a],a,e,!0)||(delete this[a],n=!0)}return n}normalize(e){const t=this,s={};return Pt.forEach(this,(n,a)=>{const r=Pt.findKey(s,a);if(r)return t[r]=os(n),void delete t[a];const l=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,s)=>t.toUpperCase()+s)}(a):String(a).trim();l!==a&&delete t[a],t[l]=os(n),s[l]=!0}),this}concat(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return this.constructor.concat(this,...t)}toJSON(e){const t=Object.create(null);return Pt.forEach(this,(s,n)=>{null!=s&&!1!==s&&(t[n]=e&&Pt.isArray(s)?s.join(", "):s)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[t,s]=e;return t+": "+s}).join("\n")}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const t=new this(e);for(var s=arguments.length,n=new Array(s>1?s-1:0),a=1;a<s;a++)n[a-1]=arguments[a];return n.forEach(e=>t.set(e)),t}static accessor(e){const t=(this[rs]=this[rs]={accessors:{}}).accessors,s=this.prototype;function n(e){const n=ls(e);t[n]||(!function(e,t){const s=Pt.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(e,n+s,{value:function(e,s,a){return this[n].call(this,t,e,s,a)},configurable:!0})})}(s,e),t[n]=!0)}return Pt.isArray(e)?e.forEach(n):n(e),this}}cs.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Pt.reduceDescriptors(cs.prototype,(e,t)=>{let{value:s}=e,n=t[0].toUpperCase()+t.slice(1);return{get:()=>s,set(e){this[n]=e}}}),Pt.freezeMethods(cs);const ds=cs;function us(e,t){const s=this||ns,n=t||s,a=ds.from(n.headers);let r=n.data;return Pt.forEach(e,function(e){r=e.call(s,r,a.normalize(),t?t.status:void 0)}),a.normalize(),r}function ms(e){return!(!e||!e.__CANCEL__)}function hs(e,t,s){Mt.call(this,null==e?"canceled":e,Mt.ERR_CANCELED,t,s),this.name="CanceledError"}Pt.inherits(hs,Mt,{__CANCEL__:!0});const ps=hs;function xs(e,t,s){const n=s.config.validateStatus;s.status&&n&&!n(s.status)?t(new Mt("Request failed with status code "+s.status,[Mt.ERR_BAD_REQUEST,Mt.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s)):e(s)}const gs=function(e,t){e=e||10;const s=new Array(e),n=new Array(e);let a,r=0,l=0;return t=void 0!==t?t:1e3,function(o){const i=Date.now(),c=n[l];a||(a=i),s[r]=o,n[r]=i;let d=l,u=0;for(;d!==r;)u+=s[d++],d%=e;if(r=(r+1)%e,r===l&&(l=(l+1)%e),i-a<t)return;const m=c&&i-c;return m?Math.round(1e3*u/m):void 0}};const fs=function(e,t){let s,n,a=0,r=1e3/t;const l=function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();a=r,s=null,n&&(clearTimeout(n),n=null),e.apply(null,t)};return[function(){const e=Date.now(),t=e-a;for(var o=arguments.length,i=new Array(o),c=0;c<o;c++)i[c]=arguments[c];t>=r?l(i,e):(s=i,n||(n=setTimeout(()=>{n=null,l(s)},r-t)))},()=>s&&l(s)]},bs=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,n=0;const a=gs(50,250);return fs(s=>{const r=s.loaded,l=s.lengthComputable?s.total:void 0,o=r-n,i=a(o);n=r;e({loaded:r,total:l,progress:l?r/l:void 0,bytes:o,rate:i||void 0,estimated:i&&l&&r<=l?(l-r)/i:void 0,event:s,lengthComputable:null!=l,[t?"download":"upload"]:!0})},s)},ys=(e,t)=>{const s=null!=e;return[n=>t[0]({lengthComputable:s,total:e,loaded:n}),t[1]]},vs=e=>function(){for(var t=arguments.length,s=new Array(t),n=0;n<t;n++)s[n]=arguments[n];return Pt.asap(()=>e(...s))},js=es.hasStandardBrowserEnv?((e,t)=>s=>(s=new URL(s,es.origin),e.protocol===s.protocol&&e.host===s.host&&(t||e.port===s.port)))(new URL(es.origin),es.navigator&&/(msie|trident)/i.test(es.navigator.userAgent)):()=>!0,ws=es.hasStandardBrowserEnv?{write(e,t,s,n,a,r){const l=[e+"="+encodeURIComponent(t)];Pt.isNumber(s)&&l.push("expires="+new Date(s).toGMTString()),Pt.isString(n)&&l.push("path="+n),Pt.isString(a)&&l.push("domain="+a),!0===r&&l.push("secure"),document.cookie=l.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function Ns(e,t,s){let n=!function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}(t);return e&&(n||0==s)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const ks=e=>e instanceof ds?He({},e):e;function Ss(e,t){t=t||{};const s={};function n(e,t,s,n){return Pt.isPlainObject(e)&&Pt.isPlainObject(t)?Pt.merge.call({caseless:n},e,t):Pt.isPlainObject(t)?Pt.merge({},t):Pt.isArray(t)?t.slice():t}function a(e,t,s,a){return Pt.isUndefined(t)?Pt.isUndefined(e)?void 0:n(void 0,e,0,a):n(e,t,0,a)}function r(e,t){if(!Pt.isUndefined(t))return n(void 0,t)}function l(e,t){return Pt.isUndefined(t)?Pt.isUndefined(e)?void 0:n(void 0,e):n(void 0,t)}function o(s,a,r){return r in t?n(s,a):r in e?n(void 0,s):void 0}const i={url:r,method:r,data:r,baseURL:l,transformRequest:l,transformResponse:l,paramsSerializer:l,timeout:l,timeoutMessage:l,withCredentials:l,withXSRFToken:l,adapter:l,responseType:l,xsrfCookieName:l,xsrfHeaderName:l,onUploadProgress:l,onDownloadProgress:l,decompress:l,maxContentLength:l,maxBodyLength:l,beforeRedirect:l,transport:l,httpAgent:l,httpsAgent:l,cancelToken:l,socketPath:l,responseEncoding:l,validateStatus:o,headers:(e,t,s)=>a(ks(e),ks(t),0,!0)};return Pt.forEach(Object.keys(Object.assign({},e,t)),function(n){const r=i[n]||a,l=r(e[n],t[n],n);Pt.isUndefined(l)&&r!==o||(s[n]=l)}),s}const Cs=e=>{const t=Ss({},e);let s,{data:n,withXSRFToken:a,xsrfHeaderName:r,xsrfCookieName:l,headers:o,auth:i}=t;if(t.headers=o=ds.from(o),t.url=Ht(Ns(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),i&&o.set("Authorization","Basic "+btoa((i.username||"")+":"+(i.password?unescape(encodeURIComponent(i.password)):""))),Pt.isFormData(n))if(es.hasStandardBrowserEnv||es.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if(!1!==(s=o.getContentType())){const[e,...t]=s?s.split(";").map(e=>e.trim()).filter(Boolean):[];o.setContentType([e||"multipart/form-data",...t].join("; "))}if(es.hasStandardBrowserEnv&&(a&&Pt.isFunction(a)&&(a=a(t)),a||!1!==a&&js(t.url))){const e=r&&l&&ws.read(l);e&&o.set(r,e)}return t},_s="undefined"!==typeof XMLHttpRequest&&function(e){return new Promise(function(t,s){const n=Cs(e);let a=n.data;const r=ds.from(n.headers).normalize();let l,o,i,c,d,{responseType:u,onUploadProgress:m,onDownloadProgress:h}=n;function p(){c&&c(),d&&d(),n.cancelToken&&n.cancelToken.unsubscribe(l),n.signal&&n.signal.removeEventListener("abort",l)}let x=new XMLHttpRequest;function g(){if(!x)return;const n=ds.from("getAllResponseHeaders"in x&&x.getAllResponseHeaders());xs(function(e){t(e),p()},function(e){s(e),p()},{data:u&&"text"!==u&&"json"!==u?x.response:x.responseText,status:x.status,statusText:x.statusText,headers:n,config:e,request:x}),x=null}x.open(n.method.toUpperCase(),n.url,!0),x.timeout=n.timeout,"onloadend"in x?x.onloadend=g:x.onreadystatechange=function(){x&&4===x.readyState&&(0!==x.status||x.responseURL&&0===x.responseURL.indexOf("file:"))&&setTimeout(g)},x.onabort=function(){x&&(s(new Mt("Request aborted",Mt.ECONNABORTED,e,x)),x=null)},x.onerror=function(){s(new Mt("Network Error",Mt.ERR_NETWORK,e,x)),x=null},x.ontimeout=function(){let t=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const a=n.transitional||Gt;n.timeoutErrorMessage&&(t=n.timeoutErrorMessage),s(new Mt(t,a.clarifyTimeoutError?Mt.ETIMEDOUT:Mt.ECONNABORTED,e,x)),x=null},void 0===a&&r.setContentType(null),"setRequestHeader"in x&&Pt.forEach(r.toJSON(),function(e,t){x.setRequestHeader(t,e)}),Pt.isUndefined(n.withCredentials)||(x.withCredentials=!!n.withCredentials),u&&"json"!==u&&(x.responseType=n.responseType),h&&([i,d]=bs(h,!0),x.addEventListener("progress",i)),m&&x.upload&&([o,c]=bs(m),x.upload.addEventListener("progress",o),x.upload.addEventListener("loadend",c)),(n.cancelToken||n.signal)&&(l=t=>{x&&(s(!t||t.type?new ps(null,e,x):t),x.abort(),x=null)},n.cancelToken&&n.cancelToken.subscribe(l),n.signal&&(n.signal.aborted?l():n.signal.addEventListener("abort",l)));const f=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(n.url);f&&-1===es.protocols.indexOf(f)?s(new Mt("Unsupported protocol "+f+":",Mt.ERR_BAD_REQUEST,e)):x.send(a||null)})},Es=(e,t)=>{const{length:s}=e=e?e.filter(Boolean):[];if(t||s){let s,n=new AbortController;const a=function(e){if(!s){s=!0,l();const t=e instanceof Error?e:this.reason;n.abort(t instanceof Mt?t:new ps(t instanceof Error?t.message:t))}};let r=t&&setTimeout(()=>{r=null,a(new Mt("timeout ".concat(t," of ms exceeded"),Mt.ETIMEDOUT))},t);const l=()=>{e&&(r&&clearTimeout(r),r=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(a):e.removeEventListener("abort",a)}),e=null)};e.forEach(e=>e.addEventListener("abort",a));const{signal:o}=n;return o.unsubscribe=()=>Pt.asap(l),o}};function Ts(e,t){this.v=e,this.k=t}function Ps(e){return function(){return new As(e.apply(this,arguments))}}function As(e){var t,s;function n(t,s){try{var r=e[t](s),l=r.value,o=l instanceof Ts;Promise.resolve(o?l.v:l).then(function(s){if(o){var i="return"===t?"return":"next";if(!l.k||s.done)return n(i,s);s=e[i](s).value}a(r.done?"return":"normal",s)},function(e){n("throw",e)})}catch(e){a("throw",e)}}function a(e,a){switch(e){case"return":t.resolve({value:a,done:!0});break;case"throw":t.reject(a);break;default:t.resolve({value:a,done:!1})}(t=t.next)?n(t.key,t.arg):s=null}this._invoke=function(e,a){return new Promise(function(r,l){var o={key:e,arg:a,resolve:r,reject:l,next:null};s?s=s.next=o:(t=s=o,n(e,a))})},"function"!=typeof e.return&&(this.return=void 0)}function Ds(e){return new Ts(e,0)}function Ls(e){var t={},s=!1;function n(t,n){return s=!0,n=new Promise(function(s){s(e[t](n))}),{done:!1,value:new Ts(n,1)}}return t["undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator"]=function(){return this},t.next=function(e){return s?(s=!1,e):n("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(s)throw s=!1,e;return n("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return s?(s=!1,e):n("return",e)}),t}function Ms(e){var t,s,n,a=2;for("undefined"!=typeof Symbol&&(s=Symbol.asyncIterator,n=Symbol.iterator);a--;){if(s&&null!=(t=e[s]))return t.call(e);if(n&&null!=(t=e[n]))return new Rs(t.call(e));s="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function Rs(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then(function(e){return{value:e,done:t}})}return Rs=function(e){this.s=e,this.n=e.next},Rs.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var s=this.s.return;return void 0===s?Promise.resolve({value:e,done:!0}):t(s.apply(this.s,arguments))},throw:function(e){var s=this.s.return;return void 0===s?Promise.reject(e):t(s.apply(this.s,arguments))}},new Rs(e)}As.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},As.prototype.next=function(e){return this._invoke("next",e)},As.prototype.throw=function(e){return this._invoke("throw",e)},As.prototype.return=function(e){return this._invoke("return",e)};const Fs=function*(e,t){let s=e.byteLength;if(!t||s<t)return void(yield e);let n,a=0;for(;a<s;)n=a+t,yield e.slice(a,n),a=n},Is=function(){var e=Ps(function*(e,t){var s,n=!1,a=!1;try{for(var r,l=Ms(Os(e));n=!(r=yield Ds(l.next())).done;n=!1){const e=r.value;yield*Ls(Ms(Fs(e,t)))}}catch(o){a=!0,s=o}finally{try{n&&null!=l.return&&(yield Ds(l.return()))}finally{if(a)throw s}}});return function(t,s){return e.apply(this,arguments)}}(),Os=function(){var e=Ps(function*(e){if(e[Symbol.asyncIterator])return void(yield*Ls(Ms(e)));const t=e.getReader();try{for(;;){const{done:e,value:s}=yield Ds(t.read());if(e)break;yield s}}finally{yield Ds(t.cancel())}});return function(t){return e.apply(this,arguments)}}(),Bs=(e,t,s,n)=>{const a=Is(e,t);let r,l=0,o=e=>{r||(r=!0,n&&n(e))};return new ReadableStream({async pull(e){try{const{done:t,value:n}=await a.next();if(t)return o(),void e.close();let r=n.byteLength;if(s){let e=l+=r;s(e)}e.enqueue(new Uint8Array(n))}catch(t){throw o(t),t}},cancel:e=>(o(e),a.return())},{highWaterMark:2})},Us="function"===typeof fetch&&"function"===typeof Request&&"function"===typeof Response,zs=Us&&"function"===typeof ReadableStream,Vs=Us&&("function"===typeof TextEncoder?(Ws=new TextEncoder,e=>Ws.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var Ws;const qs=function(e){try{for(var t=arguments.length,s=new Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];return!!e(...s)}catch(ey){return!1}},Hs=zs&&qs(()=>{let e=!1;const t=new Request(es.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),Ys=zs&&qs(()=>Pt.isReadableStream(new Response("").body)),Gs={stream:Ys&&(e=>e.body)};var $s;Us&&($s=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!Gs[e]&&(Gs[e]=Pt.isFunction($s[e])?t=>t[e]():(t,s)=>{throw new Mt("Response type '".concat(e,"' is not supported"),Mt.ERR_NOT_SUPPORT,s)})}));const Qs=async(e,t)=>{const s=Pt.toFiniteNumber(e.getContentLength());return null==s?(async e=>{if(null==e)return 0;if(Pt.isBlob(e))return e.size;if(Pt.isSpecCompliantForm(e)){const t=new Request(es.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return Pt.isArrayBufferView(e)||Pt.isArrayBuffer(e)?e.byteLength:(Pt.isURLSearchParams(e)&&(e+=""),Pt.isString(e)?(await Vs(e)).byteLength:void 0)})(t):s},Ks=Us&&(async e=>{let{url:t,method:s,data:n,signal:a,cancelToken:r,timeout:l,onDownloadProgress:o,onUploadProgress:i,responseType:c,headers:d,withCredentials:u="same-origin",fetchOptions:m}=Cs(e);c=c?(c+"").toLowerCase():"text";let h,p=Es([a,r&&r.toAbortSignal()],l);const x=p&&p.unsubscribe&&(()=>{p.unsubscribe()});let g;try{if(i&&Hs&&"get"!==s&&"head"!==s&&0!==(g=await Qs(d,n))){let e,s=new Request(t,{method:"POST",body:n,duplex:"half"});if(Pt.isFormData(n)&&(e=s.headers.get("content-type"))&&d.setContentType(e),s.body){const[e,t]=ys(g,bs(vs(i)));n=Bs(s.body,65536,e,t)}}Pt.isString(u)||(u=u?"include":"omit");const a="credentials"in Request.prototype;h=new Request(t,He(He({},m),{},{signal:p,method:s.toUpperCase(),headers:d.normalize().toJSON(),body:n,duplex:"half",credentials:a?u:void 0}));let r=await fetch(h,m);const l=Ys&&("stream"===c||"response"===c);if(Ys&&(o||l&&x)){const e={};["status","statusText","headers"].forEach(t=>{e[t]=r[t]});const t=Pt.toFiniteNumber(r.headers.get("content-length")),[s,n]=o&&ys(t,bs(vs(o),!0))||[];r=new Response(Bs(r.body,65536,s,()=>{n&&n(),x&&x()}),e)}c=c||"text";let f=await Gs[Pt.findKey(Gs,c)||"text"](r,e);return!l&&x&&x(),await new Promise((t,s)=>{xs(t,s,{data:f,headers:ds.from(r.headers),status:r.status,statusText:r.statusText,config:e,request:h})})}catch(f){if(x&&x(),f&&"TypeError"===f.name&&/Load failed|fetch/i.test(f.message))throw Object.assign(new Mt("Network Error",Mt.ERR_NETWORK,e,h),{cause:f.cause||f});throw Mt.from(f,f&&f.code,e,h)}}),Js={http:null,xhr:_s,fetch:Ks};Pt.forEach(Js,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(ey){}Object.defineProperty(e,"adapterName",{value:t})}});const Xs=e=>"- ".concat(e),Zs=e=>Pt.isFunction(e)||null===e||!1===e,en=e=>{e=Pt.isArray(e)?e:[e];const{length:t}=e;let s,n;const a={};for(let r=0;r<t;r++){let t;if(s=e[r],n=s,!Zs(s)&&(n=Js[(t=String(s)).toLowerCase()],void 0===n))throw new Mt("Unknown adapter '".concat(t,"'"));if(n)break;a[t||"#"+r]=n}if(!n){const e=Object.entries(a).map(e=>{let[t,s]=e;return"adapter ".concat(t," ")+(!1===s?"is not supported by the environment":"is not available in the build")});let s=t?e.length>1?"since :\n"+e.map(Xs).join("\n"):" "+Xs(e[0]):"as no adapter specified";throw new Mt("There is no suitable adapter to dispatch the request "+s,"ERR_NOT_SUPPORT")}return n};function tn(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new ps(null,e)}function sn(e){tn(e),e.headers=ds.from(e.headers),e.data=us.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return en(e.adapter||ns.adapter)(e).then(function(t){return tn(e),t.data=us.call(e,e.transformResponse,t),t.headers=ds.from(t.headers),t},function(t){return ms(t)||(tn(e),t&&t.response&&(t.response.data=us.call(e,e.transformResponse,t.response),t.response.headers=ds.from(t.response.headers))),Promise.reject(t)})}const nn="1.10.0",an={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{an[e]=function(s){return typeof s===e||"a"+(t<1?"n ":" ")+e}});const rn={};an.transitional=function(e,t,s){function n(e,t){return"[Axios v"+nn+"] Transitional option '"+e+"'"+t+(s?". "+s:"")}return(s,a,r)=>{if(!1===e)throw new Mt(n(a," has been removed"+(t?" in "+t:"")),Mt.ERR_DEPRECATED);return t&&!rn[a]&&(rn[a]=!0,console.warn(n(a," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(s,a,r)}},an.spelling=function(e){return(t,s)=>(console.warn("".concat(s," is likely a misspelling of ").concat(e)),!0)};const ln={assertOptions:function(e,t,s){if("object"!==typeof e)throw new Mt("options must be an object",Mt.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let a=n.length;for(;a-- >0;){const r=n[a],l=t[r];if(l){const t=e[r],s=void 0===t||l(t,r,e);if(!0!==s)throw new Mt("option "+r+" must be "+s,Mt.ERR_BAD_OPTION_VALUE);continue}if(!0!==s)throw new Mt("Unknown option "+r,Mt.ERR_BAD_OPTION)}},validators:an},on=ln.validators;class cn{constructor(e){this.defaults=e||{},this.interceptors={request:new Yt,response:new Yt}}async request(e,t){try{return await this._request(e,t)}catch(s){if(s instanceof Error){let e={};Error.captureStackTrace?Error.captureStackTrace(e):e=new Error;const t=e.stack?e.stack.replace(/^.+\n/,""):"";try{s.stack?t&&!String(s.stack).endsWith(t.replace(/^.+\n.+\n/,""))&&(s.stack+="\n"+t):s.stack=t}catch(ey){}}throw s}}_request(e,t){"string"===typeof e?(t=t||{}).url=e:t=e||{},t=Ss(this.defaults,t);const{transitional:s,paramsSerializer:n,headers:a}=t;void 0!==s&&ln.assertOptions(s,{silentJSONParsing:on.transitional(on.boolean),forcedJSONParsing:on.transitional(on.boolean),clarifyTimeoutError:on.transitional(on.boolean)},!1),null!=n&&(Pt.isFunction(n)?t.paramsSerializer={serialize:n}:ln.assertOptions(n,{encode:on.function,serialize:on.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),ln.assertOptions(t,{baseUrl:on.spelling("baseURL"),withXsrfToken:on.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let r=a&&Pt.merge(a.common,a[t.method]);a&&Pt.forEach(["delete","get","head","post","put","patch","common"],e=>{delete a[e]}),t.headers=ds.concat(r,a);const l=[];let o=!0;this.interceptors.request.forEach(function(e){"function"===typeof e.runWhen&&!1===e.runWhen(t)||(o=o&&e.synchronous,l.unshift(e.fulfilled,e.rejected))});const i=[];let c;this.interceptors.response.forEach(function(e){i.push(e.fulfilled,e.rejected)});let d,u=0;if(!o){const e=[sn.bind(this),void 0];for(e.unshift.apply(e,l),e.push.apply(e,i),d=e.length,c=Promise.resolve(t);u<d;)c=c.then(e[u++],e[u++]);return c}d=l.length;let m=t;for(u=0;u<d;){const e=l[u++],t=l[u++];try{m=e(m)}catch(h){t.call(this,h);break}}try{c=sn.call(this,m)}catch(h){return Promise.reject(h)}for(u=0,d=i.length;u<d;)c=c.then(i[u++],i[u++]);return c}getUri(e){return Ht(Ns((e=Ss(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}}Pt.forEach(["delete","get","head","options"],function(e){cn.prototype[e]=function(t,s){return this.request(Ss(s||{},{method:e,url:t,data:(s||{}).data}))}}),Pt.forEach(["post","put","patch"],function(e){function t(t){return function(s,n,a){return this.request(Ss(a||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:s,data:n}))}}cn.prototype[e]=t(),cn.prototype[e+"Form"]=t(!0)});const dn=cn;class un{constructor(e){if("function"!==typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(e){t=e});const s=this;this.promise.then(e=>{if(!s._listeners)return;let t=s._listeners.length;for(;t-- >0;)s._listeners[t](e);s._listeners=null}),this.promise.then=e=>{let t;const n=new Promise(e=>{s.subscribe(e),t=e}).then(e);return n.cancel=function(){s.unsubscribe(t)},n},e(function(e,n,a){s.reason||(s.reason=new ps(e,n,a),t(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new un(function(t){e=t}),cancel:e}}}const mn=un;const hn={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(hn).forEach(e=>{let[t,s]=e;hn[s]=t});const pn=hn;const xn=function e(t){const s=new dn(t),n=Ye(dn.prototype.request,s);return Pt.extend(n,dn.prototype,s,{allOwnKeys:!0}),Pt.extend(n,s,null,{allOwnKeys:!0}),n.create=function(s){return e(Ss(t,s))},n}(ns);xn.Axios=dn,xn.CanceledError=ps,xn.CancelToken=mn,xn.isCancel=ms,xn.VERSION=nn,xn.toFormData=Bt,xn.AxiosError=Mt,xn.Cancel=xn.CanceledError,xn.all=function(e){return Promise.all(e)},xn.spread=function(e){return function(t){return e.apply(null,t)}},xn.isAxiosError=function(e){return Pt.isObject(e)&&!0===e.isAxiosError},xn.mergeConfig=Ss,xn.AxiosHeaders=ds,xn.formToJSON=e=>ts(Pt.isHTMLForm(e)?new FormData(e):e),xn.getAdapter=en,xn.HttpStatusCode=pn,xn.default=xn;const gn=xn;var fn=s(579);gn.defaults.baseURL="";const bn=(0,a.createContext)(),yn=(e,t)=>{switch(t.type){case"LOGIN_START":return He(He({},e),{},{loading:!0,error:null});case"LOGIN_SUCCESS":return He(He({},e),{},{loading:!1,isAuthenticated:!0,user:t.payload.user,token:t.payload.token,error:null});case"LOGIN_FAILURE":return He(He({},e),{},{loading:!1,isAuthenticated:!1,user:null,token:null,error:t.payload});case"LOGOUT":return He(He({},e),{},{isAuthenticated:!1,user:null,token:null,loading:!1,error:null});case"SET_USER":return He(He({},e),{},{user:t.payload});default:return e}},vn={isAuthenticated:!!localStorage.getItem("token"),user:null,token:localStorage.getItem("token"),loading:!!localStorage.getItem("token"),error:null},jn=e=>{let{children:t}=e;const[s,n]=(0,a.useReducer)(yn,vn);(0,a.useEffect)(()=>{s.token?gn.defaults.headers.common.Authorization="Bearer ".concat(s.token):delete gn.defaults.headers.common.Authorization},[s.token]),(0,a.useEffect)(()=>{(async()=>{const e=localStorage.getItem("token");if(e)try{let t;try{t=await gn.get("/api/auth/me")}catch(c){t=await gn.get("/api/auth/profile")}n({type:"LOGIN_SUCCESS",payload:{user:t.data.user||t.data,token:e}})}catch(d){var t,s,a,r,l,o,i;console.error("Token verification failed:",d),null!==(t=d.response)&&void 0!==t&&null!==(s=t.data)&&void 0!==s&&s.forceLogout||null!==(a=d.response)&&void 0!==a&&null!==(r=a.data)&&void 0!==r&&r.clearToken||null!==(l=d.response)&&void 0!==l&&null!==(o=l.data)&&void 0!==o&&null!==(i=o.message)&&void 0!==i&&i.includes("Invalid user session")?(console.log("\ud83d\udea8 FORCE LOGOUT - Clearing all auth data"),localStorage.removeItem("token"),localStorage.removeItem("authToken"),localStorage.removeItem("jwt"),sessionStorage.clear()):localStorage.removeItem("token"),n({type:"LOGOUT"})}else n({type:"LOGOUT"})})()},[]);return(0,fn.jsx)(bn.Provider,{value:He(He({},s),{},{login:async(e,t)=>{n({type:"LOGIN_START"});try{console.log("\ud83d\udd10 AuthContext: Sending login request to API");const s=await gn.post("/api/auth/login",{email:e,password:t});console.log("\u2705 AuthContext: Login response received:",s.data);const{token:a,user:r}=s.data;return localStorage.setItem("token",a),gn.defaults.headers.common.Authorization="Bearer ".concat(a),n({type:"LOGIN_SUCCESS",payload:{user:r,token:a}}),{success:!0}}catch(u){var s,a,r,l,o,i,c,d;console.error("\u274c AuthContext: Login error:",u),console.error("\u274c Error details:",{message:u.message,response:null===(s=u.response)||void 0===s?void 0:s.data,status:null===(a=u.response)||void 0===a?void 0:a.status});const e=(null===(r=u.response)||void 0===r||null===(l=r.data)||void 0===l?void 0:l.message)||"Login failed";return e.includes("Account error")||null!==(o=u.response)&&void 0!==o&&null!==(i=o.data)&&void 0!==i&&i.clearToken||null!==(c=u.response)&&void 0!==c&&null!==(d=c.data)&&void 0!==d&&d.forceLogout||e.includes("Invalid user session")?(console.log("\ud83d\udea8 FORCE LOGOUT DETECTED - Clearing all auth data"),localStorage.removeItem("token"),localStorage.removeItem("authToken"),localStorage.removeItem("jwt"),sessionStorage.clear(),n({type:"LOGOUT"})):n({type:"LOGIN_FAILURE",payload:e}),{success:!1,message:e}}},register:async e=>{n({type:"LOGIN_START"});try{const t=await gn.post("/api/auth/register",e),{token:s,user:a}=t.data;return localStorage.setItem("token",s),n({type:"LOGIN_SUCCESS",payload:{user:a,token:s}}),{success:!0}}catch(a){var t,s;const e=(null===(t=a.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||"Registration failed";return n({type:"LOGIN_FAILURE",payload:e}),{success:!1,message:e}}},logout:()=>{console.log("\ud83d\udea8 LOGOUT CALLED - Clearing all auth data"),localStorage.removeItem("token"),localStorage.removeItem("authToken"),localStorage.removeItem("jwt"),localStorage.removeItem("user"),localStorage.removeItem("userData"),sessionStorage.clear(),delete gn.defaults.headers.common.Authorization,n({type:"LOGOUT"})}}),children:t})},wn=()=>{const e=(0,a.useContext)(bn);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e},Nn=Object.create(null);Nn.open="0",Nn.close="1",Nn.ping="2",Nn.pong="3",Nn.message="4",Nn.upgrade="5",Nn.noop="6";const kn=Object.create(null);Object.keys(Nn).forEach(e=>{kn[Nn[e]]=e});const Sn={type:"error",data:"parser error"},Cn="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),_n="function"===typeof ArrayBuffer,En=e=>"function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,Tn=(e,t,s)=>{let{type:n,data:a}=e;return Cn&&a instanceof Blob?t?s(a):Pn(a,s):_n&&(a instanceof ArrayBuffer||En(a))?t?s(a):Pn(new Blob([a]),s):s(Nn[n]+(a||""))},Pn=(e,t)=>{const s=new FileReader;return s.onload=function(){const e=s.result.split(",")[1];t("b"+(e||""))},s.readAsDataURL(e)};function An(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let Dn;const Ln="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Mn="undefined"===typeof Uint8Array?[]:new Uint8Array(256);for(let s=0;s<64;s++)Mn[Ln.charCodeAt(s)]=s;const Rn="function"===typeof ArrayBuffer,Fn=(e,t)=>{if("string"!==typeof e)return{type:"message",data:On(e,t)};const s=e.charAt(0);if("b"===s)return{type:"message",data:In(e.substring(1),t)};return kn[s]?e.length>1?{type:kn[s],data:e.substring(1)}:{type:kn[s]}:Sn},In=(e,t)=>{if(Rn){const s=(e=>{let t,s,n,a,r,l=.75*e.length,o=e.length,i=0;"="===e[e.length-1]&&(l--,"="===e[e.length-2]&&l--);const c=new ArrayBuffer(l),d=new Uint8Array(c);for(t=0;t<o;t+=4)s=Mn[e.charCodeAt(t)],n=Mn[e.charCodeAt(t+1)],a=Mn[e.charCodeAt(t+2)],r=Mn[e.charCodeAt(t+3)],d[i++]=s<<2|n>>4,d[i++]=(15&n)<<4|a>>2,d[i++]=(3&a)<<6|63&r;return c})(e);return On(s,t)}return{base64:!0,data:e}},On=(e,t)=>"blob"===t?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer,Bn=String.fromCharCode(30);function Un(){return new TransformStream({transform(e,t){!function(e,t){Cn&&e.data instanceof Blob?e.data.arrayBuffer().then(An).then(t):_n&&(e.data instanceof ArrayBuffer||En(e.data))?t(An(e.data)):Tn(e,!1,e=>{Dn||(Dn=new TextEncoder),t(Dn.encode(e))})}(e,s=>{const n=s.length;let a;if(n<126)a=new Uint8Array(1),new DataView(a.buffer).setUint8(0,n);else if(n<65536){a=new Uint8Array(3);const e=new DataView(a.buffer);e.setUint8(0,126),e.setUint16(1,n)}else{a=new Uint8Array(9);const e=new DataView(a.buffer);e.setUint8(0,127),e.setBigUint64(1,BigInt(n))}e.data&&"string"!==typeof e.data&&(a[0]|=128),t.enqueue(a),t.enqueue(s)})}})}let zn;function Vn(e){return e.reduce((e,t)=>e+t.length,0)}function Wn(e,t){if(e[0].length===t)return e.shift();const s=new Uint8Array(t);let n=0;for(let a=0;a<t;a++)s[a]=e[0][n++],n===e[0].length&&(e.shift(),n=0);return e.length&&n<e[0].length&&(e[0]=e[0].slice(n)),s}function qn(e){if(e)return function(e){for(var t in qn.prototype)e[t]=qn.prototype[t];return e}(e)}qn.prototype.on=qn.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},qn.prototype.once=function(e,t){function s(){this.off(e,s),t.apply(this,arguments)}return s.fn=t,this.on(e,s),this},qn.prototype.off=qn.prototype.removeListener=qn.prototype.removeAllListeners=qn.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var s,n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var a=0;a<n.length;a++)if((s=n[a])===t||s.fn===t){n.splice(a,1);break}return 0===n.length&&delete this._callbacks["$"+e],this},qn.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),s=this._callbacks["$"+e],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(s){n=0;for(var a=(s=s.slice(0)).length;n<a;++n)s[n].apply(this,t)}return this},qn.prototype.emitReserved=qn.prototype.emit,qn.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},qn.prototype.hasListeners=function(e){return!!this.listeners(e).length};const Hn="function"===typeof Promise&&"function"===typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),Yn="undefined"!==typeof self?self:"undefined"!==typeof window?window:Function("return this")();function Gn(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];return s.reduce((t,s)=>(e.hasOwnProperty(s)&&(t[s]=e[s]),t),{})}const $n=Yn.setTimeout,Qn=Yn.clearTimeout;function Kn(e,t){t.useNativeTimers?(e.setTimeoutFn=$n.bind(Yn),e.clearTimeoutFn=Qn.bind(Yn)):(e.setTimeoutFn=Yn.setTimeout.bind(Yn),e.clearTimeoutFn=Yn.clearTimeout.bind(Yn))}function Jn(e){return"string"===typeof e?function(e){let t=0,s=0;for(let n=0,a=e.length;n<a;n++)t=e.charCodeAt(n),t<128?s+=1:t<2048?s+=2:t<55296||t>=57344?s+=3:(n++,s+=4);return s}(e):Math.ceil(1.33*(e.byteLength||e.size))}function Xn(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}class Zn extends Error{constructor(e,t,s){super(e),this.description=t,this.context=s,this.type="TransportError"}}class ea extends qn{constructor(e){super(),this.writable=!1,Kn(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,s){return super.emitReserved("error",new Zn(e,t,s)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=Fn(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return-1===e.indexOf(":")?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(e){const t=function(e){let t="";for(let s in e)e.hasOwnProperty(s)&&(t.length&&(t+="&"),t+=encodeURIComponent(s)+"="+encodeURIComponent(e[s]));return t}(e);return t.length?"?"+t:""}}class ta extends ea{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let e=0;this._polling&&(e++,this.once("pollComplete",function(){--e||t()})),this.writable||(e++,this.once("drain",function(){--e||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){((e,t)=>{const s=e.split(Bn),n=[];for(let a=0;a<s.length;a++){const e=Fn(s[a],t);if(n.push(e),"error"===e.type)break}return n})(e,this.socket.binaryType).forEach(e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)}),"closed"!==this.readyState&&(this._polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,((e,t)=>{const s=e.length,n=new Array(s);let a=0;e.forEach((e,r)=>{Tn(e,!1,e=>{n[r]=e,++a===s&&t(n.join(Bn))})})})(e,e=>{this.doWrite(e,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=Xn()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}}let sa=!1;try{sa="undefined"!==typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(ty){}const na=sa;function aa(){}class ra extends ta{constructor(e){if(super(e),"undefined"!==typeof location){const t="https:"===location.protocol;let s=location.port;s||(s=t?"443":"80"),this.xd="undefined"!==typeof location&&e.hostname!==location.hostname||s!==e.port}}doWrite(e,t){const s=this.request({method:"POST",data:e});s.on("success",t),s.on("error",(e,t)=>{this.onError("xhr post error",e,t)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(e,t)=>{this.onError("xhr poll error",e,t)}),this.pollXhr=e}}class la extends qn{constructor(e,t,s){super(),this.createRequest=e,Kn(this,s),this._opts=s,this._method=s.method||"GET",this._uri=t,this._data=void 0!==s.data?s.data:null,this._create()}_create(){var e;const t=Gn(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const s=this._xhr=this.createRequest(t);try{s.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){s.setDisableHeaderCheck&&s.setDisableHeaderCheck(!0);for(let e in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(e)&&s.setRequestHeader(e,this._opts.extraHeaders[e])}}catch(ey){}if("POST"===this._method)try{s.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(ey){}try{s.setRequestHeader("Accept","*/*")}catch(ey){}null===(e=this._opts.cookieJar)||void 0===e||e.addCookies(s),"withCredentials"in s&&(s.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(s.timeout=this._opts.requestTimeout),s.onreadystatechange=()=>{var e;3===s.readyState&&(null===(e=this._opts.cookieJar)||void 0===e||e.parseCookies(s.getResponseHeader("set-cookie"))),4===s.readyState&&(200===s.status||1223===s.status?this._onLoad():this.setTimeoutFn(()=>{this._onError("number"===typeof s.status?s.status:0)},0))},s.send(this._data)}catch(ey){return void this.setTimeoutFn(()=>{this._onError(ey)},0)}"undefined"!==typeof document&&(this._index=la.requestsCount++,la.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if("undefined"!==typeof this._xhr&&null!==this._xhr){if(this._xhr.onreadystatechange=aa,e)try{this._xhr.abort()}catch(ey){}"undefined"!==typeof document&&delete la.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}if(la.requestsCount=0,la.requests={},"undefined"!==typeof document)if("function"===typeof attachEvent)attachEvent("onunload",oa);else if("function"===typeof addEventListener){addEventListener("onpagehide"in Yn?"pagehide":"unload",oa,!1)}function oa(){for(let e in la.requests)la.requests.hasOwnProperty(e)&&la.requests[e].abort()}const ia=function(){const e=ca({xdomain:!1});return e&&null!==e.responseType}();function ca(e){const t=e.xdomain;try{if("undefined"!==typeof XMLHttpRequest&&(!t||na))return new XMLHttpRequest}catch(ey){}if(!t)try{return new(Yn[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(ey){}}const da="undefined"!==typeof navigator&&"string"===typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class ua extends ea{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,s=da?{}:Gn(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,s)}catch(ty){return this.emitReserved("error",ty)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const s=e[t],n=t===e.length-1;Tn(s,this.supportsBinary,e=>{try{this.doWrite(s,e)}catch(ey){}n&&Hn(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){"undefined"!==typeof this.ws&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=Xn()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}const ma=Yn.WebSocket||Yn.MozWebSocket;const ha={websocket:class extends ua{createSocket(e,t,s){return da?new ma(e,t,s):t?new ma(e,t):new ma(e)}doWrite(e,t){this.ws.send(t)}},webtransport:class extends ea{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(ty){return this.emitReserved("error",ty)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const t=function(e,t){zn||(zn=new TextDecoder);const s=[];let n=0,a=-1,r=!1;return new TransformStream({transform(l,o){for(s.push(l);;){if(0===n){if(Vn(s)<1)break;const e=Wn(s,1);r=128===(128&e[0]),a=127&e[0],n=a<126?3:126===a?1:2}else if(1===n){if(Vn(s)<2)break;const e=Wn(s,2);a=new DataView(e.buffer,e.byteOffset,e.length).getUint16(0),n=3}else if(2===n){if(Vn(s)<8)break;const e=Wn(s,8),t=new DataView(e.buffer,e.byteOffset,e.length),r=t.getUint32(0);if(r>Math.pow(2,21)-1){o.enqueue(Sn);break}a=r*Math.pow(2,32)+t.getUint32(4),n=3}else{if(Vn(s)<a)break;const e=Wn(s,a);o.enqueue(Fn(r?e:zn.decode(e),t)),n=0}if(0===a||a>e){o.enqueue(Sn);break}}}})}(Number.MAX_SAFE_INTEGER,this.socket.binaryType),s=e.readable.pipeThrough(t).getReader(),n=Un();n.readable.pipeTo(e.writable),this._writer=n.writable.getWriter();const a=()=>{s.read().then(e=>{let{done:t,value:s}=e;t||(this.onPacket(s),a())}).catch(e=>{})};a();const r={type:"open"};this.query.sid&&(r.data='{"sid":"'.concat(this.query.sid,'"}')),this._writer.write(r).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const s=e[t],n=t===e.length-1;this._writer.write(s).then(()=>{n&&Hn(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;null===(e=this._transport)||void 0===e||e.close()}},polling:class extends ra{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=ia&&!t}request(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign(e,{xd:this.xd},this.opts),new la(ca,this.uri(),e)}}},pa=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,xa=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function ga(e){if(e.length>8e3)throw"URI too long";const t=e,s=e.indexOf("["),n=e.indexOf("]");-1!=s&&-1!=n&&(e=e.substring(0,s)+e.substring(s,n).replace(/:/g,";")+e.substring(n,e.length));let a=pa.exec(e||""),r={},l=14;for(;l--;)r[xa[l]]=a[l]||"";return-1!=s&&-1!=n&&(r.source=t,r.host=r.host.substring(1,r.host.length-1).replace(/;/g,":"),r.authority=r.authority.replace("[","").replace("]","").replace(/;/g,":"),r.ipv6uri=!0),r.pathNames=function(e,t){const s=/\/{2,9}/g,n=t.replace(s,"/").split("/");"/"!=t.slice(0,1)&&0!==t.length||n.splice(0,1);"/"==t.slice(-1)&&n.splice(n.length-1,1);return n}(0,r.path),r.queryKey=function(e,t){const s={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(e,t,n){t&&(s[t]=n)}),s}(0,r.query),r}const fa="function"===typeof addEventListener&&"function"===typeof removeEventListener,ba=[];fa&&addEventListener("offline",()=>{ba.forEach(e=>e())},!1);class ya extends qn{constructor(e,t){if(super(),this.binaryType="arraybuffer",this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&"object"===typeof e&&(t=e,e=null),e){const s=ga(e);t.hostname=s.host,t.secure="https"===s.protocol||"wss"===s.protocol,t.port=s.port,s.query&&(t.query=s.query)}else t.host&&(t.hostname=ga(t.host).host);Kn(this,t),this.secure=null!=t.secure?t.secure:"undefined"!==typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!==typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!==typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(e=>{const t=e.prototype.name;this.transports.push(t),this._transportsByName[t]=e}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"===typeof this.opts.query&&(this.opts.query=function(e){let t={},s=e.split("&");for(let n=0,a=s.length;n<a;n++){let e=s[n].split("=");t[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}return t}(this.opts.query)),fa&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},ba.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);const s=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](s)}_open(){if(0===this.transports.length)return void this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);const e=this.opts.rememberUpgrade&&ya.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket")?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",e=>this._onClose("transport close",e))}onOpen(){this.readyState="open",ya.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush()}_onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let t=0;t<this.writeBuffer.length;t++){const s=this.writeBuffer[t].data;if(s&&(e+=Jn(s)),t>0&&e>this._maxPayload)return this.writeBuffer.slice(0,t);e+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,Hn(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,s){return this._sendPacket("message",e,t,s),this}send(e,t,s){return this._sendPacket("message",e,t,s),this}_sendPacket(e,t,s,n){if("function"===typeof t&&(n=t,t=void 0),"function"===typeof s&&(n=s,s=null),"closing"===this.readyState||"closed"===this.readyState)return;(s=s||{}).compress=!1!==s.compress;const a={type:e,data:t,options:s};this.emitReserved("packetCreate",a),this.writeBuffer.push(a),n&&this.once("flush",n),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},s=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?s():e()}):this.upgrading?s():e()),this}_onError(e){if(ya.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&"opening"===this.readyState)return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),fa&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const e=ba.indexOf(this._offlineEventListener);-1!==e&&ba.splice(e,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}ya.protocol=4;class va extends ya{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),"open"===this.readyState&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),s=!1;ya.priorWebsocketSuccess=!1;const n=()=>{s||(t.send([{type:"ping",data:"probe"}]),t.once("packet",e=>{if(!s)if("pong"===e.type&&"probe"===e.data){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;ya.priorWebsocketSuccess="websocket"===t.name,this.transport.pause(()=>{s||"closed"!==this.readyState&&(c(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const e=new Error("probe error");e.transport=t.name,this.emitReserved("upgradeError",e)}}))};function a(){s||(s=!0,c(),t.close(),t=null)}const r=e=>{const s=new Error("probe error: "+e);s.transport=t.name,a(),this.emitReserved("upgradeError",s)};function l(){r("transport closed")}function o(){r("socket closed")}function i(e){t&&e.name!==t.name&&a()}const c=()=>{t.removeListener("open",n),t.removeListener("error",r),t.removeListener("close",l),this.off("close",o),this.off("upgrading",i)};t.once("open",n),t.once("error",r),t.once("close",l),this.once("close",o),this.once("upgrading",i),-1!==this._upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn(()=>{s||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let s=0;s<e.length;s++)~this.transports.indexOf(e[s])&&t.push(e[s]);return t}}class ja extends va{constructor(e){const t="object"===typeof e?e:arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(!t.transports||t.transports&&"string"===typeof t.transports[0])&&(t.transports=(t.transports||["polling","websocket","webtransport"]).map(e=>ha[e]).filter(e=>!!e)),super(e,t)}}const wa="function"===typeof ArrayBuffer,Na=Object.prototype.toString,ka="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===Na.call(Blob),Sa="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===Na.call(File);function Ca(e){return wa&&(e instanceof ArrayBuffer||(e=>"function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer)(e))||ka&&e instanceof Blob||Sa&&e instanceof File}function _a(e,t){if(!e||"object"!==typeof e)return!1;if(Array.isArray(e)){for(let t=0,s=e.length;t<s;t++)if(_a(e[t]))return!0;return!1}if(Ca(e))return!0;if(e.toJSON&&"function"===typeof e.toJSON&&1===arguments.length)return _a(e.toJSON(),!0);for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&_a(e[s]))return!0;return!1}function Ea(e){const t=[],s=e.data,n=e;return n.data=Ta(s,t),n.attachments=t.length,{packet:n,buffers:t}}function Ta(e,t){if(!e)return e;if(Ca(e)){const s={_placeholder:!0,num:t.length};return t.push(e),s}if(Array.isArray(e)){const s=new Array(e.length);for(let n=0;n<e.length;n++)s[n]=Ta(e[n],t);return s}if("object"===typeof e&&!(e instanceof Date)){const s={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(s[n]=Ta(e[n],t));return s}return e}function Pa(e,t){return e.data=Aa(e.data,t),delete e.attachments,e}function Aa(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"===typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(let s=0;s<e.length;s++)e[s]=Aa(e[s],t);else if("object"===typeof e)for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(e[s]=Aa(e[s],t));return e}const Da=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],La=5;var Ma;!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(Ma||(Ma={}));class Ra{constructor(e){this.replacer=e}encode(e){return e.type!==Ma.EVENT&&e.type!==Ma.ACK||!_a(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===Ma.EVENT?Ma.BINARY_EVENT:Ma.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}encodeAsString(e){let t=""+e.type;return e.type!==Ma.BINARY_EVENT&&e.type!==Ma.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=Ea(e),s=this.encodeAsString(t.packet),n=t.buffers;return n.unshift(s),n}}function Fa(e){return"[object Object]"===Object.prototype.toString.call(e)}class Ia extends qn{constructor(e){super(),this.reviver=e}add(e){let t;if("string"===typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const s=t.type===Ma.BINARY_EVENT;s||t.type===Ma.BINARY_ACK?(t.type=s?Ma.EVENT:Ma.ACK,this.reconstructor=new Oa(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!Ca(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const s={type:Number(e.charAt(0))};if(void 0===Ma[s.type])throw new Error("unknown packet type "+s.type);if(s.type===Ma.BINARY_EVENT||s.type===Ma.BINARY_ACK){const n=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const a=e.substring(n,t);if(a!=Number(a)||"-"!==e.charAt(t))throw new Error("Illegal attachments");s.attachments=Number(a)}if("/"===e.charAt(t+1)){const n=t+1;for(;++t;){if(","===e.charAt(t))break;if(t===e.length)break}s.nsp=e.substring(n,t)}else s.nsp="/";const n=e.charAt(t+1);if(""!==n&&Number(n)==n){const n=t+1;for(;++t;){const s=e.charAt(t);if(null==s||Number(s)!=s){--t;break}if(t===e.length)break}s.id=Number(e.substring(n,t+1))}if(e.charAt(++t)){const n=this.tryParse(e.substr(t));if(!Ia.isPayloadValid(s.type,n))throw new Error("invalid payload");s.data=n}return s}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(ey){return!1}}static isPayloadValid(e,t){switch(e){case Ma.CONNECT:return Fa(t);case Ma.DISCONNECT:return void 0===t;case Ma.CONNECT_ERROR:return"string"===typeof t||Fa(t);case Ma.EVENT:case Ma.BINARY_EVENT:return Array.isArray(t)&&("number"===typeof t[0]||"string"===typeof t[0]&&-1===Da.indexOf(t[0]));case Ma.ACK:case Ma.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Oa{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=Pa(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function Ba(e,t,s){return e.on(t,s),function(){e.off(t,s)}}const Ua=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class za extends qn{constructor(e,t,s){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,s&&s.auth&&(this.auth=s.auth),this._opts=Object.assign({},s),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Ba(e,"open",this.onopen.bind(this)),Ba(e,"packet",this.onpacket.bind(this)),Ba(e,"error",this.onerror.bind(this)),Ba(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.unshift("message"),this.emit.apply(this,t),this}emit(e){var t,s,n;if(Ua.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');for(var a=arguments.length,r=new Array(a>1?a-1:0),l=1;l<a;l++)r[l-1]=arguments[l];if(r.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(r),this;const o={type:Ma.EVENT,data:r,options:{}};if(o.options.compress=!1!==this.flags.compress,"function"===typeof r[r.length-1]){const e=this.ids++,t=r.pop();this._registerAckCallback(e,t),o.id=e}const i=null===(s=null===(t=this.io.engine)||void 0===t?void 0:t.transport)||void 0===s?void 0:s.writable,c=this.connected&&!(null===(n=this.io.engine)||void 0===n?void 0:n._hasPingExpired());return this.flags.volatile&&!i||(c?(this.notifyOutgoingListeners(o),this.packet(o)):this.sendBuffer.push(o)),this.flags={},this}_registerAckCallback(e,t){var s,n=this;const a=null!==(s=this.flags.timeout)&&void 0!==s?s:this._opts.ackTimeout;if(void 0===a)return void(this.acks[e]=t);const r=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&this.sendBuffer.splice(t,1);t.call(this,new Error("operation has timed out"))},a),l=function(){n.io.clearTimeoutFn(r);for(var e=arguments.length,s=new Array(e),a=0;a<e;a++)s[a]=arguments[a];t.apply(n,s)};l.withError=!0,this.acks[e]=l}emitWithAck(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];return new Promise((t,n)=>{const a=(e,s)=>e?n(e):t(s);a.withError=!0,s.push(a),this.emit(e,...s)})}_addToQueue(e){var t=this;let s;"function"===typeof e[e.length-1]&&(s=e.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push(function(e){if(n!==t._queue[0])return;if(null!==e)n.tryCount>t._opts.retries&&(t._queue.shift(),s&&s(e));else if(t._queue.shift(),s){for(var a=arguments.length,r=new Array(a>1?a-1:0),l=1;l<a;l++)r[l-1]=arguments[l];s(null,...r)}return n.pending=!1,t._drainQueue()}),this._queue.push(n),this._drainQueue()}_drainQueue(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.connected||0===this._queue.length)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:Ma.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(t=>String(t.id)===e)){const t=this.acks[e];delete this.acks[e],t.withError&&t.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case Ma.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Ma.EVENT:case Ma.BINARY_EVENT:this.onevent(e);break;case Ma.ACK:case Ma.BINARY_ACK:this.onack(e);break;case Ma.DISCONNECT:this.ondisconnect();break;case Ma.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const s of t)s.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&"string"===typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let s=!1;return function(){if(!s){s=!0;for(var n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];t.packet({type:Ma.ACK,id:e,data:a})}}}onack(e){const t=this.acks[e.id];"function"===typeof t&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Ma.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let s=0;s<t.length;s++)if(e===t[s])return t.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let s=0;s<t.length;s++)if(e===t[s])return t.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const s of t)s.apply(this,e.data)}}}function Va(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Va.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),s=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-s:e+s}return 0|Math.min(e,this.max)},Va.prototype.reset=function(){this.attempts=0},Va.prototype.setMin=function(e){this.ms=e},Va.prototype.setMax=function(e){this.max=e},Va.prototype.setJitter=function(e){this.jitter=e};class Wa extends qn{constructor(e,s){var n;super(),this.nsps={},this.subs=[],e&&"object"===typeof e&&(s=e,e=void 0),(s=s||{}).path=s.path||"/socket.io",this.opts=s,Kn(this,s),this.reconnection(!1!==s.reconnection),this.reconnectionAttempts(s.reconnectionAttempts||1/0),this.reconnectionDelay(s.reconnectionDelay||1e3),this.reconnectionDelayMax(s.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(n=s.randomizationFactor)&&void 0!==n?n:.5),this.backoff=new Va({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==s.timeout?2e4:s.timeout),this._readyState="closed",this.uri=e;const a=s.parser||t;this.encoder=new a.Encoder,this.decoder=new a.Decoder,this._autoConnect=!1!==s.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new ja(this.uri,this.opts);const t=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const n=Ba(t,"open",function(){s.onopen(),e&&e()}),a=t=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",t),e?e(t):this.maybeReconnectOnOpen()},r=Ba(t,"error",a);if(!1!==this._timeout){const e=this._timeout,s=this.setTimeoutFn(()=>{n(),a(new Error("timeout")),t.close()},e);this.opts.autoUnref&&s.unref(),this.subs.push(()=>{this.clearTimeoutFn(s)})}return this.subs.push(n),this.subs.push(r),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Ba(e,"ping",this.onping.bind(this)),Ba(e,"data",this.ondata.bind(this)),Ba(e,"error",this.onerror.bind(this)),Ba(e,"close",this.onclose.bind(this)),Ba(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(ey){this.onclose("parse error",ey)}}ondecoded(e){Hn(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let s=this.nsps[e];return s?this._autoConnect&&!s.active&&s.connect():(s=new za(this,e,t),this.nsps[e]=s),s}_destroy(e){const t=Object.keys(this.nsps);for(const s of t){if(this.nsps[s].active)return}this._close()}_packet(e){const t=this.encoder.encode(e);for(let s=0;s<t.length;s++)this.engine.write(t[s],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var s;this.cleanup(),null===(s=this.engine)||void 0===s||s.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const s=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open(t=>{t?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):e.onreconnect()}))},t);this.opts.autoUnref&&s.unref(),this.subs.push(()=>{this.clearTimeoutFn(s)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const qa={};function Ha(e,t){"object"===typeof e&&(t=e,e=void 0);const s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",s=arguments.length>2?arguments[2]:void 0,n=e;s=s||"undefined"!==typeof location&&location,null==e&&(e=s.protocol+"//"+s.host),"string"===typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?s.protocol+e:s.host+e),/^(https?|wss?):\/\//.test(e)||(e="undefined"!==typeof s?s.protocol+"//"+e:"https://"+e),n=ga(e)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const a=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+a+":"+n.port+t,n.href=n.protocol+"://"+a+(s&&s.port===n.port?"":":"+n.port),n}(e,(t=t||{}).path||"/socket.io"),n=s.source,a=s.id,r=s.path,l=qa[a]&&r in qa[a].nsps;let o;return t.forceNew||t["force new connection"]||!1===t.multiplex||l?o=new Wa(n,t):(qa[a]||(qa[a]=new Wa(n,t)),o=qa[a]),s.query&&!t.query&&(t.query=s.queryKey),o.socket(s.path,t)}Object.assign(Ha,{Manager:Wa,Socket:za,io:Ha,connect:Ha});const Ya=(0,a.createContext)(),Ga=()=>{const e=(0,a.useContext)(Ya);if(!e)throw new Error("useSocket must be used within a SocketProvider");return e},$a=e=>{let{children:t}=e;const[s,n]=(0,a.useState)(null),[r,l]=(0,a.useState)(!1),[o,i]=(0,a.useState)(null),[c,d]=(0,a.useState)(0),[u,m]=(0,a.useState)(null),{user:h}=wn(),p=(0,a.useRef)(null),x=(0,a.useRef)(null),g=(0,a.useRef)(!1);(0,a.useEffect)(()=>{if(h&&!g.current){g.current=!0;const e=window.location.origin;console.log("\ud83d\udd0c Connecting to WebSocket server:",e);const t=Ha(e,{withCredentials:!0,transports:["websocket","polling"],timeout:2e4,forceNew:!0,reconnection:!0,reconnectionDelay:2e3,reconnectionDelayMax:15e3,reconnectionAttempts:10,autoConnect:!0,upgrade:!0,rememberUpgrade:!1,rejectUnauthorized:!1,secure:!1,multiplex:!1});return t.on("connect",()=>{console.log("\u2705 Connected to WebSocket server"),console.log("\ud83d\udc64 User data:",{id:h.id,name:h.name,role:h.role}),l(!0),d(0),m(null),g.current=!1,x.current&&(clearTimeout(x.current),x.current=null),t.emit("join",{id:h.id,name:h.name,role:h.role}),f(t)}),t.on("disconnect",e=>{console.log("\u274c Disconnected from WebSocket server: ".concat(e)),l(!1),g.current=!1,p.current&&(clearInterval(p.current),p.current=null),"io server disconnect"===e&&(console.log("\ud83d\udd04 Server initiated disconnect, attempting to reconnect..."),x.current=setTimeout(()=>{t&&!t.connected&&t.connect()},2e3))}),t.on("connect_error",e=>{console.error("\u274c Socket connection error:",e.message),l(!1),g.current=!1,d(e=>e+1),m(e.message);const t=Math.min(1e3*Math.pow(2,c),3e4);console.log("\ud83d\udd04 Will retry connection in ".concat(t,"ms"))}),t.on("reconnect",e=>{console.log("\ud83d\udd04 Reconnected after ".concat(e," attempts")),l(!0),g.current=!1,d(0),m(null),x.current&&(clearTimeout(x.current),x.current=null),t.emit("join",{id:h.id,name:h.name,role:h.role}),f(t)}),t.on("reconnect_attempt",e=>{console.log("\ud83d\udd04 Reconnection attempt ".concat(e)),d(e)}),t.on("reconnect_error",e=>{console.error("\u274c Reconnection failed:",e.message),m(e.message)}),t.on("reconnect_failed",()=>{console.error("\u274c All reconnection attempts failed"),l(!1),g.current=!1,m("Max reconnection attempts reached")}),t.on("ping",()=>{t.emit("pong")}),n(t),()=>{console.log("\ud83e\uddf9 Cleaning up socket connection..."),p.current&&(clearInterval(p.current),p.current=null),x.current&&(clearTimeout(x.current),x.current=null),g.current=!1,t&&!t.disconnected&&(t.removeAllListeners(),setTimeout(()=>{t&&!t.disconnected&&t.disconnect()},100)),console.log("\u2705 Socket connection cleaned up")}}},[h]);const f=e=>{p.current&&clearInterval(p.current),p.current=setInterval(()=>{e.connected&&e.emit("heartbeat",{timestamp:Date.now()})},3e4)},b=(0,a.useCallback)(e=>{if(!s)return()=>{};const t=t=>{console.log("\ud83d\udcf1 Real-time: Lead created",t),e({type:"LEAD_CREATED",data:t}),i({type:"LEAD_CREATED",timestamp:new Date,data:t})},n=t=>{console.log("\ud83d\udcf1 Real-time: Lead updated",t),e({type:"LEAD_UPDATED",data:t}),i({type:"LEAD_UPDATED",timestamp:new Date,data:t})},a=t=>{console.log("\ud83d\udcf1 Real-time: Lead assigned",t),e({type:"LEAD_ASSIGNED",data:t}),i({type:"LEAD_ASSIGNED",timestamp:new Date,data:t})},r=t=>{console.log("\ud83d\udcf1 Real-time: Lead deleted",t),e({type:"LEAD_DELETED",data:t}),i({type:"LEAD_DELETED",timestamp:new Date,data:t})},l=t=>{console.log("\ud83d\udcdd Real-time: Notes updated",t),e({type:"NOTES_UPDATED",data:t}),i({type:"NOTES_UPDATED",timestamp:new Date,data:t})};return s.on("lead_created",t),s.on("lead_updated",n),s.on("lead_assigned",a),s.on("lead_deleted",r),s.on("notes_updated",l),()=>{s.off("lead_created",t),s.off("lead_updated",n),s.off("lead_assigned",a),s.off("lead_deleted",r),s.off("notes_updated",l)}},[s]),y=(0,a.useCallback)(e=>{if(!s)return()=>{};const t=t=>{console.log("\ud83d\udcca Real-time: Stats update needed",t),e({type:"STATS_UPDATE_NEEDED",data:t}),i({type:"STATS_UPDATE_NEEDED",timestamp:new Date,data:t})},n=t=>{console.log("\ud83d\udcc5 Real-time: Booking activity",t),e({type:"BOOKING_ACTIVITY",data:t}),i({type:"BOOKING_ACTIVITY",timestamp:new Date,data:t})};return s.on("stats_update_needed",t),s.on("booking_activity",n),()=>{s.off("stats_update_needed",t),s.off("booking_activity",n)}},[s]),v=(0,a.useCallback)(e=>{if(!s)return()=>{};const t=t=>{console.log("\ud83d\udcc5 Real-time: Calendar updated",t),e({type:"CALENDAR_UPDATED",data:t}),i({type:"CALENDAR_UPDATED",timestamp:new Date,data:t})};return s.on("calendar_updated",t),()=>{s.off("calendar_updated",t)}},[s]),j=(0,a.useCallback)(e=>{if(!s)return()=>{};const t=t=>{console.log("\ud83d\udcc5 Real-time: Diary updated",t),e({type:"DIARY_UPDATED",data:t}),i({type:"DIARY_UPDATED",timestamp:new Date,data:t})};return s.on("diary_updated",t),()=>{s.off("diary_updated",t)}},[s]),w=(0,a.useCallback)(e=>{s&&s.connected&&s.emit("lead_update",e)},[s]),N=(0,a.useCallback)(e=>{s&&s.connected&&s.emit("stats_update",e)},[s]),k=(0,a.useCallback)(e=>{s&&s.connected&&s.emit("calendar_update",e)},[s]),S=(0,a.useCallback)(e=>{s&&s.connected&&s.emit("diary_update",e)},[s]),C={socket:s,isConnected:r,lastUpdate:o,connectionAttempts:c,lastConnectionError:u,subscribeToLeadUpdates:b,subscribeToStatsUpdates:y,subscribeToCalendarUpdates:v,subscribeToDiaryUpdates:j,emitLeadUpdate:w,emitStatsUpdate:N,emitCalendarUpdate:k,emitDiaryUpdate:S};return(0,fn.jsx)(Ya.Provider,{value:C,children:t})};class Qa extends a.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null},this.handleGlobalError=this.handleGlobalError.bind(this),this.handleUnhandledRejection=this.handleUnhandledRejection.bind(this)}componentDidMount(){window.addEventListener("error",this.handleGlobalError),window.addEventListener("unhandledrejection",this.handleUnhandledRejection)}componentWillUnmount(){window.removeEventListener("error",this.handleGlobalError),window.removeEventListener("unhandledrejection",this.handleUnhandledRejection)}handleGlobalError(e){var t,s,n,a,r;var l;if((null===(t=e.error)||void 0===t||null===(s=t.message)||void 0===s?void 0:s.includes("chrome-extension://"))||(null===(n=e.error)||void 0===n||null===(a=n.stack)||void 0===a?void 0:a.includes("chrome-extension://"))||(null===(r=e.filename)||void 0===r?void 0:r.includes("chrome-extension://")))return console.warn("\ud83d\udd0c Chrome extension error caught by global handler, ignoring:",null===(l=e.error)||void 0===l?void 0:l.message),void e.preventDefault()}handleUnhandledRejection(e){var t,s,n,a,r;var l;if((null===(t=e.reason)||void 0===t||null===(s=t.message)||void 0===s?void 0:s.includes("chrome-extension://"))||(null===(n=e.reason)||void 0===n||null===(a=n.stack)||void 0===a?void 0:a.includes("chrome-extension://"))||(null===(r=e.reason)||void 0===r?void 0:r.toString().includes("chrome-extension://")))return console.warn("\ud83d\udd0c Chrome extension promise rejection caught by global handler, ignoring:",null===(l=e.reason)||void 0===l?void 0:l.message),void e.preventDefault()}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,t){var s,n,a;console.error("\ud83d\udea8 Error Boundary caught an error:",e,t);(null===e||void 0===e||null===(s=e.message)||void 0===s?void 0:s.includes("chrome-extension://"))||(null===e||void 0===e||null===(n=e.stack)||void 0===n?void 0:n.includes("chrome-extension://"))||(null===t||void 0===t||null===(a=t.componentStack)||void 0===a?void 0:a.includes("chrome-extension://"))?console.warn("\ud83d\udd0c Chrome extension error detected, ignoring:",e.message):this.setState({error:e,errorInfo:t})}render(){if(this.state.hasError){var e,t,s,n;return(null===(e=this.state.error)||void 0===e||null===(t=e.message)||void 0===t?void 0:t.includes("chrome-extension://"))||(null===(s=this.state.error)||void 0===s||null===(n=s.stack)||void 0===n?void 0:n.includes("chrome-extension://"))?this.props.children:(0,fn.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,fn.jsxs)("div",{className:"max-w-md w-full bg-white shadow-lg rounded-lg p-6",children:[(0,fn.jsxs)("div",{className:"flex items-center mb-4",children:[(0,fn.jsx)("div",{className:"flex-shrink-0",children:(0,fn.jsx)("svg",{className:"h-8 w-8 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,fn.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,fn.jsx)("div",{className:"ml-3",children:(0,fn.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Something went wrong"})})]}),(0,fn.jsx)("div",{className:"mt-2",children:(0,fn.jsx)("p",{className:"text-sm text-gray-500",children:"We're sorry, but something unexpected happened. Please try refreshing the page."})}),(0,fn.jsx)("div",{className:"mt-4",children:(0,fn.jsx)("button",{onClick:()=>window.location.reload(),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Refresh Page"})}),!1]})})}return this.props.children}}const Ka=Qa;var Ja={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Xa=a.createContext&&a.createContext(Ja),Za=function(){return Za=Object.assign||function(e){for(var t,s=1,n=arguments.length;s<n;s++)for(var a in t=arguments[s])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},Za.apply(this,arguments)},er=function(e,t){var s={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(s[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(s[n[a]]=e[n[a]])}return s};function tr(e){return e&&e.map(function(e,t){return a.createElement(e.tag,Za({key:t},e.attr),tr(e.child))})}function sr(e){return function(t){return a.createElement(nr,Za({attr:Za({},e.attr)},t),tr(e.child))}}function nr(e){var t=function(t){var s,n=e.attr,r=e.size,l=e.title,o=er(e,["attr","size","title"]),i=r||t.size||"1em";return t.className&&(s=t.className),e.className&&(s=(s?s+" ":"")+e.className),a.createElement("svg",Za({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,n,o,{className:s,style:Za(Za({color:e.color||t.color},t.style),e.style),height:i,width:i,xmlns:"http://www.w3.org/2000/svg"}),l&&a.createElement("title",null,l),e.children)};return void 0!==Xa?a.createElement(Xa.Consumer,null,function(e){return t(e)}):t(Ja)}function ar(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"22 12 18 12 15 21 9 3 6 12 2 12"}}]})(e)}function rr(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"line",attr:{x1:"12",y1:"8",x2:"12",y2:"12"}},{tag:"line",attr:{x1:"12",y1:"16",x2:"12.01",y2:"16"}}]})(e)}function lr(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}},{tag:"line",attr:{x1:"12",y1:"9",x2:"12",y2:"13"}},{tag:"line",attr:{x1:"12",y1:"17",x2:"12.01",y2:"17"}}]})(e)}function or(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"19",y1:"12",x2:"5",y2:"12"}},{tag:"polyline",attr:{points:"12 19 5 12 12 5"}}]})(e)}function ir(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"5",y1:"12",x2:"19",y2:"12"}},{tag:"polyline",attr:{points:"12 5 19 12 12 19"}}]})(e)}function cr(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"8",r:"7"}},{tag:"polyline",attr:{points:"8.21 13.89 7 23 12 20 17 23 15.79 13.88"}}]})(e)}function dr(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"18",y1:"20",x2:"18",y2:"10"}},{tag:"line",attr:{x1:"12",y1:"20",x2:"12",y2:"4"}},{tag:"line",attr:{x1:"6",y1:"20",x2:"6",y2:"14"}}]})(e)}function ur(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}},{tag:"path",attr:{d:"M13.73 21a2 2 0 0 1-3.46 0"}}]})(e)}function mr(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"}},{tag:"path",attr:{d:"M6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"}}]})(e)}function hr(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}},{tag:"line",attr:{x1:"16",y1:"2",x2:"16",y2:"6"}},{tag:"line",attr:{x1:"8",y1:"2",x2:"8",y2:"6"}},{tag:"line",attr:{x1:"3",y1:"10",x2:"21",y2:"10"}}]})(e)}function pr(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}},{tag:"circle",attr:{cx:"12",cy:"13",r:"4"}}]})(e)}function xr(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}},{tag:"polyline",attr:{points:"22 4 12 14.01 9 11.01"}}]})(e)}function gr(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"20 6 9 17 4 12"}}]})(e)}function fr(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"6 9 12 15 18 9"}}]})(e)}function br(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"15 18 9 12 15 6"}}]})(e)}function yr(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"9 18 15 12 9 6"}}]})(e)}function vr(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"18 15 12 9 6 15"}}]})(e)}function jr(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}}]})(e)}function wr(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"polyline",attr:{points:"12 6 12 12 16 14"}}]})(e)}function Nr(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}},{tag:"path",attr:{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"}}]})(e)}function kr(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"1",y:"4",width:"22",height:"16",rx:"2",ry:"2"}},{tag:"line",attr:{x1:"1",y1:"10",x2:"23",y2:"10"}}]})(e)}function Sr(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"12",y1:"1",x2:"12",y2:"23"}},{tag:"path",attr:{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"}}]})(e)}function Cr(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}},{tag:"polyline",attr:{points:"7 10 12 15 17 10"}},{tag:"line",attr:{x1:"12",y1:"15",x2:"12",y2:"3"}}]})(e)}function _r(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"}}]})(e)}function Er(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}},{tag:"path",attr:{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"}}]})(e)}function Tr(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"}},{tag:"polyline",attr:{points:"15 3 21 3 21 9"}},{tag:"line",attr:{x1:"10",y1:"14",x2:"21",y2:"3"}}]})(e)}function Pr(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"}},{tag:"line",attr:{x1:"1",y1:"1",x2:"23",y2:"23"}}]})(e)}function Ar(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}},{tag:"circle",attr:{cx:"12",cy:"12",r:"3"}}]})(e)}function Dr(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}},{tag:"polyline",attr:{points:"14 2 14 8 20 8"}},{tag:"line",attr:{x1:"16",y1:"13",x2:"8",y2:"13"}},{tag:"line",attr:{x1:"16",y1:"17",x2:"8",y2:"17"}},{tag:"polyline",attr:{points:"10 9 9 9 8 9"}}]})(e)}function Lr(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"}}]})(e)}function Mr(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"}}]})(e)}function Rr(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}},{tag:"polyline",attr:{points:"9 22 9 12 15 12 15 22"}}]})(e)}function Fr(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}},{tag:"circle",attr:{cx:"8.5",cy:"8.5",r:"1.5"}},{tag:"polyline",attr:{points:"21 15 16 10 5 21"}}]})(e)}function Ir(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"19",y1:"4",x2:"10",y2:"4"}},{tag:"line",attr:{x1:"14",y1:"20",x2:"5",y2:"20"}},{tag:"line",attr:{x1:"15",y1:"4",x2:"9",y2:"20"}}]})(e)}function Or(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"}}]})(e)}function Br(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}},{tag:"path",attr:{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"}}]})(e)}function Ur(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"12",y1:"2",x2:"12",y2:"6"}},{tag:"line",attr:{x1:"12",y1:"18",x2:"12",y2:"22"}},{tag:"line",attr:{x1:"4.93",y1:"4.93",x2:"7.76",y2:"7.76"}},{tag:"line",attr:{x1:"16.24",y1:"16.24",x2:"19.07",y2:"19.07"}},{tag:"line",attr:{x1:"2",y1:"12",x2:"6",y2:"12"}},{tag:"line",attr:{x1:"18",y1:"12",x2:"22",y2:"12"}},{tag:"line",attr:{x1:"4.93",y1:"19.07",x2:"7.76",y2:"16.24"}},{tag:"line",attr:{x1:"16.24",y1:"7.76",x2:"19.07",y2:"4.93"}}]})(e)}function zr(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}},{tag:"path",attr:{d:"M7 11V7a5 5 0 0 1 10 0v4"}}]})(e)}function Vr(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}},{tag:"polyline",attr:{points:"16 17 21 12 16 7"}},{tag:"line",attr:{x1:"21",y1:"12",x2:"9",y2:"12"}}]})(e)}function Wr(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"}},{tag:"polyline",attr:{points:"22,6 12,13 2,6"}}]})(e)}function qr(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"}},{tag:"circle",attr:{cx:"12",cy:"10",r:"3"}}]})(e)}function Hr(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"}}]})(e)}function Yr(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"3",y1:"12",x2:"21",y2:"12"}},{tag:"line",attr:{x1:"3",y1:"6",x2:"21",y2:"6"}},{tag:"line",attr:{x1:"3",y1:"18",x2:"21",y2:"18"}}]})(e)}function Gr(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"}}]})(e)}function $r(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"}}]})(e)}function Qr(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"}}]})(e)}function Kr(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"6",y:"4",width:"4",height:"16"}},{tag:"rect",attr:{x:"14",y:"4",width:"4",height:"16"}}]})(e)}function Jr(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"}}]})(e)}function Xr(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"5 3 19 12 5 21 5 3"}}]})(e)}function Zr(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"12",y1:"5",x2:"12",y2:"19"}},{tag:"line",attr:{x1:"5",y1:"12",x2:"19",y2:"12"}}]})(e)}function el(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"23 4 23 10 17 10"}},{tag:"polyline",attr:{points:"1 20 1 14 7 14"}},{tag:"path",attr:{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"}}]})(e)}function tl(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"}},{tag:"polyline",attr:{points:"17 21 17 13 7 13 7 21"}},{tag:"polyline",attr:{points:"7 3 7 8 15 8"}}]})(e)}function sl(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"11",cy:"11",r:"8"}},{tag:"line",attr:{x1:"21",y1:"21",x2:"16.65",y2:"16.65"}}]})(e)}function nl(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"22",y1:"2",x2:"11",y2:"13"}},{tag:"polygon",attr:{points:"22 2 15 22 11 13 2 9 22 2"}}]})(e)}function al(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"3"}},{tag:"path",attr:{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"}}]})(e)}function rl(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"}}]})(e)}function ll(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"}},{tag:"line",attr:{x1:"3",y1:"6",x2:"21",y2:"6"}},{tag:"path",attr:{d:"M16 10a4 4 0 0 1-8 0"}}]})(e)}function ol(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"}}]})(e)}function il(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"circle",attr:{cx:"12",cy:"12",r:"6"}},{tag:"circle",attr:{cx:"12",cy:"12",r:"2"}}]})(e)}function cl(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"3 6 5 6 21 6"}},{tag:"path",attr:{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}},{tag:"line",attr:{x1:"10",y1:"11",x2:"10",y2:"17"}},{tag:"line",attr:{x1:"14",y1:"11",x2:"14",y2:"17"}}]})(e)}function dl(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"23 6 13.5 15.5 8.5 10.5 1 18"}},{tag:"polyline",attr:{points:"17 6 23 6 23 12"}}]})(e)}function ul(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"4 7 4 4 20 4 20 7"}},{tag:"line",attr:{x1:"9",y1:"20",x2:"15",y2:"20"}},{tag:"line",attr:{x1:"12",y1:"4",x2:"12",y2:"20"}}]})(e)}function ml(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M6 3v7a6 6 0 0 0 6 6 6 6 0 0 0 6-6V3"}},{tag:"line",attr:{x1:"4",y1:"21",x2:"20",y2:"21"}}]})(e)}function hl(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}},{tag:"path",attr:{d:"M7 11V7a5 5 0 0 1 9.9-1"}}]})(e)}function pl(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}},{tag:"polyline",attr:{points:"17 8 12 3 7 8"}},{tag:"line",attr:{x1:"12",y1:"3",x2:"12",y2:"15"}}]})(e)}function xl(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"8.5",cy:"7",r:"4"}},{tag:"line",attr:{x1:"20",y1:"8",x2:"20",y2:"14"}},{tag:"line",attr:{x1:"23",y1:"11",x2:"17",y2:"11"}}]})(e)}function gl(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"12",cy:"7",r:"4"}}]})(e)}function fl(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"9",cy:"7",r:"4"}},{tag:"path",attr:{d:"M23 21v-2a4 4 0 0 0-3-3.87"}},{tag:"path",attr:{d:"M16 3.13a4 4 0 0 1 0 7.75"}}]})(e)}function bl(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"1",y1:"1",x2:"23",y2:"23"}},{tag:"path",attr:{d:"M16.72 11.06A10.94 10.94 0 0 1 19 12.55"}},{tag:"path",attr:{d:"M5 12.55a10.94 10.94 0 0 1 5.17-2.39"}},{tag:"path",attr:{d:"M10.71 5.05A16 16 0 0 1 22.58 9"}},{tag:"path",attr:{d:"M1.42 9a15.91 15.91 0 0 1 4.7-2.88"}},{tag:"path",attr:{d:"M8.53 16.11a6 6 0 0 1 6.95 0"}},{tag:"line",attr:{x1:"12",y1:"20",x2:"12.01",y2:"20"}}]})(e)}function yl(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M5 12.55a11 11 0 0 1 14.08 0"}},{tag:"path",attr:{d:"M1.42 9a16 16 0 0 1 21.16 0"}},{tag:"path",attr:{d:"M8.53 16.11a6 6 0 0 1 6.95 0"}},{tag:"line",attr:{x1:"12",y1:"20",x2:"12.01",y2:"20"}}]})(e)}function vl(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"line",attr:{x1:"15",y1:"9",x2:"9",y2:"15"}},{tag:"line",attr:{x1:"9",y1:"9",x2:"15",y2:"15"}}]})(e)}function jl(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"18",y1:"6",x2:"6",y2:"18"}},{tag:"line",attr:{x1:"6",y1:"6",x2:"18",y2:"18"}}]})(e)}function wl(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"11",cy:"11",r:"8"}},{tag:"line",attr:{x1:"21",y1:"21",x2:"16.65",y2:"16.65"}},{tag:"line",attr:{x1:"11",y1:"8",x2:"11",y2:"14"}},{tag:"line",attr:{x1:"8",y1:"11",x2:"14",y2:"11"}}]})(e)}function Nl(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"11",cy:"11",r:"8"}},{tag:"line",attr:{x1:"21",y1:"21",x2:"16.65",y2:"16.65"}},{tag:"line",attr:{x1:"8",y1:"11",x2:"14",y2:"11"}}]})(e)}gn.interceptors.request.use(e=>("get"===e.method&&(e.params=He(He({},e.params),{},{_t:Date.now()})),e),e=>Promise.reject(e));const kl=e=>{var t;if(!e.response)return!0;const s=e.response.status,n=null===(t=e.response.data)||void 0===t?void 0:t.error;return s>=500||503===s||"DB_CONNECTION_ERROR"===n||"DB_DISCONNECTED"===n},Sl=e=>new Promise(t=>setTimeout(t,e));gn.interceptors.response.use(e=>e,async e=>{const t=e.config;if(t.__retryCount>=1||t.skipRetry||t.__usingCustomRetry)return Promise.reject(e);t.__retryCount=t.__retryCount||0;if(!e.response&&("ECONNREFUSED"===e.code||"ENOTFOUND"===e.code||e.message.includes("Network Error"))){t.__retryCount++;const e=3e3;return console.warn("\u26a0\ufe0f Network error, retrying in ".concat(e,"ms...")),await Sl(e),gn(t)}return Promise.reject(e)});const Cl=e=>{let{className:t=""}=e;const{isConnected:s,connectionAttempts:n,lastConnectionError:r}=Ga(),[l,o]=(0,a.useState)({healthy:!0,checking:!1}),[i,c]=(0,a.useState)(!1);(0,a.useEffect)(()=>{const e=async()=>{o(e=>He(He({},e),{},{checking:!0}));try{const e=await(async()=>{try{var e,t,s;const n=Date.now(),a=await gn.get("/api/health",{timeout:5e3,skipRetry:!0}),r=Date.now()-n,l="connected"===(null===(e=a.data)||void 0===e?void 0:e.database);return{healthy:200===a.status&&l,latency:r,databaseStatus:(null===(t=a.data)||void 0===t?void 0:t.database)||"unknown",serverStatus:(null===(s=a.data)||void 0===s?void 0:s.status)||"unknown"}}catch(a){var n;return{healthy:!1,error:404===(null===(n=a.response)||void 0===n?void 0:n.status)?"Health endpoint not found":a.message,canRetry:kl(a)}}})();o(He(He({},e),{},{checking:!1}))}catch(e){o({healthy:!1,error:e.message,checking:!1})}};e();const t=setInterval(e,3e4);return()=>clearInterval(t)},[]);const d=s||l.healthy?s&&l.healthy?n>0?{status:"reconnecting",message:"Reconnecting...",icon:el,color:"text-blue-500 bg-blue-100 border-blue-200"}:{status:"connected",message:"Connected",icon:yl,color:"text-green-600 bg-green-100 border-green-200"}:{status:"degraded",message:"Partial Connection",icon:lr,color:"text-yellow-600 bg-yellow-100 border-yellow-200"}:{status:"offline",message:"Disconnected",icon:bl,color:"text-red-500 bg-red-100 border-red-200"},u=d.icon;return(0,fn.jsxs)("div",{className:"relative ".concat(t),children:[(0,fn.jsxs)("button",{onClick:()=>c(!i),className:"flex items-center space-x-2 px-3 py-1.5 rounded-lg border text-sm font-medium transition-colors ".concat(d.color," hover:opacity-80"),title:"Click for connection details",children:[(0,fn.jsx)(u,{className:"h-4 w-4 ".concat("reconnecting"===d.status?"animate-spin":"")}),(0,fn.jsx)("span",{children:d.message})]}),i&&(0,fn.jsx)("div",{className:"absolute top-full left-0 mt-2 w-72 bg-white border border-gray-200 rounded-lg shadow-lg z-50",children:(0,fn.jsxs)("div",{className:"p-4",children:[(0,fn.jsx)("h3",{className:"font-semibold text-gray-900 mb-3",children:"Connection Status"}),(0,fn.jsxs)("div",{className:"mb-3",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,fn.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Real-time Sync"}),(0,fn.jsxs)("div",{className:"flex items-center space-x-1 ".concat(s?"text-green-600":"text-red-500"),children:[s?(0,fn.jsx)(yl,{className:"h-3 w-3"}):(0,fn.jsx)(bl,{className:"h-3 w-3"}),(0,fn.jsx)("span",{className:"text-xs",children:s?"Connected":"Disconnected"})]})]}),n>0&&(0,fn.jsxs)("p",{className:"text-xs text-blue-600",children:["Reconnecting... (attempt ",n,")"]}),r&&(0,fn.jsxs)("p",{className:"text-xs text-red-500",children:["Error: ",r]})]}),(0,fn.jsxs)("div",{className:"mb-3",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,fn.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Database API"}),(0,fn.jsxs)("div",{className:"flex items-center space-x-1 ".concat(l.healthy?"text-green-600":"text-red-500"),children:[l.checking?(0,fn.jsx)(el,{className:"h-3 w-3 animate-spin"}):l.healthy?(0,fn.jsx)(yl,{className:"h-3 w-3"}):(0,fn.jsx)(bl,{className:"h-3 w-3"}),(0,fn.jsx)("span",{className:"text-xs",children:l.checking?"Checking...":l.healthy?"Connected":"Disconnected"})]})]}),l.error&&(0,fn.jsxs)("p",{className:"text-xs text-red-500",children:["Error: ",l.error]}),l.latency&&(0,fn.jsxs)("p",{className:"text-xs text-gray-500",children:["Latency: ",l.latency,"ms"]}),l.databaseStatus&&(0,fn.jsxs)("p",{className:"text-xs text-gray-500",children:["Database: ",l.databaseStatus]}),l.serverStatus&&(0,fn.jsxs)("p",{className:"text-xs text-gray-500",children:["Server: ",l.serverStatus]})]}),(!s||!l.healthy)&&(0,fn.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded p-2",children:[(0,fn.jsx)("p",{className:"text-xs text-yellow-800 font-medium mb-1",children:"Connection Issues?"}),(0,fn.jsxs)("ul",{className:"text-xs text-yellow-700 space-y-1",children:[(0,fn.jsx)("li",{children:"\u2022 Check your internet connection"}),(0,fn.jsx)("li",{children:"\u2022 Refresh the page if problems persist"}),(0,fn.jsx)("li",{children:"\u2022 Data will sync when connection is restored"})]})]}),(0,fn.jsxs)("button",{onClick:()=>{o(e=>He(He({},e),{},{checking:!0})),window.location.reload()},className:"w-full mt-3 px-3 py-2 bg-blue-50 text-blue-700 border border-blue-200 rounded text-sm font-medium hover:bg-blue-100 transition-colors",children:[(0,fn.jsx)(el,{className:"h-3 w-3 inline mr-1"}),"Refresh Page"]})]})})]})};function _l(e){if(!e||"string"!==typeof e)return e;let t=e;return t=t.replace(/^--[A-Za-z0-9._-]+$/gm,""),t=t.replace(/^--[A-Za-z0-9._-]+--$/gm,""),t=t.replace(/^Content-Type:.*$/gm,""),t=t.replace(/^Content-Transfer-Encoding:.*$/gm,""),t=t.replace(/^Content-Disposition:.*$/gm,""),t=t.replace(/^boundary=.*$/gm,""),t=t.replace(/^charset=.*$/gm,""),t=t.replace(/^MIME-Version:.*$/gm,""),t=t.replace(/^X-.*$/gm,""),t=t.replace(/^Message-ID:.*$/gm,""),t=t.replace(/^Date:.*$/gm,""),t=t.replace(/^From:.*$/gm,""),t=t.replace(/^To:.*$/gm,""),t=t.replace(/^Subject:.*$/gm,""),t=function(e){if(!e)return"";try{return e=(e=e.replace(/=\r?\n/g,"")).replace(/=([0-9A-F]{2})/gi,(e,t)=>String.fromCharCode(parseInt(t,16))),e}catch(t){return console.error("Error decoding quoted-printable:",t),e}}(t),t=function(e){if(!e)return"";e=(e=(e=(e=(e=e.replace(/<br\s*\/?>/gi,"\n")).replace(/<\/?(div|p|h[1-6]|li|tr)[^>]*>/gi,"\n")).replace(/<\/td>/gi,"\t")).replace(/<hr[^>]*>/gi,"\n---\n")).replace(/<[^>]+>/g,"");const t={"&nbsp;":" ","&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#34;":'"',"&#39;":"'","&apos;":"'","&#x27;":"'","&ldquo;":'"',"&rdquo;":'"',"&lsquo;":"'","&rsquo;":"'","&mdash;":"-","&ndash;":"-","&hellip;":"...","\xe2\u20ac\u2122":"'","\xe2\u20ac\u0153":'"',"\xe2\u20ac":'"','\xe2\u20ac"':"-",'\xe2\u20ac"':"-","\xe2\u20ac\xa6":"...","\xe2":""};for(const[s,n]of Object.entries(t))e=e.replace(new RegExp(s,"g"),n);return e=(e=e.replace(/&#(\d+);/g,(e,t)=>String.fromCharCode(t))).replace(/&#x([0-9a-f]+);/gi,(e,t)=>String.fromCharCode(parseInt(t,16))),e}(t),t=t.replace(/^\s*=\r?\n/gm,""),t=t.replace(/^=\r?\n/gm,""),t=t.replace(/\n{3,}/g,"\n\n"),t=t.replace(/[ \t]+/g," "),t=t.replace(/^\s+|\s+$/gm,""),t=t.trim(),t}function El(e){if(!e)return!1;const t=/^Content-Type:|^Content-Transfer-Encoding:|^charset=/m.test(e),s=/=([0-9A-F]{2})/i.test(e),n=/<[^>]+>/g.test(e),a=/^--[A-Za-z0-9._-]+$/m.test(e);return t||s||n||a}function Tl(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;if(!e)return"";const s=_l(e);if(s.length<=t)return s;let n=s.substring(0,t);const a=n.lastIndexOf("."),r=n.lastIndexOf(" ");return a>.7*t?n=s.substring(0,a+1):r>.8*t&&(n=s.substring(0,r)),n+(s.length>t?"...":"")}const Pl=e=>{let{htmlContent:t,textContent:s,attachments:n=[],embeddedImages:r=[],className:l=""}=e;const o=(0,a.useRef)(null);(0,a.useEffect)(()=>{if(o.current&&t){const e=o.current,s=e.contentDocument||e.contentWindow.document,n=(e=>{if(!e)return"";const t=(new DOMParser).parseFromString(e,"text/html");["script","iframe","object","embed","form","input","button"].forEach(e=>{const s=t.getElementsByTagName(e);for(;s.length>0;)s[0].remove()});const s=t.getElementsByTagName("*");for(let r=0;r<s.length;r++){const e=s[r],t=[];for(let s=0;s<e.attributes.length;s++){const n=e.attributes[s],a=n.name.toLowerCase();(a.startsWith("on")||a.startsWith("data-")||"href"===a&&n.value.startsWith("javascript:")||"src"===a&&n.value.startsWith("javascript:"))&&t.push(n.name)}t.forEach(t=>e.removeAttribute(t))}const n=t.getElementsByTagName("img");for(let l=0;l<n.length;l++){const e=n[l],t=e.getAttribute("src");if(t&&t.startsWith("cid:")){const s=t.replace("cid:",""),n=r.find(e=>e.contentId===s||e.contentId==="<".concat(s,">"));n&&n.dataUrl?e.setAttribute("src",n.dataUrl):e.style.display="none"}e.style.maxWidth="100%",e.style.height="auto"}const a=t.getElementsByTagName("a");for(let r=0;r<a.length;r++){const e=a[r],t=e.getAttribute("href");!t||t.startsWith("http")||t.startsWith("mailto:")||t.startsWith("#")||e.setAttribute("href","https://"+t),e.setAttribute("target","_blank"),e.setAttribute("rel","noopener noreferrer")}return t.body.innerHTML})(t);s.open(),s.write('\n        <!DOCTYPE html>\n        <html>\n          <head>\n            <meta charset="utf-8">\n            <meta name="viewport" content="width=device-width, initial-scale=1">\n            <style>'.concat("\n    * {\n      box-sizing: border-box;\n    }\n    \n    body {\n      margin: 0;\n      padding: 0;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n      font-size: 14px;\n      line-height: 1.5;\n      color: #202124;\n      background-color: transparent;\n    }\n    \n    /* Gmail-like typography */\n    p {\n      margin: 0 0 12px 0;\n    }\n    \n    p:last-child {\n      margin-bottom: 0;\n    }\n    \n    /* Headings */\n    h1, h2, h3, h4, h5, h6 {\n      margin: 16px 0 8px 0;\n      font-weight: 600;\n      color: #202124;\n    }\n    \n    h1 { font-size: 20px; }\n    h2 { font-size: 18px; }\n    h3 { font-size: 16px; }\n    h4, h5, h6 { font-size: 14px; }\n    \n    /* Lists */\n    ul, ol {\n      margin: 8px 0;\n      padding-left: 24px;\n    }\n    \n    li {\n      margin: 4px 0;\n    }\n    \n    /* Links */\n    a {\n      color: #1a73e8;\n      text-decoration: none;\n    }\n    \n    a:hover {\n      text-decoration: underline;\n    }\n    \n    /* Images */\n    img {\n      max-width: 100%;\n      height: auto;\n      border: 0;\n    }\n    \n    /* Tables */\n    table {\n      border-collapse: collapse;\n      max-width: 100%;\n    }\n    \n    td, th {\n      padding: 8px;\n      border: 1px solid #dadce0;\n    }\n    \n    /* Blockquotes (for reply chains) */\n    blockquote {\n      margin: 8px 0;\n      padding-left: 12px;\n      border-left: 3px solid #dadce0;\n      color: #5f6368;\n    }\n    \n    /* Gmail quote style for forwarded/replied emails */\n    .gmail_quote {\n      margin: 8px 0;\n      padding-left: 12px;\n      border-left: 3px solid #dadce0;\n    }\n    \n    /* Outlook quote style */\n    div[style*=\"border-left\"] {\n      margin: 8px 0 !important;\n    }\n    \n    /* Horizontal rules */\n    hr {\n      border: none;\n      border-top: 1px solid #dadce0;\n      margin: 16px 0;\n    }\n    \n    /* Preformatted text */\n    pre {\n      background-color: #f8f9fa;\n      padding: 12px;\n      border-radius: 4px;\n      overflow-x: auto;\n      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;\n      font-size: 13px;\n    }\n    \n    code {\n      background-color: #f8f9fa;\n      padding: 2px 6px;\n      border-radius: 3px;\n      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;\n      font-size: 13px;\n    }\n    \n    /* Common email template classes */\n    .signature {\n      margin-top: 16px;\n      padding-top: 16px;\n      border-top: 1px solid #dadce0;\n    }\n    \n    /* Hide any tracking pixels */\n    img[width=\"1\"][height=\"1\"],\n    img[width=\"0\"][height=\"0\"] {\n      display: none;\n    }\n    \n    /* Responsive embeds */\n    iframe, video {\n      max-width: 100%;\n    }\n  ","</style>\n          </head>\n          <body>").concat(n,"</body>\n        </html>\n      ")),s.close();const a=()=>{e.style.height=s.body.scrollHeight+"px"};a();const l=s.getElementsByTagName("img");for(let t of l)t.onload=a}},[t,r]);const i=e=>{if(!e)return"";const t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*10)/10+" "+["B","KB","MB","GB"][t]};if(t&&(e=>{if(!e)return!1;return/<[a-z][\s\S]*>/i.test(e)})(t))return(0,fn.jsxs)("div",{className:"gmail-email-renderer ".concat(l),children:[(0,fn.jsx)("iframe",{ref:o,className:"w-full border-0",style:{minHeight:"100px"},title:"Email Content",sandbox:"allow-same-origin allow-popups"}),n&&n.length>0&&(0,fn.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[(0,fn.jsxs)("h4",{className:"text-sm font-medium text-gray-700 mb-2 flex items-center",children:[(0,fn.jsx)(Qr,{className:"mr-2"}),"Attachments (",n.length,")"]}),(0,fn.jsx)("div",{className:"flex flex-wrap gap-2",children:n.map((e,t)=>{var s;return(0,fn.jsxs)("a",{href:e.url||e.downloadUrl||"#",target:"_blank",rel:"noopener noreferrer",className:"flex items-center px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm text-gray-700 transition-colors",children:[null!==(s=e.contentType)&&void 0!==s&&s.startsWith("image/")?(0,fn.jsx)(Fr,{className:"mr-2 text-blue-500"}):(0,fn.jsx)(Qr,{className:"mr-2 text-gray-500"}),(0,fn.jsx)("span",{className:"truncate max-w-[150px]",children:e.filename||e.name||"Attachment ".concat(t+1)}),e.size&&(0,fn.jsxs)("span",{className:"ml-2 text-xs text-gray-500",children:["(",i(e.size),")"]})]},t)})})]})]});return(0,fn.jsxs)("div",{className:"gmail-email-renderer ".concat(l),children:[(e=>{if(!e)return(0,fn.jsx)("p",{className:"text-gray-500 italic",children:"No content"});const t=/(https?:\/\/[^\s<]+|www\.[^\s<]+)/g,s=e.split(t),n=e.match(t)||[];return(0,fn.jsx)("div",{className:"whitespace-pre-wrap break-words text-sm text-gray-900",children:s.map((e,t)=>(0,fn.jsxs)(a.Fragment,{children:[e,n[t]&&(0,fn.jsx)("a",{href:n[t].startsWith("www.")?"https://".concat(n[t]):n[t],target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:n[t]})]},t))})})(s||t),n&&n.length>0&&(0,fn.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[(0,fn.jsxs)("h4",{className:"text-sm font-medium text-gray-700 mb-2 flex items-center",children:[(0,fn.jsx)(Qr,{className:"mr-2"}),"Attachments (",n.length,")"]}),(0,fn.jsx)("div",{className:"flex flex-wrap gap-2",children:n.map((e,t)=>(0,fn.jsxs)("a",{href:e.url||e.downloadUrl||"#",target:"_blank",rel:"noopener noreferrer",className:"flex items-center px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm text-gray-700 transition-colors",children:[(0,fn.jsx)(Qr,{className:"mr-2 text-gray-500"}),(0,fn.jsx)("span",{className:"truncate max-w-[150px]",children:e.filename||e.name||"Attachment ".concat(t+1)})]},t))})]})]})},Al=e=>{let{notification:t,isOpen:s,onClose:n,onReply:r}=e;const[l,o]=(0,a.useState)(""),[i,c]=(0,a.useState)(!1),[d,u]=(0,a.useState)([]),[m,h]=(0,a.useState)(!1),[p,x]=(0,a.useState)(!1),[g,f]=(0,a.useState)(null),{socket:b}=Ga(),y=(0,a.useCallback)(async()=>{try{h(!0);const e=localStorage.getItem("token"),s=(await gn.get("/api/messages-list",{headers:e?{Authorization:"Bearer ".concat(e)}:{},params:{limit:200}})).data.messages||[],n=s.filter(e=>e.leadId===t.leadId&&("email"===(null===t||void 0===t?void 0:t.type)&&"email"===e.type||"sms"===(null===t||void 0===t?void 0:t.type)&&"sms"===e.type)).sort((e,t)=>new Date(e.timestamp)-new Date(t.timestamp)).map(e=>{var t,s;return{action:"sent"===e.direction?"email"===e.type?"EMAIL_SENT":"SMS_SENT":"email"===e.type?"EMAIL_RECEIVED":"SMS_RECEIVED",timestamp:e.timestamp,performed_by:e.performedBy,performed_by_name:e.performedByName,details:{subject:e.subject,body:e.content,message:e.content,email_body:e.email_body||(null===(t=e.details)||void 0===t?void 0:t.email_body)||null,html_content:e.email_body||(null===(s=e.details)||void 0===s?void 0:s.email_body)||null,direction:e.direction,channel:e.type,attachments:e.attachments||[],embedded_images:e.embedded_images||[]}}}),a=new Set,r=n.filter(e=>{var t,s,n;const r=e.timestamp?new Date(e.timestamp).toISOString():"",l=e.action||"",o=(null===(t=e.details)||void 0===t?void 0:t.body)||(null===(s=e.details)||void 0===s?void 0:s.message)||"",i=(null===(n=e.details)||void 0===n?void 0:n.subject)||"",c=e.performed_by||"",d=r?new Date(r).setSeconds(0,0):0,u=o.substring(0,200).trim().toLowerCase(),m="".concat(l,"_").concat(d,"_").concat(c,"_").concat(i.substring(0,50),"_").concat(u);return a.has(m)?(console.log("\ud83d\udd04 Client-side deduplication: Removing duplicate entry"),!1):(a.add(m),!0)});u(r)}catch(e){console.error("Error fetching conversation history:",e),u([])}finally{h(!1)}},[null===t||void 0===t?void 0:t.leadId,null===t||void 0===t?void 0:t.type]);if((0,a.useEffect)(()=>{if(s&&t){x(!1),f(null),y();const e=async()=>{console.log("\ud83d\udcf1 MessageModal: Marking message as read (always attempt for consistency)");try{x(!0),f(null),console.log("\ud83d\udcf1 MessageModal: Attempting to mark message as read:",t.id),console.log("\ud83d\udcf1 MessageModal: Notification object:",t);let e=t.messageId||t.id;const s=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;if(!s.test(e)){const t=e.includes("_")?e.split("_")[0]:e;s.test(t)?(e=t,console.log("\ud83d\udcf1 MessageModal: Extracted UUID from composite ID:",e)):console.warn("\ud83d\udcf1 MessageModal: Invalid message ID format, may fail:",e)}console.log("\ud83d\udcf1 MessageModal: Final message identifier:",e),console.log("\ud83d\udcf1 MessageModal: Has leadId:",!!t.leadId,"Has timestamp:",!!t.timestamp);const n=localStorage.getItem("token"),a=await gn.put("/api/messages-list/".concat(e,"/read"),{},{headers:n?{Authorization:"Bearer ".concat(n)}:{}});console.log("\ud83d\udcf1 MessageModal: API response:",a.data),a.data.success?(console.log("\u2705 MessageModal: Message marked as read successfully:",t.id),console.log("\ud83d\udccb MessageModal: Update method used:",a.data.method||"booking_history"),x(!1),b&&(b.emit("message_read_direct",{messageId:t.id,leadId:t.leadId,leadName:t.leadName}),console.log("\ud83d\udce1 MessageModal: Emitted direct socket event as backup"))):(console.error("\u274c MessageModal: API response indicates failure:",a.data),f("Failed to mark message as read"),x(!1))}catch(r){var e,s,n,a;if(console.error("\u274c MessageModal: Error marking message as read:",r),console.error("\u274c MessageModal: Error details:",null===(e=r.response)||void 0===e?void 0:e.data),404===(null===(s=r.response)||void 0===s?void 0:s.status))console.log("\ud83d\uddd1\ufe0f MessageModal: Message not found (404), but keeping modal open:",t.id),f("Message not found in database"),x(!1);else f((null===(n=r.response)||void 0===n||null===(a=n.data)||void 0===a?void 0:a.message)||"Failed to mark message as read"),x(!1)}},s=setTimeout(()=>{e()},100);return()=>clearTimeout(s)}s||(x(!1),f(null))},[s,t,y,b]),(0,a.useEffect)(()=>{if(b&&s&&t){const e=e=>{"LEAD_UPDATED"===e.type&&e.data.lead&&e.data.lead.id===t.leadId&&y()},s=e=>{e&&e.leadId===t.leadId&&y()},n=e=>{e&&e.leadId===t.leadId&&y()};return b.on("lead_updated",e),b.on("sms_received",s),b.on("message_received",n),()=>{b.off("lead_updated",e),b.off("sms_received",s),b.off("message_received",n)}}},[b,s,t,y]),(0,a.useEffect)(()=>{if(d.length>0){const e=document.querySelector(".conversation-scroll");e&&(e.scrollTop=e.scrollHeight)}},[d]),!s||!t)return null;const v=e=>{try{if(!e)return"Unknown time";let t;if(t="string"===typeof e?new Date(e):"number"===typeof e?new Date(e>1e12?e:1e3*e):new Date(e),isNaN(t.getTime()))return console.warn("Invalid timestamp:",e),"Invalid date";const s=new Date-t,n=s/36e5,a=s/864e5;if(n<1){const e=Math.floor(s/6e4);return e<=0?"Just now":"".concat(e," minute").concat(1===e?"":"s"," ago")}if(n<24)return t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0});if(a<7){const e=Math.floor(a);return"".concat(e," day").concat(1===e?"":"s"," ago at ").concat(t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0}))}return t.toLocaleDateString()+" "+t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0})}catch(t){return console.error("Error formatting timestamp:",t,"Timestamp:",e),"Unknown time"}};return(0,fn.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,fn.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-lg w-full mx-4 max-h-[90vh] overflow-hidden",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-3",children:["email"===(null===t||void 0===t?void 0:t.type)?(0,fn.jsx)(Wr,{className:"h-5 w-5 text-green-600"}):(0,fn.jsx)(Gr,{className:"h-5 w-5 text-blue-600"}),(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:[t.isGrouped?"Conversation with":"Message from"," ",t.leadName||"Unknown",t.isGrouped&&t.conversationCount>1&&(0,fn.jsxs)("span",{className:"ml-2 text-sm font-normal text-purple-600",children:["(",t.conversationCount," messages)"]})]}),(0,fn.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,fn.jsxs)("p",{className:"text-sm text-gray-500",children:[(0,fn.jsx)(wr,{className:"h-3 w-3 inline mr-1"}),t.isGrouped?"Latest message: ":"",v(t.timestamp)]}),p&&(0,fn.jsxs)("span",{className:"text-xs text-blue-600 flex items-center",children:[(0,fn.jsx)("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-blue-600 mr-1"}),"Marking as read..."]}),g&&(0,fn.jsxs)("span",{className:"text-xs text-red-600 flex items-center",children:[(0,fn.jsx)(rr,{className:"h-3 w-3 mr-1"}),g]}),!p&&!g&&t.read&&(0,fn.jsxs)("span",{className:"text-xs text-green-600 flex items-center",children:[(0,fn.jsx)(gr,{className:"h-3 w-3 mr-1"}),"Read"]})]})]})]}),(0,fn.jsx)("button",{onClick:n,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,fn.jsx)(jl,{className:"h-5 w-5"})})]}),(0,fn.jsxs)("div",{className:"p-4 max-h-96 overflow-y-auto conversation-scroll bg-white",children:[(null===t||void 0===t?void 0:t.content)&&(0,fn.jsxs)("div",{className:"mb-4 rounded-lg shadow-sm ".concat("sent"===t.direction?"bg-blue-600 text-white ml-auto max-w-[85%]":"bg-gray-100 text-gray-900 mr-auto max-w-[85%]"),children:[(0,fn.jsx)("div",{className:"px-4 py-3 border-b ".concat("sent"===t.direction?"border-blue-500":"border-gray-300"),children:(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,fn.jsx)("span",{className:"text-sm font-semibold ".concat("sent"===t.direction?"text-blue-100":"text-gray-900"),children:"sent"===t.direction?"You":t.leadName||"Unknown"}),t.subject&&(0,fn.jsx)("span",{className:"text-xs ".concat("sent"===t.direction?"text-blue-200":"text-gray-600"),children:t.subject})]}),(0,fn.jsx)("span",{className:"text-xs ".concat("sent"===t.direction?"text-blue-200":"text-gray-500"),children:v(t.timestamp)})]})}),(0,fn.jsx)("div",{className:"px-4 py-3",children:"email"===(null===t||void 0===t?void 0:t.type)&&(t.email_body||t.html_content)?(0,fn.jsx)("div",{className:"email-html-wrapper",children:(0,fn.jsx)(Pl,{htmlContent:t.email_body||t.html_content,textContent:t.content,attachments:t.attachments||[],embeddedImages:t.embedded_images||[]})}):(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)("p",{className:"text-sm whitespace-pre-wrap break-words ".concat("sent"===t.direction?"text-white":"text-gray-900"),children:_l(t.content)}),El(t.content)&&(0,fn.jsx)("span",{className:"mt-2 inline-block px-2 py-0.5 text-xs rounded ".concat("sent"===t.direction?"bg-blue-500 text-blue-100":"bg-yellow-100 text-yellow-800"),children:"Auto-decoded"})]})})]}),m?(0,fn.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,fn.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),(0,fn.jsx)("span",{className:"ml-2 text-gray-500",children:"Loading conversation..."})]}):0===d.length?(0,fn.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,fn.jsx)(Gr,{className:"mx-auto h-8 w-8 mb-2"}),(0,fn.jsx)("p",{children:"No previous conversation history"}),(0,fn.jsx)("p",{className:"text-xs mt-1",children:"This is the start of your conversation"})]}):(0,fn.jsx)("div",{className:"space-y-3",children:d.filter((e,s)=>{var n,a,r;const l=(null===t||void 0===t?void 0:t.content)||"",o=(null===(n=e.details)||void 0===n?void 0:n.body)||(null===(a=e.details)||void 0===a?void 0:a.message)||(null===(r=e.details)||void 0===r?void 0:r.subject)||"";if(l.trim()===o.trim())return console.log("\ud83d\udd04 Filtering out duplicate message from conversation history"),!1;if(null!==t&&void 0!==t&&t.timestamp&&e.timestamp){const s=new Date(t.timestamp).getTime(),n=new Date(e.timestamp).getTime();if(Math.abs(s-n)<5e3&&l.includes(o.substring(0,50)))return console.log("\ud83d\udd04 Filtering out near-duplicate message from conversation history"),!1}return!0}).map((e,s)=>{var n,a,r,l,o,i,c,d,u,m,h,p,x,g;const f=["SMS_SENT","EMAIL_SENT"].includes(e.action),b="SMS_FAILED"===e.action;return(0,fn.jsx)("div",{className:"flex ".concat(f?"justify-end":"justify-start"," mb-3"),children:(0,fn.jsxs)("div",{className:"max-w-[85%] rounded-lg shadow-sm ".concat(f?"bg-blue-600 text-white":b?"bg-red-50 border border-red-300 text-red-800":"bg-gray-100 text-gray-900"),children:[(0,fn.jsx)("div",{className:"px-4 py-2 border-b ".concat(f?"border-blue-500":b?"border-red-300":"border-gray-300"),children:(0,fn.jsxs)("div",{className:"flex items-center justify-between",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,fn.jsx)("span",{className:"text-sm font-semibold ".concat(f?"text-blue-100":b?"text-red-900":"text-gray-900"),children:f?"You":t.leadName||"Unknown"}),(null===(n=e.details)||void 0===n?void 0:n.subject)&&(0,fn.jsx)("span",{className:"text-xs ".concat(f?"text-blue-200":b?"text-red-700":"text-gray-600"),children:e.details.subject})]}),(0,fn.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,fn.jsx)("span",{className:"text-xs ".concat(f?"text-blue-200":b?"text-red-700":"text-gray-500"),children:v(e.timestamp)}),f&&(0,fn.jsx)(gr,{className:"h-3 w-3 ".concat("delivered"===e.delivery_status?"text-blue-200":"text-blue-300")}),b&&(0,fn.jsx)(rr,{className:"h-3 w-3 text-red-600",title:(null===(a=e.details)||void 0===a?void 0:a.error_message)||"Failed"})]})]})}),(0,fn.jsx)("div",{className:"px-4 py-3",children:"email"===(null===t||void 0===t?void 0:t.type)&&(null!==(r=e.details)&&void 0!==r&&r.email_body||null!==(l=e.details)&&void 0!==l&&l.html_content)?(0,fn.jsx)("div",{className:f?"email-sent":b?"email-failed":"email-received",children:(0,fn.jsx)(Pl,{htmlContent:(null===(o=e.details)||void 0===o?void 0:o.email_body)||(null===(i=e.details)||void 0===i?void 0:i.html_content),textContent:(null===(c=e.details)||void 0===c?void 0:c.body)||(null===(d=e.details)||void 0===d?void 0:d.message)||(null===(u=e.details)||void 0===u?void 0:u.subject)||"No content",attachments:(null===(m=e.details)||void 0===m?void 0:m.attachments)||[],embeddedImages:(null===(h=e.details)||void 0===h?void 0:h.embedded_images)||[]})}):(0,fn.jsx)("p",{className:"text-sm whitespace-pre-wrap break-words ".concat(f?"text-white":b?"text-red-900":"text-gray-900"),children:_l((null===(p=e.details)||void 0===p?void 0:p.body)||(null===(x=e.details)||void 0===x?void 0:x.message)||(null===(g=e.details)||void 0===g?void 0:g.subject)||"No content")})})]})},"".concat(e.timestamp,"-").concat(s))})})]}),(0,fn.jsx)("div",{className:"border-t border-gray-200 p-4 bg-white",children:(0,fn.jsxs)("div",{className:"space-y-3",children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"email"===(null===t||void 0===t?void 0:t.type)?"Reply via Email":"Reply via SMS"}),(0,fn.jsx)("div",{className:"flex space-x-3",children:(0,fn.jsxs)("div",{className:"flex-1",children:[(0,fn.jsx)("textarea",{value:l,onChange:e=>o(e.target.value),placeholder:"Type your reply message...",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 resize-none",rows:"3",maxLength:"email"===(null===t||void 0===t?void 0:t.type)?5e3:160}),(0,fn.jsxs)("div",{className:"flex justify-between items-center mt-1",children:[(0,fn.jsxs)("p",{className:"text-xs text-gray-500",children:[l.length,"/","email"===(null===t||void 0===t?void 0:t.type)?5e3:160," characters"]}),l.length>140&&(0,fn.jsx)("p",{className:"text-xs text-orange-500",children:"May be sent as multiple messages"})]})]})})]})}),(0,fn.jsxs)("div",{className:"bg-gray-50 px-4 py-3 flex justify-between items-center",children:[(0,fn.jsxs)("button",{onClick:()=>window.open("/leads/".concat(t.leadId),"_blank"),className:"text-blue-600 hover:text-blue-800 text-sm font-medium flex items-center space-x-1",children:[(0,fn.jsx)(gl,{className:"h-4 w-4"}),(0,fn.jsx)("span",{children:"View Lead Details"}),(0,fn.jsx)(ir,{className:"h-3 w-3"})]}),(0,fn.jsxs)("div",{className:"flex space-x-3",children:[(0,fn.jsx)("button",{onClick:n,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Close"}),(0,fn.jsx)("button",{onClick:async()=>{if(l.trim())if(i)console.log("Reply already being sent, ignoring duplicate request");else try{if(c(!0),"email"===(null===t||void 0===t?void 0:t.type)){const e=(null===t||void 0===t?void 0:t.subject)||(null===t||void 0===t?void 0:t.content)||"",s=e&&!/^re\s*:/i.test(e)?"Re: ".concat(e):e||"Re:",a=await gn.post("/api/leads/".concat(t.leadId,"/send-email"),{subject:s,body:l});if(a.data.success){alert("Email sent successfully!"),o("");try{await gn.put("/api/messages-list/".concat(t.id,"/read"))}catch(n){}await y(),r&&r({leadId:t.leadId,leadName:t.leadName,content:l}),b&&b.emit("message_read",{leadId:t.leadId})}else alert("Failed to send email: "+(a.data.message||"Unknown error"))}else{const e=await gn.post("/api/leads/".concat(t.leadId,"/send-sms"),{message:l,type:"custom"});if(e.data.success){alert("SMS reply sent successfully!");const e=l;o("");try{await gn.put("/api/messages-list/".concat(t.id,"/read"))}catch(a){}await y(),r&&r({leadId:t.leadId,leadName:t.leadName,leadPhone:t.leadPhone,content:e}),b&&b.emit("message_read",{leadId:t.leadId})}else alert("Failed to send SMS: "+(e.data.message||"Unknown error"))}}catch(d){var e,s;console.error("Error sending reply:",d),alert("Error sending message: "+((null===(e=d.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.message)||d.message))}finally{c(!1)}else alert("Please enter a reply message")},disabled:i||!l.trim(),className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:i?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),(0,fn.jsx)("span",{children:"Sending..."})]}):(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(nl,{className:"h-4 w-4"}),(0,fn.jsx)("span",{children:"email"===(null===t||void 0===t?void 0:t.type)?"Send Email":"Send SMS"})]})})]})]})]})})};function Dl(e){return sr({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M13.5 2C13.5 2.44425 13.3069 2.84339 13 3.11805V5H18C19.6569 5 21 6.34315 21 8V18C21 19.6569 19.6569 21 18 21H6C4.34315 21 3 19.6569 3 18V8C3 6.34315 4.34315 5 6 5H11V3.11805C10.6931 2.84339 10.5 2.44425 10.5 2C10.5 1.17157 11.1716 0.5 12 0.5C12.8284 0.5 13.5 1.17157 13.5 2ZM6 7C5.44772 7 5 7.44772 5 8V18C5 18.5523 5.44772 19 6 19H18C18.5523 19 19 18.5523 19 18V8C19 7.44772 18.5523 7 18 7H13H11H6ZM2 10H0V16H2V10ZM22 10H24V16H22V10ZM9 14.5C9.82843 14.5 10.5 13.8284 10.5 13C10.5 12.1716 9.82843 11.5 9 11.5C8.17157 11.5 7.5 12.1716 7.5 13C7.5 13.8284 8.17157 14.5 9 14.5ZM15 14.5C15.8284 14.5 16.5 13.8284 16.5 13C16.5 12.1716 15.8284 11.5 15 11.5C14.1716 11.5 13.5 12.1716 13.5 13C13.5 13.8284 14.1716 14.5 15 14.5Z"}}]})(e)}const Ll="/images/edge-talent-logo.png",Ml=e=>{var t,s,n;let{children:r}=e;const l="false"!==String({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_NOTIFICATIONS_ENABLED||"true").toLowerCase(),[o,i]=(0,a.useState)(!1),[c,d]=(0,a.useState)(!1),[u,m]=(0,a.useState)(!1),[h,p]=(0,a.useState)(!1),[x,g]=(0,a.useState)(!1),[f,b]=(0,a.useState)([]),[y,v]=(0,a.useState)(()=>{try{const e=localStorage.getItem("readNotificationIds");return e?JSON.parse(e):[]}catch(e){return[]}}),[j,w]=(0,a.useState)(null),[N,k]=(0,a.useState)(!1),{user:S,logout:C,isAuthenticated:_}=wn(),{socket:E,isConnected:T}=Ga(),P=$(),A=K(),D=(0,a.useRef)(null),L=(0,a.useRef)(null),M=(0,a.useRef)(null),R=(0,a.useRef)(null),F=[{name:"Diary Templates",key:"Diary Templates"},{name:"Sale Templates",key:"Sale Templates"},{name:"Bookers Templates",key:"Bookers Templates"}];(0,a.useEffect)(()=>{const e=e=>{L.current&&!L.current.contains(e.target)&&m(!1)},t=e=>{M.current&&!M.current.contains(e.target)&&g(!1)},s=e=>{R.current&&!R.current.contains(e.target)&&p(!1)};return document.addEventListener("mousedown",e),document.addEventListener("mousedown",t),document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("mousedown",t),document.removeEventListener("mousedown",s)}},[]);const I=e=>{v(e);try{localStorage.setItem("readNotificationIds",JSON.stringify(e.slice(-500)))}catch(t){}},O=e=>{try{localStorage.setItem("lastSeenNotificationsAt",e)}catch(t){}};(0,a.useEffect)(()=>{if(!l)return void console.log("\ud83d\udd14 Notifications disabled");if(!E)return void console.log("\ud83d\udd14 No socket connection for notifications");console.log("\ud83d\udd14 Setting up notification listeners...");const e=e=>{if("LEAD_UPDATED"===e.type&&e.data.lead){const t=e.data.lead;if(t.booking_history){const e=("string"===typeof t.booking_history?JSON.parse(t.booking_history):t.booking_history).find(e=>"SMS_RECEIVED"===e.action&&new Date(e.timestamp)>new Date(Date.now()-3e4));if(e){const s={id:"".concat(t.id,"_").concat(e.timestamp),leadId:t.id,leadName:t.name,leadPhone:t.phone,message:e.details.body,timestamp:e.timestamp,read:!1};b(e=>[s,...e.slice(0,9)]),console.log("\ud83d\udcf1 New SMS notification:",s)}}}},t=e=>{var t;if(console.log("\ud83d\udcf1 Layout: Received message_received event:",e),null===e||void 0===e||!e.leadId)return void console.log("\u274c Layout: No leadId in SMS event data");const s={id:e.messageId||"".concat(e.leadId,"_").concat(e.timestamp,"_").concat(Date.now()),leadId:e.leadId,leadName:e.leadName||"SMS Reply",leadPhone:e.phone,message:e.content,content:e.content,timestamp:e.timestamp,type:"sms",read:!1,formattedTime:"Just now"};console.log("\ud83d\udd14 Layout: Adding NEW notification:",{id:s.id,lead:s.leadName,message:(null===(t=s.message)||void 0===t?void 0:t.substring(0,30))+"..."}),b(e=>{if(e.some(e=>e.id===s.id))return console.log("\u26a0\ufe0f Layout: Notification already exists, skipping duplicate"),e;const t=[s,...e.slice(0,9)];return console.log("\u2705 Layout: Added notification, total unread:",t.filter(e=>!e.read).length),t})},s=e=>{var t;if(console.log("\ud83d\udd14 Layout: Received message_received event:",e),(null===e||void 0===e||!e.leadId)&&(null===e||void 0===e||!e.phone))return void console.log("\u274c Layout: No leadId or phone in message event data");const s=e.messageId||"".concat(e.leadId||e.phone,"_").concat(e.timestamp,"_").concat(Date.now()),n={id:s,messageId:e.messageId||s,leadId:e.leadId,leadName:e.leadName||("email"===e.channel?"Email Reply":"SMS Reply"),leadPhone:e.phone||e.leadPhone,leadEmail:e.email||e.leadEmail,message:e.content,content:e.content,timestamp:e.timestamp,type:e.channel||e.type||"sms",subject:e.subject,email_body:e.email_body||e.html_body||null,read:!1,formattedTime:"Just now"};console.log("\ud83d\udd14 Layout: Adding ".concat(n.type," notification:"),{id:n.id,lead:n.leadName,content:(null===(t=n.content)||void 0===t?void 0:t.substring(0,30))+"..."}),b(e=>{if(e.some(e=>e.id===n.id))return console.log("\u26a0\ufe0f Layout: Notification already exists, skipping duplicate"),e;const t=[n,...e.slice(0,9)];return console.log("\u2705 Layout: Added ".concat(n.type," notification, total notifications:"),t.length),t})},n=e=>{console.log("\ud83d\udce1 Layout: Received message_read event:",e);const t=e.messageId;if(!t)return void console.warn("\u26a0\ufe0f Layout: No messageId in message_read event");b(e=>e.map(e=>e.id===t||e.messageId===t?(console.log("\u2705 Layout: Marking notification as read:",e.id),He(He({},e),{},{read:!0})):e));const s=Array.from(new Set([...y,t]));I(s),console.log("\ud83d\udcbe Layout: Persisted read status for:",t)},a=e=>{console.log("\ud83d\udcde Callback reminder received:",e);const t={id:"callback_".concat(e.reminderId),type:"callback_reminder",leadId:e.leadId,leadName:e.leadName||"Unknown Lead",message:e.message,timestamp:e.timestamp||(new Date).toISOString(),formattedTime:"Just now",read:!1,callbackTime:e.callbackTime,callbackNote:e.callbackNote||""};b(e=>e.some(e=>e.id===t.id)?e:[t,...e.slice(0,9)]),"Notification"in window&&"granted"===Notification.permission?new Notification("\u23f0 Callback Reminder",{body:e.message,icon:"/favicon.ico",tag:"callback_".concat(e.reminderId),requireInteraction:!0}):"Notification"in window&&"default"===Notification.permission&&Notification.requestPermission().then(t=>{"granted"===t&&new Notification("\u23f0 Callback Reminder",{body:e.message,icon:"/favicon.ico",tag:"callback_".concat(e.reminderId),requireInteraction:!0})})};return E.on("lead_updated",e),E.on("sms_received",t),E.on("message_received",s),E.on("message_read",n),E.on("callback_reminder",a),()=>{E.off("lead_updated",e),E.off("sms_received",t),E.off("message_received",s),E.off("message_read",n),E.off("callback_reminder",a)}},[E,l]),(0,a.useEffect)(()=>{if(!l)return;let e=(()=>{try{return localStorage.getItem("messagesSince")||""}catch(e){return""}})();const t=async()=>{try{var t,s,n,a;if(!l)return void console.log("\ud83d\udd14 Notifications disabled, skipping poll");const o=Date.now(),i=o-z;if(i<1e4)return void console.log("\ud83d\udd14 Skipping poll - too soon (".concat(i,"ms since last poll)"));V(o);const c=localStorage.getItem("token"),d={};e&&(d.since=e),d.limit=200;const u=await gn.get("/api/messages-list",{headers:c?{Authorization:"Bearer ".concat(c)}:{},timeout:1e4,params:d}),m=u.data.messages||[];console.log("\ud83d\udd14 Total messages fetched:",m.length);const h=(null===(t=u.data)||void 0===t||null===(s=t.meta)||void 0===s?void 0:s.latestCreatedAt)||(null===(n=u.data)||void 0===n||null===(a=n.meta)||void 0===a?void 0:a.since);if(h){e=h;try{localStorage.setItem("messagesSince",h)}catch(r){}}const p=Date.now()-6048e5,x=m.filter(e=>!((()=>{try{return new Date(e.timestamp).getTime()}catch(t){return Date.now()}})()<p)&&("received"===e.direction&&("sms"===e.type||"SMS"===e.type||"email"===e.type||(Math.random()<.1&&console.log("\ud83d\udd14 Filtering out unknown message type:",e.id,e.type),!1))));console.log("\ud83d\udd14 All recent messages:",x.length);const g=x.map(e=>{var t,s;let n="Just now";if(e.timestamp)try{let t=e.timestamp;"string"!==typeof t||!t.includes("T")||t.endsWith("Z")||t.includes("+")||t.includes("-",10)||(t+="Z");const s=new Date(t);if(!isNaN(s.getTime())){const e=new Date-s,t=Math.floor(e/6e4),a=Math.floor(e/36e5),r=Math.floor(e/864e5);n=t<1?"Just now":t<60?"".concat(t," min ago"):a<24?"".concat(a," hour").concat(a>1?"s":""," ago"):r<7?"".concat(r," day").concat(r>1?"s":""," ago"):s.toLocaleDateString()}}catch(ey){console.warn("Invalid timestamp:",e.timestamp)}const a=e.messageId||e.id,r=y.includes(a),l=!!e.isRead||r;return l?null:{id:a,messageId:e.messageId||e.id,leadId:e.leadId,leadName:e.leadName,leadPhone:e.leadPhone,leadEmail:e.leadEmail,message:e.content,content:e.content,timestamp:e.timestamp,formattedTime:n,type:e.type,subject:(null===(t=e.details)||void 0===t?void 0:t.subject)||e.subject,email_body:e.email_body||(null===(s=e.details)||void 0===s?void 0:s.email_body)||null,read:l}}).filter(e=>null!==e);g.length>0?(console.log("\ud83d\udd14 Found new notifications via polling:",g.length),b(e=>{const t=e.filter(e=>!g.some(t=>t.id===e.id)),s=g.map(t=>{const s=e.find(e=>e.id===t.id||e.messageId===t.id),n=y.includes(t.id);let a=t.read;return n&&(a=!0),s&&s.read&&(a=!0),He(He({},t),{},{read:a})}).filter(e=>!t.find(t=>t.id===e.id)),n=[...t,...s];n.sort((e,t)=>new Date(t.timestamp)-new Date(e.timestamp));const a=n.slice(0,10);return console.log("\ud83d\udd14 Final notifications:",a.length,"unread:",a.filter(e=>!e.read).length),a})):console.log("\ud83d\udd14 No new notifications found via polling")}catch(o){console.error("Error polling for notifications:",o)}};t();const s=setInterval(()=>{console.log("\ud83d\udd14 Layout: Polling for notifications..."),t()},6e4);return()=>{clearInterval(s),console.log("\ud83d\udd14 Layout: Cleaned up notification polling")}},[l,y]);const[B,U]=(0,a.useState)(new Set),[z,V]=(0,a.useState)(0),W=e=>{if("callback_reminder"===e.type){b(t=>t.map(t=>t.id===e.id?He(He({},t),{},{read:!0}):t));const t=Array.from(new Set([...y,e.id]));return I(t),void(e.leadId&&(A("/leads/".concat(e.leadId)),g(!1)))}(async e=>{const t=e.id;try{if(console.log("\ud83d\udd14 Marking notification as read:",t),y.includes(t)||B.has(t))return void console.log("\u2139\ufe0f Message already marked as read or being processed, skipping");U(e=>new Set([...e,t])),b(e=>e.map(e=>e.id===t?He(He({},e),{},{processing:!0}):e)),b(e=>e.map(e=>e.id===t?He(He({},e),{},{read:!0}):e));const s=e.messageId||t,n=localStorage.getItem("token");if((await gn.put("/api/messages-list/".concat(s,"/read"),{},{headers:n?{Authorization:"Bearer ".concat(n)}:{}})).data.success){console.log("\u2705 Message marked as read on server");const e=Array.from(new Set([...y,t]));I(e),b(e=>e.map(e=>e.id===t?He(He({},e),{},{processing:!1}):e)),setTimeout(()=>{b(e=>e.filter(e=>e.id!==t))},500)}}catch(n){var s;console.error("\u274c Error marking notification as read:",(null===(s=n.response)||void 0===s?void 0:s.data)||n.message),b(e=>e.map(e=>e.id===t?He(He({},e),{},{read:!1,processing:!1}):e))}finally{U(e=>{const s=new Set(e);return s.delete(t),s})}})(e),g(!1),w(e),k(!0)};(0,a.useEffect)(()=>{x&&O((new Date).toISOString())},[x]),(0,a.useEffect)(()=>{"/messages"===P.pathname&&(()=>{b(e=>e.map(e=>He(He({},e),{},{read:!0})));const e=Array.from(new Set([...y,...f.map(e=>e.id)]));I(e),O((new Date).toISOString())})()},[P.pathname]),(0,a.useEffect)(()=>{const e=setInterval(()=>{const e=new Date(Date.now()-6048e5);b(t=>t.filter(t=>new Date(t.timestamp)>e))},36e5);return()=>clearInterval(e)},[]);const q=f.filter(e=>!e.read).length,H=[{name:"All Leads",status:"all",icon:"\ud83d\udcca",color:"text-gray-600"},{name:"New",status:"New",icon:"\ud83c\udd95",color:"text-blue-600"},{name:"Assigned",status:"Assigned",icon:"\ud83d\udc64",color:"text-orange-600"},{name:"Booked",status:"Booked",icon:"\ud83d\udcc5",color:"text-blue-600"},{name:"Attended",status:"Attended",icon:"\u2705",color:"text-green-600"},{name:"Cancelled",status:"Cancelled",icon:"\u274c",color:"text-red-600"},{name:"No answer",status:"No answer",icon:"\ud83d\udcf5",color:"text-yellow-600"},{name:"No Answer x2",status:"No Answer x2",icon:"\ud83d\udcf5",color:"text-orange-600"},{name:"No Answer x3",status:"No Answer x3",icon:"\ud83d\udcf5",color:"text-red-600"},{name:"No photo",status:"No photo",icon:"\ud83d\udcf7",color:"text-purple-600"},{name:"Left Message",status:"Left Message",icon:"\ud83d\udcac",color:"text-yellow-600"},{name:"Not interested",status:"Not interested",icon:"\ud83d\udeab",color:"text-red-600"},{name:"Call back",status:"Call back",icon:"\ud83d\udcde",color:"text-purple-600"},{name:"Wrong number",status:"Wrong number",icon:"\ud83d\udcde",color:"text-teal-600"},{name:"Sales/converted - purchased",status:"Sales/converted - purchased",icon:"\ud83d\udcb0",color:"text-green-600"},{name:"Not Qualified",status:"Not Qualified",icon:"\u274c",color:"text-red-600"},{name:"Rejected",status:"Rejected",icon:"\ud83d\udeab",color:"text-red-600"}],Y=[{name:"Dashboard",href:"/dashboard",icon:Rr,viewerHidden:!0},{name:"Leads",href:"/leads",icon:fl,hasDropdown:!0,viewerHidden:!0,dropdownItems:[{name:"All Leads",status:"all",icon:"\ud83d\udccb"},{name:"New Leads",status:"New",icon:"\ud83c\udd95"},{name:"Booked",status:"Booked",icon:"\ud83d\udcc5"},{name:"Attended",status:"Attended",icon:"\u2705"},{name:"Cancelled",status:"Cancelled",icon:"\u274c"}]},{name:"Diary",href:"/calendar",icon:hr},{name:"Photos",href:"/photographer",icon:Fr,photographerOnly:!0},{name:"Blocked Slots",href:"/blocked-slots",icon:zr,adminOnly:!0},{name:"SalesApe AI",href:"/salesape",icon:Dl,adminOnly:!0},{name:"Messages",href:"/messages",icon:Gr},{name:"Sales",href:"/sales",icon:dl,adminOnly:!0},{name:"Finance",href:"/finance",icon:Sr,adminOnly:!0},{name:"Reports",href:"/reports",icon:dr},{name:"My Templates",href:"/bookers-templates",icon:Wr,bookerOnly:!0},{name:"Templates",href:"/templates",icon:Wr,adminOnly:!0},{name:"Contract Editor",href:"/contract-editor",icon:Dr,adminOnly:!0},{name:"Email Accounts",href:"/email-accounts",icon:Wr,adminOnly:!0},{name:"Users",href:"/users",icon:gl,adminOnly:!0}].filter(e=>(!e.adminOnly||"admin"===(null===S||void 0===S?void 0:S.role))&&((!e.bookerOnly||"booker"===(null===S||void 0===S?void 0:S.role))&&((!e.photographerOnly||"photographer"===(null===S||void 0===S?void 0:S.role))&&(!e.viewerHidden||"viewer"!==(null===S||void 0===S?void 0:S.role))))),G=e=>P.pathname===e,Q=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all";i(!1);const t="all"===e?"/leads":"/leads?status=".concat(encodeURIComponent(e));A(t,{state:{statusFilter:e},replace:!1})},J=()=>"/leads"===P.pathname,X=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"sms";i(!1);A("/messages?type=".concat("email"===e?"email":"sms"))},Z=e=>J()&&"all"===e?"bg-blue-50 text-blue-900":"text-gray-600 hover:bg-gray-50 hover:text-gray-900";return(0,fn.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,fn.jsxs)("div",{className:"fixed inset-0 flex z-40 md:hidden ".concat(o?"":"pointer-events-none"),children:[(0,fn.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-75 transition-opacity duration-300 ".concat(o?"opacity-100":"opacity-0"),onClick:()=>i(!1)}),(0,fn.jsxs)("div",{className:"relative flex-1 flex flex-col max-w-xs w-full bg-white transform transition-transform duration-300 ease-in-out ".concat(o?"translate-x-0":"-translate-x-full"),children:[(0,fn.jsx)("div",{className:"absolute top-0 right-0 -mr-12 pt-2",children:(0,fn.jsx)("button",{type:"button",className:"ml-1 flex items-center justify-center h-10 w-10 rounded-full focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white",onClick:()=>i(!1),children:(0,fn.jsx)(jl,{className:"h-6 w-6 text-white"})})}),(0,fn.jsxs)("div",{className:"flex-1 h-0 pt-5 pb-4 overflow-y-auto",children:[(0,fn.jsx)("div",{className:"flex-shrink-0 flex items-center px-4",children:(0,fn.jsx)("img",{src:Ll,alt:"EDGE TALENT",className:"h-10 w-auto object-contain"})}),(0,fn.jsx)("nav",{className:"mt-5 px-2 space-y-1",children:Y.map(e=>(0,fn.jsx)("div",{children:"Leads"===e.name?(0,fn.jsxs)("div",{className:"relative",ref:D,children:[(0,fn.jsxs)("button",{onClick:()=>d(!c),className:"group flex items-center justify-between w-full px-2 py-2 text-base font-medium rounded-md ".concat(G(e.href)?"bg-blue-100 text-blue-900":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)(e.icon,{className:"mr-4 h-6 w-6"}),e.name]}),c?(0,fn.jsx)(vr,{className:"h-4 w-4"}):(0,fn.jsx)(fr,{className:"h-4 w-4"})]}),c&&(0,fn.jsx)("div",{className:"mt-1 ml-6 space-y-1",children:H.map(e=>(0,fn.jsxs)("button",{onClick:()=>Q(e.status),className:"group flex items-center justify-between w-full px-2 py-2 text-sm rounded-md transition-colors ".concat(Z(e.status)),children:[(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("span",{className:"mr-2",children:e.icon}),(0,fn.jsx)("span",{className:e.color,children:e.name})]}),J()&&"all"===e.status&&(0,fn.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full"})]},e.status))})]}):"Messages"===e.name?(0,fn.jsxs)("div",{className:"relative",ref:R,children:[(0,fn.jsxs)("button",{onClick:()=>p(!h),className:"group flex items-center justify-between w-full px-2 py-2 text-base font-medium rounded-md ".concat(G(e.href)?"bg-blue-100 text-blue-900":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)(e.icon,{className:"mr-4 h-6 w-6"}),e.name]}),h?(0,fn.jsx)(vr,{className:"h-4 w-4"}):(0,fn.jsx)(fr,{className:"h-4 w-4"})]}),h&&(0,fn.jsxs)("div",{className:"mt-1 ml-6 space-y-1",children:[(0,fn.jsxs)("button",{onClick:()=>X("sms"),className:"group flex items-center justify-between w-full px-2 py-2 text-sm rounded-md text-gray-600 hover:bg-gray-50 hover:text-gray-900",children:[(0,fn.jsx)("span",{className:"mr-2",children:"\ud83d\udce9"}),(0,fn.jsx)("span",{children:"SMS"})]}),(0,fn.jsxs)("button",{onClick:()=>X("email"),className:"group flex items-center justify-between w-full px-2 py-2 text-sm rounded-md text-gray-600 hover:bg-gray-50 hover:text-gray-900",children:[(0,fn.jsx)("span",{className:"mr-2",children:"\u2709\ufe0f"}),(0,fn.jsx)("span",{children:"Email"})]})]})]}):"Templates"===e.name?(0,fn.jsxs)("div",{className:"relative",ref:L,children:[(0,fn.jsxs)("button",{onClick:()=>m(!u),className:"group flex items-center justify-between w-full px-2 py-2 text-base font-medium rounded-md ".concat(P.pathname.startsWith("/templates")?"bg-blue-100 text-blue-900":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)(Wr,{className:"mr-4 h-6 w-6"}),e.name]}),u?(0,fn.jsx)(vr,{className:"h-4 w-4"}):(0,fn.jsx)(fr,{className:"h-4 w-4"})]}),u&&(0,fn.jsx)("div",{className:"mt-1 ml-6 space-y-1",children:F.map(e=>{var t;return(0,fn.jsx)("button",{onClick:()=>{"Bookers Templates"===e.key?A("/bookers-templates"):(i(!1),A("/templates",{state:{category:e.key,navKey:Date.now()+Math.random()}}))},className:"group flex items-center w-full px-2 py-2 text-sm rounded-md transition-colors ".concat(P.pathname.startsWith("/templates")&&(null===(t=P.state)||void 0===t?void 0:t.category)===e.key?"bg-blue-50 text-blue-900 font-semibold":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:(0,fn.jsx)("span",{className:"mr-2",children:e.name})},e.key)})})]}):(0,fn.jsxs)(_e,{to:e.href,className:"group flex items-center px-2 py-2 text-base font-medium rounded-md ".concat(G(e.href)?"bg-blue-100 text-blue-900":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),onClick:()=>i(!1),children:[(0,fn.jsx)(e.icon,{className:"mr-4 h-6 w-6"}),e.name]})},e.name))})]}),(0,fn.jsx)("div",{className:"flex-shrink-0 flex border-t border-gray-200 p-4",children:(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("div",{className:"flex-shrink-0",children:(0,fn.jsx)("div",{className:"h-8 w-8 rounded-full bg-blue-500 flex items-center justify-center",children:(0,fn.jsx)("span",{className:"text-sm font-medium text-white",children:null===S||void 0===S||null===(t=S.name)||void 0===t?void 0:t.charAt(0).toUpperCase()})})}),(0,fn.jsxs)("div",{className:"ml-3",children:[(0,fn.jsx)("p",{className:"text-sm font-medium text-gray-700",children:null===S||void 0===S?void 0:S.name}),(0,fn.jsx)("p",{className:"text-xs text-gray-500 capitalize",children:null===S||void 0===S?void 0:S.role})]})]})})]})]}),(0,fn.jsx)("div",{className:"hidden md:flex md:w-64 md:flex-col md:fixed md:inset-y-0",children:(0,fn.jsxs)("div",{className:"flex-1 flex flex-col min-h-0 border-r border-gray-200 bg-white",children:[(0,fn.jsxs)("div",{className:"flex-1 flex flex-col pt-5 pb-4 overflow-y-auto",children:[(0,fn.jsx)("div",{className:"flex items-center flex-shrink-0 px-4",children:(0,fn.jsx)("img",{src:Ll,alt:"EDGE TALENT",className:"h-10 w-auto object-contain"})}),(0,fn.jsx)("nav",{className:"mt-5 flex-1 px-2 bg-white space-y-1",children:Y.map(e=>(0,fn.jsx)("div",{children:"Leads"===e.name?(0,fn.jsxs)("div",{className:"relative",ref:D,children:[(0,fn.jsxs)("button",{onClick:()=>d(!c),className:"group flex items-center justify-between w-full px-2 py-2 text-sm font-medium rounded-md ".concat(G(e.href)?"bg-blue-100 text-blue-900":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)(e.icon,{className:"mr-3 h-5 w-5"}),e.name]}),c?(0,fn.jsx)(vr,{className:"h-4 w-4"}):(0,fn.jsx)(fr,{className:"h-4 w-4"})]}),c&&(0,fn.jsx)("div",{className:"mt-1 ml-6 space-y-1",children:H.map(e=>(0,fn.jsxs)("button",{onClick:()=>Q(e.status),className:"group flex items-center justify-between w-full px-2 py-2 text-sm rounded-md transition-colors ".concat(Z(e.status)),children:[(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("span",{className:"mr-2",children:e.icon}),(0,fn.jsx)("span",{className:e.color,children:e.name})]}),J()&&"all"===e.status&&(0,fn.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full"})]},e.status))})]}):"Messages"===e.name?(0,fn.jsxs)("div",{className:"relative",ref:R,children:[(0,fn.jsxs)("button",{onClick:()=>p(!h),className:"group flex items-center justify-between w-full px-2 py-2 text-sm font-medium rounded-md ".concat(G(e.href)?"bg-blue-100 text-blue-900":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)(e.icon,{className:"mr-3 h-5 w-5"}),e.name]}),h?(0,fn.jsx)(vr,{className:"h-4 w-4"}):(0,fn.jsx)(fr,{className:"h-4 w-4"})]}),h&&(0,fn.jsxs)("div",{className:"mt-1 ml-6 space-y-1",children:[(0,fn.jsxs)("button",{onClick:()=>X("sms"),className:"group flex items-center justify-between w-full px-2 py-2 text-sm rounded-md text-gray-600 hover:bg-gray-50 hover:text-gray-900",children:[(0,fn.jsx)("span",{className:"mr-2",children:"\ud83d\udce9"}),(0,fn.jsx)("span",{children:"SMS"})]}),(0,fn.jsxs)("button",{onClick:()=>X("email"),className:"group flex items-center justify-between w-full px-2 py-2 text-sm rounded-md text-gray-600 hover:bg-gray-50 hover:text-gray-900",children:[(0,fn.jsx)("span",{className:"mr-2",children:"\u2709\ufe0f"}),(0,fn.jsx)("span",{children:"Email"})]})]})]}):"Templates"===e.name?(0,fn.jsxs)("div",{className:"relative",ref:L,children:[(0,fn.jsxs)("button",{onClick:()=>m(!u),className:"group flex items-center justify-between w-full px-2 py-2 text-sm font-medium rounded-md ".concat(P.pathname.startsWith("/templates")?"bg-blue-100 text-blue-900":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)(Wr,{className:"mr-3 h-5 w-5"}),e.name]}),u?(0,fn.jsx)(vr,{className:"h-4 w-4"}):(0,fn.jsx)(fr,{className:"h-4 w-4"})]}),u&&(0,fn.jsx)("div",{className:"mt-1 ml-6 space-y-1",children:F.map(e=>{var t;return(0,fn.jsx)("button",{onClick:()=>{"Bookers Templates"===e.key?A("/bookers-templates"):(i(!1),A("/templates",{state:{category:e.key,navKey:Date.now()+Math.random()}}))},className:"group flex items-center w-full px-2 py-2 text-sm rounded-md transition-colors ".concat(P.pathname.startsWith("/templates")&&(null===(t=P.state)||void 0===t?void 0:t.category)===e.key?"bg-blue-50 text-blue-900 font-semibold":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:(0,fn.jsx)("span",{className:"mr-2",children:e.name})},e.key)})})]}):(0,fn.jsxs)(_e,{to:e.href,className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md ".concat(G(e.href)?"bg-blue-100 text-blue-900":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,fn.jsx)(e.icon,{className:"mr-3 h-5 w-5"}),e.name]})},e.name))})]}),(0,fn.jsx)("div",{className:"flex-shrink-0 flex border-t border-gray-200 p-4",children:(0,fn.jsxs)("div",{className:"flex items-center w-full",children:[(0,fn.jsx)("div",{className:"flex-shrink-0",children:(0,fn.jsx)("div",{className:"h-8 w-8 rounded-full bg-blue-500 flex items-center justify-center",children:(0,fn.jsx)("span",{className:"text-sm font-medium text-white",children:null===S||void 0===S||null===(s=S.name)||void 0===s?void 0:s.charAt(0).toUpperCase()})})}),(0,fn.jsxs)("div",{className:"ml-3 flex-1",children:[(0,fn.jsx)("p",{className:"text-sm font-medium text-gray-700",children:null===S||void 0===S?void 0:S.name}),(0,fn.jsx)("p",{className:"text-xs text-gray-500 capitalize",children:null===S||void 0===S?void 0:S.role})]}),(0,fn.jsx)("button",{onClick:C,className:"ml-2 p-1 rounded-md text-gray-400 hover:text-gray-500",title:"Logout",children:(0,fn.jsx)(Vr,{className:"h-5 w-5"})})]})})]})}),(0,fn.jsxs)("div",{className:"md:pl-64 flex flex-col flex-1",children:[(0,fn.jsx)("header",{className:"bg-white shadow-sm border-b border-gray-200 sticky top-0 z-30",children:(0,fn.jsx)("div",{className:"max-w-full mx-auto px-3 sm:px-4 lg:px-8",children:(0,fn.jsxs)("div",{className:"flex justify-between items-center h-14 sm:h-16",children:[(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("div",{className:"flex-shrink-0 md:hidden",children:(0,fn.jsx)("button",{type:"button",className:"p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 touch-target",onClick:()=>i(!0),children:(0,fn.jsx)(Yr,{className:"h-6 w-6"})})}),(0,fn.jsx)("h1",{className:"md:hidden ml-2 text-lg font-bold text-gray-900",children:"CRM"})]}),(0,fn.jsxs)("div",{className:"flex items-center space-x-2 sm:space-x-4",children:[(0,fn.jsx)(Cl,{}),(0,fn.jsxs)("div",{className:"relative",ref:M,children:[(0,fn.jsxs)("button",{onClick:()=>g(!x),className:"p-2 rounded-md text-gray-400 hover:text-gray-500 relative touch-target",children:[(0,fn.jsx)(ur,{className:"h-5 w-5 sm:h-6 sm:w-6"}),q>0&&(0,fn.jsx)("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-medium",children:q>9?"9+":q})]}),x&&(0,fn.jsx)("div",{className:"absolute right-0 mt-2 w-[90vw] sm:w-80 max-w-md bg-white rounded-lg shadow-lg ring-1 ring-black ring-opacity-5 z-50",children:(0,fn.jsxs)("div",{className:"py-2",children:[(0,fn.jsx)("div",{className:"px-4 py-2 border-b border-gray-200",children:(0,fn.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:"Message Notifications"})}),0===f.length?(0,fn.jsxs)("div",{className:"px-4 py-6 text-center text-gray-500",children:[(0,fn.jsx)(Gr,{className:"mx-auto h-6 w-6 mb-2"}),(0,fn.jsx)("p",{className:"text-sm",children:"No new messages"})]}):(0,fn.jsx)("div",{className:"max-h-80 overflow-y-auto",children:f.map(e=>(0,fn.jsx)("div",{onClick:()=>W(e),className:"px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 ".concat(e.read?"":"bg-blue-50"),children:(0,fn.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,fn.jsx)("div",{className:"flex-shrink-0",children:"callback_reminder"===e.type?(0,fn.jsx)(Jr,{className:"h-5 w-5 ".concat(e.read?"text-gray-400":"text-purple-600")}):"email"===e.type?(0,fn.jsx)(Wr,{className:"h-5 w-5 ".concat(e.read?"text-gray-400":"text-blue-600")}):(0,fn.jsx)(Gr,{className:"h-5 w-5 ".concat(e.read?"text-gray-400":"text-blue-600")})}),(0,fn.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between",children:[(0,fn.jsxs)("p",{className:"text-sm font-medium ".concat(e.read?"text-gray-600":"text-gray-900"),children:[e.leadName,"email"===e.type&&e.subject&&(0,fn.jsxs)("span",{className:"text-xs text-gray-500 block",children:["Subject: ",e.subject]}),"callback_reminder"===e.type&&e.callbackTime&&(0,fn.jsxs)("span",{className:"text-xs text-purple-600 block font-semibold",children:["\u23f0 ",e.callbackTime]})]}),(0,fn.jsx)("p",{className:"text-xs text-gray-500",children:e.formattedTime||"Just now"})]}),(0,fn.jsx)("p",{className:"text-sm text-gray-600 truncate",children:e.message}),"callback_reminder"===e.type&&e.callbackNote&&(0,fn.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Note: ",e.callbackNote]}),!e.read&&(0,fn.jsx)("div",{className:"w-2 h-2 rounded-full mt-1 ".concat("callback_reminder"===e.type?"bg-purple-600":"bg-blue-600")})]})]})},e.id))}),f.length>0&&(0,fn.jsx)("div",{className:"px-4 py-2 border-t border-gray-200",children:(0,fn.jsx)("button",{onClick:()=>b([]),className:"text-xs text-gray-500 hover:text-gray-700",children:"Clear all notifications"})})]})})]}),(0,fn.jsxs)("div",{className:"hidden sm:flex sm:items-center",children:[(0,fn.jsxs)("span",{className:"hidden lg:block text-sm text-gray-700 mr-2",children:["Welcome, ",null===S||void 0===S?void 0:S.name]}),(0,fn.jsx)("div",{className:"h-8 w-8 rounded-full bg-blue-500 flex items-center justify-center",children:(0,fn.jsx)("span",{className:"text-sm font-medium text-white",children:null===S||void 0===S||null===(n=S.name)||void 0===n?void 0:n.charAt(0).toUpperCase()})})]})]})]})})}),(0,fn.jsx)("main",{className:"flex-1",children:(0,fn.jsx)("div",{className:"py-3 sm:py-4 md:py-6",children:(0,fn.jsx)("div",{className:"max-w-full mx-auto px-3 sm:px-4 lg:px-8",children:r})})})]}),(0,fn.jsx)(Al,{notification:j,isOpen:N,onClose:()=>{k(!1),w(null)},onReply:()=>{console.log("SMS reply sent successfully")}})]})},Rl=()=>{const[e,t]=(0,a.useState)({email:"",password:""}),[s,n]=(0,a.useState)(!1),[r,l]=(0,a.useState)(!1),[o,i]=(0,a.useState)({name:"",email:"",password:"",role:"sales"}),{login:c,register:d,loading:u,error:m}=wn(),h=s=>{t(He(He({},e),{},{[s.target.name]:s.target.value}))},p=e=>{i(He(He({},o),{},{[e.target.name]:e.target.value}))};return(0,fn.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:(0,fn.jsxs)("div",{className:"max-w-md w-full space-y-8",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:r?"Create your account":"Sign in to your account"}),(0,fn.jsx)("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Modelling Studio CRM System"})]}),m&&(0,fn.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:m}),r?(0,fn.jsxs)("form",{className:"mt-8 space-y-6",onSubmit:async e=>{e.preventDefault();(await d(o)).success&&l(!1)},children:[(0,fn.jsxs)("div",{className:"rounded-md shadow-sm space-y-4",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{htmlFor:"register-name",className:"block text-sm font-medium text-gray-700",children:"Full Name"}),(0,fn.jsx)("input",{id:"register-name",name:"name",type:"text",required:!0,className:"mt-1 appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm",placeholder:"Full name",value:o.name,onChange:p})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{htmlFor:"register-email",className:"block text-sm font-medium text-gray-700",children:"Email address"}),(0,fn.jsx)("input",{id:"register-email",name:"email",type:"email",required:!0,className:"mt-1 appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm",placeholder:"Email address",value:o.email,onChange:p})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{htmlFor:"register-password",className:"block text-sm font-medium text-gray-700",children:"Password"}),(0,fn.jsx)("input",{id:"register-password",name:"password",type:"password",required:!0,className:"mt-1 appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm",placeholder:"Password",value:o.password,onChange:p})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{htmlFor:"register-role",className:"block text-sm font-medium text-gray-700",children:"Role"}),(0,fn.jsxs)("select",{id:"register-role",name:"role",className:"mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",value:o.role,onChange:p,children:[(0,fn.jsx)("option",{value:"sales",children:"Sales"}),(0,fn.jsx)("option",{value:"admin",children:"Admin"})]})]})]}),(0,fn.jsx)("div",{children:(0,fn.jsx)("button",{type:"submit",disabled:u,className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:u?"Creating account...":"Create account"})}),(0,fn.jsx)("div",{className:"text-center",children:(0,fn.jsx)("button",{type:"button",onClick:()=>l(!1),className:"text-blue-600 hover:text-blue-500 text-sm",children:"Already have an account? Sign in"})})]}):(0,fn.jsxs)("form",{className:"mt-8 space-y-6",onSubmit:async t=>{t.preventDefault(),console.log("\ud83d\udd04 Attempting login with:",{email:e.email,password:e.password?"******":"empty"});try{const t=await c(e.email,e.password);console.log("\ud83d\udd04 Login result:",t)}catch(ty){console.error("\u274c Login error:",ty)}},children:[(0,fn.jsxs)("div",{className:"rounded-md shadow-sm space-y-4",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email address"}),(0,fn.jsx)("input",{id:"email",name:"email",type:"email",required:!0,className:"mt-1 appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm",placeholder:"Email address",value:e.email,onChange:h})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password"}),(0,fn.jsxs)("div",{className:"mt-1 relative",children:[(0,fn.jsx)("input",{id:"password",name:"password",type:s?"text":"password",required:!0,className:"appearance-none relative block w-full px-3 py-2 pr-10 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm",placeholder:"Password",value:e.password,onChange:h}),(0,fn.jsx)("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>n(!s),children:s?(0,fn.jsx)(Pr,{className:"h-5 w-5 text-gray-400"}):(0,fn.jsx)(Ar,{className:"h-5 w-5 text-gray-400"})})]})]})]}),(0,fn.jsx)("div",{children:(0,fn.jsx)("button",{type:"submit",disabled:u,className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:u?"Signing in...":"Sign in"})})]})]})})},Fl={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function Il(e){return function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const s=t.width?String(t.width):e.defaultWidth;return e.formats[s]||e.formats[e.defaultWidth]}}const Ol={date:Il({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:Il({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:Il({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},Bl={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function Ul(e){return(t,s)=>{let n;if("formatting"===(null!==s&&void 0!==s&&s.context?String(s.context):"standalone")&&e.formattingValues){const t=e.defaultFormattingWidth||e.defaultWidth,a=null!==s&&void 0!==s&&s.width?String(s.width):t;n=e.formattingValues[a]||e.formattingValues[t]}else{const t=e.defaultWidth,a=null!==s&&void 0!==s&&s.width?String(s.width):e.defaultWidth;n=e.values[a]||e.values[t]}return n[e.argumentCallback?e.argumentCallback(t):t]}}const zl={ordinalNumber:(e,t)=>{const s=Number(e),n=s%100;if(n>20||n<10)switch(n%10){case 1:return s+"st";case 2:return s+"nd";case 3:return s+"rd"}return s+"th"},era:Ul({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:Ul({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:e=>e-1}),month:Ul({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:Ul({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:Ul({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})};function Vl(e){return function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=s.width,a=n&&e.matchPatterns[n]||e.matchPatterns[e.defaultMatchWidth],r=t.match(a);if(!r)return null;const l=r[0],o=n&&e.parsePatterns[n]||e.parsePatterns[e.defaultParseWidth],i=Array.isArray(o)?function(e,t){for(let s=0;s<e.length;s++)if(t(e[s]))return s;return}(o,e=>e.test(l)):function(e,t){for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&t(e[s]))return s;return}(o,e=>e.test(l));let c;c=e.valueCallback?e.valueCallback(i):i,c=s.valueCallback?s.valueCallback(c):c;return{value:c,rest:t.slice(l.length)}}}const Wl={ordinalNumber:(ql={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:e=>parseInt(e,10)},function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=e.match(ql.matchPattern);if(!s)return null;const n=s[0],a=e.match(ql.parsePattern);if(!a)return null;let r=ql.valueCallback?ql.valueCallback(a[0]):a[0];return r=t.valueCallback?t.valueCallback(r):r,{value:r,rest:e.slice(n.length)}}),era:Vl({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:Vl({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:e=>e+1}),month:Vl({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:Vl({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:Vl({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})};var ql;const Hl={code:"en-US",formatDistance:(e,t,s)=>{let n;const a=Fl[e];return n="string"===typeof a?a:1===t?a.one:a.other.replace("{{count}}",t.toString()),null!==s&&void 0!==s&&s.addSuffix?s.comparison&&s.comparison>0?"in "+n:n+" ago":n},formatLong:Ol,formatRelative:(e,t,s,n)=>Bl[e],localize:zl,match:Wl,options:{weekStartsOn:0,firstWeekContainsDate:1}};let Yl={};function Gl(){return Yl}Math.pow(10,8);const $l=6048e5,Ql=Symbol.for("constructDateFrom");function Kl(e,t){return"function"===typeof e?e(t):e&&"object"===typeof e&&Ql in e?e[Ql](t):e instanceof Date?new e.constructor(t):new Date(t)}function Jl(e,t){return Kl(t||e,e)}function Xl(e){const t=Jl(e),s=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return s.setUTCFullYear(t.getFullYear()),+e-+s}function Zl(e,t){const s=Jl(e,null===t||void 0===t?void 0:t.in);return s.setHours(0,0,0,0),s}function eo(e,t,s){const[n,a]=function(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];const a=Kl.bind(null,e||s.find(e=>"object"===typeof e));return s.map(a)}(null===s||void 0===s?void 0:s.in,e,t),r=Zl(n),l=Zl(a),o=+r-Xl(r),i=+l-Xl(l);return Math.round((o-i)/864e5)}function to(e,t){const s=Jl(e,null===t||void 0===t?void 0:t.in);return s.setFullYear(s.getFullYear(),0,1),s.setHours(0,0,0,0),s}function so(e,t){const s=Jl(e,null===t||void 0===t?void 0:t.in);return eo(s,to(s))+1}function no(e,t){var s,n,a,r,l,o;const i=Gl(),c=null!==(s=null!==(n=null!==(a=null!==(r=null===t||void 0===t?void 0:t.weekStartsOn)&&void 0!==r?r:null===t||void 0===t||null===(l=t.locale)||void 0===l||null===(l=l.options)||void 0===l?void 0:l.weekStartsOn)&&void 0!==a?a:i.weekStartsOn)&&void 0!==n?n:null===(o=i.locale)||void 0===o||null===(o=o.options)||void 0===o?void 0:o.weekStartsOn)&&void 0!==s?s:0,d=Jl(e,null===t||void 0===t?void 0:t.in),u=d.getDay(),m=(u<c?7:0)+u-c;return d.setDate(d.getDate()-m),d.setHours(0,0,0,0),d}function ao(e,t){return no(e,He(He({},t),{},{weekStartsOn:1}))}function ro(e,t){const s=Jl(e,null===t||void 0===t?void 0:t.in),n=s.getFullYear(),a=Kl(s,0);a.setFullYear(n+1,0,4),a.setHours(0,0,0,0);const r=ao(a),l=Kl(s,0);l.setFullYear(n,0,4),l.setHours(0,0,0,0);const o=ao(l);return s.getTime()>=r.getTime()?n+1:s.getTime()>=o.getTime()?n:n-1}function lo(e,t){const s=ro(e,t),n=Kl((null===t||void 0===t?void 0:t.in)||e,0);return n.setFullYear(s,0,4),n.setHours(0,0,0,0),ao(n)}function oo(e,t){const s=Jl(e,null===t||void 0===t?void 0:t.in),n=+ao(s)-+lo(s);return Math.round(n/$l)+1}function io(e,t){var s,n,a,r,l,o;const i=Jl(e,null===t||void 0===t?void 0:t.in),c=i.getFullYear(),d=Gl(),u=null!==(s=null!==(n=null!==(a=null!==(r=null===t||void 0===t?void 0:t.firstWeekContainsDate)&&void 0!==r?r:null===t||void 0===t||null===(l=t.locale)||void 0===l||null===(l=l.options)||void 0===l?void 0:l.firstWeekContainsDate)&&void 0!==a?a:d.firstWeekContainsDate)&&void 0!==n?n:null===(o=d.locale)||void 0===o||null===(o=o.options)||void 0===o?void 0:o.firstWeekContainsDate)&&void 0!==s?s:1,m=Kl((null===t||void 0===t?void 0:t.in)||e,0);m.setFullYear(c+1,0,u),m.setHours(0,0,0,0);const h=no(m,t),p=Kl((null===t||void 0===t?void 0:t.in)||e,0);p.setFullYear(c,0,u),p.setHours(0,0,0,0);const x=no(p,t);return+i>=+h?c+1:+i>=+x?c:c-1}function co(e,t){var s,n,a,r,l,o;const i=Gl(),c=null!==(s=null!==(n=null!==(a=null!==(r=null===t||void 0===t?void 0:t.firstWeekContainsDate)&&void 0!==r?r:null===t||void 0===t||null===(l=t.locale)||void 0===l||null===(l=l.options)||void 0===l?void 0:l.firstWeekContainsDate)&&void 0!==a?a:i.firstWeekContainsDate)&&void 0!==n?n:null===(o=i.locale)||void 0===o||null===(o=o.options)||void 0===o?void 0:o.firstWeekContainsDate)&&void 0!==s?s:1,d=io(e,t),u=Kl((null===t||void 0===t?void 0:t.in)||e,0);u.setFullYear(d,0,c),u.setHours(0,0,0,0);return no(u,t)}function uo(e,t){const s=Jl(e,null===t||void 0===t?void 0:t.in),n=+no(s,t)-+co(s,t);return Math.round(n/$l)+1}function mo(e,t){return(e<0?"-":"")+Math.abs(e).toString().padStart(t,"0")}const ho={y(e,t){const s=e.getFullYear(),n=s>0?s:1-s;return mo("yy"===t?n%100:n,t.length)},M(e,t){const s=e.getMonth();return"M"===t?String(s+1):mo(s+1,2)},d:(e,t)=>mo(e.getDate(),t.length),a(e,t){const s=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return s.toUpperCase();case"aaa":return s;case"aaaaa":return s[0];default:return"am"===s?"a.m.":"p.m."}},h:(e,t)=>mo(e.getHours()%12||12,t.length),H:(e,t)=>mo(e.getHours(),t.length),m:(e,t)=>mo(e.getMinutes(),t.length),s:(e,t)=>mo(e.getSeconds(),t.length),S(e,t){const s=t.length,n=e.getMilliseconds();return mo(Math.trunc(n*Math.pow(10,s-3)),t.length)}},po="midnight",xo="noon",go="morning",fo="afternoon",bo="evening",yo="night",vo={G:function(e,t,s){const n=e.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return s.era(n,{width:"abbreviated"});case"GGGGG":return s.era(n,{width:"narrow"});default:return s.era(n,{width:"wide"})}},y:function(e,t,s){if("yo"===t){const t=e.getFullYear(),n=t>0?t:1-t;return s.ordinalNumber(n,{unit:"year"})}return ho.y(e,t)},Y:function(e,t,s,n){const a=io(e,n),r=a>0?a:1-a;if("YY"===t){return mo(r%100,2)}return"Yo"===t?s.ordinalNumber(r,{unit:"year"}):mo(r,t.length)},R:function(e,t){return mo(ro(e),t.length)},u:function(e,t){return mo(e.getFullYear(),t.length)},Q:function(e,t,s){const n=Math.ceil((e.getMonth()+1)/3);switch(t){case"Q":return String(n);case"QQ":return mo(n,2);case"Qo":return s.ordinalNumber(n,{unit:"quarter"});case"QQQ":return s.quarter(n,{width:"abbreviated",context:"formatting"});case"QQQQQ":return s.quarter(n,{width:"narrow",context:"formatting"});default:return s.quarter(n,{width:"wide",context:"formatting"})}},q:function(e,t,s){const n=Math.ceil((e.getMonth()+1)/3);switch(t){case"q":return String(n);case"qq":return mo(n,2);case"qo":return s.ordinalNumber(n,{unit:"quarter"});case"qqq":return s.quarter(n,{width:"abbreviated",context:"standalone"});case"qqqqq":return s.quarter(n,{width:"narrow",context:"standalone"});default:return s.quarter(n,{width:"wide",context:"standalone"})}},M:function(e,t,s){const n=e.getMonth();switch(t){case"M":case"MM":return ho.M(e,t);case"Mo":return s.ordinalNumber(n+1,{unit:"month"});case"MMM":return s.month(n,{width:"abbreviated",context:"formatting"});case"MMMMM":return s.month(n,{width:"narrow",context:"formatting"});default:return s.month(n,{width:"wide",context:"formatting"})}},L:function(e,t,s){const n=e.getMonth();switch(t){case"L":return String(n+1);case"LL":return mo(n+1,2);case"Lo":return s.ordinalNumber(n+1,{unit:"month"});case"LLL":return s.month(n,{width:"abbreviated",context:"standalone"});case"LLLLL":return s.month(n,{width:"narrow",context:"standalone"});default:return s.month(n,{width:"wide",context:"standalone"})}},w:function(e,t,s,n){const a=uo(e,n);return"wo"===t?s.ordinalNumber(a,{unit:"week"}):mo(a,t.length)},I:function(e,t,s){const n=oo(e);return"Io"===t?s.ordinalNumber(n,{unit:"week"}):mo(n,t.length)},d:function(e,t,s){return"do"===t?s.ordinalNumber(e.getDate(),{unit:"date"}):ho.d(e,t)},D:function(e,t,s){const n=so(e);return"Do"===t?s.ordinalNumber(n,{unit:"dayOfYear"}):mo(n,t.length)},E:function(e,t,s){const n=e.getDay();switch(t){case"E":case"EE":case"EEE":return s.day(n,{width:"abbreviated",context:"formatting"});case"EEEEE":return s.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return s.day(n,{width:"short",context:"formatting"});default:return s.day(n,{width:"wide",context:"formatting"})}},e:function(e,t,s,n){const a=e.getDay(),r=(a-n.weekStartsOn+8)%7||7;switch(t){case"e":return String(r);case"ee":return mo(r,2);case"eo":return s.ordinalNumber(r,{unit:"day"});case"eee":return s.day(a,{width:"abbreviated",context:"formatting"});case"eeeee":return s.day(a,{width:"narrow",context:"formatting"});case"eeeeee":return s.day(a,{width:"short",context:"formatting"});default:return s.day(a,{width:"wide",context:"formatting"})}},c:function(e,t,s,n){const a=e.getDay(),r=(a-n.weekStartsOn+8)%7||7;switch(t){case"c":return String(r);case"cc":return mo(r,t.length);case"co":return s.ordinalNumber(r,{unit:"day"});case"ccc":return s.day(a,{width:"abbreviated",context:"standalone"});case"ccccc":return s.day(a,{width:"narrow",context:"standalone"});case"cccccc":return s.day(a,{width:"short",context:"standalone"});default:return s.day(a,{width:"wide",context:"standalone"})}},i:function(e,t,s){const n=e.getDay(),a=0===n?7:n;switch(t){case"i":return String(a);case"ii":return mo(a,t.length);case"io":return s.ordinalNumber(a,{unit:"day"});case"iii":return s.day(n,{width:"abbreviated",context:"formatting"});case"iiiii":return s.day(n,{width:"narrow",context:"formatting"});case"iiiiii":return s.day(n,{width:"short",context:"formatting"});default:return s.day(n,{width:"wide",context:"formatting"})}},a:function(e,t,s){const n=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return s.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"aaa":return s.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return s.dayPeriod(n,{width:"narrow",context:"formatting"});default:return s.dayPeriod(n,{width:"wide",context:"formatting"})}},b:function(e,t,s){const n=e.getHours();let a;switch(a=12===n?xo:0===n?po:n/12>=1?"pm":"am",t){case"b":case"bb":return s.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"bbb":return s.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return s.dayPeriod(a,{width:"narrow",context:"formatting"});default:return s.dayPeriod(a,{width:"wide",context:"formatting"})}},B:function(e,t,s){const n=e.getHours();let a;switch(a=n>=17?bo:n>=12?fo:n>=4?go:yo,t){case"B":case"BB":case"BBB":return s.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"BBBBB":return s.dayPeriod(a,{width:"narrow",context:"formatting"});default:return s.dayPeriod(a,{width:"wide",context:"formatting"})}},h:function(e,t,s){if("ho"===t){let t=e.getHours()%12;return 0===t&&(t=12),s.ordinalNumber(t,{unit:"hour"})}return ho.h(e,t)},H:function(e,t,s){return"Ho"===t?s.ordinalNumber(e.getHours(),{unit:"hour"}):ho.H(e,t)},K:function(e,t,s){const n=e.getHours()%12;return"Ko"===t?s.ordinalNumber(n,{unit:"hour"}):mo(n,t.length)},k:function(e,t,s){let n=e.getHours();return 0===n&&(n=24),"ko"===t?s.ordinalNumber(n,{unit:"hour"}):mo(n,t.length)},m:function(e,t,s){return"mo"===t?s.ordinalNumber(e.getMinutes(),{unit:"minute"}):ho.m(e,t)},s:function(e,t,s){return"so"===t?s.ordinalNumber(e.getSeconds(),{unit:"second"}):ho.s(e,t)},S:function(e,t){return ho.S(e,t)},X:function(e,t,s){const n=e.getTimezoneOffset();if(0===n)return"Z";switch(t){case"X":return wo(n);case"XXXX":case"XX":return No(n);default:return No(n,":")}},x:function(e,t,s){const n=e.getTimezoneOffset();switch(t){case"x":return wo(n);case"xxxx":case"xx":return No(n);default:return No(n,":")}},O:function(e,t,s){const n=e.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+jo(n,":");default:return"GMT"+No(n,":")}},z:function(e,t,s){const n=e.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+jo(n,":");default:return"GMT"+No(n,":")}},t:function(e,t,s){return mo(Math.trunc(+e/1e3),t.length)},T:function(e,t,s){return mo(+e,t.length)}};function jo(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const s=e>0?"-":"+",n=Math.abs(e),a=Math.trunc(n/60),r=n%60;return 0===r?s+String(a):s+String(a)+t+mo(r,2)}function wo(e,t){if(e%60===0){return(e>0?"-":"+")+mo(Math.abs(e)/60,2)}return No(e,t)}function No(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const s=e>0?"-":"+",n=Math.abs(e);return s+mo(Math.trunc(n/60),2)+t+mo(n%60,2)}const ko=(e,t)=>{switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});default:return t.date({width:"full"})}},So=(e,t)=>{switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});default:return t.time({width:"full"})}},Co={p:So,P:(e,t)=>{const s=e.match(/(P+)(p+)?/)||[],n=s[1],a=s[2];if(!a)return ko(e,t);let r;switch(n){case"P":r=t.dateTime({width:"short"});break;case"PP":r=t.dateTime({width:"medium"});break;case"PPP":r=t.dateTime({width:"long"});break;default:r=t.dateTime({width:"full"})}return r.replace("{{date}}",ko(n,t)).replace("{{time}}",So(a,t))}},_o=/^D+$/,Eo=/^Y+$/,To=["D","DD","YY","YYYY"];function Po(e){return e instanceof Date||"object"===typeof e&&"[object Date]"===Object.prototype.toString.call(e)}function Ao(e){return!(!Po(e)&&"number"!==typeof e||isNaN(+Jl(e)))}const Do=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Lo=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Mo=/^'([^]*?)'?$/,Ro=/''/g,Fo=/[a-zA-Z]/;function Io(e,t,s){var n,a,r,l,o,i,c,d,u,m,h,p,x,g;const f=Gl(),b=null!==(n=null!==(a=null===s||void 0===s?void 0:s.locale)&&void 0!==a?a:f.locale)&&void 0!==n?n:Hl,y=null!==(r=null!==(l=null!==(o=null!==(i=null===s||void 0===s?void 0:s.firstWeekContainsDate)&&void 0!==i?i:null===s||void 0===s||null===(c=s.locale)||void 0===c||null===(c=c.options)||void 0===c?void 0:c.firstWeekContainsDate)&&void 0!==o?o:f.firstWeekContainsDate)&&void 0!==l?l:null===(d=f.locale)||void 0===d||null===(d=d.options)||void 0===d?void 0:d.firstWeekContainsDate)&&void 0!==r?r:1,v=null!==(u=null!==(m=null!==(h=null!==(p=null===s||void 0===s?void 0:s.weekStartsOn)&&void 0!==p?p:null===s||void 0===s||null===(x=s.locale)||void 0===x||null===(x=x.options)||void 0===x?void 0:x.weekStartsOn)&&void 0!==h?h:f.weekStartsOn)&&void 0!==m?m:null===(g=f.locale)||void 0===g||null===(g=g.options)||void 0===g?void 0:g.weekStartsOn)&&void 0!==u?u:0,j=Jl(e,null===s||void 0===s?void 0:s.in);if(!Ao(j))throw new RangeError("Invalid time value");let w=t.match(Lo).map(e=>{const t=e[0];if("p"===t||"P"===t){return(0,Co[t])(e,b.formatLong)}return e}).join("").match(Do).map(e=>{if("''"===e)return{isToken:!1,value:"'"};const t=e[0];if("'"===t)return{isToken:!1,value:Oo(e)};if(vo[t])return{isToken:!0,value:e};if(t.match(Fo))throw new RangeError("Format string contains an unescaped latin alphabet character `"+t+"`");return{isToken:!1,value:e}});b.localize.preprocessor&&(w=b.localize.preprocessor(j,w));const N={firstWeekContainsDate:y,weekStartsOn:v,locale:b};return w.map(n=>{if(!n.isToken)return n.value;const a=n.value;(null!==s&&void 0!==s&&s.useAdditionalWeekYearTokens||!function(e){return Eo.test(e)}(a))&&(null!==s&&void 0!==s&&s.useAdditionalDayOfYearTokens||!function(e){return _o.test(e)}(a))||function(e,t,s){const n=function(e,t,s){const n="Y"===e[0]?"years":"days of the month";return"Use `".concat(e.toLowerCase(),"` instead of `").concat(e,"` (in `").concat(t,"`) for formatting ").concat(n," to the input `").concat(s,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md")}(e,t,s);if(console.warn(n),To.includes(e))throw new RangeError(n)}(a,t,String(e));return(0,vo[a[0]])(j,a,b.localize,N)}).join("")}function Oo(e){const t=e.match(Mo);return t?t[1].replace(Ro,"'"):e}function Bo(){return Object.assign({},Gl())}function Uo(e,t,s){var n;const a=Bo(),r=function(e,t,s){return new Intl.DateTimeFormat(s?[s.code,"en-US"]:void 0,{timeZone:t,timeZoneName:e})}(e,s.timeZone,null!==(n=s.locale)&&void 0!==n?n:a.locale);return"formatToParts"in r?function(e,t){const s=e.formatToParts(t);for(let n=s.length-1;n>=0;--n)if("timeZoneName"===s[n].type)return s[n].value;return}(r,t):function(e,t){const s=e.format(t).replace(/\u200E/g,""),n=/ [\w-+ ]+$/.exec(s);return n?n[0].substr(1):""}(r,t)}function zo(e,t){const s=function(e){Wo[e]||(Wo[e]=Ho?new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:e,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}));return Wo[e]}(t);return"formatToParts"in s?function(e,t){try{const s=e.formatToParts(t),n=[];for(let e=0;e<s.length;e++){const t=Vo[s[e].type];void 0!==t&&(n[t]=parseInt(s[e].value,10))}return n}catch(s){if(s instanceof RangeError)return[NaN];throw s}}(s,e):function(e,t){const s=e.format(t),n=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(s);return[parseInt(n[3],10),parseInt(n[1],10),parseInt(n[2],10),parseInt(n[4],10),parseInt(n[5],10),parseInt(n[6],10)]}(s,e)}const Vo={year:0,month:1,day:2,hour:3,minute:4,second:5};const Wo={},qo=new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:"America/New_York",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date("2014-06-25T04:00:00.123Z")),Ho="06/25/2014, 00:00:00"===qo||"\u200e06\u200e/\u200e25\u200e/\u200e2014\u200e \u200e00\u200e:\u200e00\u200e:\u200e00"===qo;function Yo(e,t,s,n,a,r,l){const o=new Date(0);return o.setUTCFullYear(e,t,s),o.setUTCHours(n,a,r,l),o}const Go=36e5,$o={timezone:/([Z+-].*)$/,timezoneZ:/^(Z)$/,timezoneHH:/^([+-]\d{2})$/,timezoneHHMM:/^([+-])(\d{2}):?(\d{2})$/};function Qo(e,t,s){if(!e)return 0;let n,a,r=$o.timezoneZ.exec(e);if(r)return 0;if(r=$o.timezoneHH.exec(e),r)return n=parseInt(r[1],10),Jo(n)?-n*Go:NaN;if(r=$o.timezoneHHMM.exec(e),r){n=parseInt(r[2],10);const e=parseInt(r[3],10);return Jo(n,e)?(a=Math.abs(n)*Go+6e4*e,"+"===r[1]?-a:a):NaN}if(function(e){if(Xo[e])return!0;try{return new Intl.DateTimeFormat(void 0,{timeZone:e}),Xo[e]=!0,!0}catch(t){return!1}}(e)){t=new Date(t||Date.now());const n=s?t:function(e){return Yo(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())}(t),a=Ko(n,e),r=s?a:function(e,t,s){const n=e.getTime();let a=n-t;const r=Ko(new Date(a),s);if(t===r)return t;a-=r-t;const l=Ko(new Date(a),s);if(r===l)return r;return Math.max(r,l)}(t,a,e);return-r}return NaN}function Ko(e,t){const s=zo(e,t),n=Yo(s[0],s[1]-1,s[2],s[3]%24,s[4],s[5],0).getTime();let a=e.getTime();const r=a%1e3;return a-=r>=0?r:1e3+r,n-a}function Jo(e,t){return-23<=e&&e<=23&&(null==t||0<=t&&t<=59)}const Xo={};const Zo={X:function(e,t,s){const n=ei(s.timeZone,e);if(0===n)return"Z";switch(t){case"X":return ni(n);case"XXXX":case"XX":return si(n);default:return si(n,":")}},x:function(e,t,s){const n=ei(s.timeZone,e);switch(t){case"x":return ni(n);case"xxxx":case"xx":return si(n);default:return si(n,":")}},O:function(e,t,s){const n=ei(s.timeZone,e);switch(t){case"O":case"OO":case"OOO":return"GMT"+function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const s=e>0?"-":"+",n=Math.abs(e),a=Math.floor(n/60),r=n%60;if(0===r)return s+String(a);return s+String(a)+t+ti(r,2)}(n,":");default:return"GMT"+si(n,":")}},z:function(e,t,s){switch(t){case"z":case"zz":case"zzz":return Uo("short",e,s);default:return Uo("long",e,s)}}};function ei(e,t){var s;const n=e?Qo(e,t,!0)/6e4:null!==(s=null===t||void 0===t?void 0:t.getTimezoneOffset())&&void 0!==s?s:0;if(Number.isNaN(n))throw new RangeError("Invalid time zone specified: "+e);return n}function ti(e,t){const s=e<0?"-":"";let n=Math.abs(e).toString();for(;n.length<t;)n="0"+n;return s+n}function si(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const s=e>0?"-":"+",n=Math.abs(e);return s+ti(Math.floor(n/60),2)+t+ti(Math.floor(n%60),2)}function ni(e,t){if(e%60===0){return(e>0?"-":"+")+ti(Math.abs(e)/60,2)}return si(e,t)}function ai(e){const t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),+e-+t}const ri=36e5,li=6e4,oi={dateTimePattern:/^([0-9W+-]+)(T| )(.*)/,datePattern:/^([0-9W+-]+)(.*)/,plainTime:/:/,YY:/^(\d{2})$/,YYY:[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],YYYY:/^(\d{4})/,YYYYY:[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],MM:/^-(\d{2})$/,DDD:/^-?(\d{3})$/,MMDD:/^-?(\d{2})-?(\d{2})$/,Www:/^-?W(\d{2})$/,WwwD:/^-?W(\d{2})-?(\d{1})$/,HH:/^(\d{2}([.,]\d*)?)$/,HHMM:/^(\d{2}):?(\d{2}([.,]\d*)?)$/,HHMMSS:/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,timeZone:/(Z|[+-]\d{2}(?::?\d{2})?| UTC| [a-zA-Z]+\/[a-zA-Z_]+(?:\/[a-zA-Z_]+)?)$/};function ii(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");if(null===e)return new Date(NaN);const s=null==t.additionalDigits?2:Number(t.additionalDigits);if(2!==s&&1!==s&&0!==s)throw new RangeError("additionalDigits must be 0, 1 or 2");if(e instanceof Date||"object"===typeof e&&"[object Date]"===Object.prototype.toString.call(e))return new Date(e.getTime());if("number"===typeof e||"[object Number]"===Object.prototype.toString.call(e))return new Date(e);if("[object String]"!==Object.prototype.toString.call(e))return new Date(NaN);const n=function(e){const t={};let s,n=oi.dateTimePattern.exec(e);n?(t.date=n[1],s=n[3]):(n=oi.datePattern.exec(e),n?(t.date=n[1],s=n[2]):(t.date=null,s=e));if(s){const e=oi.timeZone.exec(s);e?(t.time=s.replace(e[1],""),t.timeZone=e[1].trim()):t.time=s}return t}(e),{year:a,restDateString:r}=function(e,t){if(e){const s=oi.YYY[t],n=oi.YYYYY[t];let a=oi.YYYY.exec(e)||n.exec(e);if(a){const t=a[1];return{year:parseInt(t,10),restDateString:e.slice(t.length)}}if(a=oi.YY.exec(e)||s.exec(e),a){const t=a[1];return{year:100*parseInt(t,10),restDateString:e.slice(t.length)}}}return{year:null}}(n.date,s),l=function(e,t){if(null===t)return null;let s,n,a;if(!e||!e.length)return s=new Date(0),s.setUTCFullYear(t),s;let r=oi.MM.exec(e);if(r)return s=new Date(0),n=parseInt(r[1],10)-1,hi(t,n)?(s.setUTCFullYear(t,n),s):new Date(NaN);if(r=oi.DDD.exec(e),r){s=new Date(0);const e=parseInt(r[1],10);return function(e,t){if(t<1)return!1;const s=mi(e);if(s&&t>366)return!1;if(!s&&t>365)return!1;return!0}(t,e)?(s.setUTCFullYear(t,0,e),s):new Date(NaN)}if(r=oi.MMDD.exec(e),r){s=new Date(0),n=parseInt(r[1],10)-1;const e=parseInt(r[2],10);return hi(t,n,e)?(s.setUTCFullYear(t,n,e),s):new Date(NaN)}if(r=oi.Www.exec(e),r)return a=parseInt(r[1],10)-1,pi(a)?ci(t,a):new Date(NaN);if(r=oi.WwwD.exec(e),r){a=parseInt(r[1],10)-1;const e=parseInt(r[2],10)-1;return pi(a,e)?ci(t,a,e):new Date(NaN)}return null}(r,a);if(null===l||isNaN(l.getTime()))return new Date(NaN);if(l){const e=l.getTime();let s,a=0;if(n.time&&(a=function(e){let t,s,n=oi.HH.exec(e);if(n)return t=parseFloat(n[1].replace(",",".")),xi(t)?t%24*ri:NaN;if(n=oi.HHMM.exec(e),n)return t=parseInt(n[1],10),s=parseFloat(n[2].replace(",",".")),xi(t,s)?t%24*ri+s*li:NaN;if(n=oi.HHMMSS.exec(e),n){t=parseInt(n[1],10),s=parseInt(n[2],10);const e=parseFloat(n[3].replace(",","."));return xi(t,s,e)?t%24*ri+s*li+1e3*e:NaN}return null}(n.time),null===a||isNaN(a)))return new Date(NaN);if(n.timeZone||t.timeZone){if(s=Qo(n.timeZone||t.timeZone,new Date(e+a)),isNaN(s))return new Date(NaN)}else s=ai(new Date(e+a)),s=ai(new Date(e+a+s));return new Date(e+a+s)}return new Date(NaN)}function ci(e,t,s){t=t||0,s=s||0;const n=new Date(0);n.setUTCFullYear(e,0,4);const a=7*t+s+1-(n.getUTCDay()||7);return n.setUTCDate(n.getUTCDate()+a),n}const di=[31,28,31,30,31,30,31,31,30,31,30,31],ui=[31,29,31,30,31,30,31,31,30,31,30,31];function mi(e){return e%400===0||e%4===0&&e%100!==0}function hi(e,t,s){if(t<0||t>11)return!1;if(null!=s){if(s<1)return!1;const n=mi(e);if(n&&s>ui[t])return!1;if(!n&&s>di[t])return!1}return!0}function pi(e,t){return!(e<0||e>52)&&(null==t||!(t<0||t>6))}function xi(e,t,s){return!(e<0||e>=25)&&((null==t||!(t<0||t>=60))&&(null==s||!(s<0||s>=60)))}const gi=/([xXOz]+)|''|'(''|[^'])+('|$)/g;function fi(e,t,s){const n=Qo(t,e=ii(e,s),!0),a=new Date(e.getTime()-n),r=new Date(0);return r.setFullYear(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate()),r.setHours(a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds()),r}const bi="Europe/London",yi=()=>fi(new Date,bi),vi=e=>{const t=yi().getHours();let s="";return s=t>=5&&t<12?"Good Morning":t>=12&&t<17?"Good Afternoon":"Good Evening","".concat(s,", ").concat(e)},ji=e=>fi(e,bi),wi=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yyyy-MM-dd HH:mm:ss";return function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const n=(t=String(t)).match(gi);if(n){const a=ii(s.originalDate||e,s);t=n.reduce(function(e,t){if("'"===t[0])return e;const n=e.indexOf(t),r="'"===e[n-1],l=e.replace(t,"'"+Zo[t[0]](a,t,s)+"'");return r?l.substring(0,n-1)+l.substring(n+1):l},t)}return Io(e,t,s)}(ji(e),t,{timeZone:bi})},Ni=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date;return wi(e,"HH:mm:ss")},ki=()=>{const{user:e}=wn(),{isConnected:t,socket:s}=Ga(),[n,r]=(0,a.useState)([]),[l,o]=(0,a.useState)([]),[i,c]=(0,a.useState)(!0),[d,u]=(0,a.useState)(yi()),[m,h]=(0,a.useState)(new Date),[p,x]=(0,a.useState)(null),[g,f]=(0,a.useState)("sms"),[b,y]=(0,a.useState)(""),[v,j]=(0,a.useState)(!1),[w,N]=(0,a.useState)(null),k=(0,a.useCallback)(async()=>{try{var e;const t=await gn.get("/api/messages-list",{params:{unread:!0,limit:10}});let s=(null===(e=t.data)||void 0===e?void 0:e.messages)||t.data||[];console.log("\ud83d\udce8 Fetched unread messages:",t.data),Array.isArray(s)||(console.warn("\ud83d\udce8 Messages response is not an array:",s),s=[]),console.log("\ud83d\udce8 Fetched ".concat(s.length," unread messages")),s.length>0&&console.log("\ud83d\udce7 Sample message:",{leadName:s[0].leadName,type:s[0].type,content:s[0].content,timestamp:s[0].timestamp}),r(s.slice(0,10))}catch(ey){console.error("Error fetching unread messages:",ey)}},[]),S=(0,a.useCallback)(async()=>{try{var e,t;const s=await gn.get("/api/leads/callback-reminders/upcoming"),n=(null===(e=s.data)||void 0===e?void 0:e.reminders)||[],a=null===(t=s.data)||void 0===t?void 0:t._debug;console.log("\ud83d\udcde Fetched ".concat(n.length," upcoming callback reminders")),a&&console.log("\ud83d\udcde DEBUG: Requesting user: ".concat(a.requestingUserName," (ID: ").concat(a.requestingUserId,")")),o(n)}catch(ey){console.error("Error fetching upcoming callbacks:",ey),o([])}},[]);(0,a.useEffect)(()=>{k(),S(),c(!1);const e=setInterval(()=>u(yi()),1e3),t=setInterval(()=>{k(),S(),h(new Date)},3e4);return()=>{clearInterval(e),clearInterval(t)}},[k,S]),(0,a.useEffect)(()=>{if(!s)return;const e=()=>{console.log("\ud83d\udce1 Dashboard: Received message update event - refreshing messages"),k(),S()};return s.on("new_message",e),s.on("message_read",e),console.log("\ud83d\udce1 Dashboard: Socket listeners registered for real-time updates"),()=>{s.off("new_message",e),s.off("message_read",e)}},[s,k,S]);return i?(0,fn.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 flex items-center justify-center",children:(0,fn.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):(0,fn.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50",children:[(0,fn.jsxs)("div",{className:"w-full h-full px-2 sm:px-4 lg:px-8 py-3 sm:py-4 lg:py-6",children:[(0,fn.jsx)("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-lg p-3 sm:p-4 lg:p-6 mb-4 sm:mb-6 lg:mb-8 border-l-4 border-red-500",children:(0,fn.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-0",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,fn.jsx)("div",{className:"h-2 w-2 sm:h-3 sm:w-3 bg-red-500 rounded-full animate-pulse"}),(0,fn.jsx)("h1",{className:"text-base sm:text-xl lg:text-2xl font-bold text-gray-900",children:vi((null===e||void 0===e?void 0:e.name)||"User")})]}),(0,fn.jsxs)("div",{className:"flex flex-wrap items-center gap-2 sm:gap-4 lg:gap-6 text-xs sm:text-sm w-full sm:w-auto",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,fn.jsx)(wr,{className:"h-4 w-4 text-gray-500"}),(0,fn.jsxs)("span",{className:"font-mono text-gray-700",children:[Ni(d)," UK"]})]}),(0,fn.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,fn.jsx)(yl,{className:"h-4 w-4 ".concat(t?"text-green-500":"text-red-500")}),(0,fn.jsx)("span",{className:"font-medium ".concat(t?"text-green-700":"text-red-700"),children:t?"LIVE":"OFFLINE"})]}),(0,fn.jsxs)("div",{className:"text-gray-500",children:["Updated ",m.toLocaleTimeString()]})]})]})}),(0,fn.jsxs)("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-lg p-4 sm:p-6 lg:p-8 h-[calc(100vh-200px)] flex flex-col",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[(0,fn.jsx)(Gr,{className:"h-5 w-5 sm:h-6 sm:w-6 lg:h-7 lg:w-7 text-indigo-500"}),(0,fn.jsx)("h2",{className:"text-lg sm:text-xl lg:text-2xl font-bold text-gray-900",children:"TASKS"})]}),((n||[]).length>0||(l||[]).length>0)&&(0,fn.jsx)("div",{className:"bg-red-500 text-white text-sm font-bold px-3 py-1 rounded-full",children:(n||[]).length+(l||[]).length})]}),(0,fn.jsxs)("div",{className:"flex-1 overflow-y-auto space-y-4 pr-2",children:[(l||[]).length>0&&(0,fn.jsx)(fn.Fragment,{children:l.map(e=>(0,fn.jsxs)("div",{className:"bg-white border-l-4 rounded-lg p-5 hover:shadow-md transition-shadow ".concat(e.isToday?"border-red-500 bg-red-50":e.isTomorrow?"border-orange-400 bg-orange-50":"border-purple-400"),children:[(0,fn.jsx)("div",{className:"flex items-start justify-between mb-3",children:(0,fn.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,fn.jsx)("div",{className:"rounded-full p-2 ".concat(e.isToday?"bg-red-100":e.isTomorrow?"bg-orange-100":"bg-purple-100"),children:(0,fn.jsx)(Jr,{className:"h-5 w-5 ".concat(e.isToday?"text-red-600":e.isTomorrow?"text-orange-600":"text-purple-600")})}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("p",{className:"font-bold text-gray-900",children:e.leadName||"Unknown Lead"}),(0,fn.jsx)("span",{className:"inline-block px-2 py-1 text-xs font-medium rounded ".concat(e.isToday?"text-red-700 bg-red-100":e.isTomorrow?"text-orange-700 bg-orange-100":"text-purple-700 bg-purple-100"),children:e.isToday?"\ud83d\udcde CALL TODAY":e.isTomorrow?"\ud83d\udcc5 TOMORROW":"\ud83d\udcc6 SCHEDULED"})]})]})}),(0,fn.jsxs)("p",{className:"font-semibold mb-2 ".concat(e.isToday?"text-red-700":e.isTomorrow?"text-orange-700":"text-gray-900"),children:["\u23f0 ",e.callbackTimeDisplay]}),e.callbackNote&&(0,fn.jsxs)("p",{className:"text-gray-700 text-sm mb-3",children:["\ud83d\udcdd ",e.callbackNote]}),(0,fn.jsxs)("div",{className:"flex items-center justify-between",children:[(0,fn.jsx)("p",{className:"text-xs text-gray-500",children:e.leadPhone&&"\ud83d\udcf1 ".concat(e.leadPhone)}),(0,fn.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,fn.jsx)("button",{onClick:()=>(async(e,t)=>{if(window.confirm("Delete callback reminder for ".concat(t,"?"))){N(e);try{const t=await gn.delete("/api/callback-reminders/".concat(e));t.data.success?(o(t=>t.filter(t=>t.id!==e)),console.log("\ud83d\uddd1\ufe0f Callback reminder ".concat(e," deleted"))):alert(t.data.message||"Failed to delete callback reminder")}catch(ey){var s,n;console.error("Error deleting callback:",ey);const t=(null===(s=ey.response)||void 0===s||null===(n=s.data)||void 0===n?void 0:n.message)||ey.message||"Failed to delete callback reminder";alert(t)}finally{N(null)}}})(e.id,e.leadName),disabled:w===e.id,className:"text-gray-400 hover:text-red-600 transition-colors disabled:opacity-50",title:"Delete callback",children:w===e.id?(0,fn.jsx)("span",{className:"text-xs",children:"..."}):(0,fn.jsx)(cl,{className:"h-4 w-4"})}),(0,fn.jsxs)("button",{onClick:()=>window.location.href="/leads/".concat(e.leadId),className:"font-medium text-sm flex items-center space-x-1 ".concat(e.isToday?"text-red-600 hover:text-red-700":e.isTomorrow?"text-orange-600 hover:text-orange-700":"text-purple-600 hover:text-purple-700"),children:[(0,fn.jsx)("span",{children:"View Lead"}),(0,fn.jsx)(ir,{className:"h-3 w-3"})]})]})]})]},e.id))}),0===(n||[]).length&&0===(l||[]).length?(0,fn.jsxs)("div",{className:"text-center py-16 text-gray-500",children:[(0,fn.jsx)(Gr,{className:"h-16 w-16 mx-auto mb-4 text-gray-300"}),(0,fn.jsx)("p",{className:"text-lg",children:"No unread messages or upcoming tasks"})]}):(n||[]).map(e=>{var t;return(0,fn.jsxs)("div",{className:"bg-white border-l-4 border-orange-400 rounded-lg p-5 hover:shadow-md transition-shadow",children:[(0,fn.jsx)("div",{className:"flex items-start justify-between mb-3",children:(0,fn.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,fn.jsx)("div",{className:"bg-green-100 rounded-full p-2",children:"email"===e.type?(0,fn.jsx)(Wr,{className:"h-5 w-5 text-green-600"}):(0,fn.jsx)(Gr,{className:"h-5 w-5 text-green-600"})}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("p",{className:"font-bold text-gray-900",children:e.leadName||e.from||e.sender_name||"Unknown"}),(0,fn.jsx)("span",{className:"inline-block px-2 py-1 text-xs font-medium text-green-700 bg-green-100 rounded",children:"email"===e.type?"EMAIL":"SMS"})]})]})}),e.subject&&(0,fn.jsx)("p",{className:"font-semibold text-gray-900 mb-2",children:e.subject}),(0,fn.jsx)("p",{className:"text-gray-700 text-sm mb-3 line-clamp-2",children:e.content||(null===(t=e.details)||void 0===t?void 0:t.body)||e.body||e.preview||"No content"}),(0,fn.jsxs)("div",{className:"flex items-center justify-between",children:[(0,fn.jsx)("p",{className:"text-xs text-gray-500",children:e.timestamp||e.created_at?new Date(e.timestamp||e.created_at).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):""}),(0,fn.jsxs)("button",{onClick:()=>(e=>{x(e),f("email"===e.type?"email":"sms"),y("")})(e),className:"text-blue-600 hover:text-blue-700 font-medium text-sm flex items-center space-x-1",children:[(0,fn.jsx)("span",{children:"Click to reply"}),(0,fn.jsx)("div",{className:"w-2 h-2 bg-red-500 rounded-full"})]})]})]},e.id)})]})]})]}),p&&(0,fn.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-2 sm:p-4",children:(0,fn.jsx)("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-2xl max-w-full sm:max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:(0,fn.jsxs)("div",{className:"p-4 sm:p-6",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,fn.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"Reply to Message"}),(0,fn.jsx)("button",{onClick:()=>x(null),className:"text-gray-400 hover:text-gray-600",children:(0,fn.jsx)(jl,{className:"h-6 w-6"})})]}),(0,fn.jsxs)("div",{className:"mb-6",children:[(0,fn.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 mb-4",children:[(0,fn.jsxs)("div",{className:"mb-3 pb-3 border-b border-gray-200",children:[(0,fn.jsxs)("p",{className:"text-sm font-semibold text-gray-900 mb-1",children:[(0,fn.jsx)("span",{className:"text-gray-500",children:"From:"})," ",p.leadName||p.from||"Unknown"]}),p.leadEmail&&(0,fn.jsxs)("p",{className:"text-sm text-gray-600 mb-1",children:[(0,fn.jsx)("span",{className:"text-gray-500",children:"Email:"})," ",p.leadEmail]}),p.leadPhone&&(0,fn.jsxs)("p",{className:"text-sm text-gray-600 mb-1",children:[(0,fn.jsx)("span",{className:"text-gray-500",children:"Phone:"})," ",p.leadPhone]}),p.subject&&(0,fn.jsxs)("p",{className:"text-sm text-gray-700 mt-2",children:[(0,fn.jsx)("span",{className:"text-gray-500",children:"Subject:"})," ",p.subject]})]}),(0,fn.jsx)("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:"email"===p.type&&(p.email_body||p.html_content)?(0,fn.jsx)(Pl,{htmlContent:p.email_body||p.html_content,textContent:p.content,attachments:p.attachments||[],embeddedImages:p.embedded_images||[]}):(0,fn.jsx)("p",{className:"text-sm text-gray-600 whitespace-pre-wrap",children:p.content||p.preview})})]}),(0,fn.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:(0,fn.jsxs)("p",{className:"text-sm font-medium text-blue-900",children:[(0,fn.jsx)("span",{className:"text-blue-600",children:"Reply will be sent to:"})," ","email"===g?p.leadEmail?(0,fn.jsxs)(fn.Fragment,{children:[p.leadName," (",p.leadEmail,")"]}):(0,fn.jsx)("span",{className:"text-red-600",children:"\u26a0\ufe0f No email address available"}):p.leadPhone?(0,fn.jsxs)(fn.Fragment,{children:[p.leadName," (",p.leadPhone,")"]}):(0,fn.jsx)("span",{className:"text-red-600",children:"\u26a0\ufe0f No phone number available"})]})}),(0,fn.jsxs)("div",{className:"flex items-center space-x-4 mb-4",children:[(0,fn.jsx)("button",{onClick:()=>f("sms"),className:"px-4 py-2 rounded-lg font-medium transition-colors ".concat("sms"===g?"bg-green-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:"SMS"}),(0,fn.jsx)("button",{onClick:()=>f("email"),className:"px-4 py-2 rounded-lg font-medium transition-colors ".concat("email"===g?"bg-blue-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:"Email"})]}),(0,fn.jsx)("textarea",{value:b,onChange:e=>y(e.target.value),placeholder:"Type your ".concat(g," message here..."),className:"w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:"6"})]}),(0,fn.jsxs)("div",{className:"flex items-center justify-end space-x-3",children:[(0,fn.jsx)("button",{onClick:()=>x(null),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors",children:"Cancel"}),(0,fn.jsxs)("button",{onClick:async()=>{if(b.trim()&&p)if("email"!==g||p.leadEmail)if("sms"!==g||p.leadPhone){j(!0);try{console.log("\ud83d\udce4 Sending reply:",{messageId:p.id,replyType:g,to:"email"===g?p.leadEmail:p.leadPhone,leadName:p.leadName});const e=await gn.post("/api/messages-list/reply",{messageId:p.id,replyType:g,reply:b});console.log("\u2705 Reply sent successfully:",e.data),await gn.put("/api/messages-list/".concat(p.id,"/read")),x(null),y(""),k();const t="email"===g?p.leadEmail||p.from:p.leadPhone;alert("".concat(g.toUpperCase()," sent successfully to ").concat(p.leadName," (").concat(t,")"))}catch(ey){var e,t;console.error("Error sending reply:",ey);const n=(null===(e=ey.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||ey.message||"Failed to send reply";alert("Failed to send reply: ".concat(n))}finally{j(!1)}}else alert("Cannot send SMS: Lead has no phone number");else alert("Cannot send email: Lead has no email address")},disabled:!b.trim()||v||"email"===g&&!(null!==p&&void 0!==p&&p.leadEmail)||"sms"===g&&!(null!==p&&void 0!==p&&p.leadPhone),className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors flex items-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,fn.jsx)(nl,{className:"h-4 w-4"}),(0,fn.jsx)("span",{children:v?"Sending...":"Send"})]})]})]})})})]})};function Si(e,t){if(null==e)return{};var s,n,a=function(e,t){if(null==e)return{};var s={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;s[n]=e[n]}return s}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)s=r[n],-1===t.indexOf(s)&&{}.propertyIsEnumerable.call(e,s)&&(a[s]=e[s])}return a}let Ci=null;"undefined"!==typeof window&&(null!==Ci?Promise.resolve(Ci):new Promise(e=>{const t=new Image;t.onload=()=>{Ci=1===t.width,e(Ci)},t.onerror=()=>{Ci=!1,e(!1)},t.src="data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoBAAEAAwA0JaQAA3AA/vuUAAA="}));const _i=new class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6e5;this.maxSize=e,this.ttl=t,this.cache=new Map}get(e){if(!this.cache.has(e))return null;const t=this.cache.get(e);return Date.now()-t.timestamp>this.ttl?(this.cache.delete(e),null):(this.cache.delete(e),this.cache.set(e,t),t.value)}set(e,t){if(this.cache.has(e)&&this.cache.delete(e),this.cache.size>=this.maxSize){const e=this.cache.keys().next().value;this.cache.delete(e)}this.cache.set(e,{value:t,timestamp:Date.now()})}has(e){if(!this.cache.has(e))return!1;const t=this.cache.get(e);return!(Date.now()-t.timestamp>this.ttl)||(this.cache.delete(e),!1)}delete(e){this.cache.delete(e)}clear(){this.cache.clear()}get size(){return this.cache.size}cleanup(){const e=Date.now();for(const[t,s]of this.cache)e-s.timestamp>this.ttl&&this.cache.delete(t)}}(500,6e5);"undefined"!==typeof window&&setInterval(()=>_i.cleanup(),12e4);const Ei=new class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2e3;this.maxSize=e,this.loadedUrls=new Set,this.urlOrder=[]}add(e){if(e&&!this.loadedUrls.has(e)){if(this.loadedUrls.size>=this.maxSize){const e=this.urlOrder.shift();this.loadedUrls.delete(e)}this.loadedUrls.add(e),this.urlOrder.push(e)}}has(e){return e&&this.loadedUrls.has(e)}clear(){this.loadedUrls.clear(),this.urlOrder=[]}get size(){return this.loadedUrls.size}}(2e3),Ti=e=>{Ei.add(e)},Pi=e=>Ei.has(e),Ai=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"optimized";if(!e||""===e.trim()||"null"===e)return null;if(e.startsWith("http://")||e.startsWith("https://"))return e;const s=e.split("/").pop();if(!s)return e;switch(t){case"thumbnail":return"/uploads/thumbnails/thumb_".concat(s);case"optimized":return"/uploads/images/opt_".concat(s);default:return e}},Di=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return new Promise((s,n)=>{if(!e)return void n(new Error("No image source provided"));const a=_i.get(e);if(a)return void s(a);let r=0;const l=()=>{const a=new Image;a.onload=()=>{_i.set(e,a),s(a)},a.onerror=()=>{r++,r<=t?setTimeout(l,100*Math.pow(2,r)):n(new Error("Failed to load image after ".concat(r," attempts: ").concat(e)))},a.src=e,a.decode&&a.decode().catch(()=>{})};l()})};const Li=new class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4;this.concurrency=e,this.queue=[],this.activeCount=0}add(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return new Promise((s,n)=>{this.queue.push({url:e,priority:t,resolve:s,reject:n}),this.queue.sort((e,t)=>e.priority-t.priority),this.process()})}process(){for(;this.activeCount<this.concurrency&&this.queue.length>0;){const{url:e,resolve:t,reject:s}=this.queue.shift();this.activeCount++;const n=new Image;n.onload=()=>{this.activeCount--,Ti(e),t(n),this.process()},n.onerror=e=>{this.activeCount--,s(e),this.process()},n.src=e}}clear(){this.queue=[]}}(6),Mi=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return e?Pi(e)?Promise.resolve():Li.add(e,t):Promise.reject(new Error("No URL provided"))},Ri=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"medium";if(!e||!e.includes("cloudinary.com"))return e;const s={thumb:{w:100,h:100,q:40},small:{w:200,h:200,q:50},medium:{w:400,h:400,q:70},large:{w:800,h:800,q:80},full:{w:1600,h:1600,q:85},blur:{w:20,h:20,q:20}},n=s[t]||s.medium;if(e.includes("/upload/")){const t="w_".concat(n.w,",h_").concat(n.h,",c_limit,q_").concat(n.q,",f_auto");return e.replace("/upload/","/upload/".concat(t,"/"))}return e},Fi=e=>e&&e.includes("cloudinary.com")&&e.includes("/upload/")?e.replace("/upload/","/upload/w_20,h_20,q_10,e_blur:500,f_auto/"):null,Ii=["src","alt","className","onClick","onLoad","onError","style","title","fallbackClassName","lazy","preload","enableFadeIn","showBlurPlaceholder","videoAutoPlay","videoMuted","videoLoop"],Oi=(0,a.memo)(e=>{let{className:t,style:s,isVisible:n}=e;return n?(0,fn.jsx)("div",{className:"absolute inset-0 ".concat(t||""),style:He(He({},s),{},{background:"linear-gradient(135deg, #e0e0e0 0%, #f5f5f5 50%, #e8e8e8 100%)",animation:"shimmer 1.5s ease-in-out infinite",borderRadius:"inherit",zIndex:1})}):null});Oi.displayName="BlurPlaceholder";const Bi=(0,a.memo)(e=>{let{src:t,alt:s,className:n="",onClick:r,onLoad:l,onError:o,style:i,title:c,fallbackClassName:d,lazy:u,preload:m,enableFadeIn:h=!0,showBlurPlaceholder:p=!0,videoAutoPlay:x=!0,videoMuted:g=!0,videoLoop:f=!0}=e,b=Si(e,Ii);const y=t&&"null"!==t&&""!==t,v=y?t:"/images/fallback.jpeg",j=(e=>{if(!e)return"image";const t=e.toLowerCase();return t.includes(".mp4")||t.includes(".webm")||t.includes(".mov")||t.includes(".avi")||t.includes(".mkv")||t.includes("video/")?"video":t.includes(".gif")?"gif":t.includes(".heic")||t.includes(".heif")?"heic":t.includes(".pdf")?"pdf":t.includes(".svg")?"svg":(t.match(/^https?:\/\/[^\/]+\/?$/)||t.startsWith("http")&&t.match(/\.(jpg|jpeg|png|gif|webp|bmp|ico|tiff?|avif)/),"image")})(v),w=!y||Pi(v),[N,k]=(0,a.useState)(v),[S,C]=(0,a.useState)(w||!y),[_,E]=(0,a.useState)(!y),[T,P]=(0,a.useState)(0),A=(0,a.useRef)(0),D=(0,a.useRef)(null),L="/images/fallback.jpeg";(0,a.useEffect)(()=>{if(!y)return k(L),C(!0),void E(!0);A.current+=1,k(t);const e=Pi(t);C(e),E(!1),P(0)},[t,y]);const M=(0,a.useCallback)(e=>{const s=A.current;requestAnimationFrame(()=>{A.current===s&&(C(!0),E(!1),y&&Ti(t),l&&l(e))})},[l,t,y]),R=(0,a.useCallback)(e=>{const s=A.current;if(A.current===s){if(N===L)return C(!0),E(!0),void(o&&o(e));if(T<2){const e=500*Math.pow(2,T);setTimeout(()=>{if(A.current===s){P(e=>e+1);const e=null!==N&&void 0!==N&&N.includes("?")?"&":"?";k("".concat(t).concat(e,"_retry=").concat(Date.now()))}},e)}else k(L),C(!0),E(!0),o&&o(e)}},[N,T,t,o]),F=(0,a.useMemo)(()=>{if(!h)return n;const e=S||_?"opacity-100":"opacity-0";return n?"".concat(n," ").concat(e):e},[n,h,S,_]),I=(0,a.useMemo)(()=>h?He(He({},i),{},{transition:"opacity 0.2s ease-out, filter 0.3s ease-out",filter:S||_?"blur(0px)":"blur(8px)"}):i,[i,h,S,_]),O=(0,a.useMemo)(()=>He({position:"relative",display:"inline-block",overflow:"hidden"},i),[i]);if("heic"===(B=j)||"pdf"===B)return(0,fn.jsx)("div",{className:"".concat(n," flex items-center justify-center bg-gray-100 border border-gray-200"),style:i,onClick:r,title:"heic"===j?"HEIC format not supported in browsers":"PDF file",children:(0,fn.jsx)("div",{className:"text-center p-1",children:(0,fn.jsx)("span",{className:"text-gray-400 text-xs",children:"heic"===j?"\ud83d\udcf7":"\ud83d\udcc4"})})});var B;const U=(null===n||void 0===n?void 0:n.includes("w-6"))||(null===n||void 0===n?void 0:n.includes("w-8"))||(null===n||void 0===n?void 0:n.includes("w-10"));return"video"===j?(0,fn.jsx)("video",He({ref:D,src:N,className:F,style:I,autoPlay:x,muted:g,loop:f,playsInline:!0,preload:!1===u?"auto":"metadata",onClick:r,onLoadedData:M,onError:R,title:c||s},b)):U||!p?(0,fn.jsx)("img",He({ref:D,src:N,alt:s||"Image",className:F,style:I,loading:!1===u?"eager":"lazy",decoding:"async",onLoad:M,onError:R,onClick:r,title:c},b)):(0,fn.jsxs)("div",{style:O,className:n,onClick:r,children:[(0,fn.jsx)(Oi,{isVisible:!S&&!_&&p}),(0,fn.jsx)("img",He({ref:D,src:N,alt:s||"Image",className:"w-full h-full object-cover",style:{transition:"opacity 0.3s ease-out",opacity:S?1:0,position:"relative",zIndex:2},loading:!1===u?"eager":"lazy",decoding:"async",onLoad:M,onError:R,title:c},b))]})});Bi.displayName="LazyImage";const Ui=Bi,zi=e=>{let{src:t,alt:s="Photo",onClose:n}=e;return(0,a.useEffect)(()=>{if(!t)return;const e=e=>{"Escape"===e.key&&(null===n||void 0===n||n())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[t,n]),t?(0,fn.jsx)("div",{className:"fixed inset-0 z-[1000] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4",onClick:n,children:(0,fn.jsxs)("div",{className:"relative max-w-5xl max-h-[90vh]",onClick:e=>e.stopPropagation(),children:[(0,fn.jsx)("button",{onClick:n,className:"absolute top-2 right-2 z-10 bg-red-600 hover:bg-red-700 text-white rounded-full p-2 transition-all duration-200 shadow-lg","aria-label":"Close image",title:"Close (ESC)",children:(0,fn.jsx)(jl,{className:"h-6 w-6"})}),(0,fn.jsx)("img",{src:t,alt:s,className:"block max-w-full max-h-[90vh] rounded-lg shadow-2xl"})]})}):null},Vi=e=>{let{isOpen:t,onClose:s,selectedLeads:n,onSuccess:r}=e;const[l,o]=(0,a.useState)([]),[i,c]=(0,a.useState)(""),[d,u]=(0,a.useState)(!1),[m,h]=(0,a.useState)(!1),[p,x]=(0,a.useState)(null),[g,f]=(0,a.useState)(!1),[b,y]=(0,a.useState)("both"),[v,j]=(0,a.useState)(""),[w,N]=(0,a.useState)(""),[k,S]=(0,a.useState)("");(0,a.useEffect)(()=>{t&&(C(),c(""),j(""),N(""),S(""),y("both"))},[t]),(0,a.useEffect)(()=>{i&&_()},[i]);const C=async()=>{try{u(!0);const e=(await gn.get("/api/templates?bookersOnly=true",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}})).data.filter(e=>!e.type.startsWith("sale_"));o(e)}catch(e){console.error("Error fetching templates:",e),alert("Error fetching templates. Please try again.")}finally{u(!1)}},_=async()=>{if(i)try{const e=l.find(e=>e.id===i||e._id===i);e&&(j(e.subject||""),N(e.email_body||e.emailBody||""),S(e.sms_body||e.smsBody||""),e.send_email&&e.send_sms?y("both"):e.send_email?y("email"):e.send_sms&&y("sms"))}catch(e){console.error("Error loading template:",e)}};return t?(0,fn.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,fn.jsxs)("div",{className:"relative top-10 mx-auto p-6 border w-full max-w-4xl shadow-lg rounded-md bg-white",children:[(0,fn.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,fn.jsxs)("h3",{className:"text-xl font-semibold text-gray-900",children:["Send Communication to ",n.length," Lead",1!==n.length?"s":""]}),(0,fn.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600",children:(0,fn.jsx)(jl,{className:"h-6 w-6"})})]}),(0,fn.jsxs)("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[(0,fn.jsxs)("div",{className:"flex items-center mb-3",children:[(0,fn.jsx)(fl,{className:"h-5 w-5 text-gray-600 mr-2"}),(0,fn.jsx)("span",{className:"font-medium text-gray-700",children:"Selected Leads:"}),(0,fn.jsxs)("span",{className:"ml-2 text-sm text-gray-500",children:["(",n.length," selected)"]})]}),(0,fn.jsx)("div",{className:"text-sm text-gray-600",children:"Individual messages will be sent to each selected lead using the template below."})]}),(0,fn.jsxs)("div",{className:"mb-6",children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Template"}),(0,fn.jsxs)("select",{value:i,onChange:e=>c(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:d,children:[(0,fn.jsx)("option",{value:"",children:"Choose a template..."}),l.map(e=>(0,fn.jsxs)("option",{value:e.id||e._id,children:[e.name," ",e.type?"(".concat(e.type.replace(/_/g," "),")"):""]},e.id||e._id))]}),d&&(0,fn.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Loading templates..."})]}),(0,fn.jsxs)("div",{className:"mb-6",children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Communication Type"}),(0,fn.jsxs)("div",{className:"flex space-x-4",children:[(0,fn.jsxs)("label",{className:"flex items-center",children:[(0,fn.jsx)("input",{type:"radio",value:"email",checked:"email"===b,onChange:e=>y(e.target.value),className:"mr-2"}),(0,fn.jsx)(Wr,{className:"h-4 w-4 text-blue-600 mr-1"}),"Email Only"]}),(0,fn.jsxs)("label",{className:"flex items-center",children:[(0,fn.jsx)("input",{type:"radio",value:"sms",checked:"sms"===b,onChange:e=>y(e.target.value),className:"mr-2"}),(0,fn.jsx)(Jr,{className:"h-4 w-4 text-green-600 mr-1"}),"SMS Only"]}),(0,fn.jsxs)("label",{className:"flex items-center",children:[(0,fn.jsx)("input",{type:"radio",value:"both",checked:"both"===b,onChange:e=>y(e.target.value),className:"mr-2"}),(0,fn.jsx)(Wr,{className:"h-4 w-4 text-blue-600 mr-1"}),(0,fn.jsx)(Jr,{className:"h-4 w-4 text-green-600 mr-1"}),"Both"]})]})]}),("email"===b||"both"===b)&&(0,fn.jsxs)("div",{className:"mb-6",children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Subject"}),(0,fn.jsx)("input",{type:"text",value:v,onChange:e=>j(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter email subject (optional - will use template default if empty)..."})]}),("email"===b||"both"===b)&&(0,fn.jsxs)("div",{className:"mb-6",children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Body"}),(0,fn.jsx)("textarea",{value:w,onChange:e=>N(e.target.value),rows:8,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter email body (optional - will use template default if empty)..."}),(0,fn.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Leave empty to use template default. Use variables like ","{leadName}",", ","{leadEmail}",", ","{leadPhone}",", etc."]})]}),("sms"===b||"both"===b)&&(0,fn.jsxs)("div",{className:"mb-6",children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"SMS Body"}),(0,fn.jsx)("textarea",{value:k,onChange:e=>S(e.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter SMS message (optional - will use template default if empty)..."}),(0,fn.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Character count: ",k.length," (SMS limit: 160 characters per message)"]})]}),(0,fn.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,fn.jsx)("button",{onClick:s,className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400",disabled:m,children:"Cancel"}),(0,fn.jsx)("button",{onClick:async()=>{if(i&&0!==n.length)try{h(!0);const e={templateId:i,leadIds:n,communicationType:b,customSubject:v||void 0,customEmailBody:w||void 0,customSmsBody:k||void 0},t=await gn.post("/api/leads/bulk-communication",e,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});let a="".concat(t.data.message,"\n\n").concat(t.data.note||"");t.data.errorCount>0&&(a+="\n\nErrors:",t.data.results.forEach(e=>{if(e.error||!e.emailSent&&!e.smsSent){const t=e.error||(e.emailError?"Email: ".concat(e.emailError):"")+(e.smsError?"SMS: ".concat(e.smsError):"");a+="\n\u2022 ".concat(e.customerName||e.leadId,": ").concat(t||"Failed to send")}})),alert(a),r(),s()}catch(a){var e,t;console.error("Error sending communications:",a),alert((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Error sending communications. Please try again.")}finally{h(!1)}},disabled:!i||m||0===n.length,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 flex items-center",children:m?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Sending..."]}):(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(nl,{className:"h-4 w-4 mr-2"}),"Send to ",n.length," Lead",1!==n.length?"s":""]})})]})]})}):null},Wi=()=>{var e,t,s,n,r;const l=K(),o=$(),{user:i}=wn(),{subscribeToLeadUpdates:c,isConnected:d}=Ga(),[u,m]=(0,a.useState)([]),[h,p]=(0,a.useState)(!0),[x,g]=(0,a.useState)({total:0,new:0,booked:0,attended:0,cancelled:0,assigned:0,rejected:0,noAnswerCall:0,noAnswerX2:0,noAnswerX3:0,leftMessage:0,notInterestedCall:0,callBack:0,wrongNumber:0,salesConverted:0,notQualified:0,attendedFilter:0,cancelledFilter:0,noShow:0}),[f,b]=(0,a.useState)(""),y=(0,a.useRef)(null),[v,j]=(0,a.useState)(()=>{var e;return new URLSearchParams(o.search).get("status")||(null===(e=o.state)||void 0===e?void 0:e.statusFilter)||"all"}),[w,N]=(0,a.useState)("all"),[k,S]=(0,a.useState)(""),[C,_]=(0,a.useState)(""),[E,T]=(0,a.useState)(()=>{const e=new URLSearchParams(o.search);return parseInt(e.get("page"))||1}),P=(0,a.useRef)(""),[A,D]=(0,a.useState)(1),[L,M]=(0,a.useState)(0),[R]=(0,a.useState)(30),[F,I]=(0,a.useState)([]),[O,B]=(0,a.useState)("table"),[U,z]=(0,a.useState)(null),[V,W]=(0,a.useState)(!1),[q,H]=(0,a.useState)(!1),[Y,G]=(0,a.useState)(!1),[Q,J]=(0,a.useState)(!1),[X,Z]=(0,a.useState)(!1),[ee,te]=(0,a.useState)(!1),[se,ne]=(0,a.useState)(!1),[ae,re]=(0,a.useState)(null),[le,oe]=(0,a.useState)([]),[ie,ce]=(0,a.useState)(""),[de,ue]=(0,a.useState)(null),[me,he]=(0,a.useState)(0),[pe,xe]=(0,a.useState)(""),[ge,fe]=(0,a.useState)(!1),[be,ye]=(0,a.useState)(null),[ve,je]=(0,a.useState)({}),[we,Ne]=(0,a.useState)(!1),[ke,Se]=(0,a.useState)(null),[Ce,_e]=(0,a.useState)(!1),[Ee,Te]=(0,a.useState)({name:"",phone:"",email:"",postcode:"",status:"New",image_url:""});(0,a.useEffect)(()=>{const e=setTimeout(()=>{T(1)},500);return()=>clearTimeout(e)},[f,w,k,C]);const Pe=(0,a.useCallback)(()=>{const e=(new Date).toLocaleDateString("en-CA",{timeZone:"Europe/London"}),t=new Date(e+"T00:00:00.000Z");switch(w){case"today":return{start:e+"T00:00:00.000Z",end:new Date(t.getTime()+864e5).toISOString().split("T")[0]+"T00:00:00.000Z"};case"yesterday":return{start:new Date(t.getTime()-864e5).toISOString().split("T")[0]+"T00:00:00.000Z",end:e+"T00:00:00.000Z"};case"week":return{start:new Date(t.getTime()-6048e5).toISOString().split("T")[0]+"T00:00:00.000Z",end:(new Date).toISOString()};case"month":return{start:new Date(t.getTime()-2592e6).toISOString().split("T")[0]+"T00:00:00.000Z",end:(new Date).toISOString()};case"custom":return k&&C?{start:k+"T00:00:00.000Z",end:C+"T23:59:59.999Z"}:null;default:return null}},[w,k,C]),Ae=(0,a.useCallback)(async()=>{p(!0);try{const e=localStorage.getItem("token"),t={page:E,limit:R,status:"all"===v?void 0:v,search:f},s=Pe();if(s){["No answer","No Answer x2","No Answer x3"].includes(v)?(t.status_changed_at_start=s.start,t.status_changed_at_end=s.end):(t.assigned_at_start=s.start,t.assigned_at_end=s.end)}else 0;0;const n=await gn.get("/api/leads",{params:t,headers:e?{Authorization:"Bearer ".concat(e)}:{},timeout:1e4});m(n.data.leads||[]),D(n.data.totalPages||1),M(n.data.total||0)}catch(e){console.error("Error fetching leads:",e),m([])}finally{p(!1)}},[E,R,v,f,Pe,w]),De=(0,a.useCallback)(async()=>{try{const e={},t=Pe();if(t){["No answer","No Answer x2","No Answer x3"].includes(v)?(e.status_changed_at_start=t.start,e.status_changed_at_end=t.end):(e.assigned_at_start=t.start,e.assigned_at_end=t.end)}const s=await gn.get("/api/stats/leads",{params:e});0,g(s.data)}catch(e){console.error("Error fetching lead counts:",e)}},[Pe,v]);(0,a.useEffect)(()=>{Ae()},[Ae]),(0,a.useEffect)(()=>{const e=()=>{const e=window.pageYOffset;let t=null;const s=n=>{t||(t=n);const a=n-t,r=Math.min(a/600,1),l=(o=r,1-Math.pow(1-o,3));var o;window.scrollTo(0,e*(1-l)),r<1&&requestAnimationFrame(s)};requestAnimationFrame(s)};window.pageYOffset>0&&e()},[E]),(0,a.useEffect)(()=>{i&&(De(),Ve())},[i,w,k,C,De]);const Le=(0,a.useMemo)(()=>[{value:"all",label:"All",count:x.total},{value:"Assigned",label:"\ud83d\udc64 Assigned",count:x.assigned},{value:"Booked",label:"\ud83d\udcc5 Booked",count:x.booked},{value:"Attended",label:"\u2705 Attended",count:x.attendedFilter},{value:"Cancelled",label:"\u274c Cancelled",count:x.cancelledFilter},{value:"No Show",label:"\ud83d\udeab No Show",count:x.noShow},{value:"No answer",label:"\ud83d\udcf5 No answer",count:x.noAnswerCall},{value:"No Answer x2",label:"\ud83d\udcf5 No Answer x2",count:x.noAnswerX2},{value:"No Answer x3",label:"\ud83d\udcf5 No Answer x3",count:x.noAnswerX3},{value:"Left Message",label:"\ud83d\udcac Left Message",count:x.leftMessage},{value:"Not interested",label:"\ud83d\udeab Not interested",count:x.notInterestedCall},{value:"Call back",label:"\ud83d\udcde Call back",count:x.callBack},{value:"Wrong number",label:"\ud83d\udcde Wrong number",count:x.wrongNumber},{value:"Sales",label:"\ud83d\udcb0 Sales",count:x.salesConverted},{value:"Not Qualified",label:"\u274c Not Qualified",count:x.notQualified},..."admin"===(null===i||void 0===i?void 0:i.role)?[{value:"Rejected",label:"Rejected",count:x.rejected}]:[]],[x.total,x.assigned,x.booked,x.attendedFilter,x.cancelledFilter,x.noShow,x.noAnswerCall,x.noAnswerX2,x.noAnswerX3,x.leftMessage,x.notInterestedCall,x.callBack,x.wrongNumber,x.salesConverted,x.notQualified,x.rejected,null===i||void 0===i?void 0:i.role]);(0,a.useEffect)(()=>{var e;if(void 0!==(null===(e=o.state)||void 0===e?void 0:e.statusFilter)){const e=o.state.statusFilter,t=new URLSearchParams(o.search).get("status");if(console.log("\ud83d\udd35 [NavState] Effect triggered:",{navStatus:e,urlStatus:t,currentStatusFilter:v}),t)console.log("\ud83d\udd35 [NavState] Skipping - URL already has status");else{console.log("\ud83d\udd35 [NavState] Applying navigation state:",e),j(e),T(1);const t=new URLSearchParams;"all"!==e&&t.set("status",e);const s=t.toString()?"".concat(o.pathname,"?").concat(t.toString()):o.pathname;P.current=s,l(s,{replace:!0})}}},[null===(e=o.state)||void 0===e?void 0:e.statusFilter,l,o.pathname]),(0,a.useEffect)(()=>{const e=new URLSearchParams(o.search),t=e.get("status")||"all",s=parseInt(e.get("page"))||1,n=v!==t,a=E!==s;if(console.log("\ud83d\udfe2 [URLSync-Write] Effect triggered:",{statusFilter:v,urlStatus:t,currentPage:E,urlPage:s,statusDiffers:n,pageDiffers:a,locationSearch:o.search}),n||a){const e=new URLSearchParams;v&&"all"!==v&&e.set("status",v),E>1&&e.set("page",E.toString());const t=e.toString()?"".concat(o.pathname,"?").concat(e.toString()):o.pathname;console.log("\ud83d\udfe2 [URLSync-Write] Updating URL:",{from:o.pathname+o.search,to:t}),P.current=t,l(t,{replace:!0})}else console.log("\ud83d\udfe2 [URLSync-Write] No change needed - state matches URL")},[v,E,l,o.pathname]),(0,a.useEffect)(()=>{const e=o.pathname+o.search;if(e===P.current)return console.log("\ud83d\udfe1 [URLSync-Read] Skipping - we just wrote this URL:",e),void(P.current="");const t=new URLSearchParams(o.search),s=t.get("status")||"all",n=parseInt(t.get("page"))||1;console.log("\ud83d\udfe1 [URLSync-Read] Effect triggered:",{currentUrl:e,urlStatus:s,urlPage:n,currentStatusFilter:v,currentPage:E,lastWritten:P.current}),s!==v&&(console.log("\ud83d\udfe1 [URLSync-Read] Updating statusFilter:",{from:v,to:s}),j(s)),n!==E&&(console.log("\ud83d\udfe1 [URLSync-Read] Updating currentPage:",{from:E,to:n}),T(n))},[o.search]);const Me=(0,a.useCallback)(e=>{const t=Pe();l("/leads/".concat(e.id),{state:He({statusFilter:v,searchTerm:f,dateFilter:w,customDateStart:k,customDateEnd:C},t?{assigned_at_start:t.start,assigned_at_end:t.end}:{})})},[l,v,f,w,k,C,Pe]),Re=(0,a.useCallback)((e,t)=>{t.stopPropagation(),localStorage.setItem("bookingLead",JSON.stringify({id:e.id,name:e.name,phone:e.phone,email:e.email,postcode:e.postcode,notes:e.notes,image_url:e.image_url,currentStatus:e.status,isReschedule:"Booked"===e.status||"Rescheduled"===e.status})),l("/calendar")},[l]),Fe=(0,a.useCallback)(e=>({New:"bg-amber-100 text-amber-800 border-amber-300",Booked:"bg-blue-100 text-blue-800 border-blue-300",Attended:"bg-green-100 text-green-800 border-green-300",Cancelled:"bg-red-100 text-red-800 border-red-300","No Show":"bg-gray-100 text-gray-800 border-gray-300",Assigned:"bg-purple-100 text-purple-800 border-purple-300",Rejected:"bg-gray-100 text-gray-800 border-gray-300","No answer":"bg-yellow-100 text-yellow-800 border-yellow-300","No Answer x2":"bg-orange-100 text-orange-800 border-orange-300","No Answer x3":"bg-red-100 text-red-800 border-red-300","Left Message":"bg-yellow-100 text-yellow-800 border-yellow-300","Not interested":"bg-red-100 text-red-800 border-red-300","Call back":"bg-purple-100 text-purple-800 border-purple-300","Wrong number":"bg-teal-100 text-teal-800 border-teal-300","No photo":"bg-purple-100 text-purple-800 border-purple-300",Sales:"bg-green-600 text-white border-green-400",Sale:"bg-green-600 text-white border-green-400","Not Qualified":"bg-red-100 text-red-800 border-red-300"}[e]||"bg-gray-100 text-gray-800 border-gray-300"),[]),Ie=(0,a.useCallback)(e=>{var t;if(e.has_sale>0&&("Attended"===e.status||"Booked"===e.status))return"Attended";return["Booked","Attended","Cancelled","Rejected","Sale","No Show"].includes(e.status)?e.status:e.call_status?e.call_status:null!==(t=e.custom_fields)&&void 0!==t&&t.call_status?e.custom_fields.call_status:e.status},[]),Oe=(0,a.useCallback)(e=>{if(!e)return"Not set";const t=new Date(e);return isNaN(t.getTime())?"Invalid date":t.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})},[]),Be=(0,a.useCallback)(e=>{I(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},[]),Ue=(0,a.useCallback)(()=>{I(e=>e.length===u.length&&u.length>0?[]:u.map(e=>e.id))},[u]),ze=[{key:"name",label:"Name"},{key:"phone",label:"Phone"},{key:"email",label:"Email"},{key:"postcode",label:"Postcode"},{key:"age",label:"Age"},{key:"lead_source",label:"Lead Source"},{key:"entry_date",label:"Entry Date"},{key:"parent_phone",label:"Parent Phone"},{key:"gender",label:"Gender"},{key:"image_url",label:"Image URL"}],Ve=(0,a.useCallback)(async()=>{try{const e=localStorage.getItem("token"),t=await gn.get("/api/users/bookers",{headers:e?{Authorization:"Bearer ".concat(e)}:{}});oe(t.data||[])}catch(e){console.error("Error fetching sales team:",e),oe([])}},[]);return h&&0===u.length&&!f?(0,fn.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-100 flex items-center justify-center",children:(0,fn.jsxs)("div",{className:"text-center space-y-4",children:[(0,fn.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600 mx-auto"}),(0,fn.jsx)("div",{className:"text-xl text-gray-700 font-medium",children:"Loading leads..."})]})}):(0,fn.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-100",children:[(0,fn.jsxs)("div",{className:"backdrop-blur-xl bg-white/80 border-b border-gray-200/50 shadow-sm",children:[(0,fn.jsxs)("div",{className:"px-6 py-4",children:[(0,fn.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-4",children:[(0,fn.jsxs)("div",{className:"flex flex-wrap items-center gap-2 sm:gap-4",children:[(0,fn.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 bg-clip-text text-transparent",children:"Leads Management"}),(0,fn.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,fn.jsx)(yl,{className:"h-4 w-4 ".concat(d?"text-green-500":"text-red-500")}),(0,fn.jsx)("span",{className:"text-xs px-2 py-1 rounded-full font-medium ".concat(d?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:d?"Live":"Offline"})]}),(0,fn.jsxs)("div",{className:"px-3 py-1 bg-gradient-to-r from-blue-100 to-indigo-100 text-blue-700 rounded-full text-sm font-semibold",children:[x.total," Total Leads"]})]}),(0,fn.jsxs)("div",{className:"flex flex-wrap items-center gap-2 sm:gap-3",children:[F.length>0&&(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-2 px-4 py-2 bg-purple-100 text-purple-700 rounded-xl",children:[(0,fn.jsx)(gr,{className:"h-4 w-4"}),(0,fn.jsxs)("span",{className:"font-medium",children:[F.length," Selected"]})]}),(0,fn.jsxs)("button",{onClick:()=>Z(!0),className:"group px-4 py-2 bg-gradient-to-r from-blue-600 to-cyan-600 text-white rounded-xl hover:from-blue-700 hover:to-cyan-700 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center space-x-2 hover:scale-105 transform",style:{pointerEvents:"auto",cursor:"pointer"},children:[(0,fn.jsx)(Gr,{className:"h-5 w-5 group-hover:animate-pulse"}),(0,fn.jsx)("span",{className:"font-medium",children:"Send Email/SMS"})]}),"admin"===(null===i||void 0===i?void 0:i.role)&&(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsxs)("button",{onClick:()=>G(!0),className:"group px-4 py-2 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-xl hover:from-purple-700 hover:to-indigo-700 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center space-x-2 hover:scale-105 transform",style:{pointerEvents:"auto",cursor:"pointer"},children:[(0,fn.jsx)(xl,{className:"h-5 w-5 group-hover:animate-pulse"}),(0,fn.jsx)("span",{className:"font-medium",children:"Assign Leads"})]}),(0,fn.jsxs)("button",{onClick:()=>te(!0),className:"group px-4 py-2 bg-gradient-to-r from-orange-500 to-amber-500 text-white rounded-xl hover:from-orange-600 hover:to-amber-600 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center space-x-2 hover:scale-105 transform",style:{pointerEvents:"auto",cursor:"pointer"},children:[(0,fn.jsx)("span",{className:"text-lg group-hover:animate-bounce",children:"\ud83e\udd8d"}),(0,fn.jsx)("span",{className:"font-medium",children:"Sales Ape"})]}),(0,fn.jsxs)("button",{onClick:()=>J(!0),className:"group px-4 py-2 bg-gradient-to-r from-red-600 to-pink-600 text-white rounded-xl hover:from-red-700 hover:to-pink-700 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center space-x-2 hover:scale-105 transform",style:{pointerEvents:"auto",cursor:"pointer"},children:[(0,fn.jsx)(cl,{className:"h-5 w-5 group-hover:animate-bounce"}),(0,fn.jsx)("span",{className:"font-medium",children:"Delete Leads"})]})]}),"admin"!==(null===i||void 0===i?void 0:i.role)&&(0,fn.jsxs)("button",{onClick:()=>I([]),className:"group px-4 py-2 bg-gray-200 text-gray-700 rounded-xl hover:bg-gray-300 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center space-x-2 hover:scale-105 transform",style:{pointerEvents:"auto",cursor:"pointer"},children:[(0,fn.jsx)(jl,{className:"h-5 w-5"}),(0,fn.jsx)("span",{className:"font-medium",children:"Clear Selection"})]})]}),(0,fn.jsxs)("button",{onClick:()=>H(!0),className:"group px-4 py-2 bg-gradient-to-r from-emerald-600 to-green-600 text-white rounded-xl hover:from-emerald-700 hover:to-green-700 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center space-x-2 hover:scale-105 transform",style:{pointerEvents:"auto",cursor:"pointer"},children:[(0,fn.jsx)(pl,{className:"h-5 w-5 group-hover:animate-bounce"}),(0,fn.jsx)("span",{className:"font-medium",children:"Upload CSV"})]}),(0,fn.jsxs)("button",{onClick:()=>W(!0),className:"group px-4 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl hover:from-blue-700 hover:to-indigo-700 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center space-x-2 hover:scale-105 transform",style:{pointerEvents:"auto",cursor:"pointer"},children:[(0,fn.jsx)(Zr,{className:"h-5 w-5 group-hover:rotate-90 transition-transform"}),(0,fn.jsx)("span",{className:"font-medium",children:"Add Lead"})]})]})]}),(0,fn.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,fn.jsxs)("div",{className:"flex-1 relative",children:[(0,fn.jsx)(sl,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),(0,fn.jsx)("input",{ref:y,type:"text",placeholder:"Search by name, phone, email, or postcode...",className:"w-full pl-12 pr-4 py-3 bg-white border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 text-gray-800 placeholder-gray-400",value:f,onChange:e=>b(e.target.value)})]}),(0,fn.jsxs)("div",{className:"flex items-center bg-white border border-gray-200 rounded-xl p-1",children:[(0,fn.jsx)("button",{onClick:()=>B("grid"),className:"px-3 py-2 rounded-lg transition-all duration-200 ".concat("grid"===O?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"),children:"Grid"}),(0,fn.jsx)("button",{onClick:()=>B("table"),className:"px-3 py-2 rounded-lg transition-all duration-200 ".concat("table"===O?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"),children:"Table"})]})]})]}),(0,fn.jsx)("div",{className:"px-3 sm:px-6 pb-3",children:(0,fn.jsx)("div",{className:"flex flex-wrap gap-1.5 sm:gap-2",children:Le.map(e=>(0,fn.jsxs)("button",{onClick:()=>{console.log("\ud83d\udd34 [FilterClick] Button clicked:",{filter:e.value,currentFilter:v,currentPage:E}),j(e.value),T(1),console.log("\ud83d\udd34 [FilterClick] State updated:",{newFilter:e.value,newPage:1})},className:"inline-flex items-center px-2.5 sm:px-3 py-1.5 rounded-lg text-xs sm:text-sm font-medium transition-all duration-200 ".concat((()=>{if(v!==e.value)return"bg-white text-gray-600 border border-gray-200 hover:bg-gray-50 hover:border-gray-300";switch(e.value){case"all":default:return"bg-gray-700 text-white shadow-md ring-2 ring-gray-400/30";case"Assigned":case"No Answer x2":return"bg-orange-500 text-white shadow-md ring-2 ring-orange-400/30";case"Booked":return"bg-blue-500 text-white shadow-md ring-2 ring-blue-400/30";case"Attended":return"bg-green-500 text-white shadow-md ring-2 ring-green-400/30";case"Cancelled":case"No Answer x3":case"Not interested":case"Not Qualified":return"bg-red-500 text-white shadow-md ring-2 ring-red-400/30";case"No Show":return"bg-gray-500 text-white shadow-md ring-2 ring-gray-400/30";case"No answer":return"bg-yellow-500 text-white shadow-md ring-2 ring-yellow-400/30";case"Left Message":return"bg-amber-500 text-white shadow-md ring-2 ring-amber-400/30";case"Call back":return"bg-purple-500 text-white shadow-md ring-2 ring-purple-400/30";case"Wrong Number":return"bg-teal-500 text-white shadow-md ring-2 ring-teal-400/30";case"Sales":return"bg-green-600 text-white shadow-md ring-2 ring-green-400/30"}})()),children:[(0,fn.jsx)("span",{className:"truncate max-w-[80px] sm:max-w-none",children:e.label}),(0,fn.jsx)("span",{className:"ml-1.5 px-1.5 py-0.5 rounded-md text-[10px] sm:text-xs font-semibold ".concat(v===e.value?"bg-white/25 text-white":"bg-gray-100 text-gray-500"),children:e.count})]},e.value))})})]}),(0,fn.jsx)("div",{className:"px-3 sm:px-6 pt-4 pb-4 bg-gradient-to-br from-gray-50 via-white to-gray-100",children:(0,fn.jsxs)("div",{className:"flex flex-col gap-3 bg-gradient-to-r from-blue-50 to-purple-50 p-3 sm:p-4 rounded-xl border-[0.3px] border-blue-200",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-2 flex-shrink-0",children:[(0,fn.jsx)(hr,{className:"h-4 w-4 sm:h-5 sm:w-5 text-blue-600"}),(0,fn.jsx)("span",{className:"text-xs sm:text-sm font-semibold text-gray-800 whitespace-nowrap",children:"Date Assigned:"})]}),(0,fn.jsxs)("div",{className:"flex flex-wrap items-center gap-2 w-full",children:[(0,fn.jsx)("button",{onClick:()=>N("today"),className:"px-2 sm:px-3 py-1.5 text-xs sm:text-sm rounded-lg font-medium transition-all duration-200 whitespace-nowrap ".concat("today"===w?"bg-blue-600 text-white shadow-md transform scale-105":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"),children:"Today"}),(0,fn.jsx)("button",{onClick:()=>N("yesterday"),className:"px-2 sm:px-3 py-1.5 text-xs sm:text-sm rounded-lg font-medium transition-all duration-200 whitespace-nowrap ".concat("yesterday"===w?"bg-blue-600 text-white shadow-md transform scale-105":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"),children:"Yesterday"}),(0,fn.jsx)("button",{onClick:()=>N("week"),className:"px-2 sm:px-3 py-1.5 text-xs sm:text-sm rounded-lg font-medium transition-all duration-200 whitespace-nowrap ".concat("week"===w?"bg-blue-600 text-white shadow-md transform scale-105":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"),children:"Last 7 Days"}),(0,fn.jsx)("button",{onClick:()=>N("month"),className:"px-2 sm:px-3 py-1.5 text-xs sm:text-sm rounded-lg font-medium transition-all duration-200 whitespace-nowrap ".concat("month"===w?"bg-blue-600 text-white shadow-md transform scale-105":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"),children:"Last 30 Days"}),(0,fn.jsx)("button",{onClick:()=>N("all"),className:"px-2 sm:px-3 py-1.5 text-xs sm:text-sm rounded-lg font-medium transition-all duration-200 whitespace-nowrap ".concat("all"===w?"bg-blue-600 text-white shadow-md transform scale-105":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"),children:"All Time"}),(0,fn.jsxs)("div",{className:"flex items-center gap-2 ml-auto",children:[(0,fn.jsx)("input",{type:"date",value:k,onChange:e=>{S(e.target.value),e.target.value&&N("custom")},className:"border border-gray-300 rounded-lg px-2 sm:px-3 py-1.5 text-xs sm:text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 min-w-[140px]",placeholder:"Start date"}),(0,fn.jsx)("span",{className:"text-gray-500 text-xs sm:text-sm whitespace-nowrap",children:"to"}),(0,fn.jsx)("input",{type:"date",value:C,onChange:e=>{_(e.target.value),e.target.value&&N("custom")},className:"border border-gray-300 rounded-lg px-2 sm:px-3 py-1.5 text-xs sm:text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 min-w-[140px]",placeholder:"End date"}),(k||C)&&(0,fn.jsx)("button",{onClick:()=>{S(""),_(""),N("all")},className:"text-gray-500 hover:text-red-600 p-1.5 hover:bg-red-50 rounded-lg transition-colors flex-shrink-0",title:"Clear custom dates",children:(0,fn.jsx)(jl,{className:"h-4 w-4"})})]})]})]})}),(0,fn.jsxs)("div",{className:"px-6 py-6",children:["grid"===O?(0,fn.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-6",children:u.map(e=>(0,fn.jsxs)("div",{onClick:()=>Me(e),className:"group bg-white rounded-2xl shadow-md hover:shadow-2xl transition-all duration-300 cursor-pointer overflow-hidden border border-gray-100 hover:border-blue-200 transform hover:scale-105",children:[(0,fn.jsxs)("div",{className:"relative h-32 bg-gradient-to-br from-blue-400 via-indigo-500 to-purple-600",children:[e.image_url&&(0,fn.jsx)(Ui,{src:Ai(e.image_url,"thumbnail"),alt:e.name,className:"absolute inset-0 w-full h-full object-cover opacity-30 cursor-zoom-in",onClick:t=>{t.stopPropagation();const s=Ai(e.image_url,"original")||e.image_url;s&&z(s)}}),(0,fn.jsxs)("div",{className:"absolute top-3 right-3 flex items-center gap-1",children:[(0,fn.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-semibold border ".concat(Fe(Ie(e))),children:Ie(e)}),e.has_sale>0&&(0,fn.jsx)("span",{className:"text-sm bg-white rounded-full px-1",title:"Sale Completed",children:"\ud83d\udcb0"}),"Arrived"===e.booking_status&&(0,fn.jsx)("span",{className:"text-sm bg-white rounded-full px-1",title:"Arrived",children:"\ud83d\udeb6"}),"No Show"===e.booking_status&&(0,fn.jsx)("span",{className:"text-sm bg-white rounded-full px-1",title:"No Show",children:"\ud83d\udeab"}),"Cancel"===e.booking_status&&(0,fn.jsx)("span",{className:"text-sm bg-white rounded-full px-1",title:"Cancelled",children:"\u274c"}),"Complete"===e.booking_status&&(0,fn.jsx)("span",{className:"text-sm bg-white rounded-full px-1",title:"Complete",children:"\u2705"}),"No Sale"===e.booking_status&&(0,fn.jsx)("span",{className:"text-sm bg-white rounded-full px-1",title:"No Sale",children:"\ud83d\udccb"}),"Reschedule"===e.booking_status&&(0,fn.jsx)("span",{className:"text-sm bg-white rounded-full px-1",title:"Rescheduled",children:"\ud83d\udd04"}),"Review"===e.booking_status&&(0,fn.jsx)("span",{className:"text-sm bg-white rounded-full px-1",title:"Under Review",children:"\ud83d\udc41\ufe0f"})]}),(0,fn.jsxs)("div",{className:"absolute bottom-3 left-3 flex items-center space-x-3",children:[e.image_url?(0,fn.jsx)(Ui,{src:Ai(e.image_url,"thumbnail"),alt:e.name,className:"w-12 h-12 rounded-full border-2 border-white shadow-lg object-cover cursor-zoom-in",onClick:t=>{t.stopPropagation();const s=Ai(e.image_url,"original")||e.image_url;s&&z(s)}}):(0,fn.jsx)("div",{className:"w-12 h-12 rounded-full bg-white/90 flex items-center justify-center border-2 border-white shadow-lg",children:(0,fn.jsx)(gl,{className:"h-6 w-6 text-gray-600"})}),(0,fn.jsx)("div",{className:"text-white",children:(0,fn.jsxs)("h3",{className:"font-bold text-lg",children:[e.name,e.lead_source&&(0,fn.jsx)("span",{className:"ml-2 inline-flex px-1.5 py-0.5 text-[9px] bg-teal-100 text-teal-700 rounded-full font-medium align-middle",children:e.lead_source})]})})]})]}),(0,fn.jsxs)("div",{className:"p-4 space-y-3",children:[(0,fn.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,fn.jsxs)("div",{className:"flex items-center text-gray-600",children:[(0,fn.jsx)(Jr,{className:"h-4 w-4 mr-2 text-gray-400"}),(0,fn.jsx)("span",{children:e.phone||"No phone"})]}),e.email&&(0,fn.jsxs)("div",{className:"flex items-center text-gray-600",children:[(0,fn.jsx)(Wr,{className:"h-4 w-4 mr-2 text-gray-400"}),(0,fn.jsx)("span",{className:"truncate",children:e.email})]}),(0,fn.jsxs)("div",{className:"flex items-center text-gray-600",children:[(0,fn.jsx)(qr,{className:"h-4 w-4 mr-2 text-gray-400"}),(0,fn.jsx)("span",{children:e.postcode||"No postcode"})]}),e.date_booked&&(0,fn.jsxs)("div",{className:"flex items-center text-gray-600",children:[(0,fn.jsx)(hr,{className:"h-4 w-4 mr-2 text-gray-400"}),(0,fn.jsx)("span",{children:Oe(e.date_booked)})]})]}),(0,fn.jsxs)("div",{className:"flex items-center justify-between pt-3 border-t border-gray-100",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,fn.jsx)("button",{onClick:t=>Re(e,t),className:"p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Book Appointment",children:(0,fn.jsx)(hr,{className:"h-4 w-4"})}),(0,fn.jsx)("button",{onClick:t=>{t.stopPropagation(),Be(e.id)},className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",children:(0,fn.jsx)(gr,{className:"h-4 w-4"})})]}),(0,fn.jsx)("button",{className:"text-gray-400 hover:text-blue-600 transition-colors",children:(0,fn.jsx)(yr,{className:"h-5 w-5"})})]})]})]},e.id))}):(0,fn.jsx)("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:(0,fn.jsx)("div",{className:"overflow-x-auto",children:(0,fn.jsxs)("table",{className:"w-full",children:[(0,fn.jsx)("thead",{className:"bg-gradient-to-r from-gray-50 to-gray-100 border-b border-gray-200",children:(0,fn.jsxs)("tr",{children:[(0,fn.jsx)("th",{className:"px-2 sm:px-4 lg:px-6 py-2 sm:py-4 text-left",children:(0,fn.jsx)("input",{type:"checkbox",checked:F.length===u.length&&u.length>0,onChange:Ue,className:"w-4 h-4 sm:w-5 sm:h-5 rounded text-blue-600 cursor-pointer"})}),(0,fn.jsx)("th",{className:"px-2 sm:px-4 lg:px-6 py-2 sm:py-4 text-left text-[10px] sm:text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Lead"}),(0,fn.jsx)("th",{className:"px-2 sm:px-4 lg:px-6 py-2 sm:py-4 text-left text-[10px] sm:text-xs font-semibold text-gray-700 uppercase tracking-wider hidden sm:table-cell",children:"Contact"}),(0,fn.jsx)("th",{className:"px-2 sm:px-4 lg:px-6 py-2 sm:py-4 text-left text-[10px] sm:text-xs font-semibold text-gray-700 uppercase tracking-wider hidden lg:table-cell",children:"Assigned"}),(0,fn.jsx)("th",{className:"px-2 sm:px-4 lg:px-6 py-2 sm:py-4 text-left text-[10px] sm:text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Status"}),(0,fn.jsx)("th",{className:"px-2 sm:px-4 lg:px-6 py-2 sm:py-4 text-left text-[10px] sm:text-xs font-semibold text-gray-700 uppercase tracking-wider hidden md:table-cell",children:"Date Booked"}),(0,fn.jsx)("th",{className:"px-2 sm:px-4 lg:px-6 py-2 sm:py-4 text-left text-[10px] sm:text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Actions"})]})}),(0,fn.jsx)("tbody",{className:"divide-y divide-gray-100",children:u.map(e=>(0,fn.jsxs)("tr",{onClick:()=>Me(e),className:"hover:bg-gray-50 cursor-pointer transition-colors",children:[(0,fn.jsx)("td",{className:"px-2 sm:px-4 lg:px-6 py-2 sm:py-4",children:(0,fn.jsx)("input",{type:"checkbox",checked:F.includes(e.id),onChange:t=>{t.stopPropagation(),Be(e.id)},onClick:e=>e.stopPropagation(),className:"w-4 h-4 sm:w-5 sm:h-5 rounded text-blue-600 cursor-pointer"})}),(0,fn.jsx)("td",{className:"px-2 sm:px-4 lg:px-6 py-2 sm:py-4",children:(0,fn.jsxs)("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[e.image_url?(0,fn.jsx)(Ui,{src:Ai(e.image_url,"thumbnail"),alt:e.name,className:"w-8 h-8 sm:w-10 sm:h-10 rounded-full object-cover cursor-zoom-in flex-shrink-0",onClick:t=>{t.stopPropagation();const s=Ai(e.image_url,"original")||e.image_url;s&&z(s)}}):(0,fn.jsx)("div",{className:"w-8 h-8 sm:w-10 sm:h-10 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0",children:(0,fn.jsx)(gl,{className:"h-4 w-4 sm:h-5 sm:w-5 text-gray-500"})}),(0,fn.jsxs)("div",{className:"min-w-0",children:[(0,fn.jsx)("div",{className:"font-medium text-gray-900 text-xs sm:text-sm truncate max-w-[80px] sm:max-w-[120px] lg:max-w-none",children:e.name}),(0,fn.jsxs)("div",{className:"text-[10px] sm:text-sm text-gray-500",children:[e.postcode,e.lead_source&&(0,fn.jsx)("span",{className:"ml-1 px-1.5 py-0.5 text-[9px] bg-teal-100 text-teal-700 rounded-full font-medium",children:e.lead_source})]})]})]})}),(0,fn.jsx)("td",{className:"px-2 sm:px-4 lg:px-6 py-2 sm:py-4 hidden sm:table-cell",children:(0,fn.jsxs)("div",{className:"text-xs sm:text-sm",children:[(0,fn.jsx)("div",{className:"text-gray-900",children:e.phone}),e.email&&(0,fn.jsx)("div",{className:"text-gray-500 truncate max-w-[120px] lg:max-w-none",children:e.email})]})}),(0,fn.jsx)("td",{className:"px-2 sm:px-4 lg:px-6 py-2 sm:py-4 hidden lg:table-cell",children:(0,fn.jsx)("div",{className:"text-xs sm:text-sm text-purple-600 font-medium",children:e.booker?"".concat(e.booker.name):"Not assigned"})}),(0,fn.jsx)("td",{className:"px-2 sm:px-4 lg:px-6 py-2 sm:py-4",children:(0,fn.jsxs)("div",{className:"flex items-center gap-1",children:[(0,fn.jsx)("span",{className:"px-1.5 sm:px-3 py-0.5 sm:py-1 rounded-full text-[10px] sm:text-xs font-semibold border whitespace-nowrap ".concat(Fe(Ie(e))),children:Ie(e)}),e.has_sale>0&&(0,fn.jsx)("span",{className:"text-xs",title:"Sale Completed",children:"\ud83d\udcb0"}),"Arrived"===e.booking_status&&(0,fn.jsx)("span",{className:"text-xs",title:"Arrived",children:"\ud83d\udeb6"}),"No Show"===e.booking_status&&(0,fn.jsx)("span",{className:"text-xs",title:"No Show",children:"\ud83d\udeab"}),"Cancel"===e.booking_status&&(0,fn.jsx)("span",{className:"text-xs",title:"Cancelled",children:"\u274c"}),"Complete"===e.booking_status&&(0,fn.jsx)("span",{className:"text-xs",title:"Complete",children:"\u2705"}),"No Sale"===e.booking_status&&(0,fn.jsx)("span",{className:"text-xs",title:"No Sale",children:"\ud83d\udccb"}),"Reschedule"===e.booking_status&&(0,fn.jsx)("span",{className:"text-xs",title:"Rescheduled",children:"\ud83d\udd04"}),"Review"===e.booking_status&&(0,fn.jsx)("span",{className:"text-xs",title:"Under Review",children:"\ud83d\udc41\ufe0f"})]})}),(0,fn.jsx)("td",{className:"px-2 sm:px-4 lg:px-6 py-2 sm:py-4 text-xs sm:text-sm text-gray-900 hidden md:table-cell",children:Oe(e.date_booked)}),(0,fn.jsx)("td",{className:"px-2 sm:px-4 lg:px-6 py-2 sm:py-4",children:(0,fn.jsxs)("div",{className:"flex items-center space-x-0.5 sm:space-x-2",children:[(0,fn.jsx)("button",{onClick:t=>Re(e,t),className:"p-1.5 sm:p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Book Appointment",children:(0,fn.jsx)(hr,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})}),(0,fn.jsx)("button",{onClick:t=>{t.stopPropagation(),Me(e)},className:"p-1.5 sm:p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"View Details",children:(0,fn.jsx)(Ar,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})})]})})]},e.id))})]})})}),0===u.length&&!h&&(0,fn.jsxs)("div",{className:"text-center py-20",children:[(0,fn.jsx)("div",{className:"text-gray-400 mb-4",children:(0,fn.jsx)(gl,{className:"h-16 w-16 mx-auto"})}),(0,fn.jsx)("h3",{className:"text-xl font-semibold text-gray-700 mb-2",children:"No leads found"}),(0,fn.jsx)("p",{className:"text-gray-500",children:"Try adjusting your search or filters"})]}),A>1&&(0,fn.jsxs)("div",{className:"mt-8 flex items-center justify-center space-x-2",children:[(0,fn.jsx)("button",{onClick:()=>{const e=Math.max(1,E-1);console.log("\ud83d\udd35 [Pagination] Previous clicked:",{currentPage:E,newPage:e,statusFilter:v}),T(e)},disabled:1===E,className:"px-4 py-2 bg-white border border-gray-200 rounded-xl text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200",children:"Previous"}),(0,fn.jsx)("div",{className:"flex items-center space-x-1",children:[...Array(Math.min(5,A))].map((e,t)=>{const s=E<=3?t+1:E>=A-2?A-4+t:E-2+t;return s<1||s>A?null:(0,fn.jsx)("button",{onClick:()=>{console.log("\ud83d\udd35 [Pagination] Page number clicked:",{pageNum:s,currentPage:E,statusFilter:v}),T(s)},className:"w-10 h-10 rounded-xl font-medium transition-all duration-200 ".concat(E===s?"bg-blue-600 text-white shadow-lg":"bg-white text-gray-700 border border-gray-200 hover:bg-gray-50"),children:s},s)})}),(0,fn.jsx)("button",{onClick:()=>{const e=Math.min(A,E+1);console.log("\ud83d\udd35 [Pagination] Next clicked:",{currentPage:E,newPage:e,totalPages:A,statusFilter:v}),T(e)},disabled:E===A,className:"px-4 py-2 bg-white border border-gray-200 rounded-xl text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200",children:"Next"})]})]}),V&&(0,fn.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",style:{pointerEvents:"auto"},children:(0,fn.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white",children:(0,fn.jsxs)("div",{className:"mt-3",children:[(0,fn.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Add New Lead"}),(0,fn.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{const e=localStorage.getItem("token");await gn.post("/api/leads",Ee,{headers:e?{Authorization:"Bearer ".concat(e)}:{}}),W(!1),Te({name:"",phone:"",email:"",postcode:"",status:"New",image_url:""}),Ae(),De()}catch(t){console.error("Error adding lead:",t)}},className:"space-y-4",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),(0,fn.jsx)("input",{type:"text",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:Ee.name,onChange:e=>Te(He(He({},Ee),{},{name:e.target.value}))})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),(0,fn.jsx)("input",{type:"tel",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:Ee.phone,onChange:e=>Te(He(He({},Ee),{},{phone:e.target.value}))})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,fn.jsx)("input",{type:"email",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:Ee.email,onChange:e=>Te(He(He({},Ee),{},{email:e.target.value}))})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Postcode"}),(0,fn.jsx)("input",{type:"text",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:Ee.postcode,onChange:e=>Te(He(He({},Ee),{},{postcode:e.target.value}))})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),(0,fn.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:Ee.status,onChange:e=>Te(He(He({},Ee),{},{status:e.target.value})),children:[(0,fn.jsx)("option",{value:"New",children:"New"}),(0,fn.jsx)("option",{value:"Booked",children:"Booked"}),(0,fn.jsx)("option",{value:"Attended",children:"Attended"}),(0,fn.jsx)("option",{value:"Cancelled",children:"Cancelled"})]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Image URL"}),(0,fn.jsx)("input",{type:"text",placeholder:"https://example.com/image.jpg",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:Ee.image_url,onChange:e=>Te(He(He({},Ee),{},{image_url:e.target.value}))})]}),(0,fn.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,fn.jsx)("button",{type:"button",onClick:()=>W(!1),className:"btn-secondary",children:"Cancel"}),(0,fn.jsx)("button",{type:"submit",className:"btn-primary",children:"Add Lead"})]})]})]})})}),q&&(0,fn.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",style:{pointerEvents:"auto"},children:(0,fn.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white",children:(0,fn.jsxs)("div",{className:"mt-3",children:[(0,fn.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Upload Leads"}),(0,fn.jsxs)("div",{className:"space-y-4",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select CSV or Excel file"}),(0,fn.jsx)("input",{type:"file",accept:".csv,.xlsx,.xls",onChange:e=>{const t=e.target.files[0];if(t){0;if(!["text/csv","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(t.type)&&!t.name.endsWith(".csv"))return void alert("Please select a CSV or Excel file");0,ue(t),xe("")}},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),de&&(0,fn.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["Selected: ",de.name]})]}),(0,fn.jsxs)("div",{className:"bg-blue-50 p-3 rounded-md",children:[(0,fn.jsx)("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:"How it works:"}),(0,fn.jsxs)("div",{className:"text-xs text-blue-800 space-y-0.5",children:[(0,fn.jsx)("p",{children:"1. Select your CSV or Excel file"}),(0,fn.jsxs)("p",{children:["2. Click ",(0,fn.jsx)("strong",{children:"Upload & Map"})," to detect columns"]}),(0,fn.jsx)("p",{children:"3. Review and adjust column mapping"}),(0,fn.jsx)("p",{children:"4. Confirm import"})]})]}),(0,fn.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,fn.jsx)("button",{type:"button",onClick:()=>{H(!1),ue(null),he(0),xe("")},className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition-colors",children:"Cancel"}),(0,fn.jsx)("button",{onClick:async()=>{if(!de)return void alert("Please select a file first");const e=localStorage.getItem("token");if(!e)return void alert("Please login again to upload files");const t=new FormData;t.append("file",de);try{xe("Analyzing..."),he(30);const s=await gn.post("/api/leads/upload-preview",t,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer ".concat(e)},onUploadProgress:e=>{const t=Math.round(100*e.loaded/e.total);he(Math.min(t,60))}});he(100),xe(""),he(0),ye(s.data),je(s.data.suggestedMapping||{}),H(!1),ue(null),fe(!0)}catch(o){var s,n,a;if(console.error("Error previewing file:",o),401===(null===(s=o.response)||void 0===s?void 0:s.status))alert("Your session has expired. Please login again.");else if(403===(null===(n=o.response)||void 0===n?void 0:n.status))alert("You need admin privileges to upload files.");else if(400===(null===(a=o.response)||void 0===a?void 0:a.status)){var r,l;alert((null===(r=o.response)||void 0===r||null===(l=r.data)||void 0===l?void 0:l.message)||"Invalid file format.")}else alert("Upload failed. Please try again.");xe(""),he(0)}},disabled:!de||"Analyzing..."===pe,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Analyzing..."===pe?"Analyzing...":"Upload & Map"})]})]})]})})}),ge&&be&&(0,fn.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 overflow-y-auto h-full w-full z-50 flex items-start justify-center pt-10",style:{pointerEvents:"auto"},children:(0,fn.jsxs)("div",{className:"relative mx-4 p-6 border w-full max-w-3xl shadow-2xl rounded-2xl bg-white",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"Map Columns"}),(0,fn.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:[be.totalRows," rows detected \u2014 ",be.columns.length," columns found"]})]}),(0,fn.jsx)("button",{onClick:()=>{fe(!1),ye(null),je({}),Se(null)},className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:(0,fn.jsx)(jl,{className:"h-5 w-5"})})]}),(0,fn.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6",children:ze.map(e=>(0,fn.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,fn.jsx)("label",{className:"w-28 text-sm font-medium text-gray-700 flex-shrink-0",children:e.label}),(0,fn.jsxs)("select",{value:ve[e.key]||"",onChange:t=>{je(s=>He(He({},s),{},{[e.key]:t.target.value||null})),Se(null)},className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white",children:[(0,fn.jsx)("option",{value:"",children:"(skip)"}),be.columns.map(e=>(0,fn.jsx)("option",{value:e,children:e},e))]})]},e.key))}),(0,fn.jsxs)("div",{className:"mb-6",children:[(0,fn.jsxs)("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:["Preview (first ",be.sampleRows.length," rows)"]}),(0,fn.jsxs)("div",{className:"overflow-x-auto border border-gray-200 rounded-lg",children:[(0,fn.jsxs)("table",{className:"w-full text-xs",children:[(0,fn.jsx)("thead",{className:"bg-gray-50",children:(0,fn.jsx)("tr",{children:ze.filter(e=>ve[e.key]).map(e=>(0,fn.jsxs)("th",{className:"px-3 py-2 text-left font-semibold text-gray-600 whitespace-nowrap",children:[e.label,(0,fn.jsx)("span",{className:"block text-[10px] font-normal text-gray-400",children:ve[e.key]})]},e.key))})}),(0,fn.jsx)("tbody",{className:"divide-y divide-gray-100",children:be.sampleRows.map((e,t)=>(0,fn.jsx)("tr",{className:"hover:bg-gray-50",children:ze.filter(e=>ve[e.key]).map(t=>(0,fn.jsx)("td",{className:"px-3 py-2 text-gray-700 whitespace-nowrap max-w-[160px] truncate",children:e[ve[t.key]]||(0,fn.jsx)("span",{className:"text-gray-300",children:"\u2014"})},t.key))},t))})]}),0===ze.filter(e=>ve[e.key]).length&&(0,fn.jsx)("div",{className:"text-center py-6 text-gray-400 text-sm",children:"No columns mapped yet \u2014 select columns above to see a preview"})]})]}),ke&&(0,fn.jsxs)("div",{className:"mb-6 border border-gray-200 rounded-lg overflow-hidden",children:[(0,fn.jsxs)("div",{className:"flex flex-wrap gap-3 p-4 bg-gray-50 border-b border-gray-200",children:[(0,fn.jsxs)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-blue-100 text-blue-800",children:["Total: ",ke.totalRows]}),(0,fn.jsxs)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold ".concat(ke.validRows===ke.totalRows?"bg-green-100 text-green-800":"bg-green-100 text-green-700"),children:["Valid: ",ke.validRows]}),ke.summary.willSkip>0&&(0,fn.jsxs)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-700",children:["Errors: ",ke.summary.willSkip]}),ke.summary.duplicatesInFile>0&&(0,fn.jsxs)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-amber-100 text-amber-700",children:["In-file duplicates: ",ke.summary.duplicatesInFile]}),ke.summary.duplicatesInDB>0&&(0,fn.jsxs)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-orange-100 text-orange-700",children:["Already in CRM: ",ke.summary.duplicatesInDB]}),0===ke.summary.willSkip&&0===ke.summary.duplicatesInDB&&0===ke.summary.duplicatesInFile&&0===ke.warnings.length&&(0,fn.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800",children:"All clear"})]}),ke.errors.length>0&&(0,fn.jsxs)("details",{className:"border-b border-gray-200",children:[(0,fn.jsx)("summary",{className:"px-4 py-3 cursor-pointer hover:bg-red-50 text-sm font-medium text-red-700 flex items-center justify-between",children:(0,fn.jsxs)("span",{children:["Errors \u2014 ",ke.errors.length," rows will be skipped"]})}),(0,fn.jsxs)("div",{className:"px-4 pb-3 max-h-40 overflow-y-auto",children:[ke.errors.map((e,t)=>(0,fn.jsxs)("div",{className:"text-xs text-red-600 py-1 border-b border-red-50 last:border-0",children:[(0,fn.jsxs)("span",{className:"font-medium",children:["Row ",e.row,":"]})," ",e.issue]},t)),(null===(t=ke.truncated)||void 0===t?void 0:t.errors)&&(0,fn.jsx)("div",{className:"text-xs text-gray-400 italic pt-1",children:"Showing first 50 of more errors..."})]})]}),ke.warnings.length>0&&(0,fn.jsxs)("details",{className:"border-b border-gray-200",children:[(0,fn.jsx)("summary",{className:"px-4 py-3 cursor-pointer hover:bg-amber-50 text-sm font-medium text-amber-700",children:(0,fn.jsxs)("span",{children:["Warnings \u2014 ",ke.warnings.length," rows with issues (will still import)"]})}),(0,fn.jsxs)("div",{className:"px-4 pb-3 max-h-40 overflow-y-auto",children:[ke.warnings.map((e,t)=>(0,fn.jsxs)("div",{className:"text-xs text-amber-600 py-1 border-b border-amber-50 last:border-0",children:[(0,fn.jsxs)("span",{className:"font-medium",children:["Row ",e.row,":"]})," ",e.issue]},t)),(null===(s=ke.truncated)||void 0===s?void 0:s.warnings)&&(0,fn.jsx)("div",{className:"text-xs text-gray-400 italic pt-1",children:"Showing first 50 of more warnings..."})]})]}),ke.inFileDuplicates.length>0&&(0,fn.jsxs)("details",{className:"border-b border-gray-200",children:[(0,fn.jsx)("summary",{className:"px-4 py-3 cursor-pointer hover:bg-amber-50 text-sm font-medium text-amber-700",children:(0,fn.jsxs)("span",{children:["In-file duplicates \u2014 ",ke.inFileDuplicates.length," phone numbers appear multiple times"]})}),(0,fn.jsxs)("div",{className:"px-4 pb-3 max-h-40 overflow-y-auto",children:[ke.inFileDuplicates.map((e,t)=>(0,fn.jsxs)("div",{className:"text-xs text-amber-600 py-1 border-b border-amber-50 last:border-0",children:[(0,fn.jsx)("span",{className:"font-medium",children:e.phone})," \u2014 appears ",e.count,"x (rows ",e.rows.join(", "),") \u2014 ",e.names.join(", ")]},t)),(null===(n=ke.truncated)||void 0===n?void 0:n.inFileDuplicates)&&(0,fn.jsx)("div",{className:"text-xs text-gray-400 italic pt-1",children:"Showing first 50 of more duplicates..."})]})]}),ke.dbDuplicates.length>0&&(0,fn.jsxs)("details",{className:"border-b border-gray-200 last:border-0",children:[(0,fn.jsx)("summary",{className:"px-4 py-3 cursor-pointer hover:bg-orange-50 text-sm font-medium text-orange-700",children:(0,fn.jsxs)("span",{children:["Already in CRM \u2014 ",ke.dbDuplicates.length," phone numbers already exist"]})}),(0,fn.jsxs)("div",{className:"px-4 pb-3 max-h-40 overflow-y-auto",children:[ke.dbDuplicates.map((e,t)=>(0,fn.jsxs)("div",{className:"text-xs text-orange-600 py-1 border-b border-orange-50 last:border-0",children:[(0,fn.jsx)("span",{className:"font-medium",children:e.phone})," \u2014 ",e.existingName," (",e.existingStatus,")"]},t)),(null===(r=ke.truncated)||void 0===r?void 0:r.dbDuplicates)&&(0,fn.jsx)("div",{className:"text-xs text-gray-400 italic pt-1",children:"Showing first 50 of more matches..."})]})]})]}),(0,fn.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[(0,fn.jsxs)("p",{className:"text-xs text-gray-400",children:[Object.values(ve).filter(Boolean).length," of ",ze.length," fields mapped"]}),(0,fn.jsxs)("div",{className:"flex space-x-3",children:[(0,fn.jsx)("button",{onClick:()=>{fe(!1),ye(null),je({}),Se(null)},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors text-sm font-medium",children:"Cancel"}),(0,fn.jsx)("button",{onClick:async()=>{if(null===be||void 0===be||!be.fileId)return;const e=localStorage.getItem("token");if(e){_e(!0),Se(null);try{const t=await gn.post("/api/leads/upload-analyze",{fileId:be.fileId,columnMapping:ve},{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}});Se(t.data)}catch(n){var t,s;console.error("Error analyzing upload:",n),alert((null===(t=n.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||"Analysis failed. Please try again.")}finally{_e(!1)}}else alert("Please login again")},disabled:Ce||!ve.name&&!ve.phone,className:"px-5 py-2 bg-amber-500 text-white rounded-lg hover:bg-amber-600 transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:Ce?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),(0,fn.jsx)("span",{children:"Analyzing..."})]}):(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(Ar,{className:"h-4 w-4"}),(0,fn.jsx)("span",{children:ke?"Re-analyze":"Analyze"})]})}),(0,fn.jsx)("button",{onClick:async()=>{if(null===be||void 0===be||!be.fileId)return;const e=localStorage.getItem("token");if(e){Ne(!0);try{const t=await gn.post("/api/leads/upload-simple",{fileId:be.fileId,columnMapping:ve},{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}),{imported:s,total:n,errors:a}=t.data;let r="Done! ".concat(s," of ").concat(n," leads imported.");a&&a.length>0&&(r+=" (".concat(a.length," rows skipped)")),fe(!1),ye(null),je({}),Se(null),alert(r),Ae(),De()}catch(a){var t,s,n;if(console.error("Error importing mapped leads:",a),400===(null===(t=a.response)||void 0===t?void 0:t.status))alert((null===(s=a.response)||void 0===s||null===(n=s.data)||void 0===n?void 0:n.message)||"Import failed.");else alert("Import failed. Please try again.")}finally{Ne(!1)}}else alert("Please login again")},disabled:we||!ke||!ve.name&&!ve.phone,className:"px-6 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",title:ke?"":"Run analysis first before importing",children:we?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),(0,fn.jsx)("span",{children:"Importing..."})]}):(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(gr,{className:"h-4 w-4"}),(0,fn.jsxs)("span",{children:["Import ",ke?ke.summary.willImport:be.totalRows," Leads"]})]})})]})]})]})}),pe&&""!==pe.trim()&&(pe.includes("Analyzing")||pe.includes("Processing")||pe.includes("Uploading")||pe.includes("Auto-processing")||pe.includes("Complete"))&&(0,fn.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 overflow-y-auto h-full w-full z-50 flex items-center justify-center",children:(0,fn.jsx)("div",{className:"relative mx-auto p-8 border w-full max-w-md shadow-2xl rounded-2xl bg-white transform transition-all duration-300",children:(0,fn.jsxs)("div",{className:"text-center",children:[(0,fn.jsx)("div",{className:"mb-6",children:pe.includes("Complete")?(0,fn.jsx)("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-r from-green-500 to-emerald-600 rounded-full",children:(0,fn.jsx)("svg",{className:"w-8 h-8 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,fn.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}):(0,fn.jsx)("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full animate-pulse",children:(0,fn.jsx)("svg",{className:"w-8 h-8 text-white animate-spin",fill:"none",viewBox:"0 0 24 24",children:(0,fn.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})}),(0,fn.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:pe.includes("Complete")?"Upload Complete!":pe.includes("Analyzing")?"Analyzing File":pe.includes("Processing")?"Processing Leads":pe.includes("Auto-processing")?"Auto-Processing":"Uploading File"}),(0,fn.jsx)("p",{className:"text-gray-600 mb-6",children:pe.includes("Complete")?"Your leads have been successfully processed and are ready for review.":pe.includes("Analyzing")?"Detecting columns and mapping data...":pe.includes("Processing")?"Importing leads and checking for duplicates...":pe.includes("Auto-processing")?"Smart processing in progress...":"Please wait while we upload your file..."}),(0,fn.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-3 mb-4",children:(0,fn.jsx)("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 h-3 rounded-full transition-all duration-300",style:{width:"".concat(me,"%"),animation:me>0?"shimmer 2s ease-in-out infinite":"none"},children:(0,fn.jsx)("div",{className:"h-full bg-white opacity-30 rounded-full animate-pulse"})})}),(0,fn.jsx)("div",{className:"text-sm text-gray-500 mb-4",children:(0,fn.jsxs)("span",{children:[me,"%"]})}),pe.includes("Analyzing")&&(0,fn.jsx)("div",{className:"bg-blue-50 p-3 rounded-lg mb-4",children:(0,fn.jsx)("p",{className:"text-sm text-blue-800",children:"\ud83d\udd0d Detecting column headers and data types..."})}),pe.includes("Processing")&&(0,fn.jsx)("div",{className:"bg-green-50 p-3 rounded-lg mb-4",children:(0,fn.jsx)("p",{className:"text-sm text-green-800",children:"\u26a1 Importing leads and checking for duplicates..."})}),pe.includes("Auto-processing")&&(0,fn.jsx)("div",{className:"bg-purple-50 p-3 rounded-lg mb-4",children:(0,fn.jsx)("p",{className:"text-sm text-purple-800",children:"\ud83e\udd16 Smart processing with AI assistance..."})})]})})}),Q&&(0,fn.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",style:{pointerEvents:"auto"},children:(0,fn.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white",children:(0,fn.jsxs)("div",{className:"mt-3",children:[(0,fn.jsx)("div",{className:"flex items-center justify-center w-12 h-12 mx-auto bg-red-100 rounded-full mb-4",children:(0,fn.jsx)(cl,{className:"h-6 w-6 text-red-600"})}),(0,fn.jsx)("h3",{className:"text-lg font-medium text-gray-900 text-center mb-2",children:"Delete Selected Leads"}),(0,fn.jsxs)("p",{className:"text-sm text-gray-500 text-center mb-6",children:["Are you sure you want to delete ",(0,fn.jsx)("strong",{children:F.length})," selected leads? This action cannot be undone."]}),(0,fn.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,fn.jsx)("button",{onClick:()=>J(!1),className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition-colors",children:"Cancel"}),(0,fn.jsxs)("button",{onClick:async()=>{if(0!==F.length)if("admin"===(null===i||void 0===i?void 0:i.role))try{const e=localStorage.getItem("token"),t=await gn.delete("/api/leads/bulk",{data:{leadIds:F},headers:e?{Authorization:"Bearer ".concat(e)}:{}});J(!1),I([]),Ae(),De(),alert("Successfully deleted ".concat(t.data.deletedCount||F.length," leads"))}catch(s){var e,t;console.error("Error deleting leads:",s),null!==(e=s.response)&&void 0!==e&&null!==(t=e.data)&&void 0!==t&&t.message?alert("Delete failed: ".concat(s.response.data.message)):alert("Failed to delete leads. Please try again.")}else alert("Only administrators can delete leads");else alert("Please select leads to delete")},className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors",children:["Delete ",F.length," Leads"]})]})]})})}),ee&&(0,fn.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",style:{pointerEvents:"auto"},children:(0,fn.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white",children:(0,fn.jsxs)("div",{className:"mt-3",children:[(0,fn.jsx)("div",{className:"flex items-center justify-center w-16 h-16 mx-auto bg-orange-100 rounded-full mb-4",children:(0,fn.jsx)("span",{className:"text-3xl",children:"\ud83e\udd8d"})}),(0,fn.jsx)("h3",{className:"text-lg font-medium text-gray-900 text-center mb-2",children:"Send to Sales Ape"}),(0,fn.jsxs)("p",{className:"text-sm text-gray-500 text-center mb-6",children:["Send ",(0,fn.jsx)("strong",{children:F.length})," selected leads to the Sales Ape AI queue for automated outreach."]}),(0,fn.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,fn.jsx)("button",{onClick:()=>te(!1),disabled:se,className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition-colors disabled:opacity-50",children:"Cancel"}),(0,fn.jsx)("button",{onClick:async()=>{if(0!==F.length){ne(!0);try{const n=localStorage.getItem("token");let a=0,r=0;const l=[];for(const o of F)try{await gn.post("/api/salesape-dashboard/queue/add",{leadId:o},{headers:{"x-auth-token":n}}),a++}catch(s){var e,t;r++;const n=(null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||s.message;l.push(n),console.error("Failed to send lead ".concat(o," to Sales Ape:"),n)}te(!1),I([]),Ae(),De(),0===r?alert("Successfully sent ".concat(a," leads to Sales Ape queue")):alert("Sent ".concat(a," leads to Sales Ape queue.\n").concat(r," failed: ").concat(l.slice(0,3).join(", ")).concat(l.length>3?"...":""))}catch(s){console.error("Error sending leads to Sales Ape:",s),alert("Failed to send leads to Sales Ape")}finally{ne(!1)}}else alert("Please select leads to send to Sales Ape")},disabled:se,className:"px-4 py-2 bg-gradient-to-r from-orange-500 to-amber-500 text-white rounded-md hover:from-orange-600 hover:to-amber-600 transition-colors disabled:opacity-50 flex items-center space-x-2",children:se?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),(0,fn.jsx)("span",{children:"Sending..."})]}):(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)("span",{children:"\ud83e\udd8d"}),(0,fn.jsxs)("span",{children:["Send ",F.length," Leads"]})]})})]})]})})}),Y&&(0,fn.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",style:{pointerEvents:"auto"},children:(0,fn.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white",children:(0,fn.jsxs)("div",{className:"mt-3",children:[(0,fn.jsx)("div",{className:"flex items-center justify-center w-12 h-12 mx-auto bg-purple-100 rounded-full mb-4",children:(0,fn.jsx)(xl,{className:"h-6 w-6 text-purple-600"})}),(0,fn.jsx)("h3",{className:"text-lg font-medium text-gray-900 text-center mb-2",children:"Assign Selected Leads"}),(0,fn.jsxs)("p",{className:"text-sm text-gray-500 text-center mb-6",children:["Assign ",(0,fn.jsx)("strong",{children:F.length})," selected leads to a team member."]}),(0,fn.jsxs)("div",{className:"mb-6",children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Team Member"}),(0,fn.jsxs)("select",{value:ie,onChange:e=>ce(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[(0,fn.jsx)("option",{value:"",children:"Choose a team member..."}),le.map(e=>(0,fn.jsxs)("option",{value:e.id,children:[e.name," (",e.leads_assigned||0," leads assigned)"]},e.id))]})]}),(0,fn.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,fn.jsx)("button",{onClick:()=>{G(!1),ce("")},className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition-colors",children:"Cancel"}),(0,fn.jsxs)("button",{onClick:async()=>{if(0!==F.length)if(ie)try{var e;const t=localStorage.getItem("token");await gn.put("/api/leads/bulk-assign",{leadIds:F,bookerId:ie},{headers:t?{Authorization:"Bearer ".concat(t)}:{}}),G(!1),I([]),ce(""),Ae(),De();const s=(null===(e=le.find(e=>e.id===ie))||void 0===e?void 0:e.name)||"Unknown";alert("Successfully assigned ".concat(F.length," leads to ").concat(s))}catch(t){console.error("Error assigning leads:",t),alert("Failed to assign leads")}else alert("Please select a team member to assign leads to");else alert("Please select leads to assign")},disabled:!ie,className:"px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:["Assign ",F.length," Leads"]})]})]})})}),(0,fn.jsx)(Vi,{isOpen:X,onClose:()=>Z(!1),selectedLeads:F,onSuccess:()=>{I([]),Ae()}}),(0,fn.jsx)(zi,{src:U,onClose:()=>z(null)})]})},qi=e=>{let{leadId:t,lead:s,onStatusUpdate:n}=e;const[r,l]=(0,a.useState)(""),[o,i]=(0,a.useState)(!1),[c,d]=(0,a.useState)(""),[u,m]=(0,a.useState)(!1),[h,p]=(0,a.useState)(!1),[x,g]=(0,a.useState)(""),[f,b]=(0,a.useState)(""),[y,v]=(0,a.useState)(""),[j,w]=(0,a.useState)(null),[N,k]=(0,a.useState)(!1),[S,C]=(0,a.useState)(!1),[_,E]=(0,a.useState)(!1),[T,P]=(0,a.useState)(0);(0,a.useEffect)(()=>{if(s&&s.booking_history)try{const e="string"===typeof s.booking_history?JSON.parse(s.booking_history):s.booking_history;if(Array.isArray(e)){const t=e.filter(e=>{var t;return"CALL_STATUS_UPDATE"===e.action&&(null===(t=e.details)||void 0===t?void 0:t.callStatus)&&("No answer"===e.details.callStatus||"No Answer x2"===e.details.callStatus||"No Answer x3"===e.details.callStatus)}),s=t.length>0;E(s),P(t.length)}}catch(ey){console.warn("Error parsing booking_history:",ey)}},[s]);const A=[{value:"No answer",label:"No answer",trigger:"email"},{value:"No photo",label:"No photo",trigger:"email"},{value:"Left Message",label:"Left Message",trigger:"email"},{value:"Not interested",label:"Not interested",trigger:"close"},{value:"Call back",label:"Call back",trigger:"callback"},{value:"Wrong number",label:"Wrong number",trigger:"close"},{value:"Sales/converted - purchased",label:"Sales/converted - purchased",trigger:"callback"},{value:"Not Qualified",label:"Not Qualified",trigger:"close"}],D=(0,a.useMemo)(()=>{const e=[...A];if(_){const t=e.findIndex(e=>"No answer"===e.value);-1!==t&&e.splice(t+1,0,{value:"No Answer x2",label:"No Answer x2",trigger:null},{value:"No Answer x3",label:"No Answer x3",trigger:null})}return e},[_]);(0,a.useEffect)(()=>{if(s)if(s.call_status)l(s.call_status);else if(s.custom_fields)try{const e="string"===typeof s.custom_fields?JSON.parse(s.custom_fields):s.custom_fields;e&&e.call_status&&l(e.call_status)}catch(ey){console.warn("Error parsing custom_fields:",ey)}},[s]);const L=async function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";i(!0),d("");try{const r=await gn.patch("/api/leads/".concat(t,"/call-status"),{callStatus:e,callbackTime:s,callbackNote:a});if(r.data.success){l(e),n&&n(e,r.data);const t=D.find(t=>t.value===e);if(t)switch(t.trigger){case"email":case"close":break;case"callback":if(s){const e=s.includes("T")?new Date(s).toLocaleString("en-GB",{dateStyle:"medium",timeStyle:"short",timeZone:"Europe/London"}):s;alert("Callback scheduled for ".concat(e,". You'll receive a reminder notification."))}}}else d(r.data.message||"Failed to update status")}catch(ty){var r,o;console.error("Error updating call status:",ty),d((null===(r=ty.response)||void 0===r||null===(o=r.data)||void 0===o?void 0:o.message)||"Failed to update status")}finally{i(!1),p(!1),w(null),g(""),b(""),v("")}},M=()=>{const e=yi(),t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(s,"-").concat(n)};(0,a.useEffect)(()=>{h&&(g(M()),b((()=>{const e=yi(),t=String(e.getHours()).padStart(2,"0"),s=String(e.getMinutes()).padStart(2,"0");return"".concat(t,":").concat(s)})()))},[h]);return(0,fn.jsxs)("div",{className:"bg-gradient-to-r from-purple-50 to-indigo-50 rounded-xl p-6 border border-purple-200 shadow-sm",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,fn.jsx)("div",{className:"p-2 bg-purple-100 rounded-lg",children:(0,fn.jsx)(fr,{className:"h-5 w-5 text-purple-600"})}),(0,fn.jsxs)("div",{className:"flex-1",children:[(0,fn.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Lead Status"}),(0,fn.jsx)("p",{className:"text-sm text-gray-600",children:"Select the status after placing a call"})]})]}),c&&(0,fn.jsx)("div",{className:"mb-4 p-3 bg-red-100 border border-red-300 rounded-lg",children:(0,fn.jsx)("p",{className:"text-sm text-red-700",children:c})}),(0,fn.jsxs)("div",{className:"relative",children:[(0,fn.jsxs)("button",{onClick:()=>!o&&m(!u),disabled:o,className:"\n            w-full px-4 py-3 rounded-lg border-2 text-left font-medium\n            flex items-center justify-between\n            transition-all duration-200\n            ".concat(r?"".concat((e=>{switch(e){case"No answer":case"No Answer x2":case"No Answer x3":case"Left Message":case"No photo":return"bg-yellow-100 text-yellow-800 border-yellow-300";case"Call back":case"Sales/converted - purchased":return"bg-blue-100 text-blue-800 border-blue-300";case"Not interested":case"Not Qualified":case"Wrong number":return"bg-red-100 text-red-800 border-red-300";default:return"bg-gray-100 text-gray-800 border-gray-300"}})(r)," border-current"):"bg-white border-gray-300 text-gray-700 hover:border-purple-400","\n            ").concat(o?"opacity-50 cursor-not-allowed":"cursor-pointer hover:shadow-md","\n          "),children:[(0,fn.jsx)("span",{children:r||"Select status..."}),(0,fn.jsx)(fr,{className:"h-5 w-5 transition-transform ".concat(u?"transform rotate-180":"")})]}),u&&(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)("div",{className:"fixed inset-0 z-10",onClick:()=>m(!1)}),(0,fn.jsx)("div",{className:"absolute z-20 w-full mt-2 bg-white border border-gray-200 rounded-lg shadow-lg max-h-64 overflow-y-auto",children:D.map(e=>(0,fn.jsxs)("button",{onClick:()=>(async e=>{if(!o)return m(!1),"Call back"===e?(w(e),void p(!0)):"No answer"===e?(w(e),void k(!0)):"No photo"===e?(w(e),void C(!0)):void await L(e)})(e.value),className:"\n                    w-full px-4 py-3 text-left hover:bg-gray-50 transition-colors\n                    flex items-center justify-between\n                    ".concat(r===e.value?"bg-purple-50":"","\n                    ").concat(o?"opacity-50 cursor-not-allowed":"cursor-pointer","\n                  "),disabled:o,children:[(0,fn.jsx)("span",{className:"font-medium",children:e.label}),r===e.value&&(0,fn.jsx)(gr,{className:"h-5 w-5 text-purple-600"})]},e.value))})]})]}),r&&(0,fn.jsxs)("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,fn.jsxs)("p",{className:"text-sm text-blue-800",children:[(0,fn.jsx)("strong",{children:"Current Status:"})," ",r]}),(()=>{const e=D.find(e=>e.value===r);if(e)switch(e.trigger){case"email":return(0,fn.jsx)("p",{className:"text-xs text-blue-600 mt-1",children:"An automatic email will be sent to the client."});case"close":return(0,fn.jsx)("p",{className:"text-xs text-blue-600 mt-1",children:"This lead will be closed."});case"callback":return(0,fn.jsx)("p",{className:"text-xs text-blue-600 mt-1",children:"Please call the client back."});default:return null}return null})()]}),o&&(0,fn.jsx)("div",{className:"mt-4 text-center",children:(0,fn.jsx)("p",{className:"text-sm text-gray-500",children:"Updating status..."})}),N&&(0,fn.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,fn.jsxs)("div",{className:"bg-white rounded-xl shadow-xl p-6 w-full max-w-md mx-4",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,fn.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Send No Answer Email?"}),(0,fn.jsx)("button",{onClick:()=>{k(!1),w(null)},className:"text-gray-400 hover:text-gray-600",children:(0,fn.jsx)(jl,{className:"h-5 w-5"})})]}),(0,fn.jsxs)("p",{className:"text-sm text-gray-600 mb-6",children:['Do you want to send your "No Answer" template email to ',(0,fn.jsx)("strong",{children:null===s||void 0===s?void 0:s.name}),"?"]}),c&&(0,fn.jsx)("div",{className:"mb-4 p-3 bg-red-100 border border-red-300 rounded-lg",children:(0,fn.jsx)("p",{className:"text-sm text-red-700",children:c})}),(0,fn.jsxs)("div",{className:"flex space-x-3",children:[(0,fn.jsx)("button",{onClick:async()=>{await L(j),k(!1)},disabled:o,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Yes, Send Email"}),(0,fn.jsx)("button",{onClick:()=>{k(!1),w(null)},className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancel"})]})]})}),S&&(0,fn.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,fn.jsxs)("div",{className:"bg-white rounded-xl shadow-xl p-6 w-full max-w-md mx-4",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,fn.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Send No Photo Email?"}),(0,fn.jsx)("button",{onClick:()=>{C(!1),w(null)},className:"text-gray-400 hover:text-gray-600",children:(0,fn.jsx)(jl,{className:"h-5 w-5"})})]}),(0,fn.jsxs)("p",{className:"text-sm text-gray-600 mb-6",children:['Do you want to send your "No Photo" template email to ',(0,fn.jsx)("strong",{children:null===s||void 0===s?void 0:s.name}),"?"]}),c&&(0,fn.jsx)("div",{className:"mb-4 p-3 bg-red-100 border border-red-300 rounded-lg",children:(0,fn.jsx)("p",{className:"text-sm text-red-700",children:c})}),(0,fn.jsxs)("div",{className:"flex space-x-3",children:[(0,fn.jsx)("button",{onClick:async()=>{await L(j),C(!1)},disabled:o,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Yes, Send Email"}),(0,fn.jsx)("button",{onClick:()=>{C(!1),w(null)},className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancel"})]})]})}),h&&(0,fn.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,fn.jsxs)("div",{className:"bg-white rounded-xl shadow-xl p-6 w-full max-w-md mx-4",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,fn.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Schedule Callback"}),(0,fn.jsx)("button",{onClick:()=>{p(!1),w(null),g(""),b(""),v("")},className:"text-gray-400 hover:text-gray-600",children:(0,fn.jsx)(jl,{className:"h-5 w-5"})})]}),(0,fn.jsxs)("div",{className:"space-y-4",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Callback Date"}),(0,fn.jsx)("input",{type:"date",value:x,onChange:e=>g(e.target.value),min:M(),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-purple-500",required:!0})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Callback Time (UK Time)"}),(0,fn.jsx)("input",{type:"time",value:f,onChange:e=>b(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-purple-500",required:!0}),(0,fn.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"You'll receive a notification at this date and time to call back"})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Note (Optional)"}),(0,fn.jsx)("textarea",{value:y,onChange:e=>v(e.target.value),placeholder:"e.g., back 5pm, discuss pricing, follow up on quote",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-purple-500",rows:"3"})]}),c&&(0,fn.jsx)("div",{className:"p-3 bg-red-100 border border-red-300 rounded-lg",children:(0,fn.jsx)("p",{className:"text-sm text-red-700",children:c})}),(0,fn.jsxs)("div",{className:"flex space-x-3",children:[(0,fn.jsxs)("button",{onClick:()=>{if(!x)return void d("Please select a callback date");if(!f)return void d("Please select a callback time");const e="".concat(x,"T").concat(f);L(j,e,y)},disabled:o||!x||!f,className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2",children:[(0,fn.jsx)(wr,{className:"h-4 w-4"}),(0,fn.jsx)("span",{children:"Schedule Callback"})]}),(0,fn.jsx)("button",{onClick:()=>{p(!1),w(null),g(""),b(""),v("")},className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancel"})]})]})]})})]})},Hi=e=>{let{isOpen:t,onClose:s,imageUrl:n,leadName:r}=e;const[l,o]=(0,a.useState)(!1),[i,c]=(0,a.useState)(!0),d=(0,a.useRef)(null),u=(e=>{if(!e)return"image";const t=e.toLowerCase();return t.includes(".mp4")||t.includes(".webm")||t.includes(".mov")||t.includes("video/")?"video":t.includes(".gif")?"gif":t.includes(".heic")||t.includes(".heif")?"heic":t.includes(".pdf")?"pdf":"image"})(n),m=(0,a.useCallback)(e=>{e.target===e.currentTarget&&s()},[s]),h=(0,a.useCallback)(e=>{"Escape"===e.key&&s()},[s]),p=(0,a.useCallback)(()=>{d.current&&(i?d.current.pause():d.current.play(),c(!i))},[i]),x=(0,a.useCallback)(async()=>{if(n)try{const e=await fetch(n),t=await e.blob(),s=window.URL.createObjectURL(t),a=document.createElement("a");a.href=s;const l=n.split("/"),o=l[l.length-1].split("?")[0],i=o.split(".").pop()||("video"===u?"mp4":"jpg"),c=r?"".concat(r.replace(/[^a-z0-9]/gi,"_"),".").concat(i):o;a.download=c,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(s)}catch(e){console.error("Download failed:",e),window.open(n,"_blank")}},[n,r,u]);return(0,a.useEffect)(()=>(t?(document.addEventListener("keydown",h),document.body.style.overflow="hidden",o(!1),c(!0)):(document.removeEventListener("keydown",h),document.body.style.overflow="unset"),()=>{document.removeEventListener("keydown",h),document.body.style.overflow="unset"}),[t,h]),t?(0,fn.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50",onClick:m,children:(0,fn.jsxs)("div",{className:"relative max-w-4xl max-h-screen p-4",children:[(0,fn.jsxs)("div",{className:"absolute top-4 right-4 z-10 flex gap-2",children:[(0,fn.jsx)("button",{onClick:x,className:"bg-black bg-opacity-50 text-white rounded-full p-2 hover:bg-opacity-70 transition-all duration-200","aria-label":"Download file",title:"Download",children:(0,fn.jsx)(Cr,{className:"h-6 w-6"})}),(0,fn.jsx)("button",{onClick:s,className:"bg-black bg-opacity-50 text-white rounded-full p-2 hover:bg-opacity-70 transition-all duration-200","aria-label":"Close photo modal",children:(0,fn.jsx)(jl,{className:"h-6 w-6"})})]}),(0,fn.jsxs)("div",{className:"relative",children:[l?(0,fn.jsx)("div",{className:"max-w-full max-h-[90vh] bg-gray-100 rounded-lg shadow-2xl flex items-center justify-center p-8",children:(0,fn.jsxs)("div",{className:"text-center text-gray-500",children:[(0,fn.jsx)(jl,{className:"h-16 w-16 mx-auto mb-4 text-gray-400"}),(0,fn.jsxs)("p",{className:"text-lg font-medium mb-2",children:["video"===u?"Video":"Image"," could not be loaded"]}),(0,fn.jsx)("p",{className:"text-sm",children:"The file may be missing or corrupted"})]})}):(0,fn.jsxs)(fn.Fragment,{children:["heic"===u&&(0,fn.jsx)("div",{className:"max-w-md bg-gray-100 rounded-lg shadow-2xl flex items-center justify-center p-8",children:(0,fn.jsxs)("div",{className:"text-center text-gray-600",children:[(0,fn.jsx)("span",{className:"text-6xl mb-4 block",children:"\ud83d\udcf7"}),(0,fn.jsx)("p",{className:"text-lg font-medium mb-2",children:"HEIC Format"}),(0,fn.jsx)("p",{className:"text-sm mb-4",children:"This Apple image format is not supported in browsers."}),(0,fn.jsx)("button",{onClick:x,className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition-colors",children:"Download Original File"})]})}),"pdf"===u&&(0,fn.jsx)("div",{className:"max-w-md bg-gray-100 rounded-lg shadow-2xl flex items-center justify-center p-8",children:(0,fn.jsxs)("div",{className:"text-center text-gray-600",children:[(0,fn.jsx)("span",{className:"text-6xl mb-4 block",children:"\ud83d\udcc4"}),(0,fn.jsx)("p",{className:"text-lg font-medium mb-2",children:"PDF Document"}),(0,fn.jsx)("p",{className:"text-sm mb-4",children:"Click below to view or download the PDF."}),(0,fn.jsxs)("div",{className:"flex gap-2 justify-center",children:[(0,fn.jsx)("button",{onClick:()=>window.open(n,"_blank"),className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition-colors",children:"Open PDF"}),(0,fn.jsx)("button",{onClick:x,className:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600 transition-colors",children:"Download"})]})]})}),"video"===u&&(0,fn.jsxs)("div",{className:"relative",children:[(0,fn.jsx)("video",{ref:d,src:n,className:"max-w-full max-h-[90vh] object-contain rounded-lg shadow-2xl",autoPlay:!0,loop:!0,muted:!1,playsInline:!0,controls:!0,onError:()=>o(!0)}),(0,fn.jsx)("button",{onClick:p,className:"absolute bottom-20 right-4 bg-black bg-opacity-50 text-white rounded-full p-3 hover:bg-opacity-70 transition-all duration-200","aria-label":i?"Pause video":"Play video",children:i?(0,fn.jsx)(Kr,{className:"h-6 w-6"}):(0,fn.jsx)(Xr,{className:"h-6 w-6"})})]}),"gif"===u&&(0,fn.jsx)("img",{src:n,alt:r,className:"max-w-full max-h-[90vh] object-contain rounded-lg shadow-2xl",onError:()=>o(!0)}),"image"===u&&(0,fn.jsx)("img",{src:n,alt:r,className:"max-w-full max-h-[90vh] object-contain rounded-lg shadow-2xl",onError:()=>o(!0)})]}),(0,fn.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white p-4 rounded-b-lg",children:[(0,fn.jsxs)("p",{className:"text-lg font-medium",children:[r,"image"!==u&&(0,fn.jsx)("span",{className:"ml-2 text-xs uppercase bg-white bg-opacity-20 px-2 py-1 rounded",children:u})]}),(0,fn.jsx)("p",{className:"text-sm opacity-90",children:"Click outside or press ESC to close"})]})]})]})}):null},Yi=e=>{let{lead:t,onSuccess:s}=e;const[n,r]=(0,a.useState)(!1),[l,o]=(0,a.useState)(null),[i,c]=(0,a.useState)(""),d=(null===t||void 0===t?void 0:t.salesape_record_id)||(null===t||void 0===t?void 0:t.salesape_sent_at);return(0,fn.jsxs)("div",{className:"salesape-button-container",children:[(0,fn.jsx)("button",{onClick:async()=>{if(!t||!t.id)return o("error"),void c("Invalid lead data");if(!t.phone||""===t.phone.trim())return o("error"),void c("Lead must have a phone number to send to SalesApe");if(("Booked"!==t.status&&!t.date_booked||window.confirm("\u26a0\ufe0f This lead is already booked. Still send to SalesApe?"))&&window.confirm("Send ".concat(t.name," to SalesApe AI for automated contact?\n\nThis will trigger automated SMS/WhatsApp messages."))){r(!0),o(null),c("");try{const e=localStorage.getItem("token"),n=await gn.post("/api/salesape-webhook/trigger/".concat(t.id),{},{headers:{Authorization:"Bearer ".concat(e)}});o("success"),c("Lead sent to SalesApe successfully!"),s&&s(n.data),setTimeout(()=>{o(null),c("")},5e3)}catch(i){var e,n,a,l;console.error("Error triggering SalesApe:",i),o("error"),c((null===(e=i.response)||void 0===e||null===(n=e.data)||void 0===n?void 0:n.message)||(null===(a=i.response)||void 0===a||null===(l=a.data)||void 0===l?void 0:l.error)||"Failed to send lead to SalesApe"),setTimeout(()=>{o(null),c("")},1e4)}finally{r(!1)}}},disabled:n||"success"===l,className:"\n          inline-flex items-center px-4 py-2 border rounded-md shadow-sm text-sm font-medium\n          focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500\n          ".concat(n?"opacity-50 cursor-not-allowed":"","\n          ").concat("success"===l?"border-green-300 text-green-700 bg-green-50 hover:bg-green-100":"error"===l?"border-red-300 text-red-700 bg-red-50 hover:bg-red-100":d?"border-purple-300 text-purple-700 bg-purple-50 hover:bg-purple-100":"border-indigo-300 text-indigo-700 bg-indigo-50 hover:bg-indigo-100","\n        "),title:d?"Lead already sent to SalesApe":"Send lead to SalesApe AI",children:n?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,fn.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,fn.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Sending..."]}):"success"===l?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(xr,{className:"mr-2 h-4 w-4"}),"Sent to SalesApe"]}):"error"===l?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(rr,{className:"mr-2 h-4 w-4"}),"Failed"]}):d?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(xr,{className:"mr-2 h-4 w-4"}),"Resend to SalesApe"]}):(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(nl,{className:"mr-2 h-4 w-4"}),"Send to SalesApe AI"]})}),i&&(0,fn.jsx)("div",{className:"\n          mt-2 text-sm\n          ".concat("success"===l?"text-green-600":"text-red-600","\n        "),children:i}),d&&(0,fn.jsxs)("div",{className:"mt-2 text-xs text-gray-500",children:[t.salesape_sent_at&&(0,fn.jsxs)("div",{children:["Sent: ",new Date(t.salesape_sent_at).toLocaleString()]}),t.salesape_status&&(0,fn.jsxs)("div",{children:["Status: ",t.salesape_status]})]})]})},Gi=e=>{let{icon:t,label:s,status:n,highlight:a,success:r}=e;return(0,fn.jsxs)("div",{className:"\n      flex items-center p-2 rounded-md\n      ".concat(a?r?"bg-green-50 text-green-800":"bg-blue-50 text-blue-800":"bg-gray-50 text-gray-600","\n    "),children:[n?(0,fn.jsx)(xr,{className:"mr-2 h-4 w-4 ".concat(a?r?"text-green-600":"text-blue-600":"text-gray-400")}):(0,fn.jsx)(jr,{className:"mr-2 h-4 w-4 text-gray-300"}),(0,fn.jsx)("span",{className:"text-sm font-medium",children:s})]})},$i=e=>{let{lead:t}=e;if((null===t||void 0===t||!t.salesape_record_id)&&(null===t||void 0===t||!t.salesape_sent_at))return null;const{salesape_status:s,salesape_initial_message_sent:n,salesape_user_engaged:a,salesape_goal_presented:r,salesape_goal_hit:l,salesape_follow_ups_ended:o,salesape_opted_out:i,salesape_conversation_summary:c,salesape_portal_link:d,salesape_last_updated:u}=t;return(0,fn.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 mt-4",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,fn.jsxs)("h3",{className:"text-lg font-medium text-gray-900 flex items-center",children:[(0,fn.jsx)(Gr,{className:"mr-2 h-5 w-5 text-indigo-600"}),"SalesApe AI Status"]}),d&&(0,fn.jsxs)("a",{href:d,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center text-sm text-indigo-600 hover:text-indigo-800",children:["View Conversation",(0,fn.jsx)(Tr,{className:"ml-1 h-4 w-4"})]})]}),s&&(0,fn.jsxs)("div",{className:"mb-4 p-3 bg-indigo-50 rounded-md",children:[(0,fn.jsxs)("div",{className:"text-sm font-medium text-indigo-900",children:["Current Status: ",(0,fn.jsx)("span",{className:"font-bold",children:s})]}),u&&(0,fn.jsxs)("div",{className:"text-xs text-indigo-600 mt-1",children:["Last updated: ",new Date(u).toLocaleString()]})]}),(0,fn.jsxs)("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[(0,fn.jsx)(Gi,{icon:Gr,label:"Initial Message",status:n}),(0,fn.jsx)(Gi,{icon:Gr,label:"User Engaged",status:a,highlight:a}),(0,fn.jsx)(Gi,{icon:il,label:"Goal Presented",status:r}),(0,fn.jsx)(Gi,{icon:dl,label:"Goal Hit",status:l,highlight:l,success:!0})]}),(i||o)&&(0,fn.jsxs)("div",{className:"flex gap-3 mb-4",children:[i&&(0,fn.jsxs)("div",{className:"flex items-center text-sm text-red-600",children:[(0,fn.jsx)(vl,{className:"mr-1 h-4 w-4"}),"Opted Out"]}),o&&(0,fn.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,fn.jsx)(xr,{className:"mr-1 h-4 w-4"}),"Follow-ups Complete"]})]}),c&&(0,fn.jsxs)("div",{className:"mt-4 p-4 bg-gray-50 rounded-md",children:[(0,fn.jsx)("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Conversation Summary"}),(0,fn.jsx)("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:c})]}),l&&(0,fn.jsx)("div",{className:"mt-4 p-4 bg-green-50 border border-green-200 rounded-md",children:(0,fn.jsxs)("div",{className:"flex items-center text-green-800",children:[(0,fn.jsx)(dl,{className:"mr-2 h-5 w-5"}),(0,fn.jsx)("span",{className:"font-medium",children:"\ud83c\udf89 SalesApe achieved the goal!"})]})})]})},Qi=e=>{const t=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,s)=>s?s.toUpperCase():t.toLowerCase()))(e);return t.charAt(0).toUpperCase()+t.slice(1)},Ki=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.filter((e,t,s)=>Boolean(e)&&""!==e.trim()&&s.indexOf(e)===t).join(" ").trim()};var Ji={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Xi=["color","size","strokeWidth","absoluteStrokeWidth","className","children","iconNode"],Zi=(0,a.forwardRef)((e,t)=>{let{color:s="currentColor",size:n=24,strokeWidth:r=2,absoluteStrokeWidth:l,className:o="",children:i,iconNode:c}=e,d=Si(e,Xi);return(0,a.createElement)("svg",He(He(He({ref:t},Ji),{},{width:n,height:n,stroke:s,strokeWidth:l?24*Number(r)/Number(n):r,className:Ki("lucide",o)},!i&&!(e=>{for(const t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(d)&&{"aria-hidden":"true"}),d),[...c.map(e=>{let[t,s]=e;return(0,a.createElement)(t,s)}),...Array.isArray(i)?i:[i]])}),ec=["className"],tc=(e,t)=>{const s=(0,a.forwardRef)((s,n)=>{let{className:r}=s,l=Si(s,ec);return(0,a.createElement)(Zi,He({ref:n,iconNode:t,className:Ki("lucide-".concat((o=Qi(e),o.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase())),"lucide-".concat(e),r)},l));var o});return s.displayName=Qi(e),s},sc=tc("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),nc=tc("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),ac=tc("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),rc=tc("grid-3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]),lc=tc("list",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]),oc=tc("loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]]),ic=tc("zoom-in",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),cc=tc("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]),dc=e=>{let{isOpen:t,onClose:s,leadId:n,leadName:r,onSelectionComplete:l,maxSelection:o=null,preSelectedIds:i=[]}=e;const[c,d]=(0,a.useState)([]),[u,m]=(0,a.useState)(!0),[h,p]=(0,a.useState)(null),[x,g]=(0,a.useState)(new Set(i)),[f,b]=(0,a.useState)("grid"),[y,v]=(0,a.useState)(null),[j,w]=(0,a.useState)(!1),N=(0,a.useCallback)(async()=>{if(n){m(!0),p(null);try{const e=await fetch("/api/photos?leadId=".concat(n),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(!e.ok)throw new Error("Failed to fetch photos");const t=await e.json();d(t.photos||[])}catch(ty){console.error("Error fetching photos:",ty),p(ty.message)}finally{m(!1)}}},[n]);(0,a.useEffect)(()=>{t&&n&&(w(!1),N())},[t,n,N]),(0,a.useEffect)(()=>{g(e=>{const t=Array.from(e).sort(),s=[...i].sort();return t.length===s.length&&t.every((e,t)=>e===s[t])?e:new Set(i)})},[i]);const k=e=>{g(t=>{const s=new Set(t);if(s.has(e))s.delete(e);else{if(o&&s.size>=o)return alert("You can only select up to ".concat(o," images")),t;s.add(e)}return s})},S=e=>{v(e)},C=()=>{v(null)};return t?(0,fn.jsxs)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:[(0,fn.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-6xl max-h-[95vh] flex flex-col overflow-hidden",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b bg-gradient-to-r from-purple-600 to-indigo-600",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,fn.jsx)("div",{className:"p-2 bg-white bg-opacity-20 rounded-lg",children:(0,fn.jsx)(sc,{className:"w-5 h-5 text-white"})}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("h2",{className:"text-xl font-semibold text-white",children:r?"".concat(r,"'s Photos"):"Client Photos"}),(0,fn.jsxs)("p",{className:"text-purple-100 text-sm",children:[c.length," photos available",o&&" \u2022 Select up to ".concat(o)]})]})]}),(0,fn.jsx)("button",{onClick:s,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors",children:(0,fn.jsx)(nc,{className:"w-6 h-6 text-white"})})]}),(0,fn.jsxs)("div",{className:"flex items-center justify-between px-6 py-3 bg-gray-50 border-b",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,fn.jsxs)("button",{onClick:()=>{if(j)g(new Set);else if(o&&c.length>o){const e=c.slice(0,o).map(e=>e.id);g(new Set(e))}else g(new Set(c.map(e=>e.id)));w(!j)},className:"flex items-center space-x-2 px-3 py-1.5 text-sm font-medium text-gray-700 hover:bg-gray-200 rounded-lg transition-colors",children:[(0,fn.jsx)(ac,{className:"w-4 h-4 ".concat(j?"text-purple-600":"")}),(0,fn.jsx)("span",{children:j?"Deselect All":"Select All"})]}),(0,fn.jsxs)("button",{onClick:()=>{g(new Set),w(!1)},disabled:0===x.size,className:"flex items-center space-x-2 px-3 py-1.5 text-sm font-medium text-gray-700 hover:bg-gray-200 rounded-lg transition-colors disabled:opacity-50",children:[(0,fn.jsx)(nc,{className:"w-4 h-4"}),(0,fn.jsx)("span",{children:"Clear"})]})]}),(0,fn.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,fn.jsxs)("div",{className:"flex border rounded-lg overflow-hidden",children:[(0,fn.jsx)("button",{onClick:()=>b("grid"),className:"p-2 ".concat("grid"===f?"bg-purple-100 text-purple-600":"bg-white text-gray-600 hover:bg-gray-100"),children:(0,fn.jsx)(rc,{className:"w-4 h-4"})}),(0,fn.jsx)("button",{onClick:()=>b("list"),className:"p-2 ".concat("list"===f?"bg-purple-100 text-purple-600":"bg-white text-gray-600 hover:bg-gray-100"),children:(0,fn.jsx)(lc,{className:"w-4 h-4"})})]}),(0,fn.jsxs)("div",{className:"px-3 py-1.5 bg-purple-100 text-purple-700 rounded-lg text-sm font-medium",children:[x.size," selected"]})]})]}),(0,fn.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:u?(0,fn.jsxs)("div",{className:"flex flex-col items-center justify-center py-20",children:[(0,fn.jsx)(oc,{className:"w-10 h-10 text-purple-600 animate-spin mb-4"}),(0,fn.jsx)("p",{className:"text-gray-500",children:"Loading photos..."})]}):h?(0,fn.jsxs)("div",{className:"flex flex-col items-center justify-center py-20",children:[(0,fn.jsx)("div",{className:"p-4 bg-red-50 rounded-full mb-4",children:(0,fn.jsx)(nc,{className:"w-10 h-10 text-red-500"})}),(0,fn.jsx)("p",{className:"text-red-600 font-medium",children:h}),(0,fn.jsx)("button",{onClick:N,className:"mt-4 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:"Retry"})]}):0===c.length?(0,fn.jsxs)("div",{className:"flex flex-col items-center justify-center py-20",children:[(0,fn.jsx)("div",{className:"p-4 bg-gray-100 rounded-full mb-4",children:(0,fn.jsx)(sc,{className:"w-10 h-10 text-gray-400"})}),(0,fn.jsx)("p",{className:"text-gray-600 font-medium",children:"No photos available"}),(0,fn.jsx)("p",{className:"text-gray-400 text-sm mt-1",children:"Photos will appear here once the photographer uploads them"})]}):"grid"===f?(0,fn.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:c.map(e=>{const t=e.cloudinary_secure_url||e.cloudinary_url,s=Ri(t,"small");return(0,fn.jsxs)("div",{className:"relative group cursor-pointer rounded-xl overflow-hidden shadow-md transition-all duration-200 ".concat(x.has(e.id)?"ring-4 ring-purple-500 ring-offset-2 transform scale-[0.98]":"hover:shadow-xl hover:scale-[1.02]"),onClick:()=>k(e.id),children:[(0,fn.jsx)("div",{className:"aspect-square bg-gray-100",children:(0,fn.jsx)("img",{src:s,alt:e.description||e.filename||"Photo",loading:"lazy",decoding:"async",className:"w-full h-full object-cover",onError:e=>{e.target.style.opacity="0.3"}})}),(0,fn.jsx)("div",{className:"absolute top-2 left-2 w-6 h-6 rounded-full border-2 flex items-center justify-center transition-colors ".concat(x.has(e.id)?"bg-purple-600 border-purple-600":"bg-white bg-opacity-80 border-gray-300 group-hover:border-purple-400"),children:x.has(e.id)&&(0,fn.jsx)(ac,{className:"w-4 h-4 text-white"})}),(0,fn.jsx)("button",{onClick:t=>{t.stopPropagation(),S(e)},className:"absolute top-2 right-2 p-1.5 bg-black bg-opacity-50 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity",children:(0,fn.jsx)(ic,{className:"w-4 h-4 text-white"})}),e.is_primary&&(0,fn.jsx)("div",{className:"absolute bottom-2 left-2 px-2 py-0.5 bg-yellow-500 text-yellow-900 text-xs font-medium rounded",children:"Primary"})]},e.id)})}):(0,fn.jsx)("div",{className:"space-y-2",children:c.map(e=>{const t=e.cloudinary_secure_url||e.cloudinary_url,s=Ri(t,"thumb");return(0,fn.jsxs)("div",{className:"flex items-center p-3 rounded-xl cursor-pointer transition-all ".concat(x.has(e.id)?"bg-purple-50 border-2 border-purple-500":"bg-gray-50 border-2 border-transparent hover:bg-gray-100"),onClick:()=>k(e.id),children:[(0,fn.jsx)("div",{className:"w-6 h-6 rounded-full border-2 flex items-center justify-center mr-4 ".concat(x.has(e.id)?"bg-purple-600 border-purple-600":"border-gray-300"),children:x.has(e.id)&&(0,fn.jsx)(ac,{className:"w-4 h-4 text-white"})}),(0,fn.jsx)("div",{className:"w-16 h-16 rounded-lg overflow-hidden bg-gray-200 mr-4 flex-shrink-0",children:(0,fn.jsx)("img",{src:s,alt:e.description||e.filename||"Photo",loading:"lazy",decoding:"async",className:"w-full h-full object-cover",onError:e=>{e.target.style.opacity="0.3"}})}),(0,fn.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,fn.jsx)("p",{className:"font-medium text-gray-900 truncate",children:e.filename||"Untitled"}),e.description&&(0,fn.jsx)("p",{className:"text-sm text-gray-500 truncate",children:e.description}),(0,fn.jsxs)("p",{className:"text-xs text-gray-400",children:[e.width&&e.height&&"".concat(e.width," x ").concat(e.height),e.format&&" \u2022 ".concat(e.format.toUpperCase())]})]}),(0,fn.jsx)("button",{onClick:t=>{t.stopPropagation(),S(e)},className:"p-2 text-gray-400 hover:text-purple-600 hover:bg-purple-100 rounded-lg transition-colors",children:(0,fn.jsx)(ic,{className:"w-5 h-5"})})]},e.id)})})}),(0,fn.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-t bg-gray-50",children:[(0,fn.jsx)("p",{className:"text-sm text-gray-500",children:x.size>0?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)("span",{className:"font-medium text-purple-600",children:x.size})," photos selected",o&&" of ".concat(o," max")]}):"Click on photos to select them"}),(0,fn.jsxs)("div",{className:"flex space-x-3",children:[(0,fn.jsx)("button",{onClick:s,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),(0,fn.jsxs)("button",{onClick:()=>{const e=c.filter(e=>x.has(e.id));null===l||void 0===l||l(e,Array.from(x)),s()},disabled:0===x.size,className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:["Confirm Selection (",x.size,")"]})]})]})]}),y&&(()=>{const e=y.cloudinary_secure_url||y.cloudinary_url,t=Ri(e,"large"),s=Fi(e);return(0,fn.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-60",onClick:C,children:(0,fn.jsxs)("div",{className:"relative max-w-5xl max-h-[90vh] p-4",children:[(0,fn.jsx)("button",{onClick:C,className:"absolute top-4 right-4 p-2 bg-white bg-opacity-10 rounded-full hover:bg-opacity-20 transition-colors z-10",children:(0,fn.jsx)(nc,{className:"w-6 h-6 text-white"})}),s&&(0,fn.jsx)("div",{className:"absolute inset-4 rounded-lg",style:{backgroundImage:"url(".concat(s,")"),backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat",filter:"blur(20px)",transform:"scale(1.05)"}}),(0,fn.jsx)("img",{src:t,alt:y.description||"Preview",className:"max-w-full max-h-[85vh] object-contain rounded-lg relative z-10",onClick:e=>e.stopPropagation()}),(0,fn.jsxs)("div",{className:"absolute bottom-4 left-4 right-4 flex justify-between items-center z-10",children:[(0,fn.jsxs)("p",{className:"text-white text-sm",children:[y.filename||"Untitled",y.width&&y.height&&" \u2022 ".concat(y.width," x ").concat(y.height)]}),(0,fn.jsxs)("a",{href:e,download:!0,target:"_blank",rel:"noopener noreferrer",className:"flex items-center space-x-2 px-3 py-1.5 bg-white bg-opacity-20 text-white rounded-lg hover:bg-opacity-30 transition-colors",onClick:e=>e.stopPropagation(),children:[(0,fn.jsx)(cc,{className:"w-4 h-4"}),(0,fn.jsx)("span",{children:"Download"})]})]})]})})})()]}):null};var uc=s(634);const mc=["src","alt","size","className","wrapperClassName","style","onClick","threshold","useBlur","fallback","onLoad","onError","fallbackSrc"],hc=["src","alt","onClick","selected","className"],pc=["src","alt","onClick","className"],xc=(0,a.memo)(e=>{let{src:t,alt:s="",size:n="medium",className:r="",wrapperClassName:l="",style:o={},onClick:i,threshold:c=100,useBlur:d=!0,fallback:u=null,onLoad:m,onError:h,fallbackSrc:p}=e,x=Si(e,mc);const[g,f]=(0,a.useState)(!1),[b,y]=(0,a.useState)(()=>Pi(t)),v=t?Ri(t,n):null,j=d&&t?Fi(t):void 0;return g||!v?u||(0,fn.jsx)("div",{className:"bg-gray-200 flex items-center justify-center ".concat(r),style:o,children:(0,fn.jsx)("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,fn.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}):(0,fn.jsx)(uc.LazyLoadImage,He({src:v,alt:s,effect:d?"blur":void 0,placeholderSrc:j,threshold:c,className:r,wrapperClassName:l,style:o,onClick:i,afterLoad:()=>{y(!0),v&&Ti(v),null===m||void 0===m||m()},onError:e=>{f(!0),h&&h(e)}},x))});xc.displayName="OptimizedImage";const gc=xc,fc=(0,a.memo)(e=>{let{src:t,alt:s,onClick:n,selected:a,className:r=""}=e,l=Si(e,hc);return(0,fn.jsxs)("div",{className:"relative overflow-hidden bg-gray-100 cursor-pointer ".concat(a?"ring-2 ring-purple-500":""," ").concat(r),onClick:n,children:[(0,fn.jsx)(xc,He({src:t,alt:s,size:"thumb",className:"w-full h-full object-cover",threshold:200},l)),a&&(0,fn.jsx)("div",{className:"absolute top-1 right-1 w-5 h-5 bg-purple-600 rounded-full flex items-center justify-center",children:(0,fn.jsx)("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,fn.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]})});fc.displayName="OptimizedThumbnail";const bc=(0,a.memo)(e=>{let{src:t,alt:s,onClick:n,className:a=""}=e,r=Si(e,pc);return(0,fn.jsx)(xc,He({src:t,alt:s,size:"medium",className:"w-full h-full object-cover ".concat(a),threshold:300,onClick:n},r))});bc.displayName="OptimizedGalleryImage";const yc=[{id:"all",label:"Full Shoot"},{id:"headshots",label:"Headshots"},{id:"zcard",label:"Z-Card"},{id:"best-pics",label:"Best Pics"}],vc=e=>{let{isOpen:t,onClose:s,photos:n=[],leadId:r,leadName:l,onProceedToPackage:o,initialSelectedIds:i=[],imageLimit:c=null,selectionMode:d=!1,onDeletePhoto:u=null}=e;const[m,h]=(0,a.useState)(n),[p,x]=(0,a.useState)("all"),[g,f]=(0,a.useState)(!1),[b,y]=(0,a.useState)(0),[v,j]=(0,a.useState)(null),[w,N]=(0,a.useState)(!1),[k,S]=(0,a.useState)(new Set(i)),[C,_]=(0,a.useState)(!0),[E]=(0,a.useState)(4e3),[T,P]=(0,a.useState)(!1),[A,D]=(0,a.useState)(!1),[L,M]=(0,a.useState)(!1),R=(0,a.useMemo)(()=>"all"===p?m:m.filter(e=>e.folder_path===p),[m,p]),F=(0,a.useMemo)(()=>{const e={all:m.length};return yc.forEach(t=>{"all"!==t.id&&(e[t.id]=m.filter(e=>e.folder_path===t.id).length)}),e},[m]),I=(0,a.useRef)(null),O=(0,a.useRef)(null),B=(0,a.useRef)(null),U=(0,a.useRef)(null),z=(0,a.useRef)(null);(0,a.useEffect)(()=>{t&&(y(0),j(null),S(new Set(i)),_(!0),P(!1),D(!1),x("all"),h(n))},[t,i,n]),(0,a.useEffect)(()=>{y(0),j(null),P(!1)},[p]),(0,a.useEffect)(()=>{R.length>0&&b>=R.length&&(y(R.length-1),j(null))},[R.length,b]),(0,a.useEffect)(()=>{(async()=>{if(t&&r){z.current=r,f(!0);try{const e=await gn.get("/api/photos",{params:{leadId:r,limit:500,fields:"minimal"}});if(z.current!==r)return void console.log("\ud83d\udcf8 Gallery: Ignoring stale photo response for lead:",r);if(e.data.success&&e.data.photos){const t=e.data.photos;console.log("\ud83d\udcf8 Gallery: Fetched ".concat(t.length," photos for lead ").concat(r)),h(t)}}catch(e){console.error("Error fetching all photos for gallery:",e)}finally{z.current===r&&f(!1)}}})()},[t,r]);const V=(0,a.useMemo)(()=>0!==R.length&&R.every(e=>k.has(e.id)),[R,k]),W=()=>{S(V?e=>{const t=new Set(e);return R.forEach(e=>t.delete(e.id)),t}:e=>{const t=new Set(e),s=R.map(e=>e.id);for(const n of s){if(null!==c&&t.size>=c)break;t.add(n)}return t})},q=V,H=(0,a.useCallback)(async()=>{try{document.fullscreenElement?(await document.exitFullscreen(),M(!1),D(!1)):B.current&&(await B.current.requestFullscreen(),M(!0),D(!0))}catch(ty){console.error("Fullscreen error:",ty)}},[]);(0,a.useEffect)(()=>{const e=()=>{const e=!!document.fullscreenElement;M(e),e||D(!1)};return document.addEventListener("fullscreenchange",e),()=>document.removeEventListener("fullscreenchange",e)},[]),(0,a.useEffect)(()=>{t||(document.fullscreenElement&&document.exitFullscreen().catch(()=>{}),U.current&&(clearTimeout(U.current),U.current=null))},[t]);const Y=(0,a.useCallback)(e=>{if(R[e]){const t=new Image,s=R[e].cloudinary_secure_url||R[e].cloudinary_url;t.src=Ri(s,"large")}},[R]),G=(0,a.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e===b||0===R.length)return;const s=(e%R.length+R.length)%R.length;U.current&&(clearTimeout(U.current),U.current=null),t?(y(s),j(null),N(!1),P(!1)):(N(!0),j(b),y(s),P(!1),Y((s+1)%R.length),U.current=setTimeout(()=>{j(null),N(!1)},500))},[b,R.length,Y]),$=(0,a.useCallback)(()=>{G(b+1)},[b,G]),Q=(0,a.useCallback)(()=>{G(b-1)},[b,G]);(0,a.useEffect)(()=>{if(C&&t&&!(R.length<=1))return O.current=setInterval(()=>{$()},E),()=>{O.current&&clearInterval(O.current)};O.current&&(clearInterval(O.current),O.current=null)},[C,t,R.length,E,$]),(0,a.useEffect)(()=>{if(!t)return;const e=e=>{var t;switch(e.key){case"ArrowLeft":Q(),_(!1);break;case"ArrowRight":$(),_(!1);break;case" ":e.preventDefault(),_(e=>!e);break;case"Escape":A?D(!1):s();break;case"Enter":K(null===(t=R[b])||void 0===t?void 0:t.id);break;case"f":case"F":H();break;case"a":case"A":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),W())}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[t,b,$,Q,s,R,A,W,H]),(0,a.useEffect)(()=>{if(I.current&&R.length>0){const e=I.current,t=e.children[b];if(t){const s=e.offsetWidth,n=t.offsetLeft-s/2+t.offsetWidth/2;e.scrollTo({left:Math.max(0,n),behavior:0===b?"instant":"smooth"})}}},[b,R.length]),(0,a.useEffect)(()=>{t&&I.current&&setTimeout(()=>{I.current&&I.current.scrollTo({left:0,behavior:"instant"})},100)},[t]);const K=e=>{e&&S(t=>{const s=new Set(t);if(s.has(e))s.delete(e);else{if(null!==c&&s.size>=c)return t;s.add(e)}return s})},J=null!==c&&k.size>=c;if(!t)return null;if(0===m.length)return(0,fn.jsx)("div",{ref:B,className:"fixed inset-0 z-50 bg-black flex items-center justify-center",children:(0,fn.jsxs)("div",{className:"text-center",children:[(0,fn.jsx)("p",{className:"text-white/60 text-lg mb-4",children:"No photos available"}),(0,fn.jsx)("button",{onClick:s,className:"text-white/80 hover:text-white",children:"Close"})]})});const X=R[b]||R[0],Z=null!==v?R[v]:null,ee=!!X&&k.has(X.id);return(0,fn.jsxs)("div",{ref:B,className:"fixed inset-0 z-50 bg-black",children:[(0,fn.jsx)("div",{className:"absolute top-0 left-0 right-0 z-20 bg-gradient-to-b from-black/80 to-transparent p-4 transition-all duration-300 ".concat(A?"opacity-0 pointer-events-none":"opacity-100"),children:(0,fn.jsxs)("div",{className:"flex items-center justify-between max-w-7xl mx-auto",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,fn.jsx)("h2",{className:"text-white text-xl font-light tracking-wide",children:l}),(0,fn.jsxs)("span",{className:"text-white/40 text-sm font-light",children:[b+1," / ",R.length]}),g&&(0,fn.jsx)(Ur,{className:"w-4 h-4 text-white/40 animate-spin"})]}),(0,fn.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,fn.jsx)("button",{onClick:W,className:"text-white/60 hover:text-white px-3 py-2 transition-colors text-sm font-light tracking-wide",children:q?"Deselect All":"Select All"}),d&&null!==c&&(0,fn.jsxs)("span",{className:"text-sm font-light tracking-wide px-3 py-1 ".concat(J?"text-white bg-white/10":"text-white/40"),children:[k.size,"/",c]}),(!d||null===c)&&k.size>0&&(0,fn.jsxs)("span",{className:"text-white/60 text-sm font-light",children:[k.size," selected"]}),(0,fn.jsx)("button",{onClick:()=>_(!C),className:"text-white/40 hover:text-white p-2 transition-colors",children:C?(0,fn.jsx)(Kr,{className:"w-5 h-5"}):(0,fn.jsx)(Xr,{className:"w-5 h-5"})}),(0,fn.jsx)("button",{onClick:H,className:"text-white/40 hover:text-white p-2 transition-colors",children:L?(0,fn.jsx)($r,{className:"w-5 h-5"}):(0,fn.jsx)(Hr,{className:"w-5 h-5"})}),(0,fn.jsx)("button",{onClick:s,className:"text-white/40 hover:text-white p-2 transition-colors",children:(0,fn.jsx)(jl,{className:"w-5 h-5"})})]})]})}),(0,fn.jsx)("div",{className:"absolute left-0 top-1/2 -translate-y-1/2 z-20 transition-all duration-500 ".concat(A?"opacity-0 pointer-events-none -translate-x-full":"opacity-100"),children:(0,fn.jsx)("nav",{className:"py-4 pl-6 pr-12",children:yc.map(e=>{const t=F[e.id]||0,s=p===e.id;return"all"!==e.id&&0===t?null:(0,fn.jsxs)("button",{onClick:()=>x(e.id),className:"block w-full text-left py-2.5 transition-all duration-300 group ".concat(s?"pl-4 border-l border-white":"pl-4 border-l border-transparent hover:border-white/30"),children:[(0,fn.jsx)("span",{className:"text-sm tracking-wider transition-all duration-300 ".concat(s?"text-white font-normal":"text-white/30 group-hover:text-white/70 font-light"),children:e.label}),t>0&&(0,fn.jsx)("span",{className:"ml-2 text-xs transition-all duration-300 ".concat(s?"text-white/50":"text-white/20"),children:t})]},e.id)})})}),(0,fn.jsx)("div",{className:"absolute inset-0 flex items-center justify-center transition-all duration-300 ".concat(A?"px-4 py-4":"px-20 py-24"),children:R.length>0&&X?(0,fn.jsxs)(fn.Fragment,{children:[Z&&(0,fn.jsx)("div",{className:"slideshow-image previous",children:(0,fn.jsx)("img",{src:Ri(Z.cloudinary_secure_url||Z.cloudinary_url,"large"),alt:"",className:"max-w-full max-h-full object-contain"})}),(0,fn.jsxs)("div",{className:"slideshow-image ".concat(T?"active":""),children:[!T&&(0,fn.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",style:{backgroundImage:"url(".concat(Fi(X.cloudinary_secure_url||X.cloudinary_url),")"),backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat",filter:"blur(20px)",transform:"scale(1.1)"}}),(0,fn.jsx)("img",{src:Ri(X.cloudinary_secure_url||X.cloudinary_url,"large"),alt:X.description||"Photo ".concat(b+1),className:"max-w-full max-h-full object-contain relative z-10",onLoad:()=>P(!0)})]}),ee&&(0,fn.jsx)("div",{className:"absolute top-28 right-24 transition-all duration-300 ".concat(A?"opacity-0":"opacity-100"),children:(0,fn.jsx)("div",{className:"w-12 h-12 rounded-full bg-purple-600 flex items-center justify-center shadow-lg animate-pulse",children:(0,fn.jsx)(gr,{className:"w-6 h-6 text-white"})})})]}):(0,fn.jsx)("p",{className:"text-white/40 font-light tracking-wide",children:"No photos in this folder"})}),R.length>1&&(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)("button",{onClick:()=>{Q(),_(!1)},className:"absolute top-1/2 -translate-y-1/2 z-30 text-white/20 hover:text-white p-4 transition-all hover:scale-110 ".concat(A?"opacity-30 hover:opacity-100":"opacity-100"),style:{left:"160px"},children:(0,fn.jsx)(br,{className:"w-8 h-8"})}),(0,fn.jsx)("button",{onClick:()=>{$(),_(!1)},className:"absolute right-8 top-1/2 -translate-y-1/2 z-30 text-white/20 hover:text-white p-4 transition-all hover:scale-110 ".concat(A?"opacity-30 hover:opacity-100":"opacity-100"),children:(0,fn.jsx)(yr,{className:"w-8 h-8"})})]}),R.length>0&&X&&(0,fn.jsx)("div",{className:"absolute bottom-36 left-1/2 -translate-x-1/2 z-20 transition-all duration-300 ".concat(A?"opacity-0 pointer-events-none":"opacity-100"),children:(0,fn.jsx)("button",{onClick:()=>K(null===X||void 0===X?void 0:X.id),disabled:!ee&&J,className:"flex items-center space-x-3 px-8 py-4 rounded-full text-lg font-semibold transition-all transform shadow-xl ".concat(ee?"bg-purple-600 text-white hover:scale-105":J?"bg-gray-400 text-white cursor-not-allowed":"bg-white text-gray-900 hover:bg-purple-50 hover:scale-105"),children:ee?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(gr,{className:"w-6 h-6"}),(0,fn.jsx)("span",{children:"Selected"})]}):J?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(Fr,{className:"w-6 h-6"}),(0,fn.jsx)("span",{children:"Limit Reached"})]}):(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(Zr,{className:"w-6 h-6"}),(0,fn.jsx)("span",{children:"Add to Selection"})]})})}),(0,fn.jsx)("div",{className:"absolute bottom-0 left-0 right-0 z-20 transition-all duration-500 ".concat(A?"opacity-0 pointer-events-none translate-y-full":"opacity-100 translate-y-0"),children:(0,fn.jsx)("div",{className:"bg-gradient-to-t from-black via-black/80 to-transparent pt-8 pb-4 px-4",children:(0,fn.jsx)("div",{ref:I,className:"flex space-x-2 overflow-x-auto scrollbar-hide px-4",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:R.map((e,t)=>{const s=e.cloudinary_secure_url||e.cloudinary_url,n=t===b,a=k.has(e.id);return(0,fn.jsxs)("button",{onClick:()=>{G(t,!0),_(!1)},className:"group/thumb relative flex-shrink-0 w-16 h-16 overflow-hidden transition-all duration-300 ".concat(n?"ring-2 ring-white opacity-100":a?"ring-2 ring-purple-500 opacity-100":"opacity-30 hover:opacity-60"),children:[(0,fn.jsx)(gc,{src:s,alt:"".concat(t+1),size:"thumb",className:"w-full h-full object-cover",useBlur:!0,threshold:200}),a&&(0,fn.jsx)("div",{className:"absolute top-1 right-1 bg-purple-600 rounded-full p-0.5 z-10",children:(0,fn.jsx)(gr,{className:"w-3 h-3 text-white"})}),u&&(0,fn.jsx)("button",{onClick:t=>{t.stopPropagation(),(async(e,t)=>{u&&(await u(e,t),h(t=>t.filter(t=>t.id!==e)),S(t=>{const s=new Set(t);return s.delete(e),s}))})(e.id,t)},className:"absolute top-0.5 left-0.5 p-0.5 bg-red-500 text-white rounded-full opacity-0 group-hover/thumb:opacity-100 transition-opacity z-20 hover:bg-red-600",title:"Delete photo",children:(0,fn.jsx)(cl,{className:"w-2.5 h-2.5"})})]},e.id)})})})}),k.size>0&&(0,fn.jsx)("div",{className:"absolute bottom-28 right-8 z-20 transition-all duration-300 ".concat(A?"opacity-0 pointer-events-none":"opacity-100"),children:(0,fn.jsx)("button",{onClick:()=>{const e=m.filter(e=>k.has(e.id)),t=Array.from(k);o(t,e)},className:"flex items-center space-x-3 text-white px-8 py-4 rounded-full text-lg font-semibold shadow-xl hover:shadow-2xl transition-all transform hover:scale-105 ".concat(d?"bg-gradient-to-r from-green-600 to-emerald-600":"bg-gradient-to-r from-purple-600 to-indigo-600"),children:d?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(gr,{className:"w-6 h-6"}),(0,fn.jsxs)("span",{children:["Confirm Selection (",k.size,c?"/".concat(c):""," photos)"]})]}):(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(ll,{className:"w-6 h-6"}),(0,fn.jsxs)("span",{children:["Select Package (",k.size," photos)"]})]})})}),C&&(0,fn.jsxs)("div",{className:"absolute bottom-28 left-8 z-20 flex items-center space-x-2 text-white/30 transition-all duration-300 ".concat(A?"opacity-0":"opacity-100"),children:[(0,fn.jsx)("div",{className:"w-1.5 h-1.5 bg-white/50 rounded-full animate-pulse"}),(0,fn.jsx)("span",{className:"text-xs font-light tracking-wider",children:"Auto"})]}),L&&(0,fn.jsx)("div",{className:"absolute top-4 right-4 z-30 text-white/20 text-xs cursor-pointer hover:text-white/60 transition-colors tracking-wider font-light",onClick:H,children:"ESC to exit"})]})},jc=tc("presentation",[["path",{d:"M2 3h20",key:"91anmk"}],["path",{d:"M21 3v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V3",key:"2k9sn8"}],["path",{d:"m7 21 5-5 5 5",key:"bip4we"}]]),wc=()=>{var e,t,s,n,r;const{id:l}=J(),o=K(),i=$(),{user:c}=wn(),[d,u]=(0,a.useState)(null),[m,h]=(0,a.useState)(!0),[p,x]=(0,a.useState)(""),[g,f]=(0,a.useState)(!1),[b,y]=(0,a.useState)({}),[v,j]=(0,a.useState)([]),[w,N]=(0,a.useState)(0),[k,S]=(0,a.useState)(!1),[C,_]=(0,a.useState)({statusFilter:"all",searchTerm:"",filteredLeads:[],dateFilter:"all",customDateStart:"",customDateEnd:"",assigned_at_start:null,assigned_at_end:null}),[E,T]=(0,a.useState)(""),[P,A]=(0,a.useState)(""),[D,L]=(0,a.useState)([]),[M,R]=(0,a.useState)([]),[F,I]=(0,a.useState)(!1),[O,B]=(0,a.useState)(!1),[U,z]=(0,a.useState)([]),[V,W]=(0,a.useState)(!1),[q,H]=(0,a.useState)([]),[Y,G]=(0,a.useState)([]),[Q,X]=(0,a.useState)(null),[Z,ee]=(0,a.useState)(!1),[te,se]=(0,a.useState)(""),[ne,ae]=(0,a.useState)(""),[re,le]=(0,a.useState)(new Set),[oe,ie]=(0,a.useState)(null),[ce,de]=(0,a.useState)([]),[ue,me]=(0,a.useState)([]),[he,pe]=(0,a.useState)(!1),[xe,ge]=(0,a.useState)(!1),[fe,be]=(0,a.useState)([]),[ye,ve]=(0,a.useState)(!1),[je,we]=(0,a.useState)(""),[Ne,ke]=(0,a.useState)("sms"),Se=e=>{e&&(e.style.height="auto",e.style.height=Math.min(e.scrollHeight,500)+"px")},[Ce,_e]=(0,a.useState)(!1),[Ee,Te]=(0,a.useState)("Duplicated"),[Pe,Ae]=(0,a.useState)(!1),[De,Le]=(0,a.useState)(!1),Me=[{_id:"welcome",name:"Welcome Message",message:"Hi [NAME], thanks for your interest! We'll contact you shortly to confirm your photoshoot booking."},{_id:"reminder",name:"Reminder Message",message:"Hi [NAME], just a reminder about your modelling photoshoot on [DATE] at [TIME]."},{_id:"followup",name:"Follow-up Message",message:"Hi [NAME], we noticed you haven't confirmed your session. Let us know if you're still interested!"}],Re=[{_id:"welcome",name:"Welcome Email",subject:"Welcome to our Modelling Studio - [NAME]",message:"Dear [NAME],\n\nThank you for your interest in our modelling services! We're excited to work with you.\n\nWe'll be in touch shortly to confirm your photoshoot booking and discuss the details.\n\nIf you have any questions in the meantime, please don't hesitate to reach out.\n\nBest regards,\nThe Studio Team"},{_id:"reminder",name:"Reminder Email",subject:"Reminder: Your Photoshoot on [DATE]",message:"Dear [NAME],\n\nThis is a friendly reminder about your upcoming modelling photoshoot scheduled for [DATE] at [TIME].\n\nPlease ensure you arrive 15 minutes early and bring any items we discussed.\n\nLooking forward to working with you!\n\nBest regards,\nThe Studio Team"},{_id:"followup",name:"Follow-up Email",subject:"Following up on your Modelling Session - [NAME]",message:"Dear [NAME],\n\nWe noticed that you haven't confirmed your modelling session yet.\n\nWe're still very interested in working with you and would love to schedule your photoshoot.\n\nPlease let us know if you're still interested or if you have any questions.\n\nBest regards,\nThe Studio Team"},{_id:"booking_confirmation",name:"Booking Confirmation",subject:"Booking Confirmed - Your Photoshoot on [DATE]",message:"Dear [NAME],\n\nGreat news! Your photoshoot has been confirmed for [DATE] at [TIME].\n\nLocation: Our Studio\nDuration: Approximately 2 hours\n\nPlease bring:\n- A variety of outfits\n- Any specific props or accessories\n- A positive attitude!\n\nWe can't wait to work with you!\n\nBest regards,\nThe Studio Team"}],Fe=e=>{const t={"No Answer Templates":["no_answer"],"Invitation Templates":["invitation_email"]},s={"No Answer Templates":[],"Invitation Templates":[]};return e.forEach(e=>{let n=!1;for(const[a,r]of Object.entries(t))if(r.includes(e.type)){s[a].push(e),n=!0;break}n||s["Invitation Templates"].push(e)}),s},Ie=e=>["no_answer","invitation_email"].includes(e.type),Oe=(0,a.useCallback)(async()=>{if(v.length<=1)return;const e=w,t=[];e>0&&t.push(v[e-1]),e<v.length-1&&t.push(v[e+1]);const s=t.map(e=>e.image_url).filter(e=>e&&""!==e).map(e=>Ai(e,"optimized"));if(0!==s.length)try{console.log("\ud83d\uddbc\ufe0f Preloading adjacent lead images:",s),await(async e=>{const t=e.filter(e=>e&&""!==e);if(0===t.length)return[];try{const e=await Promise.allSettled(t.map(e=>Di(e)));return e.filter(e=>"fulfilled"===e.status).map(e=>e.value)}catch(p){return console.warn("Some images failed to preload:",p),[]}})(s),le(e=>{const t=new Set(e);return s.forEach(e=>t.add(e)),t})}catch(p){console.warn("\u26a0\ufe0f Failed to preload some images:",p)}},[v,w]),Be=(0,a.useCallback)(async()=>{try{var e,t,s,n,a;const r=(null===(e=i.state)||void 0===e?void 0:e.statusFilter)||C.statusFilter,o=(null===(t=i.state)||void 0===t?void 0:t.searchTerm)||C.searchTerm,c=(null===(s=i.state)||void 0===s?void 0:s.assigned_at_start)||C.assigned_at_start,d=(null===(n=i.state)||void 0===n?void 0:n.assigned_at_end)||C.assigned_at_end,u={};r&&"all"!==r&&(u.status=r),o&&(u.search=o),c&&d&&(u.assigned_at_start=c,u.assigned_at_end=d);const m=[];let h=1,p=!0;const x=100;for(;p;){u.page=h,u.limit=x;const e=await gn.get("/api/leads",{params:u}),t=e.data.leads||e.data||[];if(0===t.length)p=!1;else{m.push(...t);h>=(e.data.totalPages||1)||t.length<x?p=!1:h++}}console.log("\u2705 Fetched ".concat(m.length," total leads for navigation (status: ").concat(r||"all",")"));const g=(null===(a=i.state)||void 0===a?void 0:a.filteredLeads)||C.filteredLeads,f=(null===g||void 0===g?void 0:g.length)>0?g:m;j(f),r===C.statusFilter&&o===C.searchTerm&&c===C.assigned_at_start||_(e=>He(He({},e),{},{statusFilter:r||"all",searchTerm:o||"",filteredLeads:f,assigned_at_start:c||null,assigned_at_end:d||null}));const b=f.findIndex(e=>e.id===l||e.id.toString()===l||e.id===l.toString());N(-1!==b?b:0)}catch(p){console.error("Error fetching all leads:",p),x("Failed to fetch leads. Please try again."),j([]),N(0)}},[l,C,i.state]),Ue=(0,a.useCallback)(async()=>{try{const e=await gn.get("/api/templates?bookersOnly=true"),t=e.data.map(e=>He(He({},e),{},{_id:e.id||e._id})).filter(Ie);L(t.filter(e=>e.smsBody||e.sendSMS)),R(t.filter(e=>e.emailBody||e.sendEmail))}catch(p){console.error("Error fetching templates:",p),L(Me),R(Re)}},[]),ze=(0,a.useCallback)(async()=>{if(l){console.log("\ud83d\udce5 Fetching lead data for ID:",l),h(!0);try{const e=await gn.get("/api/leads/".concat(l));console.log("\u2705 Lead data fetched:",e.data.name),u(e.data),y(e.data),x("")}catch(p){console.error("\u274c Error fetching lead:",p),x("Failed to fetch lead details. Please try again."),u(null),y({})}finally{h(!1),S(!1)}}else console.log("\u26a0\ufe0f No ID provided for fetchLead")},[l]),Ve=(0,a.useCallback)(async()=>{if(l)try{const e=await gn.get("/api/sales/by-lead/".concat(l));ie(e.data)}catch(p){var e,t;404===(null===(e=p.response)||void 0===e?void 0:e.status)||200===(null===(t=p.response)||void 0===t?void 0:t.status)||console.warn("\u26a0\ufe0f Error fetching sale:",p.message),ie(null)}},[l]),We=(0,a.useCallback)(async()=>{if(l)try{pe(!0);const e=await gn.get("/api/leads/".concat(l,"/history"));de(e.data.bookingHistory||[])}catch(p){console.error("Error fetching booking history:",p),de([])}finally{pe(!1)}},[l]),qe=(0,a.useCallback)(async()=>{if(l)try{const e=await gn.get("/api/leads/".concat(l,"/callbacks"));me(e.data||[])}catch(p){console.error("Error fetching upcoming callbacks:",p),me([])}},[l]),Ye=(0,a.useCallback)(async()=>{if(l)try{const e=await gn.get("/api/photos",{params:{leadId:l,limit:50,fields:"minimal"}});e.data.success&&z(e.data.photos||[])}catch(p){console.error("Error fetching photos:",p),z([])}},[l]),Ge=(0,a.useCallback)(async()=>{if(d&&xe)try{if(ve(!0),d.booking_history){const e=("string"===typeof d.booking_history?JSON.parse(d.booking_history):d.booking_history).filter(e=>["SMS_SENT","SMS_RECEIVED","EMAIL_SENT","EMAIL_RECEIVED"].includes(e.action)).sort((e,t)=>new Date(e.timestamp)-new Date(t.timestamp));be(e)}else be([])}catch(p){console.error("Error fetching conversation history:",p),be([])}finally{ve(!1)}},[d,xe]),$e=(0,a.useRef)(!1),Qe=(0,a.useRef)(null),Ke=(0,a.useRef)(!0),Je=(0,a.useRef)(null);(0,a.useEffect)(()=>{$e.current=!1,Qe.current=null,Ke.current=!0},[l]),(0,a.useEffect)(()=>()=>{Li.clear()},[]),(0,a.useEffect)(()=>{if(v.length>0&&w>=0){if(w>0){const e=v[w-1];null!==e&&void 0!==e&&e.image_url&&Mi(e.image_url,5).catch(()=>{})}if(w<v.length-1){const e=v[w+1];null!==e&&void 0!==e&&e.image_url&&Mi(e.image_url,5).catch(()=>{})}}},[v,w]),(0,a.useEffect)(()=>{const e=i.pathname==="/leads/".concat(l);if(!l||!e)return void(e||($e.current=!1,Qe.current=null,Je.current=null));const t=JSON.stringify(i.state)!==JSON.stringify(Qe.current);if(!$e.current||t){if(console.log("\ud83d\udd0d LeadDetail: Component initialized",{id:l,hasState:!!i.state}),i.state){const{statusFilter:e,searchTerm:t,filteredLeads:s,dateFilter:n,customDateStart:a,customDateEnd:r,assigned_at_start:o,assigned_at_end:c}=i.state;if(console.log("\ud83d\udd0d LeadDetail: Setting up navigation context",{statusFilter:e,searchTerm:t,hasFilteredLeads:!(null===s||void 0===s||!s.length),dateFilter:n,assigned_at_start:o,assigned_at_end:c}),_({statusFilter:e||"all",searchTerm:t||"",filteredLeads:s||[],dateFilter:n||"all",customDateStart:a||"",customDateEnd:r||"",assigned_at_start:o||null,assigned_at_end:c||null}),s&&s.length>0){j(s);const e=s.findIndex(e=>e.id===l);N(-1!==e?e:0),console.log("\ud83d\udccd LeadDetail: Navigation context ready, index:",e)}}$e.current=!0,Qe.current=i.state}},[l,i.pathname,i.state,v.length,Be]),(0,a.useEffect)(()=>{0===v.length&&l&&(console.log("\ud83d\udce5 LeadDetail: Fetching leads for navigation (no state provided)"),Be())},[l,v.length,Be]),(0,a.useEffect)(()=>{const e=()=>{console.log("\ud83d\udd19 Browser navigation detected, resetting refs"),$e.current=!1,Qe.current=null};return window.addEventListener("popstate",e),()=>{window.removeEventListener("popstate",e)}},[]),(0,a.useEffect)(()=>{l&&Je.current!==l&&(console.log("\ud83d\udce5 LeadDetail: Fetching initial data for lead:",l),Je.current=l,H([]),G([]),z([]),ze(),Ue(),Ve(),We(),qe(),Ye())},[l,ze,Ue,Ve,We,qe,Ye]),(0,a.useEffect)(()=>{if(l&&v.length>0){const e=v.findIndex(e=>e.id===l);-1!==e&&e!==w&&(N(e),console.log("\ud83d\udd04 LeadDetail: Updated index for existing lead:",e))}},[l,v,w]),(0,a.useEffect)(()=>{v.length>0&&Oe()},[v,w,Oe]),(0,a.useEffect)(()=>{xe&&d&&Ge()},[xe,d,Ge]),(0,a.useEffect)(()=>{je&&xe&&setTimeout(()=>{const e=document.querySelector('textarea[placeholder*="reply"]');Se(e)},0)},[je,Ne,xe]);const Xe=e=>{const{name:t,value:s}=e.target;y(e=>He(He({},e),{},{[t]:s}))},Ze=()=>w>0&&v.length>0,et=()=>w<v.length-1&&v.length>0,tt=e=>{const t=new Date(d.dateBooked).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"}),s=new Date(d.dateBooked).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});return e.replace(/\[NAME\]/g,d.name).replace(/\[DATE\]/g,t).replace(/\[TIME\]/g,s)},st=async(e,t)=>{try{await gn.post("/api/leads/".concat(l,"/history"),{action:e,details:t,timestamp:(new Date).toISOString()}),We()}catch(p){console.error("Error adding history entry:",p)}},nt=e=>{let{leadId:t,lead:s,onStatusUpdate:n}=e;const[r,l]=(0,a.useState)(""),[c,d]=(0,a.useState)(!1),[u,m]=(0,a.useState)(""),[h,p]=(0,a.useState)(!1),[x,g]=(0,a.useState)(!1),[f,b]=(0,a.useState)(""),[y,v]=(0,a.useState)(""),[j,w]=(0,a.useState)(null),[N,k]=(0,a.useState)(!1),[S,C]=(0,a.useState)(!1),[_,E]=(0,a.useState)(0);(0,a.useEffect)(()=>{if(s&&s.booking_history)try{const e="string"===typeof s.booking_history?JSON.parse(s.booking_history):s.booking_history;if(Array.isArray(e)){const t=e.filter(e=>{var t;return"CALL_STATUS_UPDATE"===e.action&&(null===(t=e.details)||void 0===t?void 0:t.callStatus)&&("No answer"===e.details.callStatus||"No Answer x2"===e.details.callStatus||"No Answer x3"===e.details.callStatus)}),s=t.length>0;C(s),E(t.length)}}catch(ey){console.warn("Error parsing booking_history:",ey)}},[s]);const T=[{value:"No answer",label:"No answer",trigger:"email"},{value:"Left Message",label:"Left Message",trigger:"email"},{value:"Not interested",label:"Not interested",trigger:"close"},{value:"Call back",label:"Call back",trigger:"callback"},{value:"Wrong number",label:"Wrong number",trigger:"close"},{value:"Sales/converted - purchased",label:"Sales/converted - purchased",trigger:"callback"},{value:"Not Qualified",label:"Not Qualified",trigger:"close"}],P=(0,a.useMemo)(()=>{const e=[...T];if(S){const t=e.findIndex(e=>"No answer"===e.value);-1!==t&&e.splice(t+1,0,{value:"No Answer x2",label:"No Answer x2",trigger:null},{value:"No Answer x3",label:"No Answer x3",trigger:null})}return e},[S]);(0,a.useEffect)(()=>{if(s){let e=null;if(s.custom_fields)try{const t="string"===typeof s.custom_fields?JSON.parse(s.custom_fields):s.custom_fields;e=(null===t||void 0===t?void 0:t.call_status)||null}catch(ey){console.warn("Error parsing custom_fields for call_status:",ey)}s.call_status&&(e=s.call_status),e||"Wrong number"!==s.status||(e="Wrong number"),l(e||"")}},[s]);const A=async function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";d(!0),m("");try{const r=await gn.patch("/api/leads/".concat(t,"/call-status"),{callStatus:e,callbackTime:s,callbackNote:a});if(r.data.success){l(e),n&&n(e,r.data);const t={"No answer":"No answer","No Answer x2":"No answer","No Answer x3":"No answer","Left Message":"Left Message","Not interested":"Not interested","Call back":"Call back","Wrong number":"Wrong Number","Sales/converted - purchased":"Sales/converted - purchased","Not Qualified":"Not Qualified"}[e]||"all",a=P.find(t=>t.value===e);if(a)switch(a.trigger){case"email":alert("Status updated. An automatic email will be sent to the client. Redirecting to leads page...");break;case"close":alert("Status updated. This lead will be closed. Redirecting to leads page...");break;case"callback":s&&alert("Status updated. Callback scheduled for ".concat(s,". You'll receive a reminder notification. Redirecting to leads page..."))}setTimeout(()=>{var e;const s=(null===(e=i.state)||void 0===e?void 0:e.currentPage)||parseInt(sessionStorage.getItem("leadsPage")||"1",10);sessionStorage.setItem("leadsPage",s.toString()),o("/leads",{state:{statusFilter:t,currentPage:s},replace:!1})},500)}else m(r.data.message||"Failed to update status")}catch(ty){var r,c;console.error("Error updating call status:",ty),m((null===(r=ty.response)||void 0===r||null===(c=r.data)||void 0===c?void 0:c.message)||"Failed to update status")}finally{d(!1),g(!1),w(null),b(""),v("")}},D=()=>{const e=yi(),t=String(e.getHours()).padStart(2,"0"),s=String(e.getMinutes()).padStart(2,"0");return"".concat(t,":").concat(s)};(0,a.useEffect)(()=>{x&&!f&&b(D())},[x]);return(0,fn.jsxs)("div",{className:"mt-4 bg-gradient-to-r from-purple-50 to-indigo-50 rounded-xl p-6 border border-purple-200 shadow-sm",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,fn.jsx)("div",{className:"p-2 bg-purple-100 rounded-lg",children:(0,fn.jsx)(fr,{className:"h-5 w-5 text-purple-600"})}),(0,fn.jsxs)("div",{className:"flex-1",children:[(0,fn.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Lead Status"}),(0,fn.jsx)("p",{className:"text-sm text-gray-600",children:"Select the status after placing a call"})]})]}),u&&(0,fn.jsx)("div",{className:"mb-4 p-3 bg-red-100 border border-red-300 rounded-lg",children:(0,fn.jsx)("p",{className:"text-sm text-red-700",children:u})}),(0,fn.jsxs)("div",{className:"relative",children:[(0,fn.jsxs)("button",{onClick:()=>!c&&p(!h),disabled:c,className:"\n              w-full px-4 py-3 rounded-lg border-2 text-left font-medium\n              flex items-center justify-between\n              transition-all duration-200\n              ".concat(r?"".concat((e=>{switch(e){case"No answer":case"No Answer x2":case"No Answer x3":case"Left Message":return"bg-yellow-100 text-yellow-800 border-yellow-300";case"Call back":case"Sales/converted - purchased":return"bg-blue-100 text-blue-800 border-blue-300";case"Not interested":case"Not Qualified":case"Wrong number":return"bg-red-100 text-red-800 border-red-300";default:return"bg-gray-100 text-gray-800 border-gray-300"}})(r)," border-current"):"bg-white border-gray-300 text-gray-700 hover:border-purple-400","\n              ").concat(c?"opacity-50 cursor-not-allowed":"cursor-pointer hover:shadow-md","\n            "),children:[(0,fn.jsx)("span",{children:r||"Select status..."}),(0,fn.jsx)(fr,{className:"h-5 w-5 transition-transform ".concat(h?"transform rotate-180":"")})]}),h&&(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)("div",{className:"fixed inset-0 z-10",onClick:()=>p(!1)}),(0,fn.jsx)("div",{className:"absolute z-20 w-full mt-2 bg-white border border-gray-200 rounded-lg shadow-lg max-h-64 overflow-y-auto",children:P.map(e=>(0,fn.jsxs)("button",{onClick:()=>(async e=>{if(!c)return p(!1),"Call back"===e?(w(e),void g(!0)):"No answer"===e?(w(e),void k(!0)):void await A(e)})(e.value),className:"\n                      w-full px-4 py-3 text-left hover:bg-gray-50 transition-colors\n                      flex items-center justify-between\n                      ".concat(r===e.value?"bg-purple-50":"","\n                      ").concat(c?"opacity-50 cursor-not-allowed":"cursor-pointer","\n                    "),disabled:c,children:[(0,fn.jsx)("span",{className:"font-medium",children:e.label}),r===e.value&&(0,fn.jsx)(gr,{className:"h-5 w-5 text-purple-600"})]},e.value))})]})]}),r&&(0,fn.jsxs)("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,fn.jsxs)("p",{className:"text-sm text-blue-800",children:[(0,fn.jsx)("strong",{children:"Current Status:"})," ",r]}),(()=>{const e=P.find(e=>e.value===r);if(e)switch(e.trigger){case"email":return(0,fn.jsx)("p",{className:"text-xs text-blue-600 mt-1",children:"An automatic email will be sent to the client."});case"close":return(0,fn.jsx)("p",{className:"text-xs text-blue-600 mt-1",children:"This lead will be closed."});case"callback":return(0,fn.jsx)("p",{className:"text-xs text-blue-600 mt-1",children:"Please call the client back."});default:return null}return null})()]}),c&&(0,fn.jsx)("div",{className:"mt-4 text-center",children:(0,fn.jsx)("p",{className:"text-sm text-gray-500",children:"Updating status..."})}),N&&(0,fn.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,fn.jsxs)("div",{className:"bg-white rounded-xl shadow-xl p-6 w-full max-w-md mx-4",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,fn.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Send No Answer Email?"}),(0,fn.jsx)("button",{onClick:()=>{k(!1),w(null)},className:"text-gray-400 hover:text-gray-600",children:(0,fn.jsx)(jl,{className:"h-5 w-5"})})]}),(0,fn.jsxs)("p",{className:"text-sm text-gray-600 mb-6",children:['Do you want to send your "No Answer" template email to ',(0,fn.jsx)("strong",{children:null===s||void 0===s?void 0:s.name}),"?"]}),u&&(0,fn.jsx)("div",{className:"mb-4 p-3 bg-red-100 border border-red-300 rounded-lg",children:(0,fn.jsx)("p",{className:"text-sm text-red-700",children:u})}),(0,fn.jsxs)("div",{className:"flex space-x-3",children:[(0,fn.jsx)("button",{onClick:async()=>{await A(j),k(!1)},disabled:c,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Yes, Send Email"}),(0,fn.jsx)("button",{onClick:()=>{k(!1),w(null)},className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancel"})]})]})}),x&&(0,fn.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,fn.jsxs)("div",{className:"bg-white rounded-xl shadow-xl p-6 w-full max-w-md mx-4",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,fn.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Schedule Callback"}),(0,fn.jsx)("button",{onClick:()=>{g(!1),w(null),b(""),v("")},className:"text-gray-400 hover:text-gray-600",children:(0,fn.jsx)(jl,{className:"h-5 w-5"})})]}),(0,fn.jsxs)("div",{className:"space-y-4",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Callback Time (UK Time)"}),(0,fn.jsx)("input",{type:"time",value:f||D(),onChange:e=>b(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-purple-500",required:!0}),(0,fn.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"You'll receive a notification at this time to call back"})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Note (Optional)"}),(0,fn.jsx)("textarea",{value:y,onChange:e=>v(e.target.value),placeholder:"e.g., back 5pm, discuss pricing, follow up on quote",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-purple-500",rows:"3"})]}),u&&(0,fn.jsx)("div",{className:"p-3 bg-red-100 border border-red-300 rounded-lg",children:(0,fn.jsx)("p",{className:"text-sm text-red-700",children:u})}),(0,fn.jsxs)("div",{className:"flex space-x-3",children:[(0,fn.jsxs)("button",{onClick:()=>{f?A(j,f,y):m("Please select a callback time")},disabled:c||!f,className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2",children:[(0,fn.jsx)(wr,{className:"h-4 w-4"}),(0,fn.jsx)("span",{children:"Schedule Callback"})]}),(0,fn.jsx)("button",{onClick:()=>{g(!1),w(null),b(""),v("")},className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancel"})]})]})]})})]})};return m||k?(0,fn.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,fn.jsxs)("div",{className:"text-center",children:[(0,fn.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),(0,fn.jsx)("p",{className:"text-gray-600",children:k?"Loading next lead...":"Loading lead details..."})]})}):p?(0,fn.jsxs)("div",{className:"text-center py-12",children:[(0,fn.jsx)("p",{className:"text-red-500 mb-4",children:p}),(0,fn.jsx)("button",{onClick:()=>{x(""),ze()},className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Retry"})]}):d?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsxs)("div",{className:"relative min-h-screen bg-gray-50",children:[oe&&void 0!==oe.saleAmount&&(0,fn.jsx)("div",{className:"w-full flex justify-center items-center py-4",children:(0,fn.jsxs)("div",{className:"bg-green-100 border border-green-300 rounded-lg px-6 py-3 shadow text-2xl font-bold text-green-800",children:["Amount Spent: \xa3",Number(oe.saleAmount).toFixed(2)]})}),(0,fn.jsxs)("div",{className:"max-w-7xl mx-auto space-y-6",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,fn.jsx)("button",{onClick:()=>{var e;const t=(null===(e=i.state)||void 0===e?void 0:e.currentPage)||parseInt(sessionStorage.getItem("leadsPage")||"1",10);sessionStorage.setItem("leadsPage",t.toString()),o("/leads",{state:{statusFilter:C.statusFilter,searchTerm:C.searchTerm,currentPage:t}})},className:"p-2 rounded-md text-gray-400 hover:text-gray-600",children:(0,fn.jsx)(or,{className:"h-5 w-5"})}),(0,fn.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:"Lead Details"}),v.length>0&&(0,fn.jsxs)("span",{className:"text-sm text-gray-500",children:[w+1," of ",v.length,(0,fn.jsxs)("span",{className:"ml-2 text-xs text-gray-400",children:["(filter: ",C.statusFilter,', search: "',C.searchTerm,'")']})]})]}),(0,fn.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,fn.jsx)("button",{onClick:()=>{if(w>0&&v.length>0){var e;const t=v[w-1];console.log("\u2b05\ufe0f Navigating to previous lead:",t.name,"ID:",t.id),S(!0),u(null),o("/leads/".concat(t.id),{replace:!0,state:{statusFilter:C.statusFilter,searchTerm:C.searchTerm,dateFilter:C.dateFilter,customDateStart:C.customDateStart,customDateEnd:C.customDateEnd,assigned_at_start:C.assigned_at_start,assigned_at_end:C.assigned_at_end,currentPage:(null===(e=i.state)||void 0===e?void 0:e.currentPage)||1,filteredLeads:v}})}},disabled:!Ze()||k,className:"p-2 rounded-md transition-colors relative ".concat(Ze()&&!k?"text-gray-600 hover:text-gray-800 hover:bg-gray-100":"text-gray-300 cursor-not-allowed"),title:"Previous Lead ".concat(Ze()?"(".concat(null===(e=v[w-1])||void 0===e?void 0:e.name,")"):"(none)"),children:k&&w>0?(0,fn.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-gray-600"}):(0,fn.jsx)(br,{className:"h-5 w-5"})}),(0,fn.jsx)("button",{onClick:()=>{if(w<v.length-1&&v.length>0){var e;const t=v[w+1];console.log("\u27a1\ufe0f Navigating to next lead:",t.name,"ID:",t.id),S(!0),u(null),o("/leads/".concat(t.id),{replace:!0,state:{statusFilter:C.statusFilter,searchTerm:C.searchTerm,dateFilter:C.dateFilter,customDateStart:C.customDateStart,customDateEnd:C.customDateEnd,assigned_at_start:C.assigned_at_start,assigned_at_end:C.assigned_at_end,currentPage:(null===(e=i.state)||void 0===e?void 0:e.currentPage)||1,filteredLeads:v}})}},disabled:!et()||k,className:"p-2 rounded-md transition-colors relative ".concat(et()&&!k?"text-gray-600 hover:text-gray-800 hover:bg-gray-100":"text-gray-300 cursor-not-allowed"),title:"Next Lead ".concat(et()?"(".concat(null===(t=v[w+1])||void 0===t?void 0:t.name,")"):"(none)"),children:k&&w<v.length-1?(0,fn.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-gray-600"}):(0,fn.jsx)(yr,{className:"h-5 w-5"})})]}),(0,fn.jsxs)("div",{className:"flex items-center space-x-3",children:[!g&&(0,fn.jsxs)("button",{onClick:()=>(localStorage.setItem("bookingLead",JSON.stringify({id:d.id,name:d.name,phone:d.phone,email:d.email,postcode:d.postcode,notes:d.notes,image_url:d.image_url,currentStatus:d.status})),void o("/calendar")),className:"btn-secondary flex items-center space-x-2",children:[(0,fn.jsx)(hr,{className:"h-4 w-4"}),(0,fn.jsx)("span",{children:"booked"===(null===(s=d.status)||void 0===s?void 0:s.toLowerCase())?"Reschedule":"Book Appointment"})]}),g?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)("button",{onClick:()=>{f(!1),y(d)},className:"btn-secondary",children:"Cancel"}),(0,fn.jsxs)("button",{onClick:async()=>{try{const e=d.notes||"",t=b.notes||"",s=await gn.put("/api/leads/".concat(l),b),n=s.data.lead||s.data;u(n),y(n),f(!1),e!==t&&(await st("NOTES_UPDATED",{oldNotes:e,newNotes:t}),localStorage.setItem("calendarRefreshTrigger","true"))}catch(p){console.error("Error updating lead:",p),alert("Failed to save changes. Please try again.")}},className:"btn-primary flex items-center space-x-2",children:[(0,fn.jsx)(tl,{className:"h-4 w-4"}),(0,fn.jsx)("span",{children:"Save"})]})]}):(0,fn.jsxs)("button",{onClick:()=>f(!0),className:"btn-primary flex items-center space-x-2",children:[(0,fn.jsx)(Er,{className:"h-4 w-4"}),(0,fn.jsx)("span",{children:"Edit"})]})]})]}),(0,fn.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[(0,fn.jsxs)("div",{className:"lg:col-span-3 space-y-6",children:[(0,fn.jsxs)("div",{className:"card",children:[(0,fn.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Basic Information"}),(0,fn.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,fn.jsx)("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4",children:(0,fn.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,fn.jsx)("div",{className:"w-12 h-12 rounded-xl bg-blue-500 flex items-center justify-center flex-shrink-0",children:(0,fn.jsx)(gl,{className:"h-6 w-6 text-white"})}),(0,fn.jsxs)("div",{className:"flex-1",children:[(0,fn.jsx)("p",{className:"text-sm font-medium text-blue-600 uppercase tracking-wide",children:"Full Name"}),g?(0,fn.jsx)("input",{type:"text",name:"name",value:b.name,onChange:Xe,className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-lg font-bold text-gray-900"}):(0,fn.jsx)("p",{className:"text-lg font-bold text-gray-900 mt-1",children:d.name})]})]})}),(0,fn.jsx)("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-4",children:(0,fn.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,fn.jsx)("div",{className:"w-12 h-12 rounded-xl bg-green-500 flex items-center justify-center flex-shrink-0",children:(0,fn.jsx)(gl,{className:"h-6 w-6 text-white"})}),(0,fn.jsxs)("div",{className:"flex-1",children:[(0,fn.jsx)("p",{className:"text-sm font-medium text-green-600 uppercase tracking-wide",children:"Age"}),g?(0,fn.jsx)("input",{type:"number",name:"age",value:b.age||"",onChange:Xe,min:"1",max:"120",placeholder:"Enter age",className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500 text-lg font-bold text-gray-900"}):(0,fn.jsx)("p",{className:"text-lg font-bold text-gray-900 mt-1",children:d.age?"".concat(d.age," years old"):"N/A"})]})]})}),(0,fn.jsx)("div",{className:"bg-gradient-to-r from-indigo-50 to-blue-50 rounded-xl p-4",children:(0,fn.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,fn.jsx)("div",{className:"w-12 h-12 rounded-xl bg-indigo-500 flex items-center justify-center flex-shrink-0",children:(0,fn.jsx)(gl,{className:"h-6 w-6 text-white"})}),(0,fn.jsxs)("div",{className:"flex-1",children:[(0,fn.jsx)("p",{className:"text-sm font-medium text-indigo-600 uppercase tracking-wide",children:"Gender"}),g?(0,fn.jsxs)("select",{name:"gender",value:b.gender||"",onChange:Xe,className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-lg font-bold text-gray-900",children:[(0,fn.jsx)("option",{value:"",children:"Select gender"}),(0,fn.jsx)("option",{value:"Female",children:"Female"}),(0,fn.jsx)("option",{value:"Male",children:"Male"})]}):(0,fn.jsx)("p",{className:"text-lg font-bold text-gray-900 mt-1",children:d.gender||"N/A"})]})]})}),(0,fn.jsx)("div",{className:"bg-gradient-to-r from-amber-50 to-yellow-50 rounded-xl p-4",children:(0,fn.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,fn.jsx)("div",{className:"w-12 h-12 rounded-xl bg-amber-500 flex items-center justify-center flex-shrink-0",children:(0,fn.jsx)(hr,{className:"h-6 w-6 text-white"})}),(0,fn.jsxs)("div",{className:"flex-1",children:[(0,fn.jsx)("p",{className:"text-sm font-medium text-amber-600 uppercase tracking-wide",children:"Entry Date"}),(0,fn.jsx)("p",{className:"text-lg font-bold text-gray-900 mt-1",children:d.entry_date?new Date(d.entry_date).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A"})]})]})})]})]}),(0,fn.jsxs)("div",{className:"card",children:[(0,fn.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Contact Information"}),(0,fn.jsxs)("div",{className:"space-y-6",children:[(0,fn.jsx)("div",{className:"bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl p-4",children:(0,fn.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,fn.jsx)("div",{className:"w-12 h-12 rounded-xl bg-purple-500 flex items-center justify-center flex-shrink-0",children:(0,fn.jsx)(Jr,{className:"h-6 w-6 text-white"})}),(0,fn.jsx)("div",{className:"flex-1",children:(0,fn.jsxs)("div",{className:"flex ".concat(d.parent_phone||g?"gap-6":""),children:[(0,fn.jsxs)("div",{className:"flex-1",children:[(0,fn.jsx)("p",{className:"text-sm font-medium text-purple-600 uppercase tracking-wide",children:"Phone Number"}),g?(0,fn.jsx)("input",{type:"tel",name:"phone",value:b.phone,onChange:Xe,className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-lg font-bold text-gray-900"}):(0,fn.jsx)("p",{className:"text-lg font-bold text-gray-900 mt-1",children:d.phone}),!g&&(0,fn.jsx)("a",{href:"tel:".concat(d.phone),className:"text-sm text-purple-600 hover:text-purple-800 transition-colors",children:"Click to call \u2192"})]}),(d.parent_phone||g)&&(0,fn.jsxs)("div",{className:"flex-1",children:[(0,fn.jsx)("p",{className:"text-sm font-medium text-purple-600 uppercase tracking-wide",children:"Parent Phone"}),g?(0,fn.jsx)("input",{type:"tel",name:"parent_phone",value:b.parent_phone||"",onChange:Xe,className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-lg font-bold text-gray-900",placeholder:"Optional"}):(0,fn.jsx)("p",{className:"text-lg font-bold text-gray-900 mt-1",children:d.parent_phone}),!g&&d.parent_phone&&(0,fn.jsx)("a",{href:"tel:".concat(d.parent_phone),className:"text-sm text-purple-600 hover:text-purple-800 transition-colors",children:"Click to call \u2192"})]})]})})]})}),(0,fn.jsx)("div",{className:"bg-gradient-to-r from-pink-50 to-rose-50 rounded-xl p-4",children:(0,fn.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,fn.jsx)("div",{className:"w-12 h-12 rounded-xl bg-pink-500 flex items-center justify-center flex-shrink-0",children:(0,fn.jsx)(Wr,{className:"h-6 w-6 text-white"})}),(0,fn.jsxs)("div",{className:"flex-1",children:[(0,fn.jsx)("p",{className:"text-sm font-medium text-pink-600 uppercase tracking-wide",children:"Email Address"}),g?(0,fn.jsx)("input",{type:"email",name:"email",value:b.email||"",onChange:Xe,className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-pink-500 focus:border-pink-500 text-lg font-bold text-gray-900"}):(0,fn.jsx)("p",{className:"text-lg font-bold text-gray-900 mt-1 break-all",children:d.email||"N/A"}),!g&&d.email&&(0,fn.jsx)("a",{href:"mailto:".concat(d.email),className:"text-sm text-pink-600 hover:text-pink-800 transition-colors",children:"Send email \u2192"})]})]})}),(0,fn.jsx)("div",{className:"bg-gradient-to-r from-orange-50 to-amber-50 rounded-xl p-4",children:(0,fn.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,fn.jsx)("div",{className:"w-12 h-12 rounded-xl bg-orange-500 flex items-center justify-center flex-shrink-0",children:(0,fn.jsx)(qr,{className:"h-6 w-6 text-white"})}),(0,fn.jsxs)("div",{className:"flex-1",children:[(0,fn.jsx)("p",{className:"text-sm font-medium text-orange-600 uppercase tracking-wide",children:"Postcode"}),g?(0,fn.jsx)("input",{type:"text",name:"postcode",value:b.postcode,onChange:Xe,className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-orange-500 focus:border-orange-500 text-lg font-bold text-gray-900"}):(0,fn.jsx)("p",{className:"text-lg font-bold text-gray-900 mt-1",children:d.postcode}),!g&&(0,fn.jsx)("a",{href:"https://maps.google.com/maps?q=".concat(d.postcode),target:"_blank",rel:"noopener noreferrer",className:"text-sm text-orange-600 hover:text-orange-800 transition-colors",children:"View on map \u2192"})]})]})})]})]}),!g&&(0,fn.jsx)(qi,{leadId:d.id,lead:d,onStatusUpdate:(e,t)=>{var s,n;let a={};try{d.custom_fields&&(a="string"===typeof d.custom_fields?JSON.parse(d.custom_fields):d.custom_fields)}catch(ey){a={}}a.call_status=e,u(He(He({},d),{},{custom_fields:JSON.stringify(a),call_status:e})),null!==t&&void 0!==t&&null!==(s=t.workflowResult)&&void 0!==s&&s.emailSent?alert('Status updated to "'.concat(e,'". ').concat(t.workflowResult.emailMessage||"Automatic email sent to client.")):null!==t&&void 0!==t&&null!==(n=t.workflowResult)&&void 0!==n&&n.emailMessage&&!t.workflowResult.emailSent&&console.warn("Email workflow:",t.workflowResult.emailMessage)}}),(0,fn.jsxs)("div",{className:"card",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,fn.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Notes"}),!g&&(0,fn.jsxs)("button",{onClick:()=>{y(e=>He(He({},e),{},{notes:(null===d||void 0===d?void 0:d.notes)||""})),f(!0)},className:"text-sm text-blue-600 hover:text-blue-800 font-medium flex items-center space-x-1 hover:bg-blue-50 px-2 py-1 rounded transition-colors",children:[(0,fn.jsx)(Er,{className:"h-3 w-3"}),(0,fn.jsx)("span",{children:"Edit Notes"})]})]}),g?(0,fn.jsxs)("div",{className:"space-y-3",children:[(0,fn.jsxs)("div",{className:"relative",children:[(0,fn.jsx)("textarea",{name:"notes",rows:"6",value:b.notes||"",onChange:Xe,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none break-words",placeholder:"Add detailed notes about this lead...",autoFocus:!0}),(0,fn.jsxs)("div",{className:"absolute bottom-2 right-2 text-xs text-gray-400",children:[(b.notes||"").length," characters"]})]}),(0,fn.jsxs)("div",{className:"flex items-center justify-between",children:[(0,fn.jsx)("div",{className:"text-xs text-gray-500",children:"All users can edit notes \u2022 Changes appear in booking history"}),(0,fn.jsxs)("div",{className:"flex space-x-2",children:[(0,fn.jsxs)("button",{onClick:async()=>{try{const e=d.notes||"",t=b.notes||"",s=await gn.patch("/api/leads/".concat(l,"/notes"),{notes:t,oldNotes:e}),n=s.data.lead||s.data;u(n),y(e=>He(He({},e),{},{notes:n.notes||""})),f(!1),localStorage.setItem("calendarRefreshTrigger","true")}catch(p){var e,t;console.error("Error updating notes:",p);const n=(null===(e=p.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Failed to save notes. Please try again.";alert(n)}},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm font-medium flex items-center space-x-1",children:[(0,fn.jsx)(gr,{className:"h-3 w-3"}),(0,fn.jsx)("span",{children:"Save Notes"})]}),(0,fn.jsx)("button",{onClick:()=>{y(e=>He(He({},e),{},{notes:(null===d||void 0===d?void 0:d.notes)||""})),f(!1)},className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 text-sm font-medium",children:"Cancel"})]})]})]}):(0,fn.jsx)("div",{children:d.notes?(0,fn.jsxs)("div",{children:[(0,fn.jsx)("div",{className:"max-h-96 overflow-y-auto",children:(0,fn.jsx)("p",{className:"text-gray-900 whitespace-pre-wrap leading-relaxed break-words",children:d.notes})}),(0,fn.jsx)("div",{className:"mt-2 text-xs text-gray-500",children:'Click "Edit Notes" to modify'})]}):(0,fn.jsxs)("div",{className:"text-center py-4",children:[(0,fn.jsx)("p",{className:"text-gray-500 italic",children:"No notes available"}),(0,fn.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:'Click "Edit Notes" to add notes'})]})})]}),!g&&(0,fn.jsxs)("div",{className:"card",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between",children:[(0,fn.jsxs)("button",{onClick:()=>ge(!xe),className:"flex items-center space-x-2 flex-1 text-left hover:bg-gray-50 p-2 -m-2 rounded-md transition-colors",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,fn.jsx)(Gr,{className:"h-5 w-5 text-indigo-500"}),(0,fn.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"\ud83d\udce8 Messages"}),fe.length>0&&(0,fn.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800",children:[fe.length," messages"]})]}),xe?(0,fn.jsx)(vr,{className:"h-5 w-5 text-gray-400"}):(0,fn.jsx)(fr,{className:"h-5 w-5 text-gray-400"})]}),(0,fn.jsxs)("button",{onClick:()=>o("/bookers-templates"),className:"ml-3 px-3 py-2 text-sm bg-indigo-100 hover:bg-indigo-200 text-indigo-700 rounded-md flex items-center space-x-1 transition-colors border border-indigo-200",title:"Manage Bookers Templates - Create & edit templates for Lead Details",children:[(0,fn.jsx)(al,{className:"h-4 w-4"}),(0,fn.jsx)("span",{children:"Manage Templates"})]})]}),xe&&(0,fn.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[(0,fn.jsx)("div",{className:"max-h-80 overflow-y-auto bg-gray-50 rounded-lg p-4 mb-4",children:ye?(0,fn.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,fn.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-indigo-600"}),(0,fn.jsx)("span",{className:"ml-2 text-gray-500",children:"Loading conversation..."})]}):0===fe.length?(0,fn.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,fn.jsx)(Gr,{className:"mx-auto h-8 w-8 mb-2 text-gray-300"}),(0,fn.jsx)("p",{children:"No conversation history"}),(0,fn.jsx)("p",{className:"text-sm mt-1",children:"Messages will appear here when sent or received"})]}):(0,fn.jsx)("div",{className:"space-y-3",children:fe.map((e,t)=>{var s,n,a;return(0,fn.jsx)("div",{className:"flex ".concat(["SMS_SENT","EMAIL_SENT"].includes(e.action)?"justify-end":"justify-start"),children:(0,fn.jsxs)("div",{className:"max-w-xs lg:max-w-md px-4 py-2 rounded-lg shadow-sm ".concat(["SMS_SENT","EMAIL_SENT"].includes(e.action)?"bg-blue-500 text-white":"bg-white border text-gray-900"),children:[e.action.includes("EMAIL")&&(null===(s=e.details)||void 0===s?void 0:s.subject)&&(0,fn.jsx)("p",{className:"text-sm font-semibold mb-1",children:e.details.subject}),(0,fn.jsx)("p",{className:"text-sm whitespace-pre-wrap break-words leading-relaxed",children:(null===(n=e.details)||void 0===n?void 0:n.body)||(null===(a=e.details)||void 0===a?void 0:a.message)||"No content available"}),(0,fn.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,fn.jsxs)("p",{className:"text-xs ".concat(["SMS_SENT","EMAIL_SENT"].includes(e.action)?"text-blue-100":"text-gray-500"),children:[(()=>{try{const t=new Date(e.timestamp);if(isNaN(t.getTime()))return"Unknown time";const s=new Date-t,n=s/36e5;if(n<1){const e=Math.floor(s/6e4);return e<=0?"Just now":"".concat(e,"m ago")}return n<24?t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0}):t.toLocaleDateString()+" "+t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0})}catch(p){return"Unknown time"}})()," \u2022 ",e.action.includes("SMS")?"SMS":"Email"]}),["SMS_SENT","EMAIL_SENT"].includes(e.action)&&(0,fn.jsx)(gr,{className:"h-3 w-3 text-blue-100"})]})]})},"".concat(e.timestamp,"-").concat(t))})})}),(0,fn.jsxs)("div",{className:"space-y-3",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,fn.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Reply via:"}),(0,fn.jsxs)("div",{className:"flex space-x-2",children:[(0,fn.jsx)("button",{onClick:()=>ke("sms"),className:"px-3 py-1 rounded-md text-sm font-medium transition-colors ".concat("sms"===Ne?"bg-blue-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:"SMS"}),(0,fn.jsx)("button",{onClick:()=>ke("email"),className:"px-3 py-1 rounded-md text-sm font-medium transition-colors ".concat("email"===Ne?"bg-blue-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),disabled:!d.email,children:"Email"})]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Choose Template (Optional)"}),(0,fn.jsxs)("select",{value:"sms"===Ne?E:P,onChange:e=>{const t=e.target.value;if("sms"===Ne){if(T(t),t){const e=D.find(e=>e._id===t);if(e){const t=e.smsBody||e.message||"",s=tt(t);we(s),setTimeout(()=>{const e=document.querySelector('textarea[placeholder*="reply"]');Se(e)},0)}}}else if(A(t),t){const e=M.find(e=>e._id===t);if(e){const t=e.subject||"",s=e.emailBody||e.message||"",n=tt(t)+"\n\n"+tt(s);we(n),setTimeout(()=>{const e=document.querySelector('textarea[placeholder*="reply"]');Se(e)},0)}}},className:"w-full px-4 py-3 text-base border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",style:{minHeight:"48px"},children:[(0,fn.jsx)("option",{value:"",children:"Select a template..."}),"sms"===Ne?Object.entries(Fe(D)).map(e=>{let[t,s]=e;return s.length>0&&(0,fn.jsx)("optgroup",{label:t,children:s.map(e=>(0,fn.jsx)("option",{value:e._id,children:e.name},e._id))},t)}):Object.entries(Fe(M)).map(e=>{let[t,s]=e;return s.length>0&&(0,fn.jsx)("optgroup",{label:t,children:s.map(e=>(0,fn.jsx)("option",{value:e._id,children:e.name},e._id))},t)})]})]}),"email"===Ne&&(()=>{const e=M.find(e=>"invitation_email"===e.type);return e&&(0,fn.jsx)("div",{className:"flex justify-end mb-2",children:(0,fn.jsxs)("button",{type:"button",onClick:()=>{const t=e.subject||"",s=e.emailBody||e.message||"",n=tt(t)+"\n\n"+tt(s);we(n),A(e._id),setTimeout(()=>{const e=document.querySelector('textarea[placeholder*="reply"]');Se(e)},0)},className:"px-4 py-2 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-lg hover:from-purple-700 hover:to-indigo-700 transition-all flex items-center gap-2 shadow-md text-sm",children:[(0,fn.jsx)(Wr,{className:"h-4 w-4"}),"Quick: Send Invitation Email"]})})})(),(0,fn.jsxs)("div",{className:"flex space-x-2",children:[(0,fn.jsx)("textarea",{value:je,onChange:e=>{we(e.target.value),Se(e.target)},placeholder:"Type your ".concat("sms"===Ne?"SMS":"email"," reply..."),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 resize-none overflow-hidden",style:{minHeight:"60px"},maxLength:"sms"===Ne?160:5e3}),(0,fn.jsxs)("button",{onClick:async()=>{if(je.trim())try{if("sms"===Ne){if(!d.phone)return void alert("This lead does not have a phone number.");const e=await gn.post("/api/leads/".concat(d.id,"/send-sms"),{message:je,type:"custom"});e.data.success?(alert("SMS sent successfully to ".concat(d.phone,"!")),await st("SMS_SENT",{recipient:d.phone,message:je,template:"Quick reply"}),we(""),setTimeout(()=>Ge(),1e3)):alert("Failed to send SMS: ".concat(e.data.message))}else{if(!d.email)return void alert("This lead does not have an email address.");let e="Reply",t=je;if(je.includes("\n\n")){const s=je.split("\n\n");s[0].length<100&&(e=s[0],t=s.slice(1).join("\n\n"))}const s=await gn.post("/api/leads/".concat(d.id,"/send-email"),{subject:e,body:t});s.data.success?(alert("Email sent successfully to ".concat(d.email,"!")),we(""),setTimeout(()=>Ge(),1e3)):alert("Failed to send email: ".concat(s.data.message))}}catch(p){var e,t;console.error("Error sending reply:",p),alert("Error sending reply: ".concat((null===(e=p.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||p.message))}else alert("Please enter a reply message.")},disabled:!je.trim(),className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[(0,fn.jsx)(nl,{className:"h-4 w-4"}),(0,fn.jsx)("span",{children:"Send"})]})]}),(0,fn.jsx)("p",{className:"text-xs text-gray-500",children:"sms"===Ne?"Send to: ".concat(d.phone," (").concat(je.length,"/160 characters)"):"Send to: ".concat(d.email||"No email address")})]})]})]}),ue.length>0&&(0,fn.jsxs)("div",{className:"card border-l-4 border-purple-500",children:[(0,fn.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,fn.jsxs)("h3",{className:"text-lg font-medium text-gray-900 flex items-center space-x-2",children:[(0,fn.jsx)(wr,{className:"h-5 w-5 text-purple-600"}),(0,fn.jsx)("span",{children:"\u23f0 Upcoming Callbacks"})]})}),(0,fn.jsx)("div",{className:"space-y-3",children:ue.map(e=>{const t=new Date(e.callback_time),s=new Date,n=t<s,a=t.toDateString()===s.toDateString();return(0,fn.jsx)("div",{className:"p-4 rounded-lg border-2 ".concat(n?"bg-red-50 border-red-200":a?"bg-yellow-50 border-yellow-200":"bg-purple-50 border-purple-200"),children:(0,fn.jsx)("div",{className:"flex items-start justify-between",children:(0,fn.jsxs)("div",{className:"flex-1",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,fn.jsx)(wr,{className:"h-4 w-4 ".concat(n?"text-red-600":a?"text-yellow-600":"text-purple-600")}),(0,fn.jsx)("span",{className:"font-semibold text-gray-900",children:t.toLocaleString("en-GB",{weekday:"short",day:"numeric",month:"short",hour:"2-digit",minute:"2-digit",timeZone:"Europe/London"})}),n&&(0,fn.jsx)("span",{className:"text-xs bg-red-100 text-red-700 px-2 py-1 rounded",children:"Overdue"}),a&&!n&&(0,fn.jsx)("span",{className:"text-xs bg-yellow-100 text-yellow-700 px-2 py-1 rounded",children:"Today"})]}),e.callback_note&&(0,fn.jsxs)("p",{className:"text-sm text-gray-700 mb-2",children:["\ud83d\udcdd ",e.callback_note]}),(0,fn.jsxs)("div",{className:"text-xs text-gray-500",children:["Status: ",(0,fn.jsx)("span",{className:"font-medium capitalize",children:e.status})]})]})})},e.id)})})]}),(0,fn.jsxs)("div",{className:"card",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,fn.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"\ud83d\udccb Booking History"}),he&&(0,fn.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500"})]}),ce.length>0||ue.length>0?(0,fn.jsx)("div",{className:"space-y-4",children:ue.filter(e=>"pending"===e.status).map(e=>{const t=new Date(e.callback_time);return{action:"CALLBACK_SCHEDULED",performedByName:"System",timestamp:e.created_at,details:{callbackTime:t.toLocaleString("en-GB",{weekday:"long",day:"numeric",month:"long",hour:"2-digit",minute:"2-digit",timeZone:"Europe/London"}),note:e.callback_note||"No note",status:e.status},isCallback:!0}}).concat(ce.filter(e=>e.action&&""!==e.action.trim()&&(e.performedByName||e.timestamp))).sort((e,t)=>{const s=new Date(e.timestamp||0).getTime();return new Date(t.timestamp||0).getTime()-s}).map((e,t)=>{var s;return(0,fn.jsx)("div",{className:"border-l-4 pl-4 py-3 rounded-r-lg ".concat(e.isCallback?"border-purple-500 bg-purple-50":"border-blue-500 bg-gray-50"),children:(0,fn.jsxs)("div",{className:"flex items-start justify-between",children:[(0,fn.jsxs)("div",{className:"flex-1",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[e.isCallback&&(0,fn.jsx)(wr,{className:"h-4 w-4 text-purple-600"}),(0,fn.jsx)("span",{className:"font-semibold text-gray-900",children:e.isCallback?"\ud83d\udcde Callback Scheduled":e.action}),(0,fn.jsx)("span",{className:"text-sm text-gray-500",children:e.isCallback?"":"by ".concat(e.performedByName)})]}),e.details&&Object.keys(e.details).length>0&&(0,fn.jsx)("div",{className:"text-sm text-gray-600 mb-2",children:e.isCallback?(0,fn.jsxs)("div",{className:"bg-purple-100 p-3 rounded-lg",children:[(0,fn.jsxs)("div",{className:"font-medium text-purple-800 mb-1",children:["Scheduled for: ",e.details.callbackTime]}),(0,fn.jsxs)("div",{className:"text-sm text-purple-700",children:["Note: ",e.details.note]}),(0,fn.jsxs)("div",{className:"text-xs text-purple-600 mt-1",children:["Status: ",e.details.status]})]}):"NOTES_UPDATED"===e.action?(0,fn.jsx)("div",{className:"space-y-2",children:(0,fn.jsxs)("div",{className:"bg-blue-50 p-3 rounded-lg",children:[(0,fn.jsxs)("div",{className:"font-medium text-blue-800 mb-1",children:["Notes ","added"===e.details.changeType?"Added":"Modified"]}),e.details.oldNotes&&(0,fn.jsxs)("div",{className:"text-xs text-gray-600 mb-1",children:[(0,fn.jsx)("span",{className:"font-medium",children:"Previous:"})," ",e.details.oldNotes]}),(0,fn.jsxs)("div",{className:"text-sm text-gray-800",children:[(0,fn.jsx)("span",{className:"font-medium",children:"New:"})," ",e.details.newNotes]}),(0,fn.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:[e.details.characterCount," characters"]})]})}):Object.entries(e.details).map(e=>{let[t,s]=e;return(0,fn.jsxs)("div",{className:"mb-1",children:[(0,fn.jsxs)("span",{className:"font-medium",children:[t,":"]})," ","object"===typeof s&&null!==s?JSON.stringify(s):s]},t)})}),e.leadSnapshot&&Object.keys(e.leadSnapshot).length>0&&(0,fn.jsxs)("div",{className:"text-xs text-gray-500 bg-white p-2 rounded border",children:[(0,fn.jsx)("div",{className:"font-medium mb-1",children:"Lead State:"}),Object.entries(e.leadSnapshot).map(e=>{let[t,s]=e;return(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("span",{className:"font-medium",children:[t,":"]})," ","object"===typeof s&&null!==s?JSON.stringify(s):s||"N/A"]},t)})]})]}),(0,fn.jsx)("div",{className:"text-xs text-gray-400 ml-4",children:(()=>{try{if(!e.timestamp)return"Unknown time";let t;if(t="string"===typeof e.timestamp?new Date(e.timestamp):"number"===typeof e.timestamp?new Date(e.timestamp>1e12?e.timestamp:1e3*e.timestamp):new Date(e.timestamp),isNaN(t.getTime()))return"Invalid date";const s=new Date-t,n=s/36e5,a=s/864e5;if(n<1){const e=Math.floor(s/6e4);return e<=0?"Just now":"".concat(e," min ago")}if(n<24)return t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0});if(a<7){const e=Math.floor(a);return"".concat(e," day").concat(1===e?"":"s"," ago")}return t.toLocaleDateString()+" "+t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0})}catch(p){return console.error("Error formatting timestamp:",p,"Timestamp:",e.timestamp),"Unknown time"}})()})]})},e.isCallback?"callback-".concat(null===(s=e.details)||void 0===s?void 0:s.callbackTime):t)})}):(0,fn.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,fn.jsx)("div",{className:"text-4xl mb-2",children:"\ud83d\udccb"}),(0,fn.jsx)("p",{children:"No booking history available"}),(0,fn.jsx)("p",{className:"text-sm",children:"History will appear here when actions are taken on this lead"})]})]})]}),(0,fn.jsxs)("div",{className:"space-y-6",children:[(0,fn.jsxs)("div",{className:"card",children:[(0,fn.jsxs)("div",{className:"mb-4",children:[(0,fn.jsx)("div",{className:"mx-auto w-full max-w-xs aspect-square bg-gray-300 flex items-center justify-center rounded-lg overflow-hidden shadow-lg hover:shadow-xl transition-shadow duration-300 relative",children:d.image_url?(0,fn.jsxs)(fn.Fragment,{children:[d.image_url.toLowerCase().includes(".heic")||d.image_url.toLowerCase().includes(".heif")?(0,fn.jsxs)("div",{className:"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-gray-200 to-gray-300 cursor-pointer",onClick:()=>I(!0),title:"HEIC format - click to try viewing",children:[(0,fn.jsx)("span",{className:"text-4xl mb-2",children:"\ud83d\udcf7"}),(0,fn.jsx)("span",{className:"text-xs text-gray-500",children:"HEIC Format"})]}):d.image_url.toLowerCase().includes(".pdf")?(0,fn.jsxs)("div",{className:"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-gray-200 to-gray-300 cursor-pointer",onClick:()=>window.open(d.image_url,"_blank"),title:"PDF file - click to open",children:[(0,fn.jsx)("span",{className:"text-4xl mb-2",children:"\ud83d\udcc4"}),(0,fn.jsx)("span",{className:"text-xs text-gray-500",children:"PDF File"})]}):d.image_url.toLowerCase().includes(".mp4")||d.image_url.toLowerCase().includes(".webm")||d.image_url.toLowerCase().includes(".mov")?(0,fn.jsx)("video",{src:d.image_url,className:"w-full h-full object-cover cursor-pointer",muted:!0,loop:!0,playsInline:!0,autoPlay:!0,preload:"auto",onClick:()=>I(!0)}):(0,fn.jsx)(Ui,{src:d.image_url,alt:d.name,className:"w-full h-full object-cover cursor-pointer hover:scale-105 transition-transform duration-300",lazy:!1,enableFadeIn:!0,showBlurPlaceholder:!0,onClick:()=>I(!0)}),(d.image_url.toLowerCase().includes(".gif")||d.image_url.toLowerCase().includes(".mp4")||d.image_url.toLowerCase().includes(".webm"))&&(0,fn.jsx)("span",{className:"absolute top-2 right-2 bg-black bg-opacity-60 text-white text-xs px-2 py-1 rounded uppercase font-medium",children:d.image_url.toLowerCase().includes(".gif")?"GIF":"VIDEO"})]}):(0,fn.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-gray-200 to-gray-300",children:(0,fn.jsx)("span",{className:"text-6xl font-medium text-gray-600",children:d.name.charAt(0).toUpperCase()})})}),d.image_url&&(0,fn.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:["Click ",d.image_url.toLowerCase().includes(".mp4")||d.image_url.toLowerCase().includes(".webm")?"video":"photo"," to view full screen"]})]}),(0,fn.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:d.name}),(0,fn.jsxs)("div",{className:"space-y-2 text-sm text-gray-600",children:[d.age&&(0,fn.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,fn.jsx)(gl,{className:"h-4 w-4"}),(0,fn.jsxs)("span",{children:[d.age," years old"]})]}),d.gender&&(0,fn.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,fn.jsx)(gl,{className:"h-4 w-4"}),(0,fn.jsx)("span",{children:d.gender})]}),(0,fn.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,fn.jsx)(Jr,{className:"h-4 w-4"}),(0,fn.jsx)("span",{children:d.phone})]}),d.email&&(0,fn.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,fn.jsx)(Wr,{className:"h-4 w-4"}),(0,fn.jsx)("span",{children:d.email})]})]}),(0,fn.jsxs)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[(0,fn.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Lead Information"}),(0,fn.jsxs)("div",{className:"space-y-3",children:[(0,fn.jsxs)("div",{className:"flex justify-between",children:[(0,fn.jsx)("span",{className:"text-sm text-gray-600",children:"Status:"}),(0,fn.jsx)("span",{className:(e=>{if(!e)return"status-badge status-new";switch(e.toLowerCase()){case"new":default:return"status-badge status-new";case"assigned":return"status-badge status-assigned";case"contacted":return"status-badge status-contacted";case"booked":return"status-badge status-booked";case"confirmed":return"status-badge status-confirmed";case"attended":return"status-badge status-attended";case"cancelled":return"status-badge status-cancelled";case"no answer":case"noanswer":return"status-badge status-no-answer";case"not interested":case"notinterested":return"status-badge status-not-interested";case"sale":case"sales/converted - purchased":return"status-badge status-sale";case"rejected":return"status-badge status-rejected";case"call back":case"callback":return"status-badge status-call-back";case"left message":case"leftmessage":return"status-badge status-left-message";case"not qualified":case"notqualified":return"status-badge status-not-qualified";case"reschedule":return"status-badge status-reschedule";case"no show":case"noshow":return"status-badge status-no-show";case"wrong number":case"wrongnumber":return"status-badge status-wrong-number"}})(d.status),children:d.status})]}),(0,fn.jsxs)("div",{className:"flex justify-between",children:[(0,fn.jsx)("span",{className:"text-sm text-gray-600",children:"Assigned to:"}),(0,fn.jsx)("span",{className:"text-sm font-medium text-gray-900",children:(null===(n=d.booker)||void 0===n?void 0:n.name)||"N/A"})]}),(0,fn.jsxs)("div",{className:"flex justify-between",children:[(0,fn.jsx)("span",{className:"text-sm text-gray-600",children:"Date Added:"}),(0,fn.jsx)("span",{className:"text-sm font-medium text-gray-900",children:(e=>{if(!e)return"Not set";const t=new Date(e);return isNaN(t.getTime())?"Invalid date":t.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})(d.created_at)})]}),d.lead_source&&(0,fn.jsxs)("div",{className:"flex justify-between items-center",children:[(0,fn.jsx)("span",{className:"text-sm text-gray-600",children:"Lead Source:"}),(0,fn.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-semibold bg-teal-100 text-teal-800",children:d.lead_source})]})]})]})]}),!g&&(0,fn.jsx)("div",{className:"mt-4",children:(0,fn.jsx)(Yi,{lead:d,onSuccess:e=>{ze()}})}),!g&&"admin"===(null===c||void 0===c?void 0:c.role)&&(0,fn.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,fn.jsxs)("button",{onClick:()=>{ee(!1),W(!0)},className:"w-full flex items-center justify-center px-4 py-2.5 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-lg hover:from-purple-700 hover:to-indigo-700 transition-all shadow-md",children:[(0,fn.jsx)(jc,{className:"w-4 h-4 mr-2"}),(0,fn.jsx)("span",{children:"View Gallery"}),U.length>0&&(0,fn.jsx)("span",{className:"ml-2 bg-white/20 px-2 py-0.5 rounded-full text-xs",children:U.length})]}),(0,fn.jsxs)("button",{onClick:()=>B(!0),className:"w-full flex items-center justify-center px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-all text-sm",children:[(0,fn.jsx)(sc,{className:"w-4 h-4 mr-2"}),(0,fn.jsx)("span",{children:"Quick View Images"})]})]}),!g&&"Rejected"!==d.status&&(0,fn.jsx)("button",{className:"mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",onClick:()=>_e(!0),children:"Reject Lead"}),!g&&"booker"===(null===c||void 0===c?void 0:c.role)&&(0,fn.jsx)(nt,{leadId:d.id,lead:d,onStatusUpdate:(e,t)=>{let s={};try{d.custom_fields&&(s="string"===typeof d.custom_fields?JSON.parse(d.custom_fields):d.custom_fields)}catch(ey){s={}}s.call_status=e;let n=d.status;("Wrong number"===e||["Not interested","Not Qualified"].includes(e))&&(n="Rejected"),u(He(He({},d),{},{custom_fields:JSON.stringify(s),call_status:e,status:n})),ze()}}),!g&&d.phone&&"Booked"===d.status&&(0,fn.jsx)("button",{className:"mt-4 px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",onClick:async()=>{if(d.dateBooked)try{const e=await gn.post("/api/leads/".concat(d.id,"/send-booking-confirmation"),{appointmentDate:d.dateBooked});e.data.success?alert("Booking confirmation SMS sent successfully to ".concat(d.phone,"!")):alert("Failed to send booking confirmation: ".concat(e.data.message))}catch(p){var e,t;console.error("Booking confirmation error:",p),alert("Error sending booking confirmation: ".concat((null===(e=p.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||p.message))}else alert("This lead does not have a booked date.")},children:"Send Booking Confirmation SMS"}),(0,fn.jsx)($i,{lead:d})]})]})]})]}),(0,fn.jsx)(Hi,{isOpen:F,onClose:()=>I(!1),imageUrl:null!==d&&void 0!==d&&d.image_url?Ai(d.image_url,"original"):null,leadName:null===d||void 0===d?void 0:d.name}),Ce&&(0,fn.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50",children:(0,fn.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 w-96",children:[(0,fn.jsx)("h2",{className:"text-lg font-bold mb-4",children:"Reject Lead"}),(0,fn.jsxs)("p",{className:"text-sm text-gray-600 mb-4",children:["This lead will be rejected as ",(0,fn.jsx)("span",{className:"font-semibold",children:"Duplicated"}),"."]}),(0,fn.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,fn.jsx)("button",{className:"px-4 py-2 bg-gray-300 rounded hover:bg-gray-400",onClick:()=>_e(!1),children:"Cancel"}),(0,fn.jsx)("button",{className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",disabled:Pe,onClick:async()=>{Ae(!0);try{await gn.patch("/api/leads/".concat(d.id,"/reject"),{reason:Ee}),u(He(He({},d),{},{status:"Rejected",reject_reason:Ee})),_e(!1)}catch(ty){alert("Failed to reject lead.")}Ae(!1)},children:"Confirm Reject"})]})]})}),(0,fn.jsx)(vc,{isOpen:V,onClose:()=>W(!1),photos:U,leadId:null===d||void 0===d?void 0:d.id,leadName:(null===d||void 0===d?void 0:d.name)||"Client",initialSelectedIds:q,imageLimit:null!==(r=null===Q||void 0===Q?void 0:Q.imageCount)&&void 0!==r?r:null===Q||void 0===Q?void 0:Q.image_count,selectionMode:Z,onProceedToPackage:(e,t)=>{H(e),G(t),W(!1),ee(!1)}}),(0,fn.jsx)(dc,{isOpen:O,onClose:()=>B(!1),leadId:null===d||void 0===d?void 0:d.id,leadName:null===d||void 0===d?void 0:d.name,onSelectionComplete:(e,t)=>{z(e),H(t),G(e),console.log("Selected photos:",t)}})]}):(0,fn.jsxs)("div",{className:"text-center py-12",children:[(0,fn.jsx)("p",{className:"text-gray-500",children:"Lead not found"}),(0,fn.jsx)("button",{onClick:()=>{var e;return o("/leads",{state:{statusFilter:C.statusFilter,searchTerm:C.searchTerm,currentPage:(null===(e=i.state)||void 0===e?void 0:e.currentPage)||1}})},className:"mt-4 btn-primary",children:"Back to Leads"})]})},Nc=()=>{const{user:e}=wn(),[t,s]=(0,a.useState)([]),[n,r]=(0,a.useState)(!0),[l,o]=(0,a.useState)(""),[i,c]=(0,a.useState)([]),[d,u]=(0,a.useState)(!1),[m,h]=(0,a.useState)(!1),[p,x]=(0,a.useState)({name:"",email:"",password:"",role:"booker",assigned_email_account_id:""}),[g,f]=(0,a.useState)({}),[b,y]=(0,a.useState)(!1),[v,j]=(0,a.useState)(null),[w,N]=(0,a.useState)(!1),[k,S]=(0,a.useState)(!1),[C,_]=(0,a.useState)(null),[E,T]=(0,a.useState)(!1);(0,a.useEffect)(()=>{"admin"===(null===e||void 0===e?void 0:e.role)&&(A(),P())},[e]);const P=async()=>{try{const e=await gn.get("/api/email-accounts/dropdown");c(e.data)}catch(e){console.error("Error fetching email accounts:",e)}},A=async()=>{try{const e=await gn.get("/api/users");s(e.data)}catch(e){console.error("Error fetching users:",e),s([{id:"1",name:"Alice Smith",email:"alice.smith@studio.com",role:"booker",leadsAssigned:3,bookingsMade:4,showUps:2,isActive:!0,createdAt:"2024-01-15T00:00:00.000Z"},{id:"2",name:"John Doe",email:"john.doe@studio.com",role:"admin",leadsAssigned:2,bookingsMade:2,showUps:2,isActive:!0,createdAt:"2024-02-01T00:00:00.000Z"},{id:"3",name:"Mike Jones",email:"mike.jones@studio.com",role:"booker",leadsAssigned:3,bookingsMade:3,showUps:3,isActive:!0,createdAt:"2024-01-20T00:00:00.000Z"},{id:"4",name:"Ethan Brown",email:"ethan.brown@studio.com",role:"booker",leadsAssigned:2,bookingsMade:4,showUps:2,isActive:!0,createdAt:"2024-03-01T00:00:00.000Z"}])}r(!1)},D=e=>{const{name:t,value:s}=e.target;x(e=>He(He({},e),{},{[t]:s})),g[t]&&f(e=>He(He({},e),{},{[t]:""}))},L=()=>{u(!1),x({name:"",email:"",password:"",role:"booker",assigned_email_account_id:""}),f({})},M=t.filter(e=>e.name.toLowerCase().includes(l.toLowerCase())||e.email.toLowerCase().includes(l.toLowerCase()));return"admin"!==(null===e||void 0===e?void 0:e.role)?(0,fn.jsx)("div",{className:"text-center py-12",children:(0,fn.jsx)("p",{className:"text-gray-500",children:"Access denied. Admin privileges required."})}):n?(0,fn.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,fn.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):(0,fn.jsxs)("div",{className:"space-y-6",children:[(0,fn.jsxs)("div",{className:"flex justify-between items-center",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"Users"}),(0,fn.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Manage team members and their permissions"})]}),(0,fn.jsxs)("button",{onClick:()=>u(!0),className:"btn-primary flex items-center space-x-2",children:[(0,fn.jsx)(Zr,{className:"h-4 w-4"}),(0,fn.jsx)("span",{children:"Add User"})]})]}),(0,fn.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,fn.jsxs)("div",{className:"relative flex-1",children:[(0,fn.jsx)(sl,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),(0,fn.jsx)("input",{type:"text",placeholder:"Search users...",className:"pl-10 pr-4 py-2 border border-gray-300 rounded-md w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:l,onChange:e=>o(e.target.value)})]}),(0,fn.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,fn.jsx)(Lr,{className:"h-5 w-5 text-gray-400"}),(0,fn.jsxs)("select",{className:"border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,fn.jsx)("option",{value:"all",children:"All Roles"}),(0,fn.jsx)("option",{value:"photographer",children:"Photographer"}),(0,fn.jsx)("option",{value:"admin",children:"Admin"}),(0,fn.jsx)("option",{value:"sales",children:"Sales"}),(0,fn.jsx)("option",{value:"viewer",children:"Viewer"})]})]})]}),(0,fn.jsxs)("div",{className:"card",children:[(0,fn.jsx)("div",{className:"overflow-x-auto",children:(0,fn.jsxs)("table",{className:"min-w-full",children:[(0,fn.jsx)("thead",{children:(0,fn.jsxs)("tr",{className:"table-header",children:[(0,fn.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),(0,fn.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),(0,fn.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),(0,fn.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Leads Assigned"}),(0,fn.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Bookings Made"}),(0,fn.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Show Ups"}),(0,fn.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,fn.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:M.map(e=>{return(0,fn.jsxs)("tr",{className:"table-row",children:[(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("div",{className:"h-8 w-8 rounded-full bg-blue-500 flex items-center justify-center",children:(0,fn.jsx)("span",{className:"text-sm font-medium text-white",children:e.name.charAt(0).toUpperCase()})}),(0,fn.jsxs)("div",{className:"ml-3",children:[(0,fn.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,fn.jsxs)("div",{className:"text-sm text-gray-500",children:["Joined ",(s=e.createdAt,new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}))]})]})]})}),(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,fn.jsx)("div",{className:"text-sm text-gray-900",children:e.email})}),(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,fn.jsx)("span",{className:(t=e.role,"admin"===t?"status-badge bg-purple-100 text-purple-800":"viewer"===t?"status-badge bg-green-100 text-green-800":"status-badge bg-blue-100 text-blue-800"),children:e.role})}),(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,fn.jsx)("div",{className:"text-sm text-gray-900",children:e.leadsAssigned})}),(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,fn.jsx)("div",{className:"text-sm text-gray-900",children:e.bookingsMade})}),(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,fn.jsx)("div",{className:"text-sm text-gray-900",children:e.showUps})}),(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,fn.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,fn.jsx)("button",{onClick:()=>(e=>{j({id:e.id,name:e.name,email:e.email,role:e.role,password:"",assigned_email_account_id:e.assigned_email_account_id||""}),y(!0)})(e),className:"text-blue-600 hover:text-blue-900",children:(0,fn.jsx)(Er,{className:"h-4 w-4"})}),(0,fn.jsx)("button",{onClick:()=>{return t=e.id,_(t),void S(!0);var t},className:"text-red-600 hover:text-red-900",children:(0,fn.jsx)(cl,{className:"h-4 w-4"})})]})})]},e.id);var t,s})})]})}),0===M.length&&(0,fn.jsx)("div",{className:"text-center py-12",children:(0,fn.jsx)("p",{className:"text-gray-500",children:"No users found"})})]}),(0,fn.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,fn.jsx)("div",{className:"card",children:(0,fn.jsxs)("div",{className:"text-center",children:[(0,fn.jsx)("div",{className:"text-2xl font-semibold text-gray-900",children:t.length}),(0,fn.jsx)("div",{className:"text-sm text-gray-500",children:"Total Users"})]})}),(0,fn.jsx)("div",{className:"card",children:(0,fn.jsxs)("div",{className:"text-center",children:[(0,fn.jsx)("div",{className:"text-2xl font-semibold text-gray-900",children:t.filter(e=>"admin"===e.role).length}),(0,fn.jsx)("div",{className:"text-sm text-gray-500",children:"Admins"})]})}),(0,fn.jsx)("div",{className:"card",children:(0,fn.jsxs)("div",{className:"text-center",children:[(0,fn.jsx)("div",{className:"text-2xl font-semibold text-gray-900",children:t.filter(e=>"booker"===e.role).length}),(0,fn.jsx)("div",{className:"text-sm text-gray-500",children:"Bookers"})]})}),(0,fn.jsx)("div",{className:"card",children:(0,fn.jsxs)("div",{className:"text-center",children:[(0,fn.jsx)("div",{className:"text-2xl font-semibold text-gray-900",children:t.filter(e=>"viewer"===e.role).length}),(0,fn.jsx)("div",{className:"text-sm text-gray-500",children:"Viewers"})]})}),(0,fn.jsx)("div",{className:"card",children:(0,fn.jsxs)("div",{className:"text-center",children:[(0,fn.jsx)("div",{className:"text-2xl font-semibold text-gray-900",children:t.reduce((e,t)=>e+(t.leadsAssigned||0),0)}),(0,fn.jsx)("div",{className:"text-sm text-gray-500",children:"Total Leads"})]})}),(0,fn.jsx)("div",{className:"card",children:(0,fn.jsxs)("div",{className:"text-center",children:[(0,fn.jsx)("div",{className:"text-2xl font-semibold text-gray-900",children:t.filter(e=>"viewer"===e.role).length}),(0,fn.jsx)("div",{className:"text-sm text-gray-500",children:"Sales Viewers"})]})})]}),d&&(0,fn.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,fn.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[(0,fn.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,fn.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Create New User"}),(0,fn.jsx)("button",{onClick:L,className:"text-gray-400 hover:text-gray-600",children:(0,fn.jsx)(jl,{className:"h-6 w-6"})})]}),(0,fn.jsxs)("form",{onSubmit:async e=>{e.preventDefault();const t=(()=>{const e={};return p.name.trim()||(e.name="Name is required"),p.email.trim()?/\S+@\S+\.\S+/.test(p.email)||(e.email="Email is invalid"):e.email="Email is required",p.password?p.password.length<6&&(e.password="Password must be at least 6 characters"):e.password="Password is required",e})();if(Object.keys(t).length>0)f(t);else{h(!0),f({});try{const e=await gn.post("/api/users",p);s(t=>[e.data.user,...t]),x({name:"",email:"",password:"",role:"booker",assigned_email_account_id:""}),u(!1),alert("User created successfully!")}catch(r){var n,a;console.error("Error creating user:",r);const e=(null===(n=r.response)||void 0===n||null===(a=n.data)||void 0===a?void 0:a.message)||"Failed to create user";f({submit:e})}h(!1)}},className:"space-y-4",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[(0,fn.jsx)(gl,{className:"inline h-4 w-4 mr-2"}),"Full Name"]}),(0,fn.jsx)("input",{type:"text",name:"name",value:p.name,onChange:D,className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ".concat(g.name?"border-red-500":"border-gray-300"),placeholder:"Enter full name"}),g.name&&(0,fn.jsx)("p",{className:"text-red-500 text-xs mt-1",children:g.name})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[(0,fn.jsx)(Wr,{className:"inline h-4 w-4 mr-2"}),"Email Address"]}),(0,fn.jsx)("input",{type:"email",name:"email",value:p.email,onChange:D,className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ".concat(g.email?"border-red-500":"border-gray-300"),placeholder:"Enter email address"}),g.email&&(0,fn.jsx)("p",{className:"text-red-500 text-xs mt-1",children:g.email})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[(0,fn.jsx)(zr,{className:"inline h-4 w-4 mr-2"}),"Password"]}),(0,fn.jsx)("input",{type:"password",name:"password",value:p.password,onChange:D,className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ".concat(g.password?"border-red-500":"border-gray-300"),placeholder:"Enter password (minimum 6 characters)"}),g.password&&(0,fn.jsx)("p",{className:"text-red-500 text-xs mt-1",children:g.password})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[(0,fn.jsx)(rl,{className:"inline h-4 w-4 mr-2"}),"Role"]}),(0,fn.jsxs)("select",{name:"role",value:p.role,onChange:D,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,fn.jsx)("option",{value:"booker",children:"Booker"}),(0,fn.jsx)("option",{value:"viewer",children:"Viewer"}),(0,fn.jsx)("option",{value:"photographer",children:"Photographer"}),(0,fn.jsx)("option",{value:"admin",children:"Administrator"})]}),(0,fn.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"admin"===p.role?"Full access to all features and user management":"viewer"===p.role?"Read-only access to view data only":"photographer"===p.role?"Access to upload and manage photos for leads":"Access to leads management and bookings"})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[(0,fn.jsx)(Wr,{className:"inline h-4 w-4 mr-2"}),"Email Account"]}),(0,fn.jsxs)("select",{name:"assigned_email_account_id",value:p.assigned_email_account_id,onChange:D,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,fn.jsx)("option",{value:"",children:"System Default"}),i.map(e=>(0,fn.jsxs)("option",{value:e.id,children:[e.name," (",e.email,")",e.is_default?" - Default":""]},e.id))]}),(0,fn.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Email account used for sending messages from this user"})]}),g.submit&&(0,fn.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-3",children:(0,fn.jsx)("p",{className:"text-red-600 text-sm",children:g.submit})}),(0,fn.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,fn.jsx)("button",{type:"button",onClick:L,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",children:"Cancel"}),(0,fn.jsx)("button",{type:"submit",disabled:m,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2",children:m?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),(0,fn.jsx)("span",{children:"Creating..."})]}):(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(Zr,{className:"h-4 w-4"}),(0,fn.jsx)("span",{children:"Create User"})]})})]})]})]})}),b&&(0,fn.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,fn.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[(0,fn.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,fn.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Edit User"}),(0,fn.jsx)("button",{onClick:()=>y(!1),className:"text-gray-400 hover:text-gray-600",children:(0,fn.jsx)(jl,{className:"h-6 w-6"})})]}),(0,fn.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),v.password&&v.password.length<6)alert("Password must be at least 6 characters long");else{N(!0);try{const e=He({},v);e.password||delete e.password;const t=await gn.put("/api/users/".concat(v.id),e);s(e=>e.map(e=>e.id===v.id?He(He({},e),t.data.user):e)),y(!1),j(null),alert(e.password?"User updated successfully! Password has been changed.":"User updated successfully!")}catch(a){var t,n;console.error("Error updating user:",a),alert((null===(t=a.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.message)||"Failed to update user")}N(!1)}},className:"space-y-4",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[(0,fn.jsx)(gl,{className:"inline h-4 w-4 mr-2"}),"Full Name"]}),(0,fn.jsx)("input",{type:"text",name:"name",value:v.name,onChange:e=>j(t=>He(He({},t),{},{name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter full name"})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[(0,fn.jsx)(Wr,{className:"inline h-4 w-4 mr-2"}),"Email Address"]}),(0,fn.jsx)("input",{type:"email",name:"email",value:v.email,onChange:e=>j(t=>He(He({},t),{},{email:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter email address"})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[(0,fn.jsx)(zr,{className:"inline h-4 w-4 mr-2"}),"New Password"]}),(0,fn.jsx)("input",{type:"password",name:"password",value:v.password,onChange:e=>j(t=>He(He({},t),{},{password:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Leave blank to keep current password"}),(0,fn.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Leave blank to keep current password. Must be at least 6 characters if changing."})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[(0,fn.jsx)(rl,{className:"inline h-4 w-4 mr-2"}),"Role"]}),(0,fn.jsxs)("select",{name:"role",value:v.role,onChange:e=>j(t=>He(He({},t),{},{role:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,fn.jsx)("option",{value:"booker",children:"Booker"}),(0,fn.jsx)("option",{value:"viewer",children:"Viewer"}),(0,fn.jsx)("option",{value:"photographer",children:"Photographer"}),(0,fn.jsx)("option",{value:"admin",children:"Administrator"})]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[(0,fn.jsx)(Wr,{className:"inline h-4 w-4 mr-2"}),"Email Account"]}),(0,fn.jsxs)("select",{name:"assigned_email_account_id",value:v.assigned_email_account_id||"",onChange:e=>j(t=>He(He({},t),{},{assigned_email_account_id:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,fn.jsx)("option",{value:"",children:"System Default"}),i.map(e=>(0,fn.jsxs)("option",{value:e.id,children:[e.name," (",e.email,")",e.is_default?" - Default":""]},e.id))]}),(0,fn.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Email account used for sending messages from this user"})]}),(0,fn.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,fn.jsx)("button",{type:"button",onClick:()=>y(!1),className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",children:"Cancel"}),(0,fn.jsx)("button",{type:"submit",disabled:w,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2",children:w?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),(0,fn.jsx)("span",{children:"Updating..."})]}):(0,fn.jsx)("span",{children:"Update User"})})]})]})]})}),k&&(0,fn.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,fn.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[(0,fn.jsxs)("div",{className:"text-center",children:[(0,fn.jsx)("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100",children:(0,fn.jsx)(cl,{className:"h-6 w-6 text-red-600"})}),(0,fn.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900 mt-4",children:"Delete User"}),(0,fn.jsx)("div",{className:"mt-2 px-7 py-3",children:(0,fn.jsx)("p",{className:"text-sm text-gray-500",children:"Are you sure you want to delete this user? This action cannot be undone."})})]}),(0,fn.jsxs)("div",{className:"mt-5 sm:mt-6 flex justify-center space-x-4",children:[(0,fn.jsx)("button",{type:"button",onClick:()=>S(!1),className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",children:"Cancel"}),(0,fn.jsx)("button",{type:"button",onClick:async()=>{if(C){T(!0);try{await gn.delete("/api/users/".concat(C)),s(e=>e.filter(e=>e.id!==C)),S(!1),_(null),alert("User deleted successfully!")}catch(n){var e,t;console.error("Error deleting user:",n),alert((null===(e=n.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Failed to delete user")}T(!1)}},disabled:E,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2",children:E?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),(0,fn.jsx)("span",{children:"Deleting..."})]}):(0,fn.jsx)("span",{children:"Delete User"})})]})]})})]})},kc=tc("dollar-sign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),Sc=tc("credit-card",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),Cc=tc("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]]),_c=tc("message-square",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),Ec=e=>{let{isOpen:t,onClose:s,lead:n,existingSale:r,onSaveSuccess:l}=e;const[o,i]=(0,a.useState)({saleAmount:r&&r.saleAmount?r.saleAmount.toString():"",paymentMethod:(null===r||void 0===r?void 0:r.paymentMethod)||"cash",paymentType:(null===r||void 0===r?void 0:r.paymentType)||"full_payment",financeAmount:"",financeFrequency:"monthly",financeStartDate:(new Date).toISOString().split("T")[0],notes:(null===r||void 0===r?void 0:r.notes)||"",images:[],emailReceipt:!1,smsReceipt:!1,customEmail:"",customPhone:""}),[c,d]=(0,a.useState)(!1),[u,m]=(0,a.useState)(!1),[h,p]=(0,a.useState)([]),[x,g]=(0,a.useState)("");(0,a.useEffect)(()=>{t&&(async()=>{try{const e=await fetch("/api/templates?isActive=true",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(e.ok){const t=await e.json(),s=t.filter(e=>{const t=(e.type||"").toLowerCase(),s=(e.category||"").toLowerCase();return t.includes("receipt")||t.includes("sale_notification")||s.includes("receipt")||s.includes("sale")||s.includes("payment")}),n=s.length>0?s:t;if(p(n),n.length>0){const e=n[0]._id;g(e),console.log("\ud83d\udccb Default template selected:",{id:e,name:n[0].name,email_account:n[0].email_account,allTemplates:n.map(e=>"".concat(e.name," (").concat(e.email_account,")"))})}}}catch(e){console.error("Error fetching templates:",e)}})()},[t]),(0,a.useEffect)(()=>{i(r?{saleAmount:r.saleAmount?r.saleAmount.toString():"",paymentMethod:r.paymentMethod||"cash",paymentType:r.paymentType||"full_payment",financeAmount:"",financeFrequency:"monthly",financeStartDate:(new Date).toISOString().split("T")[0],notes:r.notes||"",images:[],emailReceipt:!1,smsReceipt:!1,customEmail:"",customPhone:""}:{saleAmount:"",paymentMethod:"cash",paymentType:"full_payment",financeAmount:"",financeFrequency:"monthly",financeStartDate:(new Date).toISOString().split("T")[0],notes:"",images:[],emailReceipt:!1,smsReceipt:!1,customEmail:"",customPhone:""})},[r]);const f=e=>{const{name:t,value:s,type:n,checked:a}=e.target;i(e=>He(He({},e),{},{[t]:"checkbox"===n?a:s}))},b=async e=>{try{const t={leadId:n.id,totalAmount:parseFloat(o.saleAmount),paymentAmount:parseFloat(o.financeAmount),frequency:o.financeFrequency,startDate:o.financeStartDate,notes:"Finance agreement created from sale ".concat(e)};if(!(await fetch("/api/finance",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify(t)})).ok)throw new Error("Failed to create finance agreement")}catch(t){console.error("Error creating finance agreement:",t),alert("Sale saved but failed to create finance agreement. Please create it manually.")}},y=async e=>{m(!0);try{const t=[],s=h.find(e=>e._id===x);console.log("\ud83d\udce7 FRONTEND: Sending receipt with template:",{selectedTemplateId:x,selectedTemplateIdType:typeof x,templateId:x,templateName:null===s||void 0===s?void 0:s.name,emailAccount:(null===s||void 0===s?void 0:s.email_account)||"primary",allTemplates:h.map(e=>({id:e._id,name:e.name,email_account:e.email_account}))}),o.emailReceipt&&t.push(fetch("/api/sales/".concat(e,"/send-receipt/email"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify({email:o.customEmail||n.email,templateId:x})}).then(async e=>{if(!e.ok){const t=await e.json().catch(()=>({error:"Unknown error"}));throw new Error("Email receipt failed: ".concat(e.status," - ").concat(t.error||t.message||"Unknown error"))}return e.json()})),o.smsReceipt&&t.push(fetch("/api/sales/".concat(e,"/send-receipt/sms"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify({phone:o.customPhone||n.phone,templateId:x})}).then(async e=>{if(!e.ok){const t=await e.json().catch(()=>({error:"Unknown error"}));throw new Error("SMS receipt failed: ".concat(e.status," - ").concat(t.error||t.message||"Unknown error"))}return e.json()}));const a=await Promise.allSettled(t);a.forEach((e,t)=>{const s=0===t&&o.emailReceipt?"email":"SMS";"fulfilled"===e.status?console.log("\u2705 ".concat(s," receipt sent successfully")):console.error("\u274c ".concat(s," receipt failed:"),e.reason)});const r=a.filter(e=>"rejected"===e.status);r.length>0?(console.error("\u274c ".concat(r.length," receipt(s) failed to send")),alert("Sale saved but ".concat(r.length," receipt(s) failed to send. Check console for details."))):console.log("\u2705 All receipts sent successfully")}catch(t){console.error("Error sending receipts:",t),alert("Sale saved but failed to send receipts. You can send them manually later.")}finally{m(!1)}};if(!t)return null;const v=0===h.length;return(0,fn.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,fn.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[98vh] flex flex-col overflow-hidden",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between p-6 border-b bg-white sticky top-0 z-10",children:[(0,fn.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:r?"Edit Sale":"Record Sale"}),(0,fn.jsx)("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-full",children:(0,fn.jsx)(nc,{className:"w-5 h-5"})})]}),(0,fn.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),d(!0);try{const e={saleAmount:parseFloat(o.saleAmount),paymentMethod:o.paymentMethod,paymentType:o.paymentType,notes:o.notes,sendReceipt:o.emailReceipt||o.smsReceipt,customEmail:o.customEmail||n.email,customPhone:o.customPhone||n.phone};let t;if(r?t=await fetch("/api/sales/".concat(r.id),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify(e)}):(e.leadId=n.id,t=await fetch("/api/sales",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify(e)})),!t.ok){const e=await t.json();throw new Error(e.error||"Failed to save sale")}{const e=await t.json();console.log("\u2705 Sale completed successfully:",e),"finance"!==o.paymentType||r||await b(e.id),(o.emailReceipt||o.smsReceipt)&&e.id&&await y(e.id),null===l||void 0===l||l(),s()}}catch(t){console.error("Error saving sale:",t),alert("Failed to save sale: "+t.message)}finally{d(!1)}},className:"p-6 space-y-6 overflow-y-auto flex-1",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sale Amount (\xa3)"}),(0,fn.jsxs)("div",{className:"relative",children:[(0,fn.jsx)(kc,{className:"absolute left-3 top-3 w-5 h-5 text-gray-400"}),(0,fn.jsx)("input",{type:"number",name:"saleAmount",value:o.saleAmount,onChange:f,step:"0.01",min:"0",required:!0,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0.00"})]})]}),(0,fn.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,fn.jsx)("h3",{className:"font-medium text-gray-900 mb-2",children:"Customer Information"}),(0,fn.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("span",{className:"font-medium",children:"Name:"})," ",n.name]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("span",{className:"font-medium",children:"Email:"})," ",n.email]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("span",{className:"font-medium",children:"Phone:"})," ",n.phone]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("span",{className:"font-medium",children:"Booking Date:"})," ",new Date(n.dateBooked).toLocaleDateString()]})]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Payment Type"}),(0,fn.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,fn.jsxs)("label",{className:"flex items-center p-3 border border-gray-300 rounded-md cursor-pointer hover:bg-gray-50",children:[(0,fn.jsx)("input",{type:"radio",name:"paymentType",value:"full_payment",checked:"full_payment"===o.paymentType,onChange:f,className:"mr-2"}),(0,fn.jsx)("span",{className:"text-sm font-medium",children:"Full Payment"})]}),(0,fn.jsxs)("label",{className:"flex items-center p-3 border border-gray-300 rounded-md cursor-pointer hover:bg-gray-50",children:[(0,fn.jsx)("input",{type:"radio",name:"paymentType",value:"finance",checked:"finance"===o.paymentType,onChange:f,className:"mr-2"}),(0,fn.jsx)("span",{className:"text-sm font-medium",children:"Finance Agreement"})]})]})]}),"finance"===o.paymentType&&(0,fn.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg space-y-4",children:[(0,fn.jsx)("h3",{className:"font-medium text-gray-900",children:"Finance Agreement Details"}),(0,fn.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["weekly"===o.financeFrequency?"Weekly":"Monthly"," Payment Amount (\xa3)"]}),(0,fn.jsx)("input",{type:"number",name:"financeAmount",value:o.financeAmount,onChange:f,step:"0.01",min:"0",required:"finance"===o.paymentType,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter custom payment amount"}),(0,fn.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Set how much the customer will pay each ","weekly"===o.financeFrequency?"week":"month"]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Frequency"}),(0,fn.jsxs)("select",{name:"financeFrequency",value:o.financeFrequency,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,fn.jsx)("option",{value:"weekly",children:"Weekly"}),(0,fn.jsx)("option",{value:"monthly",children:"Monthly"})]})]})]}),o.saleAmount&&o.financeAmount&&(0,fn.jsxs)("div",{className:"bg-white p-3 rounded-md border border-blue-200",children:[(0,fn.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Payment Summary"}),(0,fn.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("span",{className:"text-gray-600",children:"Total Amount:"}),(0,fn.jsxs)("span",{className:"font-medium ml-2",children:["\xa3",parseFloat(o.saleAmount).toFixed(2)]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("span",{className:"text-gray-600",children:["weekly"===o.financeFrequency?"Weekly":"Monthly"," Payment:"]}),(0,fn.jsxs)("span",{className:"font-medium ml-2",children:["\xa3",parseFloat(o.financeAmount||0).toFixed(2)]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("span",{className:"text-gray-600",children:"Number of Payments:"}),(0,fn.jsx)("span",{className:"font-medium ml-2",children:o.financeAmount>0?Math.ceil(parseFloat(o.saleAmount)/parseFloat(o.financeAmount)):0})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("span",{className:"text-gray-600",children:"Duration:"}),(0,fn.jsx)("span",{className:"font-medium ml-2",children:o.financeAmount>0?"weekly"===o.financeFrequency?"".concat(Math.ceil(parseFloat(o.saleAmount)/parseFloat(o.financeAmount))," weeks"):"".concat(Math.ceil(parseFloat(o.saleAmount)/parseFloat(o.financeAmount))," months"):"0 months"})]})]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Date"}),(0,fn.jsx)("input",{type:"date",name:"financeStartDate",value:o.financeStartDate,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Payment Method"}),(0,fn.jsxs)("div",{className:"relative",children:[(0,fn.jsx)(Sc,{className:"absolute left-3 top-3 w-5 h-5 text-gray-400"}),(0,fn.jsxs)("select",{name:"paymentMethod",value:o.paymentMethod,onChange:f,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,fn.jsx)("option",{value:"cash",children:"Cash"}),(0,fn.jsx)("option",{value:"card",children:"Card"}),(0,fn.jsx)("option",{value:"bank_transfer",children:"Bank Transfer"}),(0,fn.jsx)("option",{value:"other",children:"Other"})]})]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes (Optional)"}),(0,fn.jsx)("textarea",{name:"notes",value:o.notes,onChange:f,rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Any additional notes about the sale..."})]}),(0,fn.jsxs)("div",{className:"bg-gray-100 p-4 rounded-lg",children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Upload Images (Coming Soon)"}),(0,fn.jsx)("p",{className:"text-sm text-gray-500",children:"Image upload feature will be available in the next update."})]}),(0,fn.jsxs)("div",{className:"bg-blue-50 border border-blue-200 p-4 rounded-lg",children:[(0,fn.jsx)("h3",{className:"font-medium text-gray-900 mb-3",children:"Send Receipt"}),(0,fn.jsxs)("div",{className:"space-y-4",children:[h.length>0?(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Receipt Template"}),(0,fn.jsx)("select",{value:x,onChange:e=>g(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:h.map(e=>(0,fn.jsxs)("option",{value:e._id,children:[e.name," ","secondary"===e.email_account?"(Diary@edgetalent.co.uk)":"(Primary)"]},e._id))}),(0,fn.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"Emails sent via Gmail API from the template's configured account."})]}):(0,fn.jsx)("div",{className:"text-sm text-gray-600 bg-white border border-gray-200 rounded-md p-3",children:"No receipt templates available. Add one in Templates to send automated receipts."}),(0,fn.jsxs)("div",{className:"flex flex-col space-y-3",children:[(0,fn.jsxs)("label",{className:"flex items-center ".concat(v?"opacity-60 cursor-not-allowed":""),children:[(0,fn.jsx)("input",{type:"checkbox",id:"emailReceipt",name:"emailReceipt",checked:o.emailReceipt,onChange:f,disabled:v,className:"w-4 h-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500 disabled:opacity-60 disabled:cursor-not-allowed"}),(0,fn.jsxs)("span",{className:"ml-2 text-sm text-gray-700 flex items-center",children:[(0,fn.jsx)(Cc,{className:"w-4 h-4 mr-1"}),"Send Email Receipt"]})]}),o.emailReceipt&&(0,fn.jsxs)("div",{className:"pl-6 space-y-2",children:[(0,fn.jsx)("label",{className:"block text-xs font-medium text-gray-600",children:"Recipient Email"}),(0,fn.jsx)("input",{type:"email",name:"customEmail",value:o.customEmail,onChange:f,placeholder:n.email||"customer@example.com",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,fn.jsxs)("p",{className:"text-xs text-gray-500",children:["Leave blank to use ",n.email||"the lead email on file","."]})]}),(0,fn.jsxs)("label",{className:"flex items-center ".concat(v?"opacity-60 cursor-not-allowed":""),children:[(0,fn.jsx)("input",{type:"checkbox",id:"smsReceipt",name:"smsReceipt",checked:o.smsReceipt,onChange:f,disabled:v,className:"w-4 h-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500 disabled:opacity-60 disabled:cursor-not-allowed"}),(0,fn.jsxs)("span",{className:"ml-2 text-sm text-gray-700 flex items-center",children:[(0,fn.jsx)(_c,{className:"w-4 h-4 mr-1"}),"Send SMS Receipt"]})]}),o.smsReceipt&&(0,fn.jsxs)("div",{className:"pl-6 space-y-2",children:[(0,fn.jsx)("label",{className:"block text-xs font-medium text-gray-600",children:"Recipient Phone"}),(0,fn.jsx)("input",{type:"tel",name:"customPhone",value:o.customPhone,onChange:f,placeholder:n.phone||"+44 1234 567890",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,fn.jsxs)("p",{className:"text-xs text-gray-500",children:["Leave blank to use ",n.phone||"the lead phone number on file","."]})]})]}),v?(0,fn.jsx)("div",{className:"text-xs text-orange-700 bg-orange-100 rounded-md p-3",children:"Add receipt templates in Templates to enable automatic receipt sending."}):(0,fn.jsx)("div",{className:"text-xs text-blue-700 bg-blue-100 rounded-md p-3",children:"Receipts are sent immediately after saving the sale when selected above. You can choose email, SMS, or both."})]})]}),(0,fn.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,fn.jsx)("button",{type:"button",onClick:s,className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"}),(0,fn.jsx)("button",{type:"submit",disabled:c||u,className:"px-6 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:c?"Saving...":u?"Sending Receipts...":r?"Update Sale":"Save Sale"})]})]})]})})},Tc=tc("crown",[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]]),Pc=tc("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]),Ac=tc("package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]),Dc=tc("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),Lc=tc("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),Mc=tc("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),Rc=tc("minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),Fc=tc("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Ic=tc("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),Oc=e=>{var t,s;return e&&null!==(t=null!==(s=e.imageCount)&&void 0!==s?s:e.image_count)&&void 0!==t?t:null},Bc=e=>{let{isOpen:t,onClose:s,lead:n,onPackagesSelected:r,onSendContract:l,onPackageSelected:o,onChangeImages:i,selectedPhotoCount:c=0,selectedPhotoIds:d=[],onTrimSelection:u,initialPackage:m=null}=e;const[h,p]=(0,a.useState)({main:[],individual:[]}),[x,g]=(0,a.useState)(!0),[f,b]=(0,a.useState)(null),[y,v]=(0,a.useState)(null),[j,w]=(0,a.useState)({}),[N,k]=(0,a.useState)(null),[S,C]=(0,a.useState)(!1),[_,E]=(0,a.useState)({subtotal:0,vatAmount:0,total:0,items:[]}),T=(0,a.useCallback)(async()=>{g(!0),b(null);try{const e=await fetch("/api/packages",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(!e.ok)throw new Error("Failed to fetch packages");const t=await e.json();p({main:t.mainPackages||[],individual:t.individualPackages||[]})}catch(ty){console.error("Error fetching packages:",ty),b(ty.message)}finally{g(!1)}},[]);(0,a.useEffect)(()=>{t&&(T(),m||(v(null),w({}),E({subtotal:0,vatAmount:0,total:0,items:[]})))},[t,T,m]),(0,a.useEffect)(()=>{if(t&&m&&h.main.length>0){const e=h.main.find(e=>e.id===m.id);e&&v(e)}},[t,m,h.main]),(0,a.useEffect)(()=>{P()},[y,j]);const P=async()=>{const e=[];if(y&&e.push({packageId:y.id,quantity:1}),Object.entries(j).forEach(t=>{let[s,n]=t;n>0&&e.push({packageId:s,quantity:n})}),0!==e.length){C(!0);try{const t=await fetch("/api/packages/calculate-total",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify({items:e})});if(t.ok){const e=await t.json();E({subtotal:e.calculation.subtotal,vatAmount:e.calculation.vatAmount,total:e.calculation.total,items:e.calculation.items})}}catch(ty){console.error("Error calculating totals:",ty)}finally{C(!1)}}else E({subtotal:0,vatAmount:0,total:0,items:[]})},A=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;w(s=>{const n=s[e.id]||0,a=Math.max(0,n+t);if(0===a){const t=e.id,{[t]:n}=s;return Si(s,[t].map(Ve))}return He(He({},s),{},{[e.id]:a})})},D=e=>"\xa3".concat(parseFloat(e).toFixed(2)),L=(0,a.useMemo)(()=>{if(!y)return{valid:!0,message:null,excess:0};const e=Oc(y);if(null===e||void 0===e)return{valid:!0,message:c>0?"".concat(c," photos selected (unlimited included)"):"Full shoot - unlimited images included",excess:0};if(c<=e)return{valid:!0,message:"".concat(c," of ").concat(e," photos selected"),excess:0};const t=c-e;return{valid:!0,message:"".concat(c," of ").concat(e," photos selected (+").concat(t," extra)"),excess:t,hasExcess:!0}},[y,c]),M=e=>{switch(e){case"platinum":return(0,fn.jsx)(Tc,{className:"w-5 h-5 text-purple-500"});case"gold":return(0,fn.jsx)(Pc,{className:"w-5 h-5 text-yellow-500"});case"silver":return(0,fn.jsx)(Pc,{className:"w-5 h-5 text-gray-400"});default:return(0,fn.jsx)(Ac,{className:"w-5 h-5 text-blue-500"})}},R=e=>{switch(e){case"platinum":return"from-purple-500 to-indigo-600";case"gold":return"from-yellow-500 to-amber-600";case"silver":return"from-gray-400 to-gray-600";case"intro":return"from-blue-500 to-cyan-600";default:return"from-gray-500 to-gray-700"}};if(!t)return null;y||Object.values(j).some(e=>e>0);return(0,fn.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:(0,fn.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-5xl max-h-[95vh] flex flex-col overflow-hidden",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b bg-gradient-to-r from-green-600 to-emerald-600",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,fn.jsx)("div",{className:"p-2 bg-white bg-opacity-20 rounded-lg",children:(0,fn.jsx)(Ac,{className:"w-5 h-5 text-white"})}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("h2",{className:"text-xl font-semibold text-white",children:"Select Package"}),(0,fn.jsx)("p",{className:"text-green-100 text-sm",children:null!==n&&void 0!==n&&n.name?"For ".concat(n.name):"Choose a package for this client"})]})]}),(0,fn.jsx)("button",{onClick:s,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors",children:(0,fn.jsx)(nc,{className:"w-6 h-6 text-white"})})]}),(0,fn.jsx)("div",{className:"flex-1 overflow-y-auto",children:x?(0,fn.jsxs)("div",{className:"flex flex-col items-center justify-center py-20",children:[(0,fn.jsx)(oc,{className:"w-10 h-10 text-green-600 animate-spin mb-4"}),(0,fn.jsx)("p",{className:"text-gray-500",children:"Loading packages..."})]}):f?(0,fn.jsxs)("div",{className:"flex flex-col items-center justify-center py-20",children:[(0,fn.jsx)("p",{className:"text-red-600 font-medium",children:f}),(0,fn.jsx)("button",{onClick:T,className:"mt-4 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"Retry"})]}):(0,fn.jsxs)("div",{className:"p-6 space-y-8",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,fn.jsx)(Ac,{className:"w-5 h-5 mr-2 text-green-600"}),"Main Packages (VAT Inclusive)"]}),(0,fn.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:h.main.map(e=>(0,fn.jsxs)("div",{onClick:()=>(e=>{(null===y||void 0===y?void 0:y.id)===e.id?v(null):v(e)})(e),className:"relative cursor-pointer rounded-xl overflow-hidden transition-all duration-200 ".concat((null===y||void 0===y?void 0:y.id)===e.id?"ring-4 ring-green-500 ring-offset-2 transform scale-[1.02]":"hover:shadow-xl hover:scale-[1.01]"),children:[(0,fn.jsxs)("div",{className:"p-4 bg-gradient-to-br ".concat(R(e.code)," text-white"),children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[M(e.code),(null===y||void 0===y?void 0:y.id)===e.id&&(0,fn.jsx)("div",{className:"w-6 h-6 bg-white rounded-full flex items-center justify-center",children:(0,fn.jsx)(ac,{className:"w-4 h-4 text-green-600"})})]}),(0,fn.jsx)("h4",{className:"text-xl font-bold",children:e.name}),e.totalValue&&(0,fn.jsxs)("p",{className:"text-sm opacity-80 line-through",children:["Value: ",D(e.totalValue)]}),(0,fn.jsx)("p",{className:"text-2xl font-bold mt-1",children:D(e.price)})]}),(0,fn.jsxs)("div",{className:"p-4 bg-white border border-gray-200 border-t-0 rounded-b-xl",children:[(()=>{const t=Oc(e),s=null===t||c<=(t||0);return(0,fn.jsxs)("div",{className:"flex items-center justify-between py-2 px-3 rounded-lg mb-3 ".concat((null===y||void 0===y?void 0:y.id)===e.id?s?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200":"bg-gray-50"),children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,fn.jsx)(sc,{className:"w-4 h-4 ".concat((null===y||void 0===y?void 0:y.id)===e.id?s?"text-green-600":"text-red-500":"text-gray-500")}),(0,fn.jsx)("span",{className:"text-sm font-medium ".concat((null===y||void 0===y?void 0:y.id)===e.id?s?"text-green-700":"text-red-700":"text-gray-700"),children:null===t?"Full Shoot":"".concat(t," images")})]}),(null===y||void 0===y?void 0:y.id)===e.id&&c>0&&(0,fn.jsx)("span",{className:"text-xs font-medium ".concat(s?"text-green-600":"text-red-600"),children:null===t?"".concat(c," selected"):"".concat(c,"/").concat(t)})]})})(),(0,fn.jsxs)("button",{onClick:t=>{t.stopPropagation(),k(N===e.id?null:e.id)},className:"flex items-center justify-between w-full text-sm text-gray-600 hover:text-gray-900",children:[(0,fn.jsx)("span",{children:"What's included"}),N===e.id?(0,fn.jsx)(Dc,{className:"w-4 h-4"}):(0,fn.jsx)(Lc,{className:"w-4 h-4"})]}),N===e.id&&e.includes&&(0,fn.jsx)("ul",{className:"mt-3 space-y-1.5",children:e.includes.map((e,t)=>(0,fn.jsxs)("li",{className:"flex items-start text-sm text-gray-600",children:[(0,fn.jsx)(ac,{className:"w-4 h-4 text-green-500 mr-2 flex-shrink-0 mt-0.5"}),(0,fn.jsx)("span",{children:e})]},t))})]})]},e.id))})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,fn.jsx)(Mc,{className:"w-5 h-5 mr-2 text-green-600"}),"Individual Items (+VAT)"]}),(0,fn.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:h.individual.map(e=>{const t=j[e.id]||0,s=1.2*(parseFloat(e.price)||0);return(0,fn.jsxs)("div",{className:"p-4 rounded-xl border-2 transition-all ".concat(t>0?"border-green-500 bg-green-50":"border-gray-200 bg-white hover:border-gray-300"),children:[(0,fn.jsxs)("div",{className:"flex items-start justify-between",children:[(0,fn.jsxs)("div",{className:"flex-1",children:[(0,fn.jsx)("h4",{className:"font-medium text-gray-900",children:e.name}),(0,fn.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:e.description}),(0,fn.jsxs)("p",{className:"text-lg font-semibold text-gray-900 mt-2",children:[D(e.price),(0,fn.jsx)("span",{className:"text-sm font-normal text-gray-500",children:" +VAT"})]}),(0,fn.jsxs)("p",{className:"text-xs text-gray-400",children:["(",D(s)," inc. VAT)"]})]}),(0,fn.jsxs)("div",{className:"flex items-center space-x-2 ml-4",children:[(0,fn.jsx)("button",{onClick:()=>A(e,-1),disabled:0===t,className:"p-1.5 rounded-lg border border-gray-300 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,fn.jsx)(Rc,{className:"w-4 h-4"})}),(0,fn.jsx)("span",{className:"w-8 text-center font-medium",children:t}),(0,fn.jsx)("button",{onClick:()=>A(e,1),className:"p-1.5 rounded-lg border border-green-500 bg-green-500 text-white hover:bg-green-600",children:(0,fn.jsx)(Mc,{className:"w-4 h-4"})})]})]}),e.includes&&e.includes.length>0&&(0,fn.jsx)("ul",{className:"mt-3 space-y-1",children:e.includes.slice(0,2).map((e,t)=>(0,fn.jsxs)("li",{className:"flex items-center text-xs text-gray-500",children:[(0,fn.jsx)(ac,{className:"w-3 h-3 text-green-500 mr-1.5"}),e]},t))})]},e.id)})})]})]})}),(0,fn.jsx)("div",{className:"border-t bg-gray-50 p-6",children:(0,fn.jsxs)("div",{className:"flex items-start justify-between",children:[(0,fn.jsxs)("div",{className:"flex-1",children:[(0,fn.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"Order Summary"}),_.items.length>0?(0,fn.jsxs)("div",{className:"space-y-1 text-sm",children:[_.items.map((e,t)=>(0,fn.jsxs)("div",{className:"flex justify-between text-gray-600",children:[(0,fn.jsxs)("span",{children:[e.name,e.quantity>1&&" x".concat(e.quantity)]}),(0,fn.jsx)("span",{children:D(e.lineTotal)})]},t)),(0,fn.jsxs)("div",{className:"pt-2 border-t mt-2 space-y-1",children:[(0,fn.jsxs)("div",{className:"flex justify-between text-gray-600",children:[(0,fn.jsx)("span",{children:"Subtotal"}),(0,fn.jsx)("span",{children:D(_.subtotal)})]}),(0,fn.jsxs)("div",{className:"flex justify-between text-gray-600",children:[(0,fn.jsx)("span",{children:"VAT (20%)"}),(0,fn.jsx)("span",{children:D(_.vatAmount)})]})]})]}):(0,fn.jsx)("p",{className:"text-sm text-gray-500",children:"No items selected"})]}),(0,fn.jsxs)("div",{className:"ml-8 text-right",children:[(0,fn.jsxs)("div",{className:"mb-4",children:[(0,fn.jsx)("p",{className:"text-sm text-gray-500",children:"Total"}),(0,fn.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:S?(0,fn.jsx)(oc,{className:"w-6 h-6 animate-spin inline"}):D(_.total)}),c>0&&y&&(0,fn.jsxs)("div",{className:"mt-2 text-sm flex items-center justify-end space-x-1 ".concat(L.hasExcess?"text-amber-600":"text-green-600"),children:[(0,fn.jsx)(sc,{className:"w-4 h-4"}),(0,fn.jsx)("span",{children:L.message})]})]}),L.hasExcess&&(0,fn.jsx)("div",{className:"mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg text-left",children:(0,fn.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,fn.jsx)(Fc,{className:"w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5"}),(0,fn.jsx)("div",{children:(0,fn.jsxs)("p",{className:"text-sm font-medium text-amber-800",children:[L.excess," extra photo",L.excess>1?"s":""," beyond package limit - you can adjust pricing on next screen"]})})]})}),(0,fn.jsxs)("div",{className:"flex space-x-3",children:[(0,fn.jsx)("button",{onClick:s,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),o&&y&&0===c&&(0,fn.jsxs)("button",{onClick:()=>o(y),className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center space-x-2",children:[(0,fn.jsx)(sc,{className:"w-4 h-4"}),(0,fn.jsxs)("span",{children:["Select Images",Oc(y)?" (".concat(Oc(y)," max)"):" (Unlimited)"]})]}),y&&c>0&&(i||o)&&(0,fn.jsxs)("button",{onClick:()=>(i||o)(y),className:"px-4 py-2 bg-purple-100 text-purple-700 border border-purple-300 rounded-lg hover:bg-purple-200 transition-colors flex items-center space-x-2",children:[(0,fn.jsx)(sc,{className:"w-4 h-4"}),(0,fn.jsxs)("span",{children:["Change Images (",c,")"]})]}),l&&y&&(0,fn.jsxs)("button",{onClick:()=>l({leadId:n.id,package:y,items:_.items,totals:_}),disabled:S,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2",children:[(0,fn.jsx)(Ic,{className:"w-4 h-4"}),(0,fn.jsx)("span",{children:"Generate Invoice"})]}),!y&&Object.values(j).some(e=>e>0)&&(0,fn.jsx)(fn.Fragment,{children:l&&(0,fn.jsxs)("button",{onClick:()=>{const e=Object.entries(j).filter(e=>{let[t,s]=e;return s>0}).map(e=>{let[t,s]=e;const n=h.individual.find(e=>e.id===t);return n?He(He({},n),{},{quantity:s}):null}).filter(Boolean),t=e.map(e=>(e.name||"").toLowerCase()+" "+(e.code||"").toLowerCase()).join(" "),s={id:"individual-items",name:e.map(e=>"".concat(e.name).concat(e.quantity>1?" x".concat(e.quantity):"")).join(", "),code:"individual",price:_.subtotal,includes:e.flatMap(e=>e.includes||[]),hasZCard:t.includes("z-card")||t.includes("zcard"),hasEfolio:t.includes("efolio")||t.includes("e-folio"),hasProjectInfluencer:t.includes("influencer"),has3Lance:t.includes("3lance")||t.includes("casting"),hasAgencyList:t.includes("agency")||t.includes("agency list")};l({leadId:n.id,package:s,items:_.items,totals:_})},disabled:S,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2",children:[(0,fn.jsx)(Ic,{className:"w-4 h-4"}),(0,fn.jsx)("span",{children:"Generate Invoice"})]})})]})]})]})})]})})},Uc=tc("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),zc=tc("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),Vc=tc("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),Wc=tc("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),qc=tc("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),Hc=e=>{let{onSave:t,onCancel:s,saving:n=!1,width:r=500,height:l=200,penColor:o="#1a1a2e",backgroundColor:i="#ffffff"}=e;const c=(0,a.useRef)(null),[d,u]=(0,a.useState)(!1),[m,h]=(0,a.useState)(!1),[p,x]=(0,a.useState)(null);(0,a.useEffect)(()=>{const e=c.current;if(!e)return;const t=e.getContext("2d"),s=window.devicePixelRatio||1;e.width=r*s,e.height=l*s,e.style.width="".concat(r,"px"),e.style.height="".concat(l,"px"),t.scale(s,s),t.fillStyle=i,t.fillRect(0,0,r,l),t.strokeStyle=o,t.lineWidth=2,t.lineCap="round",t.lineJoin="round",x(t)},[r,l,o,i]);const g=(0,a.useCallback)(e=>{const t=c.current.getBoundingClientRect();return e.touches?{x:e.touches[0].clientX-t.left,y:e.touches[0].clientY-t.top}:{x:e.clientX-t.left,y:e.clientY-t.top}},[]),f=(0,a.useCallback)(e=>{if(!p)return;e.preventDefault();const t=g(e);p.beginPath(),p.moveTo(t.x,t.y),u(!0),h(!0)},[p,g]),b=(0,a.useCallback)(e=>{if(!d||!p)return;e.preventDefault();const t=g(e);p.lineTo(t.x,t.y),p.stroke()},[d,p,g]),y=(0,a.useCallback)(()=>{p&&(p.closePath(),u(!1))},[p]),v=(0,a.useCallback)(()=>{p&&(p.fillStyle=i,p.fillRect(0,0,r,l),h(!1))},[p,r,l,i]),j=(0,a.useCallback)(()=>{const e=c.current;return e?e.toDataURL("image/png"):null},[]),w=(0,a.useCallback)(()=>{if(!m)return void alert("Please sign in the box above");const e=j();e&&(null===t||void 0===t||t(e))},[m,j,t]);return(0,a.useEffect)(()=>{const e=c.current;if(e)return e.addEventListener("mousedown",f),e.addEventListener("mousemove",b),e.addEventListener("mouseup",y),e.addEventListener("mouseout",y),e.addEventListener("touchstart",f,{passive:!1}),e.addEventListener("touchmove",b,{passive:!1}),e.addEventListener("touchend",y),()=>{e.removeEventListener("mousedown",f),e.removeEventListener("mousemove",b),e.removeEventListener("mouseup",y),e.removeEventListener("mouseout",y),e.removeEventListener("touchstart",f),e.removeEventListener("touchmove",b),e.removeEventListener("touchend",y)}},[f,b,y]),(0,fn.jsxs)("div",{className:"space-y-4",children:[(0,fn.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:(0,fn.jsx)("p",{className:"text-sm text-blue-800",children:"Please sign in the box below using your mouse or finger (on touch devices). Your signature confirms acceptance of the invoice terms."})}),(0,fn.jsxs)("div",{className:"relative",children:[(0,fn.jsxs)("div",{className:"border-2 border-gray-300 rounded-lg overflow-hidden bg-white",children:[(0,fn.jsx)("canvas",{ref:c,className:"cursor-crosshair touch-none",style:{display:"block"}}),(0,fn.jsx)("div",{className:"absolute bottom-8 left-8 right-8 border-b border-gray-300",style:{pointerEvents:"none"}}),(0,fn.jsx)("div",{className:"absolute bottom-2 left-8 text-xs text-gray-400",style:{pointerEvents:"none"},children:"Sign above this line"})]}),!m&&(0,fn.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",style:{opacity:.3},children:(0,fn.jsx)("p",{className:"text-gray-400 text-lg italic",children:"Sign here"})})]}),(0,fn.jsxs)("div",{className:"flex items-center justify-between",children:[(0,fn.jsxs)("button",{onClick:v,className:"flex items-center space-x-2 px-4 py-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:[(0,fn.jsx)(qc,{className:"w-4 h-4"}),(0,fn.jsx)("span",{children:"Clear"})]}),(0,fn.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,fn.jsxs)("button",{onClick:s,className:"flex items-center space-x-2 px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,fn.jsx)(nc,{className:"w-4 h-4"}),(0,fn.jsx)("span",{children:"Cancel"})]}),(0,fn.jsxs)("button",{onClick:w,disabled:!m||n,className:"flex items-center space-x-2 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[n?(0,fn.jsx)(oc,{className:"w-4 h-4 animate-spin"}):(0,fn.jsx)(ac,{className:"w-4 h-4"}),(0,fn.jsx)("span",{children:n?"Saving...":"Accept & Sign"})]})]})]}),(0,fn.jsx)("p",{className:"text-xs text-gray-500 text-center",children:"By signing above, I confirm that I have read and agree to the terms of this invoice. I authorise the charges as listed."})]})},Yc=e=>{let{isOpen:t,onClose:s,invoice:n,lead:r,onPaymentRecorded:l,onSignatureSaved:o,onComplete:i,onSendSignatureEmail:c}=e;const[d,u]=(0,a.useState)((null===n||void 0===n?void 0:n.paymentMethod)||"pdq"),[m,h]=(0,a.useState)((null===n||void 0===n?void 0:n.authCode)||""),[p,x]=(0,a.useState)(""),[g,f]=(0,a.useState)(!1),[b,y]=(0,a.useState)(!1),[v,j]=(0,a.useState)(!1),[w,N]=(0,a.useState)(!1),[k,S]=(0,a.useState)((null===n||void 0===n?void 0:n.clientSignatureData)||null),[C,_]=(0,a.useState)(null),[E,T]=(0,a.useState)(null);(0,a.useEffect)(()=>{n&&(u(n.paymentMethod||"pdq"),h(n.authCode||""),S(n.clientSignatureData||null))},[n]);const P=e=>"\xa3".concat(parseFloat(e||0).toFixed(2)),A=(e,t)=>{var s,n;const a={payment:{pending:{color:"bg-yellow-100 text-yellow-800",icon:Uc,text:"Pending"},paid:{color:"bg-green-100 text-green-800",icon:zc,text:"Paid"},partial:{color:"bg-blue-100 text-blue-800",icon:Uc,text:"Partial"},refunded:{color:"bg-red-100 text-red-800",icon:Vc,text:"Refunded"}},signature:{pending:{color:"bg-yellow-100 text-yellow-800",icon:Uc,text:"Pending"},sent:{color:"bg-blue-100 text-blue-800",icon:Wc,text:"Sent"},signed:{color:"bg-green-100 text-green-800",icon:zc,text:"Signed"},declined:{color:"bg-red-100 text-red-800",icon:Vc,text:"Declined"}}},r=(null===(s=a[t])||void 0===s?void 0:s[e])||(null===(n=a[t])||void 0===n?void 0:n.pending),l=r.icon;return(0,fn.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(r.color),children:[(0,fn.jsx)(l,{className:"w-3 h-3 mr-1"}),r.text]})};if(!t||!n)return null;const D="paid"===n.paymentStatus,L="signed"===n.signatureStatus||k,M=D&&L;return(0,fn.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:(0,fn.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[95vh] flex flex-col overflow-hidden",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b bg-gradient-to-r from-blue-600 to-indigo-600",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,fn.jsx)("div",{className:"p-2 bg-white bg-opacity-20 rounded-lg",children:(0,fn.jsx)(Ic,{className:"w-5 h-5 text-white"})}),(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("h2",{className:"text-xl font-semibold text-white",children:["Invoice ",n.invoiceNumber]}),(0,fn.jsx)("p",{className:"text-blue-100 text-sm",children:n.clientName||(null===r||void 0===r?void 0:r.name)})]})]}),(0,fn.jsx)("button",{onClick:s,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors",children:(0,fn.jsx)(nc,{className:"w-6 h-6 text-white"})})]}),(C||E)&&(0,fn.jsxs)("div",{className:"mx-6 mt-4 p-4 rounded-lg flex items-start space-x-3 ".concat(C?"bg-red-50 text-red-800":"bg-green-50 text-green-800"),children:[C?(0,fn.jsx)(Vc,{className:"w-5 h-5 flex-shrink-0"}):(0,fn.jsx)(zc,{className:"w-5 h-5 flex-shrink-0"}),(0,fn.jsx)("span",{className:"text-sm",children:C||E}),(0,fn.jsx)("button",{onClick:()=>{_(null),T(null)},className:"ml-auto",children:(0,fn.jsx)(nc,{className:"w-4 h-4"})})]}),(0,fn.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:(0,fn.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,fn.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,fn.jsxs)("div",{className:"bg-gray-50 rounded-xl p-4",children:[(0,fn.jsx)("h3",{className:"font-medium text-gray-900 mb-3",children:"Client Information"}),(0,fn.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("span",{className:"text-gray-500",children:"Name:"}),(0,fn.jsx)("p",{className:"font-medium",children:n.clientName||(null===r||void 0===r?void 0:r.name)})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("span",{className:"text-gray-500",children:"Email:"}),(0,fn.jsx)("p",{className:"font-medium",children:n.clientEmail||(null===r||void 0===r?void 0:r.email)||"-"})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("span",{className:"text-gray-500",children:"Phone:"}),(0,fn.jsx)("p",{className:"font-medium",children:n.clientPhone||(null===r||void 0===r?void 0:r.phone)||"-"})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("span",{className:"text-gray-500",children:"Date:"}),(0,fn.jsx)("p",{className:"font-medium",children:(R=n.createdAt,R?new Date(R).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-")})]})]})]}),(0,fn.jsx)("div",{className:"bg-white border rounded-xl overflow-hidden",children:(0,fn.jsxs)("table",{className:"w-full",children:[(0,fn.jsx)("thead",{className:"bg-gray-50",children:(0,fn.jsxs)("tr",{children:[(0,fn.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Description"}),(0,fn.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Qty"}),(0,fn.jsx)("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Price"}),(0,fn.jsx)("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Total"})]})}),(0,fn.jsx)("tbody",{className:"divide-y divide-gray-100",children:(n.items||[]).map((e,t)=>(0,fn.jsxs)("tr",{children:[(0,fn.jsxs)("td",{className:"px-4 py-3",children:[(0,fn.jsx)("p",{className:"font-medium text-gray-900",children:e.name}),e.includes&&e.includes.length>0&&(0,fn.jsxs)("ul",{className:"mt-1 space-y-0.5",children:[e.includes.slice(0,3).map((e,t)=>(0,fn.jsxs)("li",{className:"text-xs text-gray-500 flex items-center",children:[(0,fn.jsx)(ac,{className:"w-3 h-3 text-green-500 mr-1"}),e]},t)),e.includes.length>3&&(0,fn.jsxs)("li",{className:"text-xs text-gray-400",children:["+",e.includes.length-3," more"]})]})]}),(0,fn.jsx)("td",{className:"px-4 py-3 text-center text-gray-600",children:e.quantity||1}),(0,fn.jsx)("td",{className:"px-4 py-3 text-right text-gray-600",children:P(e.unitPrice)}),(0,fn.jsx)("td",{className:"px-4 py-3 text-right font-medium text-gray-900",children:P(e.lineTotal)})]},t))}),(0,fn.jsxs)("tfoot",{className:"bg-gray-50",children:[(0,fn.jsxs)("tr",{children:[(0,fn.jsx)("td",{colSpan:"3",className:"px-4 py-2 text-right text-sm text-gray-600",children:"Subtotal"}),(0,fn.jsx)("td",{className:"px-4 py-2 text-right text-sm font-medium",children:P(n.subtotal)})]}),(0,fn.jsxs)("tr",{children:[(0,fn.jsx)("td",{colSpan:"3",className:"px-4 py-2 text-right text-sm text-gray-600",children:"VAT (20%)"}),(0,fn.jsx)("td",{className:"px-4 py-2 text-right text-sm font-medium",children:P(n.vatAmount)})]}),(0,fn.jsxs)("tr",{className:"border-t-2 border-gray-200",children:[(0,fn.jsx)("td",{colSpan:"3",className:"px-4 py-3 text-right text-lg font-semibold",children:"Total"}),(0,fn.jsx)("td",{className:"px-4 py-3 text-right text-xl font-bold text-gray-900",children:P(n.totalAmount)})]})]})]})}),w?(0,fn.jsxs)("div",{className:"bg-white border rounded-xl p-4",children:[(0,fn.jsx)("h3",{className:"font-medium text-gray-900 mb-4",children:"Client Signature"}),(0,fn.jsx)(Hc,{onSave:async e=>{f(!0),_(null);try{const t=await fetch("/api/invoices/".concat(n.id,"/save-signature"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify({signatureData:e})});if(!t.ok){const e=await t.json();throw new Error(e.message||"Failed to save signature")}const s=await t.json();S(e),N(!1),T("Signature saved successfully"),null===o||void 0===o||o(s.invoice),setTimeout(()=>T(null),3e3)}catch(ty){console.error("Error saving signature:",ty),_(ty.message)}finally{f(!1)}},onCancel:()=>N(!1),saving:g})]}):k?(0,fn.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-xl p-4",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,fn.jsxs)("h3",{className:"font-medium text-green-900 flex items-center",children:[(0,fn.jsx)(zc,{className:"w-5 h-5 mr-2"}),"Signature Collected"]}),(0,fn.jsx)("button",{onClick:()=>N(!0),className:"text-sm text-green-700 hover:text-green-900",children:"Re-sign"})]}),(0,fn.jsx)("div",{className:"bg-white rounded-lg p-2 border",children:(0,fn.jsx)("img",{src:k,alt:"Client signature",className:"max-h-24 mx-auto"})})]}):null]}),(0,fn.jsxs)("div",{className:"space-y-4",children:[(0,fn.jsxs)("div",{className:"bg-gray-50 rounded-xl p-4 space-y-4",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between",children:[(0,fn.jsx)("span",{className:"text-sm text-gray-600",children:"Payment"}),A(n.paymentStatus,"payment")]}),(0,fn.jsxs)("div",{className:"flex items-center justify-between",children:[(0,fn.jsx)("span",{className:"text-sm text-gray-600",children:"Signature"}),A(k?"signed":n.signatureStatus,"signature")]})]}),!D&&(0,fn.jsxs)("div",{className:"bg-white border rounded-xl p-4",children:[(0,fn.jsxs)("h3",{className:"font-medium text-gray-900 mb-3 flex items-center",children:[(0,fn.jsx)(Sc,{className:"w-4 h-4 mr-2"}),"Record Payment"]}),(0,fn.jsxs)("div",{className:"space-y-3",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Method"}),(0,fn.jsxs)("select",{value:d,onChange:e=>u(e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,fn.jsx)("option",{value:"pdq",children:"PDQ Machine (Card)"}),(0,fn.jsx)("option",{value:"cash",children:"Cash"}),(0,fn.jsx)("option",{value:"bank_transfer",children:"Bank Transfer"}),(0,fn.jsx)("option",{value:"other",children:"Other"})]})]}),"pdq"===d&&(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Authorisation Code *"}),(0,fn.jsx)("input",{type:"text",value:m,onChange:e=>h(e.target.value),placeholder:"Enter auth code",className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reference (Optional)"}),(0,fn.jsx)("input",{type:"text",value:p,onChange:e=>x(e.target.value),placeholder:"Transaction reference",className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,fn.jsxs)("button",{onClick:async()=>{if(m||"pdq"!==d){f(!0),_(null);try{const e=await fetch("/api/invoices/".concat(n.id,"/record-payment"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify({paymentMethod:d,authCode:m||null,paymentReference:p||null})});if(!e.ok){const t=await e.json();throw new Error(t.message||"Failed to record payment")}const t=await e.json();T("Payment recorded successfully"),null===l||void 0===l||l(t.invoice),setTimeout(()=>T(null),3e3)}catch(ty){console.error("Error recording payment:",ty),_(ty.message)}finally{f(!1)}}else _("Please enter the PDQ authorisation code")},disabled:g,className:"w-full py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 flex items-center justify-center space-x-2",children:[g?(0,fn.jsx)(oc,{className:"w-4 h-4 animate-spin"}):(0,fn.jsx)(ac,{className:"w-4 h-4"}),(0,fn.jsx)("span",{children:"Record Payment"})]})]})]}),D&&!L&&(0,fn.jsxs)("div",{className:"bg-white border rounded-xl p-4",children:[(0,fn.jsx)("h3",{className:"font-medium text-gray-900 mb-3",children:"Collect Signature"}),(0,fn.jsxs)("div",{className:"space-y-2",children:[(0,fn.jsxs)("button",{onClick:()=>N(!0),className:"w-full py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center justify-center space-x-2",children:[(0,fn.jsx)(Ic,{className:"w-4 h-4"}),(0,fn.jsx)("span",{children:"Sign Here"})]}),(0,fn.jsxs)("button",{onClick:async()=>{y(!0),_(null);try{const e=await fetch("/api/signature/send-email",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify({invoiceId:n.id,email:(null===r||void 0===r?void 0:r.email)||n.clientEmail})});if(!e.ok){const t=await e.json();throw new Error(t.message||"Failed to send signature email")}const t=await e.json();T("Signature request sent to ".concat(t.sentTo)),null===c||void 0===c||c(t),setTimeout(()=>T(null),5e3)}catch(ty){console.error("Error sending signature email:",ty),_(ty.message)}finally{y(!1)}},disabled:b||!n.clientEmail,className:"w-full py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 disabled:opacity-50 flex items-center justify-center space-x-2",children:[b?(0,fn.jsx)(oc,{className:"w-4 h-4 animate-spin"}):(0,fn.jsx)(Cc,{className:"w-4 h-4"}),(0,fn.jsx)("span",{children:"Email Signature Link"})]})]})]}),(0,fn.jsxs)("button",{onClick:async()=>{if("paid"===n.paymentStatus)if("signed"===n.signatureStatus||k){j(!0),_(null);try{const e=await fetch("/api/invoices/".concat(n.id,"/complete"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify({createSale:!0})});if(!e.ok){const t=await e.json();throw new Error(t.message||"Failed to complete invoice")}const t=await e.json();T("Invoice completed! Delivery emails will be sent."),null===i||void 0===i||i(t.invoice),setTimeout(()=>{s()},2e3)}catch(ty){console.error("Error completing invoice:",ty),_(ty.message)}finally{j(!1)}}else _("Please collect signature before completing");else _("Please record payment before completing")},disabled:!M||v,className:"w-full py-3 rounded-xl font-medium flex items-center justify-center space-x-2 transition-colors ".concat(M?"bg-gradient-to-r from-green-600 to-emerald-600 text-white hover:from-green-700 hover:to-emerald-700":"bg-gray-200 text-gray-500 cursor-not-allowed"),children:[v?(0,fn.jsx)(oc,{className:"w-5 h-5 animate-spin"}):(0,fn.jsx)(zc,{className:"w-5 h-5"}),(0,fn.jsx)("span",{children:"Complete Sale"})]}),!M&&(0,fn.jsx)("p",{className:"text-xs text-center text-gray-500",children:D?"Collect signature to complete":"Record payment first"}),n.pdfUrl&&(0,fn.jsxs)("a",{href:n.pdfUrl,target:"_blank",rel:"noopener noreferrer",className:"w-full py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 flex items-center justify-center space-x-2",children:[(0,fn.jsx)(cc,{className:"w-4 h-4"}),(0,fn.jsx)("span",{children:"Download Invoice PDF"})]})]})]})})]})});var R},Gc=tc("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),$c=tc("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),Qc=tc("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),Kc=tc("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),Jc=tc("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),Xc=tc("pound-sterling",[["path",{d:"M18 7c0-5.333-8-5.333-8 0",key:"1prm2n"}],["path",{d:"M10 7v14",key:"18tmcs"}],["path",{d:"M6 21h12",key:"4dkmi1"}],["path",{d:"M6 13h10",key:"ybwr4a"}]]),Zc=tc("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),ed=tc("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),td=tc("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),sd=tc("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),nd=tc("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),ad=e=>{let{isOpen:t,onClose:s,lead:n,packageData:r,invoiceData:l,selectedPhotoIds:o=[],onContractSent:i,onBackToPackages:c,onBackToPhotos:d}=e;const[u,m]=(0,a.useState)(!1),[h,p]=(0,a.useState)(!1),[x,g]=(0,a.useState)(null),[f,b]=(0,a.useState)(null),[y,v]=(0,a.useState)(!1),[j,w]=(0,a.useState)(null),[N,k]=(0,a.useState)(!1),[S,C]=(0,a.useState)("draft"),[_,E]=(0,a.useState)(!1),[T,P]=(0,a.useState)(null),[A,D]=(0,a.useState)(null),[L,M]=(0,a.useState)(""),[R,F]=(0,a.useState)(null),[I,O]=(0,a.useState)(0),[B,U]=(0,a.useState)(0),[z,V]=(0,a.useState)(0),[W,q]=(0,a.useState)(!1),[H,Y]=(0,a.useState)(!1),[G,$]=(0,a.useState)(!1),[Q,K]=(0,a.useState)(""),[J,X]=(0,a.useState)(!1),[Z,ee]=(0,a.useState)(null),[te,se]=(0,a.useState)(!1),[ne,ae]=(0,a.useState)([]),[re,le]=(0,a.useState)(!1),[oe,ie]=(0,a.useState)("edit"),ce=e=>"contract_draft_".concat(e),de=e=>{e&&(localStorage.removeItem(ce(e)),console.log("\ud83d\uddd1\ufe0f Cleared saved contract state for lead ".concat(e)))},ue=()=>{Z&&(xe(Z.contractDetails),ie(Z.step),Z.contract&&b(Z.contract),Z.emailSent&&v(Z.emailSent),Z.contractStatus&&C(Z.contractStatus),console.log("\u2705 Resumed contract state from step: ".concat(Z.step))),X(!1),ee(null)},me=()=>{null!==n&&void 0!==n&&n.id&&de(n.id),X(!1),ee(null)},he=()=>{X(!1),ee(null),s()},[pe,xe]=(0,a.useState)({customerName:"",clientNameIfDifferent:"",address:"",postcode:"",phone:"",email:"",isVip:!1,studioNumber:"",photographer:"",invoiceNumber:"",digitalImages:!0,digitalImagesQty:"",digitalZCard:!1,efolio:!1,efolioUrl:"",projectInfluencer:!1,influencerLogin:"",influencerPassword:"",allowImageUse:!0,notes:"",subtotal:0,vatAmount:0,total:0,paymentMethod:"card",authCode:"",depositAmount:0,financeAmount:0,financeFrequency:"monthly",financeStartDate:"",financeDueDay:1,financeDuration:12});(0,a.useEffect)(()=>{if(t&&n){var e,s,a,o,i;const t=(e=>{if(!e)return null;try{const t=localStorage.getItem(ce(e));if(t){const s=JSON.parse(t);if((Date.now()-s.timestamp)/36e5<24)return s;localStorage.removeItem(ce(e))}}catch(ty){console.error("Error loading saved contract state:",ty)}return null})(n.id);if(t&&!J)return ee(t),void X(!0);if(J)return;const c=(null===r||void 0===r?void 0:r.price)||0,d=(null===l||void 0===l?void 0:l.subtotal)||c,u=(null===l||void 0===l?void 0:l.vatAmount)||.2*c,m=(null===l||void 0===l?void 0:l.total)||1.2*c,h=async()=>{try{const e=await fetch("/api/contracts/next-invoice-number",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(e.ok){const t=await e.json();t.invoiceNumber&&(xe(e=>He(He({},e),{},{invoiceNumber:t.invoiceNumber})),console.log("\ud83d\udccb Invoice number set: ".concat(t.invoiceNumber)))}}catch(ty){console.error("Error fetching invoice number:",ty)}};xe({customerName:n.name||"",clientNameIfDifferent:n.parent_name||"",address:n.address||"",postcode:n.postcode||"",phone:n.phone||"",email:n.email||"",isVip:n.is_vip||!1,studioNumber:(null===l||void 0===l?void 0:l.studioNumber)||"",photographer:(null===l||void 0===l?void 0:l.photographer)||"",invoiceNumber:"",digitalImages:!0,digitalImagesQty:(null===r||void 0===r?void 0:r.imageCount)||(null===r||void 0===r?void 0:r.image_count)||"All",digitalZCard:void 0!==(null===r||void 0===r?void 0:r.hasZCard)?r.hasZCard:(null===r||void 0===r||null===(e=r.includes)||void 0===e?void 0:e.some(e=>e.toLowerCase().includes("z-card")))||!1,efolio:void 0!==(null===r||void 0===r?void 0:r.hasEfolio)?r.hasEfolio:(null===r||void 0===r||null===(s=r.includes)||void 0===s?void 0:s.some(e=>e.toLowerCase().includes("efolio")||e.toLowerCase().includes("e-folio")))||!1,efolioUrl:"",projectInfluencer:void 0!==(null===r||void 0===r?void 0:r.hasProjectInfluencer)?r.hasProjectInfluencer:(null===r||void 0===r||null===(a=r.includes)||void 0===a?void 0:a.some(e=>e.toLowerCase().includes("influencer")))||!1,influencerLogin:"",influencerPassword:"",threeLanceCastings:void 0!==(null===r||void 0===r?void 0:r.has3Lance)?r.has3Lance:(null===r||void 0===r||null===(o=r.includes)||void 0===o?void 0:o.some(e=>e.toLowerCase().includes("3lance")||e.toLowerCase().includes("casting")))||!1,recommendedAgencyList:void 0!==(null===r||void 0===r?void 0:r.hasAgencyList)?r.hasAgencyList:(null===r||void 0===r||null===(i=r.includes)||void 0===i?void 0:i.some(e=>e.toLowerCase().includes("agency")))||!1,allowImageUse:!0,notes:"Package: ".concat((null===r||void 0===r?void 0:r.name)||"Standard Package"),subtotal:d,vatAmount:u,total:m,paymentMethod:(null===l||void 0===l?void 0:l.paymentMethod)||"card",authCode:(null===l||void 0===l?void 0:l.authCode)||"",financeFrequency:("finance"===(null===l||void 0===l?void 0:l.paymentMethod)||"payl8r"===(null===l||void 0===l?void 0:l.paymentMethod))&&(null===l||void 0===l?void 0:l.financeFrequency)||"monthly",financeStartDate:"finance"===(null===l||void 0===l?void 0:l.paymentMethod)||"payl8r"===(null===l||void 0===l?void 0:l.paymentMethod)?(null===l||void 0===l?void 0:l.financeStartDate)||new Date(Date.now()+2592e6).toISOString().split("T")[0]:"",financeDueDay:("finance"===(null===l||void 0===l?void 0:l.paymentMethod)||"payl8r"===(null===l||void 0===l?void 0:l.paymentMethod))&&(null===l||void 0===l?void 0:l.financeDueDay)||1,financeDuration:("finance"===(null===l||void 0===l?void 0:l.paymentMethod)||"payl8r"===(null===l||void 0===l?void 0:l.paymentMethod))&&(null===l||void 0===l?void 0:l.financeDuration)||12}),h(),b(null),v(!1),g(null),k(!1),ie("edit")}},[t,n,r,l,J]),(0,a.useEffect)(()=>{if(t&&null!==n&&void 0!==n&&n.id&&!J&&pe.customerName){if("signed"===S)return void de(n.id);((e,t)=>{if(!e)return;const s={contractDetails:t.contractDetails,step:t.step,contract:t.contract,emailSent:t.emailSent,contractStatus:t.contractStatus,timestamp:Date.now(),leadId:e};localStorage.setItem(ce(e),JSON.stringify(s)),console.log("\ud83d\udcbe Contract state saved for lead ".concat(e))})(n.id,{contractDetails:pe,step:oe,contract:f,emailSent:y,contractStatus:S})}},[pe,oe,f,y,S,t,null===n||void 0===n?void 0:n.id,J]);const ge=(e,t)=>{xe(s=>He(He({},s),{},{[e]:t}))};(0,a.useEffect)(()=>{if(null===f||void 0===f||!f.id||"send"!==oe)return;if("signed"===S&&null!==T)return;const e=setInterval(()=>{(async()=>{if(null!==f&&void 0!==f&&f.id){E(!0);try{const t=await fetch("/api/contracts/".concat(f.id),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(t.ok){var e;const s=await t.json(),n=(null===(e=s.contract)||void 0===e?void 0:e.status)||s.status||"draft";if(C(n),s.contract){b(e=>He(He({},e),s.contract));const e=s.contract.data||{};void 0!==s.contract.deliveryEmailSent?(P(s.contract.deliveryEmailSent),D(s.contract.deliveryEmailTime),M(s.contract.deliveryEmailTo||e.email),F(s.contract.deliveryEmailError||null),O(s.contract.deliveryAttachmentCount||0),U(s.contract.deliveryPhotoCount||0)):void 0!==e.delivery_email_sent&&(P(e.delivery_email_sent),D(e.delivery_email_time),M(e.delivery_email_to||e.email),F(e.delivery_email_error||null),O(e.delivery_attachment_count||0),U(e.delivery_photo_count||0)),s.contract.selectedPhotoCount&&V(s.contract.selectedPhotoCount),(s.contract.authCode||e.authCode)&&(K(s.contract.authCode||e.authCode),$(!0))}}}catch(ty){console.error("Error checking contract status:",ty)}finally{E(!1)}}})()},1e3);return()=>clearInterval(e)},[null===f||void 0===f?void 0:f.id,S,oe,T]);const fe=async()=>{if(null!==f&&void 0!==f&&f.id){q(!0),g(null);try{const e=await fetch("/api/contracts/".concat(f.id,"/resend-delivery"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify({email:pe.email})}),t=await e.json();if(!e.ok)throw new Error(t.message||"Failed to resend delivery email");P(!0),D((new Date).toISOString()),M(t.sentTo),F(null),O(t.attachments||0),U(t.photoCount||0)}catch(ty){g(ty.message)}finally{q(!1)}}},be=e=>"\xa3".concat(parseFloat(e||0).toFixed(2));if(!t)return null;if(J&&Z){var ye,ve;const e=Z.step,t=(new Date(Z.timestamp),Math.round((Date.now()-Z.timestamp)/6e4)),s=t<60?"".concat(t," minutes ago"):"".concat(Math.round(t/60)," hours ago");return(0,fn.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:(0,fn.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md overflow-hidden",children:[(0,fn.jsx)("div",{className:"px-6 py-4 border-b bg-gradient-to-r from-amber-500 to-orange-500",children:(0,fn.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,fn.jsx)("div",{className:"p-2 bg-white bg-opacity-20 rounded-lg",children:(0,fn.jsx)(Gc,{className:"w-5 h-5 text-white"})}),(0,fn.jsx)("h2",{className:"text-lg font-semibold text-white",children:"Resume Contract?"})]})}),(0,fn.jsxs)("div",{className:"p-6",children:[(0,fn.jsxs)("p",{className:"text-gray-700 mb-4",children:["You have an unfinished contract for ",(0,fn.jsx)("strong",{children:(null===(ye=Z.contractDetails)||void 0===ye?void 0:ye.customerName)||(null===n||void 0===n?void 0:n.name)}),"."]}),(0,fn.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between text-sm mb-2",children:[(0,fn.jsx)("span",{className:"text-gray-500",children:"Saved:"}),(0,fn.jsx)("span",{className:"text-gray-700",children:s})]}),(0,fn.jsxs)("div",{className:"flex items-center justify-between text-sm mb-2",children:[(0,fn.jsx)("span",{className:"text-gray-500",children:"Step:"}),(0,fn.jsx)("span",{className:"text-gray-700 capitalize",children:"edit"===e?"Edit Details":"review"===e?"Review":"Send"})]}),(0,fn.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,fn.jsx)("span",{className:"text-gray-500",children:"Invoice:"}),(0,fn.jsx)("span",{className:"text-gray-700 font-mono",children:(null===(ve=Z.contractDetails)||void 0===ve?void 0:ve.invoiceNumber)||"-"})]})]}),(0,fn.jsxs)("div",{className:"flex space-x-3",children:[(0,fn.jsx)("button",{onClick:me,className:"flex-1 px-4 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium",children:"Start New"}),(0,fn.jsx)("button",{onClick:ue,className:"flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Resume"})]})]})]})})}return(0,fn.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:(0,fn.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b bg-gradient-to-r from-blue-600 to-indigo-600 flex-shrink-0",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,fn.jsx)("div",{className:"p-2 bg-white bg-opacity-20 rounded-lg",children:(0,fn.jsx)(Ic,{className:"w-5 h-5 text-white"})}),(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("h2",{className:"text-lg font-semibold text-white",children:["edit"===oe&&"Edit Invoice Details","review"===oe&&"Review Invoice","send"===oe&&"Send Invoice"]}),(0,fn.jsxs)("p",{className:"text-blue-100 text-sm",children:[(null===n||void 0===n?void 0:n.name)||"Customer"," \u2022 ",(null===r||void 0===r?void 0:r.name)||"Package"]})]})]}),(0,fn.jsx)("button",{onClick:he,className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors",children:(0,fn.jsx)(nc,{className:"w-5 h-5 text-white"})})]}),(0,fn.jsxs)("div",{className:"px-6 py-3 bg-gray-50 border-b flex items-center justify-center space-x-4 flex-shrink-0",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-2 ".concat("edit"===oe?"text-blue-600 font-medium":"text-gray-400"),children:[(0,fn.jsx)("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-xs ".concat("edit"===oe?"bg-blue-600 text-white":"bg-gray-300 text-gray-600"),children:"1"}),(0,fn.jsx)("span",{className:"text-sm",children:"Edit Details"})]}),(0,fn.jsx)($c,{className:"w-4 h-4 text-gray-400"}),(0,fn.jsxs)("div",{className:"flex items-center space-x-2 ".concat("review"===oe?"text-blue-600 font-medium":"text-gray-400"),children:[(0,fn.jsx)("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-xs ".concat("review"===oe?"bg-blue-600 text-white":"bg-gray-300 text-gray-600"),children:"2"}),(0,fn.jsx)("span",{className:"text-sm",children:"Review"})]}),(0,fn.jsx)($c,{className:"w-4 h-4 text-gray-400"}),(0,fn.jsxs)("div",{className:"flex items-center space-x-2 ".concat("send"===oe?"text-blue-600 font-medium":"text-gray-400"),children:[(0,fn.jsx)("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-xs ".concat("send"===oe?"bg-blue-600 text-white":"bg-gray-300 text-gray-600"),children:"3"}),(0,fn.jsx)("span",{className:"text-sm",children:"Send"})]})]}),(0,fn.jsxs)("div",{className:"flex-1 overflow-y-auto p-6",children:[x&&(0,fn.jsxs)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-start space-x-2",children:[(0,fn.jsx)(Fc,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("p",{className:"text-red-800 font-medium",children:"Error"}),(0,fn.jsx)("p",{className:"text-red-600 text-sm",children:x})]})]}),"edit"===oe&&(0,fn.jsxs)("div",{className:"space-y-6",children:[(c||d)&&(0,fn.jsxs)("div",{className:"flex items-center space-x-2 pb-4 border-b border-gray-200",children:[(0,fn.jsx)(Qc,{className:"w-4 h-4 text-gray-400"}),(0,fn.jsx)("span",{className:"text-sm text-gray-500",children:"Go back to:"}),d&&(0,fn.jsxs)("button",{onClick:d,className:"px-3 py-1.5 text-sm bg-purple-50 text-purple-700 border border-purple-200 rounded-lg hover:bg-purple-100 transition-colors flex items-center space-x-1",children:[(0,fn.jsx)(sc,{className:"w-4 h-4"}),(0,fn.jsx)("span",{children:"Photo Selection"})]}),c&&(0,fn.jsxs)("button",{onClick:c,className:"px-3 py-1.5 text-sm bg-green-50 text-green-700 border border-green-200 rounded-lg hover:bg-green-100 transition-colors flex items-center space-x-1",children:[(0,fn.jsx)(Ac,{className:"w-4 h-4"}),(0,fn.jsx)("span",{children:"Package Selection"})]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("h3",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center",children:[(0,fn.jsx)(Kc,{className:"w-4 h-4 mr-2 text-blue-500"}),"CUSTOMER DETAILS"]}),(0,fn.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,fn.jsxs)("div",{className:"col-span-2",children:[(0,fn.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Name (as in diary)"}),(0,fn.jsx)("input",{type:"text",value:pe.customerName,onChange:e=>ge("customerName",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,fn.jsxs)("div",{className:"col-span-2",children:[(0,fn.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Client Name (if different)"}),(0,fn.jsx)("input",{type:"text",value:pe.clientNameIfDifferent,onChange:e=>ge("clientNameIfDifferent",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Postcode"}),(0,fn.jsxs)("div",{className:"relative",children:[(0,fn.jsx)("input",{type:"text",value:pe.postcode,onChange:e=>ge("postcode",e.target.value),onBlur:e=>(async e=>{if(!e||e.length<5)return;const t=e.trim().toUpperCase().replace(/\s+/g,"");if(/^[A-Z]{1,2}\d[A-Z\d]?\s*\d[A-Z]{2}$/i.test(t)){se(!0),ae([]),le(!1);try{const e=await fetch("/api/postcode/lookup/".concat(encodeURIComponent(t))),s=await e.json();s.addresses&&s.addresses.length>0&&(ae(s.addresses),le(!0))}catch(ty){console.error("Postcode lookup failed:",ty)}finally{se(!1)}}})(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"e.g. SW1A 1AA"}),te&&(0,fn.jsx)("div",{className:"absolute right-2 top-1/2 -translate-y-1/2",children:(0,fn.jsx)(oc,{className:"w-4 h-4 animate-spin text-blue-500"})})]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Select Address"}),(0,fn.jsx)("div",{className:"relative",children:(0,fn.jsxs)("select",{value:"",onChange:e=>{const t=ne.find(t=>t.full===e.target.value||t.display===e.target.value);var s;t&&(ge("address",(s=t).full||s.display),le(!1),ae([]))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:0===ne.length,children:[(0,fn.jsx)("option",{value:"",children:0===ne.length?"Enter postcode first":"Select from ".concat(ne.length," addresses")}),ne.map((e,t)=>(0,fn.jsx)("option",{value:e.full||e.display,children:e.display},t))]})})]}),(0,fn.jsxs)("div",{className:"col-span-2",children:[(0,fn.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Full Address"}),(0,fn.jsx)("input",{type:"text",value:pe.address,onChange:e=>ge("address",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Select address from dropdown above"})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Phone / Mobile"}),(0,fn.jsx)("input",{type:"tel",value:pe.phone,onChange:e=>ge("phone",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,fn.jsxs)("div",{className:"col-span-2",children:[(0,fn.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Email"}),(0,fn.jsx)("input",{type:"email",value:pe.email,onChange:e=>ge("email",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,fn.jsxs)("div",{className:"col-span-2 flex items-center",children:[(0,fn.jsx)("input",{type:"checkbox",id:"isVip",checked:pe.isVip,onChange:e=>ge("isVip",e.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,fn.jsx)("label",{htmlFor:"isVip",className:"ml-2 text-sm text-gray-700",children:"VIP Customer"})]})]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("h3",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center",children:[(0,fn.jsx)(Jc,{className:"w-4 h-4 mr-2 text-purple-500"}),"STUDIO INFO"]}),(0,fn.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Studio No."}),(0,fn.jsx)("input",{type:"text",value:pe.studioNumber,onChange:e=>ge("studioNumber",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Photographer"}),(0,fn.jsx)("input",{type:"text",value:pe.photographer,onChange:e=>ge("photographer",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Invoice No."}),(0,fn.jsx)("input",{type:"text",value:pe.invoiceNumber,onChange:e=>ge("invoiceNumber",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("h3",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center",children:[(0,fn.jsx)(Ac,{className:"w-4 h-4 mr-2 text-green-500"}),"ORDER DETAILS"]}),(0,fn.jsxs)("div",{className:"space-y-3",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between bg-gray-50 p-3 rounded-lg",children:[(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("input",{type:"checkbox",id:"digitalImages",checked:pe.digitalImages,onChange:e=>ge("digitalImages",e.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,fn.jsx)("label",{htmlFor:"digitalImages",className:"ml-2 text-sm text-gray-700",children:"Digital Images"})]}),(0,fn.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,fn.jsx)("label",{className:"text-xs text-gray-500",children:"Qty:"}),(0,fn.jsx)("input",{type:"text",value:pe.digitalImagesQty,onChange:e=>ge("digitalImagesQty",e.target.value),className:"w-20 px-2 py-1 border border-gray-300 rounded text-sm",placeholder:"All"})]})]}),(0,fn.jsxs)("div",{className:"flex items-center bg-gray-50 p-3 rounded-lg",children:[(0,fn.jsx)("input",{type:"checkbox",id:"digitalZCard",checked:pe.digitalZCard,onChange:e=>ge("digitalZCard",e.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,fn.jsx)("label",{htmlFor:"digitalZCard",className:"ml-2 text-sm text-gray-700",children:"Digital Z-Card"})]}),(0,fn.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg",children:[(0,fn.jsxs)("div",{className:"flex items-center mb-2",children:[(0,fn.jsx)("input",{type:"checkbox",id:"efolio",checked:pe.efolio,onChange:e=>ge("efolio",e.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,fn.jsx)("label",{htmlFor:"efolio",className:"ml-2 text-sm text-gray-700",children:"E-Folio"})]}),pe.efolio&&(0,fn.jsx)("input",{type:"text",value:pe.efolioUrl,onChange:e=>ge("efolioUrl",e.target.value),placeholder:"E-Folio URL",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"})]}),(0,fn.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg",children:[(0,fn.jsxs)("div",{className:"flex items-center mb-2",children:[(0,fn.jsx)("input",{type:"checkbox",id:"projectInfluencer",checked:pe.projectInfluencer,onChange:e=>ge("projectInfluencer",e.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,fn.jsx)("label",{htmlFor:"projectInfluencer",className:"ml-2 text-sm text-gray-700",children:"Project Influencer"})]}),pe.projectInfluencer&&(0,fn.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,fn.jsx)("input",{type:"text",value:pe.influencerLogin,onChange:e=>ge("influencerLogin",e.target.value),placeholder:"Login",className:"px-3 py-2 border border-gray-300 rounded-lg text-sm"}),(0,fn.jsx)("input",{type:"text",value:pe.influencerPassword,onChange:e=>ge("influencerPassword",e.target.value),placeholder:"Password",className:"px-3 py-2 border border-gray-300 rounded-lg text-sm"})]})]}),(0,fn.jsxs)("div",{className:"flex items-center bg-gray-50 p-3 rounded-lg",children:[(0,fn.jsx)("input",{type:"checkbox",id:"allowImageUse",checked:pe.allowImageUse,onChange:e=>ge("allowImageUse",e.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,fn.jsx)("label",{htmlFor:"allowImageUse",className:"ml-2 text-sm text-gray-700",children:"Allow image use for marketing"})]})]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Notes"}),(0,fn.jsx)("textarea",{value:pe.notes,onChange:e=>ge("notes",e.target.value),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Additional notes for the contract..."})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("h3",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center",children:[(0,fn.jsx)(Xc,{className:"w-4 h-4 mr-2 text-yellow-500"}),"PAYMENT DETAILS"]}),(0,fn.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg space-y-3",children:[(0,fn.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Subtotal (excl VAT)"}),(0,fn.jsxs)("div",{className:"relative",children:[(0,fn.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"\xa3"}),(0,fn.jsx)("input",{type:"number",step:"0.01",value:pe.subtotal,onChange:e=>(e=>{const t=parseFloat(e)||0,s=.2*t,n=t+s;xe(e=>He(He({},e),{},{subtotal:t,vatAmount:s,total:n}))})(e.target.value),className:"w-full pl-7 pr-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"VAT (20%)"}),(0,fn.jsxs)("div",{className:"relative",children:[(0,fn.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"\xa3"}),(0,fn.jsx)("input",{type:"text",value:pe.vatAmount.toFixed(2),readOnly:!0,className:"w-full pl-7 pr-3 py-2 border border-gray-200 rounded-lg text-sm bg-gray-100 text-gray-600"})]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Total"}),(0,fn.jsxs)("div",{className:"relative",children:[(0,fn.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"\xa3"}),(0,fn.jsx)("input",{type:"text",value:pe.total.toFixed(2),readOnly:!0,className:"w-full pl-7 pr-3 py-2 border border-gray-200 rounded-lg text-sm bg-gray-100 font-semibold text-gray-800"})]})]})]}),(0,fn.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Payment Method"}),(0,fn.jsxs)("select",{value:pe.paymentMethod,onChange:e=>{const t=e.target.value;if(ge("paymentMethod",t),("finance"===t||"payl8r"===t)&&"finance"!==pe.paymentMethod&&"payl8r"!==pe.paymentMethod){const e=new Date;e.setDate(e.getDate()+30),ge("financeStartDate",e.toISOString().split("T")[0]),ge("financeFrequency","monthly"),ge("financeDueDay",1),ge("financeDuration",12)}"finance"!==t&&"payl8r"!==t&&(ge("depositAmount",0),ge("financeAmount",0),ge("financeStartDate",""),ge("financeFrequency","monthly"),ge("financeDueDay",1),ge("financeDuration",12))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,fn.jsx)("option",{value:"card",children:"Card"}),(0,fn.jsx)("option",{value:"cash",children:"Cash"}),(0,fn.jsx)("option",{value:"finance",children:"Finance"}),(0,fn.jsx)("option",{value:"payl8r",children:"Payl8er"})]})]}),"finance"!==pe.paymentMethod&&"payl8r"!==pe.paymentMethod&&(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Auth Code (if applicable)"}),(0,fn.jsx)("input",{type:"text",value:pe.authCode,onChange:e=>ge("authCode",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Card auth code"})]})]}),("finance"===pe.paymentMethod||"payl8r"===pe.paymentMethod)&&(0,fn.jsxs)("div",{className:"mt-3 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:[(0,fn.jsxs)("h4",{className:"text-xs font-semibold text-amber-800 mb-3 flex items-center",children:[(0,fn.jsx)(Xc,{className:"w-3 h-3 mr-1"}),"payl8r"===pe.paymentMethod?"PAYL8R BREAKDOWN":"FINANCE BREAKDOWN"]}),(0,fn.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-xs font-medium text-amber-700 mb-1",children:"Deposit Amount"}),(0,fn.jsxs)("div",{className:"relative",children:[(0,fn.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-amber-600",children:"\xa3"}),(0,fn.jsx)("input",{type:"number",step:"0.01",min:"0",value:pe.depositAmount||"",onChange:e=>{const t=parseFloat(e.target.value)||0;ge("depositAmount",t);const s=Math.max(0,pe.total-t);ge("financeAmount",s)},className:"w-full pl-7 pr-3 py-2 border border-amber-300 rounded-lg text-sm focus:ring-2 focus:ring-amber-500 focus:border-amber-500 bg-white",placeholder:"0.00"})]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-xs font-medium text-amber-700 mb-1",children:"Finance Amount (Remaining)"}),(0,fn.jsxs)("div",{className:"relative",children:[(0,fn.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-amber-600",children:"\xa3"}),(0,fn.jsx)("input",{type:"text",value:(pe.financeAmount||0).toFixed(2),readOnly:!0,className:"w-full pl-7 pr-3 py-2 border border-amber-200 rounded-lg text-sm bg-amber-100 text-amber-800 font-semibold"})]}),(0,fn.jsx)("p",{className:"text-xs text-amber-600 mt-1",children:"Auto-calculated: Total - Deposit"})]})]}),"finance"===pe.paymentMethod&&(0,fn.jsxs)("div",{className:"border-t border-amber-200 pt-3 mt-3",children:[(0,fn.jsx)("h5",{className:"text-xs font-semibold text-amber-800 mb-2",children:"Finance Agreement Settings"}),(0,fn.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-xs font-medium text-amber-700 mb-1",children:"Payment Frequency"}),(0,fn.jsxs)("select",{value:pe.financeFrequency||"monthly",onChange:e=>ge("financeFrequency",e.target.value),className:"w-full px-2 py-2 border border-amber-300 rounded-lg text-sm focus:ring-2 focus:ring-amber-500 bg-white",children:[(0,fn.jsx)("option",{value:"weekly",children:"Weekly"}),(0,fn.jsx)("option",{value:"bi-weekly",children:"Bi-weekly"}),(0,fn.jsx)("option",{value:"monthly",children:"Monthly"})]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-xs font-medium text-amber-700 mb-1",children:"First Payment Date"}),(0,fn.jsx)("input",{type:"date",value:pe.financeStartDate||"",onChange:e=>ge("financeStartDate",e.target.value),className:"w-full px-2 py-2 border border-amber-300 rounded-lg text-sm focus:ring-2 focus:ring-amber-500 bg-white"})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-xs font-medium text-amber-700 mb-1",children:"Start Day"}),(0,fn.jsx)("input",{type:"number",min:"1",max:"31",value:pe.financeDueDay||1,onChange:e=>ge("financeDueDay",parseInt(e.target.value)||1),className:"w-full px-2 py-2 border border-amber-300 rounded-lg text-sm focus:ring-2 focus:ring-amber-500 bg-white"})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-xs font-medium text-amber-700 mb-1",children:"Duration (# of payments)"}),(0,fn.jsx)("input",{type:"number",min:"1",max:"60",value:pe.financeDuration||12,onChange:e=>{const t=parseInt(e.target.value)||12;ge("financeDuration",t)},className:"w-full px-2 py-2 border border-amber-300 rounded-lg text-sm focus:ring-2 focus:ring-amber-500 bg-white"}),(0,fn.jsxs)("p",{className:"text-xs text-amber-600 mt-1",children:[pe.financeDuration||12," ","weekly"===pe.financeFrequency?"weekly":"bi-weekly"===pe.financeFrequency?"bi-weekly":"monthly"," payments of ",be((pe.financeAmount||0)/(pe.financeDuration||12))]})]})]})]})]})]})]})]}),"review"===oe&&(0,fn.jsxs)("div",{className:"space-y-4",children:[(0,fn.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-2 text-blue-700 mb-2",children:[(0,fn.jsx)(Zc,{className:"w-5 h-5"}),(0,fn.jsx)("span",{className:"font-medium",children:"Review Contract Details"})]}),(0,fn.jsx)("p",{className:"text-sm text-blue-600",children:"Please review the contract details below before creating. Once created, these details will be overlaid on the PDF contract."})]}),(0,fn.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,fn.jsxs)("h4",{className:"font-medium text-gray-700 mb-2 flex items-center",children:[(0,fn.jsx)(Kc,{className:"w-4 h-4 mr-2"}),"Customer Details"]}),(0,fn.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("span",{className:"text-gray-500",children:"Name:"})," ",(0,fn.jsx)("span",{className:"font-medium",children:pe.customerName})]}),pe.clientNameIfDifferent&&(0,fn.jsxs)("div",{children:[(0,fn.jsx)("span",{className:"text-gray-500",children:"Client:"})," ",(0,fn.jsx)("span",{className:"font-medium",children:pe.clientNameIfDifferent})]}),(0,fn.jsxs)("div",{className:"col-span-2",children:[(0,fn.jsx)("span",{className:"text-gray-500",children:"Address:"})," ",(0,fn.jsx)("span",{className:"font-medium",children:pe.address})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("span",{className:"text-gray-500",children:"Postcode:"})," ",(0,fn.jsx)("span",{className:"font-medium",children:pe.postcode})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("span",{className:"text-gray-500",children:"Phone:"})," ",(0,fn.jsx)("span",{className:"font-medium",children:pe.phone})]}),(0,fn.jsxs)("div",{className:"col-span-2",children:[(0,fn.jsx)("span",{className:"text-gray-500",children:"Email:"})," ",(0,fn.jsx)("span",{className:"font-medium",children:pe.email})]}),pe.isVip&&(0,fn.jsx)("div",{className:"col-span-2",children:(0,fn.jsx)("span",{className:"bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded text-xs",children:"VIP"})})]})]}),(0,fn.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,fn.jsxs)("h4",{className:"font-medium text-gray-700 mb-2 flex items-center",children:[(0,fn.jsx)(Ac,{className:"w-4 h-4 mr-2"}),"Order Details"]}),(0,fn.jsxs)("div",{className:"text-sm space-y-1",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-2",children:[pe.digitalImages?(0,fn.jsx)(ac,{className:"w-4 h-4 text-green-500"}):(0,fn.jsx)(nc,{className:"w-4 h-4 text-gray-300"}),(0,fn.jsxs)("span",{children:["Digital Images: ",pe.digitalImagesQty]})]}),(0,fn.jsxs)("div",{className:"flex items-center space-x-2",children:[pe.digitalZCard?(0,fn.jsx)(ac,{className:"w-4 h-4 text-green-500"}):(0,fn.jsx)(nc,{className:"w-4 h-4 text-gray-300"}),(0,fn.jsx)("span",{children:"Digital Z-Card"})]}),(0,fn.jsxs)("div",{className:"flex items-center space-x-2",children:[pe.efolio?(0,fn.jsx)(ac,{className:"w-4 h-4 text-green-500"}):(0,fn.jsx)(nc,{className:"w-4 h-4 text-gray-300"}),(0,fn.jsxs)("span",{children:["E-Folio ",pe.efolioUrl&&"(".concat(pe.efolioUrl,")")]})]}),(0,fn.jsxs)("div",{className:"flex items-center space-x-2",children:[pe.projectInfluencer?(0,fn.jsx)(ac,{className:"w-4 h-4 text-green-500"}):(0,fn.jsx)(nc,{className:"w-4 h-4 text-gray-300"}),(0,fn.jsx)("span",{children:"Project Influencer"})]}),(0,fn.jsxs)("div",{className:"flex items-center space-x-2",children:[pe.allowImageUse?(0,fn.jsx)(ac,{className:"w-4 h-4 text-green-500"}):(0,fn.jsx)(nc,{className:"w-4 h-4 text-gray-300"}),(0,fn.jsx)("span",{children:"Permission for image use"})]})]}),pe.notes&&(0,fn.jsxs)("div",{className:"mt-2 pt-2 border-t text-sm",children:[(0,fn.jsx)("span",{className:"text-gray-500",children:"Notes:"})," ",(0,fn.jsx)("span",{children:pe.notes})]})]}),(0,fn.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,fn.jsxs)("h4",{className:"font-medium text-gray-700 mb-2 flex items-center",children:[(0,fn.jsx)(Sc,{className:"w-4 h-4 mr-2"}),"Payment Details"]}),(0,fn.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,fn.jsxs)("div",{className:"flex justify-between",children:[(0,fn.jsx)("span",{className:"text-gray-500",children:"Subtotal:"}),(0,fn.jsx)("span",{children:be(pe.subtotal)})]}),(0,fn.jsxs)("div",{className:"flex justify-between",children:[(0,fn.jsx)("span",{className:"text-gray-500",children:"VAT (20%):"}),(0,fn.jsx)("span",{children:be(pe.vatAmount)})]}),(0,fn.jsxs)("div",{className:"flex justify-between font-semibold text-base border-t pt-1 mt-1",children:[(0,fn.jsx)("span",{children:"Total:"}),(0,fn.jsx)("span",{children:be(pe.total)})]}),(0,fn.jsxs)("div",{className:"pt-2",children:[(0,fn.jsx)("span",{className:"text-gray-500",children:"Payment Method:"})," ",(0,fn.jsx)("span",{className:"capitalize",children:pe.paymentMethod}),pe.authCode&&(0,fn.jsxs)("span",{className:"text-gray-400 ml-2",children:["(Auth: ",pe.authCode,")"]})]}),("finance"===pe.paymentMethod||"payl8r"===pe.paymentMethod)&&(0,fn.jsxs)("div",{className:"mt-3 p-2 bg-amber-50 border border-amber-200 rounded-lg",children:[(0,fn.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,fn.jsx)("span",{className:"text-amber-700",children:"Deposit Paid:"}),(0,fn.jsx)("span",{className:"font-medium text-amber-800",children:be(pe.depositAmount)})]}),(0,fn.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,fn.jsxs)("span",{className:"text-amber-700",children:["payl8r"===pe.paymentMethod?"Payl8r Amount":"Finance Amount",":"]}),(0,fn.jsx)("span",{className:"font-semibold text-amber-800",children:be(pe.financeAmount)})]}),"finance"===pe.paymentMethod&&(0,fn.jsxs)("div",{className:"mt-2 pt-2 border-t border-amber-200 text-xs text-amber-700",children:[(0,fn.jsxs)("div",{className:"flex justify-between",children:[(0,fn.jsx)("span",{children:"Payment Frequency:"}),(0,fn.jsx)("span",{className:"capitalize font-medium",children:pe.financeFrequency||"monthly"})]}),(0,fn.jsxs)("div",{className:"flex justify-between",children:[(0,fn.jsx)("span",{children:"Duration:"}),(0,fn.jsxs)("span",{className:"font-medium",children:[pe.financeDuration||12," ","weekly"===pe.financeFrequency?"weekly":"bi-weekly"===pe.financeFrequency?"bi-weekly":"monthly"," payments"]})]}),(0,fn.jsxs)("div",{className:"flex justify-between",children:[(0,fn.jsx)("span",{children:"Payment Amount:"}),(0,fn.jsx)("span",{className:"font-medium",children:be((pe.financeAmount||0)/(pe.financeDuration||12))})]}),(0,fn.jsxs)("div",{className:"flex justify-between",children:[(0,fn.jsx)("span",{children:"First Payment:"}),(0,fn.jsx)("span",{className:"font-medium",children:pe.financeStartDate?new Date(pe.financeStartDate).toLocaleDateString("en-GB"):"Not set"})]}),(0,fn.jsxs)("div",{className:"flex justify-between",children:[(0,fn.jsx)("span",{children:"Start Day:"}),(0,fn.jsx)("span",{className:"font-medium",children:pe.financeDueDay||1})]})]})]})]})]})]}),"send"===oe&&(0,fn.jsx)("div",{children:f?(0,fn.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,fn.jsxs)("div",{className:"space-y-4",children:[(0,fn.jsxs)("div",{className:"bg-white border border-gray-200 rounded-xl p-4",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-2 mb-3",children:[(0,fn.jsx)(Cc,{className:"w-5 h-5 text-blue-600"}),(0,fn.jsx)("h3",{className:"font-semibold text-gray-800",children:"Send Contract"})]}),(0,fn.jsx)("div",{className:"mb-3",children:(0,fn.jsx)("input",{type:"email",value:pe.email,onChange:e=>ge("email",e.target.value),placeholder:"customer@email.com",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})}),y?(0,fn.jsxs)("div",{className:"flex items-center space-x-2 text-green-600 bg-green-50 rounded-lg px-3 py-2",children:[(0,fn.jsx)(zc,{className:"w-4 h-4"}),(0,fn.jsxs)("span",{className:"text-sm",children:["Sent ",j&&new Date(j).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"})]})]}):(0,fn.jsx)("button",{onClick:async()=>{if(f&&pe.email){p(!0),g(null);try{const e=await fetch("/api/contracts/send/".concat(f.id),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify({email:pe.email})}),t=await e.json();if(!e.ok)throw new Error(t.message||"Failed to send contract");v(!0),w((new Date).toISOString()),C("sent"),null===i||void 0===i||i(f)}catch(ty){g(ty.message)}finally{p(!1)}}},disabled:h||!pe.email,className:"w-full py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center space-x-2 text-sm font-medium",children:h?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(oc,{className:"w-4 h-4 animate-spin"}),(0,fn.jsx)("span",{children:"Sending..."})]}):(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(Wc,{className:"w-4 h-4"}),(0,fn.jsx)("span",{children:"Send Email"})]})}),(0,fn.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-100",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,fn.jsx)("button",{onClick:async()=>{if(null!==f&&void 0!==f&&f.signingUrl)try{await navigator.clipboard.writeText(f.signingUrl),k(!0),setTimeout(()=>k(!1),2e3)}catch(ty){const t=document.createElement("textarea");t.value=f.signingUrl,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),k(!0),setTimeout(()=>k(!1),2e3)}},className:"flex-1 py-2 px-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors flex items-center justify-center space-x-1 text-sm",children:N?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(ac,{className:"w-4 h-4 text-green-600"}),(0,fn.jsx)("span",{className:"text-green-600",children:"Copied!"})]}):(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(ed,{className:"w-4 h-4"}),(0,fn.jsx)("span",{children:"Copy Link"})]})}),(0,fn.jsxs)("a",{href:null===f||void 0===f?void 0:f.signingUrl,target:"_blank",rel:"noopener noreferrer",className:"flex-1 py-2 px-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors flex items-center justify-center space-x-1 text-sm",children:[(0,fn.jsx)(Zc,{className:"w-4 h-4"}),(0,fn.jsx)("span",{children:"Preview"})]})]}),(0,fn.jsxs)("p",{className:"text-xs text-gray-400 mt-2 flex items-center space-x-1",children:[(0,fn.jsx)(Uc,{className:"w-3 h-3"}),(0,fn.jsx)("span",{children:"Link expires in 7 days"})]})]})]}),"signed"===S&&(0,fn.jsxs)("div",{className:"bg-white border border-gray-200 rounded-xl p-4",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-2 mb-3",children:[(0,fn.jsx)(Sc,{className:"w-5 h-5 text-purple-600"}),(0,fn.jsx)("h3",{className:"font-semibold text-gray-800",children:"Auth Code"}),(0,fn.jsx)("span",{className:"text-xs text-gray-400",children:"(internal)"})]}),(0,fn.jsxs)("div",{className:"flex space-x-2",children:[(0,fn.jsx)("input",{type:"text",value:Q,onChange:e=>{K(e.target.value),$(!1)},placeholder:"Enter auth code",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-purple-500 focus:border-purple-500"}),(0,fn.jsx)("button",{onClick:async()=>{if(null!==f&&void 0!==f&&f.id&&Q.trim()){Y(!0),g(null);try{const e=await fetch("/api/contracts/".concat(f.id,"/auth-code"),{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify({authCode:Q.trim()})}),t=await e.json();if(!e.ok)throw new Error(t.message||"Failed to save auth code");$(!0),setTimeout(()=>$(!1),3e3)}catch(ty){g(ty.message)}finally{Y(!1)}}},disabled:H||!Q.trim(),className:"px-4 py-2 rounded-lg text-sm font-medium flex items-center space-x-1 transition-colors ".concat(G?"bg-green-100 text-green-700":"bg-purple-600 text-white hover:bg-purple-700 disabled:opacity-50"),children:H?(0,fn.jsx)(oc,{className:"w-4 h-4 animate-spin"}):G?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(ac,{className:"w-4 h-4"}),(0,fn.jsx)("span",{children:"Saved"})]}):(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(td,{className:"w-4 h-4"}),(0,fn.jsx)("span",{children:"Save"})]})})]})]})]}),(0,fn.jsxs)("div",{className:"space-y-4",children:[(0,fn.jsxs)("div",{className:"bg-white border border-gray-200 rounded-xl p-4",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,fn.jsx)("div",{className:"w-2 h-2 rounded-full ".concat("signed"===S?"bg-green-500":"bg-amber-500 animate-pulse")}),(0,fn.jsx)("h3",{className:"font-semibold text-gray-800",children:"Status"})]}),"signed"!==S&&(0,fn.jsxs)("span",{className:"text-xs text-gray-400 flex items-center space-x-1",children:[(0,fn.jsx)(Gc,{className:"w-3 h-3 ".concat(_?"animate-spin":"")}),(0,fn.jsx)("span",{children:"Live"})]})]}),"signed"===S?(0,fn.jsxs)("div",{className:"bg-green-50 rounded-lg p-4",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,fn.jsx)("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0",children:(0,fn.jsx)(zc,{className:"w-7 h-7 text-green-600"})}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("p",{className:"font-semibold text-green-800",children:"Signed"}),(0,fn.jsx)("p",{className:"text-sm text-green-600",children:(null===f||void 0===f?void 0:f.signedAt)&&new Date(f.signedAt).toLocaleString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),((null===f||void 0===f?void 0:f.signed_pdf_url)||(null===f||void 0===f?void 0:f.pdfUrl))&&(0,fn.jsxs)("a",{href:f.signed_pdf_url||f.pdfUrl,target:"_blank",rel:"noopener noreferrer",className:"mt-3 w-full py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center space-x-2 text-sm font-medium",children:[(0,fn.jsx)(cc,{className:"w-4 h-4"}),(0,fn.jsx)("span",{children:"Download PDF"})]})]}):(0,fn.jsx)("div",{className:"bg-amber-50 rounded-lg p-4",children:(0,fn.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,fn.jsx)("div",{className:"w-12 h-12 bg-amber-100 rounded-full flex items-center justify-center flex-shrink-0",children:(0,fn.jsx)(Uc,{className:"w-7 h-7 text-amber-600"})}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("p",{className:"font-semibold text-amber-800",children:"Awaiting Signature"}),(0,fn.jsx)("p",{className:"text-sm text-amber-600",children:j?"Sent ".concat(Math.floor((Date.now()-new Date(j).getTime())/6e4)," mins ago"):"Waiting for customer"})]})]})})]}),"signed"===S&&(0,fn.jsxs)("div",{className:"bg-white border border-gray-200 rounded-xl p-4",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-2 mb-3",children:[(0,fn.jsx)(Cc,{className:"w-5 h-5 ".concat(R?"text-red-600":T?"text-green-600":"text-gray-400")}),(0,fn.jsx)("h3",{className:"font-semibold text-gray-800",children:"Delivery Email"})]}),!0!==T||R?R?(0,fn.jsxs)("div",{className:"space-y-3",children:[(0,fn.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-2 text-red-700",children:[(0,fn.jsx)(Fc,{className:"w-4 h-4"}),(0,fn.jsx)("span",{className:"text-sm font-medium",children:"Failed to Send"})]}),(0,fn.jsx)("p",{className:"text-sm text-red-600 mt-1",children:R}),A&&(0,fn.jsxs)("p",{className:"text-xs text-red-400 mt-1",children:["Attempted: ",new Date(A).toLocaleString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),(0,fn.jsx)("button",{onClick:fe,disabled:W,className:"w-full py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 transition-colors flex items-center justify-center space-x-2 text-sm font-medium",children:W?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(oc,{className:"w-4 h-4 animate-spin"}),(0,fn.jsx)("span",{children:"Retrying..."})]}):(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(Gc,{className:"w-4 h-4"}),(0,fn.jsx)("span",{children:"Retry Sending"})]})})]}):(0,fn.jsxs)("div",{className:"space-y-3",children:[(0,fn.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-2 text-blue-700",children:[(0,fn.jsx)(oc,{className:"w-4 h-4 animate-spin"}),(0,fn.jsx)("span",{className:"text-sm font-medium",children:"Processing..."})]}),(0,fn.jsx)("p",{className:"text-sm text-blue-600 mt-1",children:"Delivery email is being sent automatically. This may take a moment."})]}),(0,fn.jsx)("button",{onClick:fe,disabled:W,className:"w-full py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors flex items-center justify-center space-x-2 text-sm",children:W?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(oc,{className:"w-4 h-4 animate-spin"}),(0,fn.jsx)("span",{children:"Sending..."})]}):(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(Gc,{className:"w-4 h-4"}),(0,fn.jsx)("span",{children:"Send Manually"})]})})]}):(0,fn.jsxs)("div",{className:"space-y-3",children:[(0,fn.jsxs)("div",{className:"bg-green-50 rounded-lg p-3",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-2 text-green-700",children:[(0,fn.jsx)(zc,{className:"w-4 h-4"}),(0,fn.jsx)("span",{className:"text-sm font-medium",children:"Sent Successfully"})]}),(0,fn.jsxs)("p",{className:"text-sm text-green-600 mt-1",children:["To: ",L]}),(0,fn.jsx)("p",{className:"text-xs text-green-500 mt-1",children:A&&new Date(A).toLocaleString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}),(0,fn.jsxs)("p",{className:"text-xs text-green-500 mt-1",children:["PDF + ",B||z||(null===o||void 0===o?void 0:o.length)||0," images attached"]})]}),(0,fn.jsx)("button",{onClick:fe,disabled:W,className:"w-full py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors flex items-center justify-center space-x-2 text-sm",children:W?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(oc,{className:"w-4 h-4 animate-spin"}),(0,fn.jsx)("span",{children:"Resending..."})]}):(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(Gc,{className:"w-4 h-4"}),(0,fn.jsx)("span",{children:"Resend Delivery"})]})})]})]})]})]}):(0,fn.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-2 text-yellow-700 mb-2",children:[(0,fn.jsx)(Fc,{className:"w-5 h-5"}),(0,fn.jsx)("span",{className:"font-medium",children:"Contract Data Missing"})]}),(0,fn.jsx)("p",{className:"text-sm text-yellow-600",children:"The contract was created but data is missing. Please check the console for details."})]})})]}),(0,fn.jsxs)("div",{className:"px-6 py-4 bg-gray-50 border-t flex justify-between flex-shrink-0",children:[(0,fn.jsxs)("div",{children:["edit"!==oe&&"send"!==oe&&(0,fn.jsxs)("button",{onClick:()=>ie("review"===oe?"edit":"review"),className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors flex items-center space-x-1",children:[(0,fn.jsx)(sd,{className:"w-4 h-4"}),(0,fn.jsx)("span",{children:"Back"})]}),"send"===oe&&!y&&(0,fn.jsxs)("button",{onClick:()=>ie("edit"),className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors flex items-center space-x-1",children:[(0,fn.jsx)(nd,{className:"w-4 h-4"}),(0,fn.jsx)("span",{children:"Edit Details"})]})]}),(0,fn.jsxs)("div",{className:"flex space-x-3",children:[(0,fn.jsx)("button",{onClick:he,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:y?"Done":"Cancel"}),"edit"===oe&&(0,fn.jsxs)("button",{onClick:()=>ie("review"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-1",children:[(0,fn.jsx)("span",{children:"Review"}),(0,fn.jsx)($c,{className:"w-4 h-4"})]}),"review"===oe&&(0,fn.jsx)("button",{onClick:async()=>{m(!0),g(null);try{const e=await fetch("/api/contracts/create",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify({leadId:n.id,packageId:null===r||void 0===r?void 0:r.id,packageData:r,invoiceData:He(He({},l),pe),contractDetails:pe,selectedPhotoIds:o})}),t=await e.json();if(!e.ok)throw console.error("Contract creation error:",t),new Error(t.message||t.error||"Failed to create contract");const s=t.contract||t.success&&t.contract;if(console.log("Contract creation response:",{data:t,contractData:s}),!s)throw console.error("No contract returned from API:",t),new Error("Contract was not created - no contract data returned. Check console for details.");if(!s.id||!s.signingUrl)throw console.error("Contract data missing required fields:",s),new Error("Contract created but missing required fields (id or signingUrl)");b(s),ie("send"),console.log("Contract created successfully, moving to send step")}catch(ty){console.error("Error creating contract:",ty),g(ty.message||"Failed to create contract. Please check the console for details.")}finally{m(!1)}},disabled:u,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2",children:u?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(oc,{className:"w-4 h-4 animate-spin"}),(0,fn.jsx)("span",{children:"Creating..."})]}):(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(Ic,{className:"w-4 h-4"}),(0,fn.jsx)("span",{children:"Create Contract"})]})})]})]})]})})},rd=e=>{var t;let{isOpen:s,onClose:n,lead:r,initialChannel:l="sms"}=e;const[o,i]=(0,a.useState)(l),[c,d]=(0,a.useState)([]),[u,m]=(0,a.useState)(!1),[h,p]=(0,a.useState)(""),[x,g]=(0,a.useState)(!1),[f,b]=(0,a.useState)({}),{socket:y}=Ga(),v=(0,a.useCallback)(async()=>{if(null===r||void 0===r||!r.id)return void console.error("\u274c No lead ID provided");m(!0);const e={steps:[],errors:[],apiMessages:0,filteredMessages:0};try{const i=localStorage.getItem("token");e.steps.push("Starting fetch for lead: "+r.id);let c=[];try{var t;e.steps.push("Calling /api/leads/".concat(r.id,"/messages..."));const s=(null===(t=(await gn.get("/api/leads/".concat(r.id,"/messages"),{headers:i?{Authorization:"Bearer ".concat(i)}:{}})).data)||void 0===t?void 0:t.messages)||[];e.apiMessages=s.length,e.steps.push("API returned ".concat(s.length," messages for lead")),c=s.filter(e=>{var t,s;const n=null===(t=e.action)||void 0===t?void 0:t.startsWith("EMAIL"),a=null===(s=e.action)||void 0===s?void 0:s.startsWith("SMS");return"email"===o?n:a}).map((e,t)=>{var s,n,a,l,o,i,c,d,u;return{id:e.id||"".concat(e.action,"_").concat(e.timestamp,"_").concat(t),leadId:r.id,type:null!==(s=e.action)&&void 0!==s&&s.startsWith("EMAIL")?"email":"sms",direction:(null===(n=e.details)||void 0===n?void 0:n.direction)||(null!==(a=e.action)&&void 0!==a&&a.includes("SENT")?"sent":"received"),content:(null===(l=e.details)||void 0===l?void 0:l.body)||(null===(o=e.details)||void 0===o?void 0:o.message)||"",subject:null===(i=e.details)||void 0===i?void 0:i.subject,email_body:(null===(c=e.details)||void 0===c?void 0:c.email_body)||(null===(d=e.details)||void 0===d?void 0:d.html_content),timestamp:e.timestamp,attachments:(null===(u=e.details)||void 0===u?void 0:u.attachments)||[],action:e.action}}),e.filteredMessages=c.length,e.steps.push("Filtered to ".concat(c.length," ").concat(o," messages"))}catch(n){e.errors.push("Lead messages API error: "+n.message),e.steps.push("API failed, trying booking history fallback...")}if(0===c.length)try{var s;e.steps.push("Trying booking history fallback...");const t=await gn.get("/api/leads/".concat(r.id),{headers:i?{Authorization:"Bearer ".concat(i)}:{}}),n=(null===(s=t.data)||void 0===s?void 0:s.lead)||t.data;let l=(null===n||void 0===n?void 0:n.bookingHistory)||(null===n||void 0===n?void 0:n.booking_history)||[];if("string"===typeof l)try{l=JSON.parse(l)}catch(a){l=[]}Array.isArray(l)||(l=[]);const d=l.filter(e=>["SMS_SENT","SMS_RECEIVED","EMAIL_SENT","EMAIL_RECEIVED"].includes(e.action)).map((e,t)=>{var s,n,a,l,o,i,c,d;return{id:"".concat(e.action,"_").concat(e.timestamp,"_").concat(t),leadId:r.id,type:null!==(s=e.action)&&void 0!==s&&s.startsWith("EMAIL")?"email":"sms",direction:null!==(n=e.action)&&void 0!==n&&n.includes("SENT")?"sent":"received",content:(null===(a=e.details)||void 0===a?void 0:a.body)||(null===(l=e.details)||void 0===l?void 0:l.message)||"",subject:null===(o=e.details)||void 0===o?void 0:o.subject,email_body:(null===(i=e.details)||void 0===i?void 0:i.email_body)||(null===(c=e.details)||void 0===c?void 0:c.html_content),timestamp:e.timestamp||e.created_at,attachments:(null===(d=e.details)||void 0===d?void 0:d.attachments)||[],action:e.action}}).filter(e=>"email"===o?"email"===e.type:"sms"===e.type);d.length>0&&(c=d,e.steps.push("Found ".concat(d.length," messages in booking history")))}catch(l){e.errors.push("Booking history fallback error: "+l.message)}const u=c.map(e=>{var t,s,n;return He(He({},e),{},{direction:e.direction||(e.isOutgoing||e.outgoing||e.sent||null!==(t=e.action)&&void 0!==t&&t.includes("SENT")?"sent":"received"),content:e.content||e.body||e.message||e.text||(null===(s=e.details)||void 0===s?void 0:s.body)||"",timestamp:e.timestamp||e.created_at||e.createdAt||e.date,email_body:e.email_body||e.htmlContent||e.html||null,subject:e.subject||(null===(n=e.details)||void 0===n?void 0:n.subject)})});u.sort((e,t)=>new Date(e.timestamp||0)-new Date(t.timestamp||0)),e.steps.push("Final message count: ".concat(u.length)),console.log("\u2705 Final: ".concat(u.length," messages to display")),d(u)}catch(i){e.errors.push("Fatal error: "+i.message),console.error("\u274c Error fetching messages:",i),d([])}finally{b(e),m(!1),console.log("\ud83d\udce8 Message Fetch Debug:",e)}},[null===r||void 0===r?void 0:r.id,o]);(0,a.useEffect)(()=>{s&&(console.log("\ud83d\udcf1 Modal opened, fetching messages..."),v())},[s,o,v]),(0,a.useEffect)(()=>{if(!y||!s||null===r||void 0===r||!r.id)return;const e=e=>{console.log("\ud83d\udce8 Real-time message received:",e),(null===e||void 0===e?void 0:e.leadId)!==r.id&&(null===e||void 0===e?void 0:e.lead_id)!==r.id||v()};return y.on("message_received",e),y.on("sms_received",e),y.on("email_received",e),()=>{y.off("message_received",e),y.off("sms_received",e),y.off("email_received",e)}},[y,s,null===r||void 0===r?void 0:r.id,v]),(0,a.useEffect)(()=>{c.length>0&&!u&&setTimeout(()=>{const e=document.getElementById("msg-scroll-container");e&&(e.scrollTop=e.scrollHeight)},100)},[c,u]);const j=async()=>{if(h.trim()&&!x){g(!0);try{if("email"===o){const e=c.find(e=>"received"===e.direction||"sent"===e.direction),t=(null===e||void 0===e?void 0:e.subject)||"",s=t&&!t.startsWith("Re:")?"Re: ".concat(t):t||"Re: Your email";console.log("\ud83d\udce7 Sending email to:",r.email);const n=await gn.post("/api/leads/".concat(r.id,"/send-email"),{subject:s,body:h.trim()});n.data.success?(p(""),v()):alert("Failed to send email: "+(n.data.message||"Unknown error"))}else{console.log("\ud83d\udcf1 Sending SMS to:",r.phone);const e=await gn.post("/api/leads/".concat(r.id,"/send-sms"),{message:h.trim(),type:"custom"});e.data.success?(p(""),v()):alert("Failed to send SMS: "+(e.data.message||"Unknown error"))}}catch(s){var e,t;console.error("\u274c Error sending reply:",s),alert("Error sending message: "+((null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||s.message))}finally{g(!1)}}},w=e=>{if(!e)return"";try{const t=new Date(e);if(isNaN(t.getTime()))return"";const s=new Date-t,n=s/864e5;if(s/36e5<1){const e=Math.floor(s/6e4);return e<=0?"Just now":"".concat(e,"m ago")}return n<1?t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0}):n<7?t.toLocaleDateString([],{weekday:"short"})+" "+t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):t.toLocaleDateString([],{month:"short",day:"numeric"})}catch(t){return""}},N=e=>{if(!e)return"";try{const t=new Date(e);if(isNaN(t.getTime()))return"";const s=new Date,n=t.toDateString()===s.toDateString(),a=new Date(s-864e5).toDateString()===t.toDateString();return n?"Today":a?"Yesterday":t.toLocaleDateString([],{weekday:"long",month:"short",day:"numeric"})}catch(t){return""}};if(!s||!r)return null;const k=!!r.email,S=!!r.phone;return(0,fn.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[100] p-4",children:(0,fn.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-lg max-h-[85vh] flex flex-col overflow-hidden animate-in fade-in zoom-in-95 duration-200",children:[(0,fn.jsxs)("div",{className:"px-5 py-4 border-b flex items-center justify-between ".concat("email"===o?"bg-gradient-to-r from-indigo-500 to-purple-600":"bg-gradient-to-r from-blue-500 to-cyan-500"),children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,fn.jsx)("div",{className:"w-10 h-10 rounded-full bg-white/20 flex items-center justify-center",children:"email"===o?(0,fn.jsx)(Wr,{className:"w-5 h-5 text-white"}):(0,fn.jsx)(Gr,{className:"w-5 h-5 text-white"})}),(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("h3",{className:"text-white font-semibold text-lg leading-tight",children:["email"===o?"Email":"SMS"," with ",r.name]}),(0,fn.jsx)("p",{className:"text-white/70 text-xs",children:"email"===o?r.email:r.phone})]})]}),(0,fn.jsxs)("div",{className:"flex items-center space-x-2",children:[k&&S&&(0,fn.jsxs)("div",{className:"flex bg-white/20 rounded-lg p-0.5 mr-2",children:[(0,fn.jsx)("button",{onClick:()=>i("sms"),className:"px-3 py-1.5 rounded-md text-xs font-medium transition-all ".concat("sms"===o?"bg-white text-blue-600 shadow-sm":"text-white hover:bg-white/10"),children:"SMS"}),(0,fn.jsx)("button",{onClick:()=>i("email"),className:"px-3 py-1.5 rounded-md text-xs font-medium transition-all ".concat("email"===o?"bg-white text-indigo-600 shadow-sm":"text-white hover:bg-white/10"),children:"Email"})]}),(0,fn.jsx)("button",{onClick:n,className:"p-2 hover:bg-white/20 rounded-full transition-colors",children:(0,fn.jsx)(jl,{className:"w-5 h-5 text-white"})})]})]}),(0,fn.jsx)("div",{id:"msg-scroll-container",className:"flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50",children:u?(0,fn.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,fn.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):0===c.length?(0,fn.jsxs)("div",{className:"text-center py-12",children:["email"===o?(0,fn.jsx)(Wr,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}):(0,fn.jsx)(Gr,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),(0,fn.jsxs)("p",{className:"text-sm text-gray-500",children:["No ",o," messages found"]}),f.steps&&(0,fn.jsxs)("div",{className:"mt-4 mx-4 p-3 bg-gray-100 rounded-lg text-left",children:[(0,fn.jsx)("p",{className:"text-xs font-semibold text-gray-600 mb-2",children:"Debug Info:"}),(0,fn.jsx)("ul",{className:"text-[10px] text-gray-500 space-y-1 max-h-32 overflow-y-auto",children:f.steps.map((e,t)=>(0,fn.jsx)("li",{className:"truncate",children:e},t))}),(null===(t=f.errors)||void 0===t?void 0:t.length)>0&&(0,fn.jsx)("div",{className:"mt-2 text-[10px] text-red-500",children:f.errors.map((e,t)=>(0,fn.jsx)("p",{children:e},t))})]}),(0,fn.jsx)("p",{className:"text-xs text-gray-400 mt-3",children:"email"!==o||k?"sms"!==o||S?"Start the conversation below":"No phone number for this lead":"No email address for this lead"})]}):c.map((e,t)=>{var s;const n="sent"===e.direction,l=e.timestamp,i=c[t-1],d=null===i||void 0===i?void 0:i.timestamp,u=0===t||l&&d&&new Date(l).toDateString()!==new Date(d).toDateString();return(0,fn.jsxs)(a.Fragment,{children:[u&&(0,fn.jsx)("div",{className:"flex items-center justify-center my-4",children:(0,fn.jsx)("div",{className:"bg-gray-200 px-3 py-1 rounded-full text-xs text-gray-500",children:N(l)})}),(0,fn.jsx)("div",{className:"flex ".concat(n?"justify-end":"justify-start"),children:(0,fn.jsxs)("div",{className:"max-w-[85%] rounded-2xl shadow-sm overflow-hidden ".concat(n?"email"===o?"bg-indigo-500 text-white rounded-br-md":"bg-blue-500 text-white rounded-br-md":"bg-white border border-gray-200 text-gray-800 rounded-bl-md"),children:[(0,fn.jsxs)("div",{className:"px-4 py-2 text-xs font-medium flex items-center space-x-2 ".concat(n?"bg-black/10 text-white/80":"bg-gray-100 text-gray-600 border-b border-gray-200"),children:[(0,fn.jsx)(gl,{className:"w-3 h-3"}),(0,fn.jsx)("span",{children:n?"You":r.name}),e.subject&&(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)("span",{className:"opacity-50",children:"\u2022"}),(0,fn.jsx)("span",{className:"truncate max-w-[150px]",children:e.subject})]})]}),(0,fn.jsxs)("div",{className:"px-4 py-3",children:["email"===o&&(e.email_body||e.htmlContent)?(0,fn.jsx)("div",{className:"max-h-64 overflow-y-auto ".concat(n?"email-sent":""),children:(0,fn.jsx)(Pl,{htmlContent:e.email_body||e.htmlContent,textContent:e.content,attachments:e.attachments||[],embeddedImages:e.embedded_images||[]})}):(0,fn.jsx)("p",{className:"text-sm whitespace-pre-wrap leading-relaxed ".concat(n?"text-white":"text-gray-800"),children:_l(e.content||"No content")}),(null===(s=e.attachments)||void 0===s?void 0:s.length)>0&&(0,fn.jsxs)("div",{className:"mt-2 flex items-center space-x-1 text-xs ".concat(n?"text-white/70":"text-gray-500"),children:[(0,fn.jsx)(Qr,{className:"w-3 h-3"}),(0,fn.jsxs)("span",{children:[e.attachments.length," attachment",e.attachments.length>1?"s":""]})]})]}),(0,fn.jsxs)("div",{className:"px-4 py-1.5 flex items-center justify-end space-x-2 ".concat(n?"bg-black/10 text-white/60":"bg-gray-50 text-gray-400 border-t border-gray-100"),children:[(0,fn.jsx)(wr,{className:"w-3 h-3"}),(0,fn.jsx)("span",{className:"text-xs",children:w(l)}),n&&(0,fn.jsx)(gr,{className:"w-3 h-3"})]})]})})]},e.id||t)})}),(0,fn.jsx)("div",{className:"border-t border-gray-200 bg-white p-4",children:("email"===o?k:S)?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsxs)("div",{className:"flex items-end space-x-3",children:[(0,fn.jsxs)("div",{className:"flex-1 relative",children:[(0,fn.jsx)("textarea",{value:h,onChange:e=>p(e.target.value),placeholder:"Type your ".concat(o,"..."),rows:h.includes("\n")?3:1,className:"w-full px-4 py-3 pr-12 bg-gray-100 border-0 rounded-xl resize-none focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all text-sm",onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),j())}}),h.length>0&&(0,fn.jsx)("div",{className:"absolute right-3 bottom-3 text-xs text-gray-400",children:h.length})]}),(0,fn.jsx)("button",{onClick:j,disabled:!h.trim()||x,className:"p-3 rounded-xl transition-all ".concat(h.trim()&&!x?"email"===o?"bg-indigo-500 hover:bg-indigo-600 text-white shadow-lg shadow-indigo-200":"bg-blue-500 hover:bg-blue-600 text-white shadow-lg shadow-blue-200":"bg-gray-200 text-gray-400 cursor-not-allowed"),children:x?(0,fn.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-current"}):(0,fn.jsx)(nl,{className:"w-5 h-5"})})]}),(0,fn.jsxs)("div",{className:"mt-2 flex items-center justify-between text-xs text-gray-400",children:[(0,fn.jsx)("span",{children:"Press Enter to send, Shift+Enter for new line"}),(0,fn.jsxs)("span",{children:["Replying to ","email"===o?r.email:r.phone]})]})]}):(0,fn.jsxs)("div",{className:"text-center py-3 text-amber-600 bg-amber-50 rounded-lg",children:[(0,fn.jsx)(rr,{className:"w-4 h-4 inline mr-1"}),(0,fn.jsxs)("span",{className:"text-sm",children:["Cannot send ",o," - no ","email"===o?"email address":"phone number"," for this lead"]})]})})]})})},ld=[{time:"10:00",slot1Type:"child-male",slot1Color:"bg-gradient-to-r from-yellow-100 to-blue-100",slot1BorderColor:"border-yellow-300",slot1Label:"Child/Male",slot2Type:"female",slot2Color:"bg-pink-100",slot2BorderColor:"border-pink-200",slot2Label:"Female"},{time:"10:30",slot1Type:"child-male",slot1Color:"bg-gradient-to-r from-yellow-100 to-blue-100",slot1BorderColor:"border-yellow-300",slot1Label:"Child/Male",slot2Type:"child-male",slot2Color:"bg-gradient-to-r from-yellow-100 to-blue-100",slot2BorderColor:"border-yellow-300",slot2Label:"Child/Male"},{time:"11:00",slot1Type:"female",slot1Color:"bg-pink-100",slot1BorderColor:"border-pink-200",slot1Label:"Female",slot2Type:"child-male",slot2Color:"bg-gradient-to-r from-yellow-100 to-blue-100",slot2BorderColor:"border-yellow-300",slot2Label:"Child/Male"},{time:"11:30",slot1Type:"female",slot1Color:"bg-pink-100",slot1BorderColor:"border-pink-200",slot1Label:"Female",slot2Type:"female",slot2Color:"bg-pink-100",slot2BorderColor:"border-pink-200",slot2Label:"Female"},{time:"12:00",slot1Type:"child-male",slot1Color:"bg-gradient-to-r from-yellow-100 to-blue-100",slot1BorderColor:"border-yellow-300",slot1Label:"Child/Male",slot2Type:"male",slot2Color:"bg-blue-100",slot2BorderColor:"border-blue-200",slot2Label:"Male"},{time:"12:30",slot1Type:"female",slot1Color:"bg-pink-100",slot1BorderColor:"border-pink-200",slot1Label:"Female",slot2Type:"female",slot2Color:"bg-pink-100",slot2BorderColor:"border-pink-200",slot2Label:"Female"},{time:"13:00",slot1Type:"female",slot1Color:"bg-pink-100",slot1BorderColor:"border-pink-200",slot1Label:"Female",slot2Type:"male",slot2Color:"bg-blue-100",slot2BorderColor:"border-blue-200",slot2Label:"Male"},{time:"13:30",slot1Type:"female",slot1Color:"bg-pink-100",slot1BorderColor:"border-pink-200",slot1Label:"Female",slot2Type:"child-male",slot2Color:"bg-gradient-to-r from-yellow-100 to-blue-100",slot2BorderColor:"border-yellow-300",slot2Label:"Male/Child"},{time:"14:00",slot1Type:"child-male",slot1Color:"bg-gradient-to-r from-yellow-100 to-blue-100",slot1BorderColor:"border-yellow-300",slot1Label:"Male/Child",slot2Type:"child-male",slot2Color:"bg-gradient-to-r from-yellow-100 to-blue-100",slot2BorderColor:"border-yellow-300",slot2Label:"Male/Child"},{time:"14:30",slot1Type:"female",slot1Color:"bg-pink-100",slot1BorderColor:"border-pink-200",slot1Label:"Female",slot2Type:"child-male",slot2Color:"bg-gradient-to-r from-yellow-100 to-blue-100",slot2BorderColor:"border-yellow-300",slot2Label:"Male/Child"},{time:"15:00",slot1Type:"female",slot1Color:"bg-pink-100",slot1BorderColor:"border-pink-200",slot1Label:"Female",slot2Type:"female",slot2Color:"bg-pink-100",slot2BorderColor:"border-pink-200",slot2Label:"Female"},{time:"15:30",slot1Type:"child-male",slot1Color:"bg-gradient-to-r from-yellow-100 to-blue-100",slot1BorderColor:"border-yellow-300",slot1Label:"Male/Child",slot2Type:"child-male",slot2Color:"bg-gradient-to-r from-yellow-100 to-blue-100",slot2BorderColor:"border-yellow-300",slot2Label:"Male/Child"},{time:"16:00",slot1Type:"male",slot1Color:"bg-blue-100",slot1BorderColor:"border-blue-200",slot1Label:"Male",slot2Type:"male",slot2Color:"bg-blue-100",slot2BorderColor:"border-blue-200",slot2Label:"Male"},{time:"16:30",slot1Type:"male",slot1Color:"bg-blue-100",slot1BorderColor:"border-blue-200",slot1Label:"Male",slot2Type:"male",slot2Color:"bg-blue-100",slot2BorderColor:"border-blue-200",slot2Label:"Male"}],od=e=>{let{selectedDate:t,events:s,blockedSlots:n=[],onSlotClick:r,onEventClick:l}=e;const[o,i]=(0,a.useState)(null),c=(0,a.useRef)(null);(0,a.useEffect)(()=>{if(!o)return;const e=e=>{c.current&&!c.current.contains(e.target)&&i(null)},t=e=>{"Escape"===e.key&&i(null)};return document.addEventListener("mousedown",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t)}},[o]);const d=(0,a.useMemo)(()=>{if(!s||0===s.length)return new Map;const e=t.toISOString().split("T")[0],n=new Map;return s.forEach(t=>{if(!t.date_booked)return;if(new Date(t.date_booked).toISOString().split("T")[0]!==e)return;const s="".concat(t.time_booked||"","_").concat(t.booking_slot||1);n.has(s)||n.set(s,[]),n.get(s).push(t)}),n},[s,t]),u=(0,a.useMemo)(()=>{if(!n||0===n.length)return new Map;const e=new Map;return n.forEach(t=>{const s=new Date(t.date).toISOString().split("T")[0];e.has(s)||e.set(s,[]),e.get(s).push(t)}),e},[n]),m=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=t.toISOString().split("T")[0],a=u.get(n)||[];return 0!==a.length&&a.some(t=>{if(!t.time_slot){if(s&&t.slot_number)return parseInt(t.slot_number)===parseInt(s);if(!t.slot_number)return!0}if(e&&t.time_slot===e){if(s&&t.slot_number)return parseInt(t.slot_number)===parseInt(s);if(!t.slot_number)return!0}return!1})},h=(e,t)=>{const s="".concat(e,"_").concat(t);return d.get(s)||[]},p=(e,t)=>{const s=h(e,t);return s.length>0?s[0]:null},x=e=>e?"Arrived"===e.booking_status?(0,fn.jsx)("span",{className:"inline-block w-3 h-3 rounded-full mr-2 shadow-sm",style:{backgroundColor:"#2563eb"}}):"Left"===e.booking_status?(0,fn.jsx)("span",{className:"inline-block w-3 h-3 rounded-full mr-2 shadow-sm",style:{backgroundColor:"#1f2937"}}):"No Show"===e.booking_status?(0,fn.jsx)("span",{className:"inline-block w-3 h-3 rounded-full mr-2 shadow-sm",style:{backgroundColor:"#ef4444"}}):"No Sale"===e.booking_status?(0,fn.jsx)("span",{className:"inline-block w-3 h-3 rounded-full mr-2 shadow-sm",style:{backgroundColor:"#b91c1c"}}):"Review"===e.booking_status?(0,fn.jsx)("span",{className:"inline-block w-3 h-3 rounded-full mr-2 shadow-sm",style:{backgroundColor:"#8b5cf6"}}):1==e.is_double_confirmed?(0,fn.jsx)("span",{className:"inline-block text-green-700 font-black text-sm mr-1",children:"\u2713\u2713"}):1==e.is_confirmed?(0,fn.jsx)(xr,{className:"inline-block w-5 h-5 text-green-500 mr-1"}):(0,fn.jsx)(wr,{className:"inline-block w-5 h-5 text-orange-400 mr-1"}):null,g=(e,t,s,n)=>{if(m(s,n))return"bg-gray-300 opacity-60";const a=1===n?e.slot1Color:e.slot2Color;return t?t.has_sale||"Arrived"===t.booking_status?"bg-blue-300":"Left"===t.booking_status?"bg-gray-400":"No Show"===t.booking_status?"bg-red-300":"No Sale"===t.booking_status?"bg-red-200":"Review"===t.booking_status?"bg-purple-300":1==t.is_double_confirmed?"bg-green-400":1==t.is_confirmed?"bg-green-300":"bg-orange-200":a};return(0,fn.jsxs)("div",{className:"slot-calendar-container",children:[(0,fn.jsxs)("div",{className:"mb-4",children:[(0,fn.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:t.toLocaleDateString("en-GB",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),(0,fn.jsxs)("div",{className:"flex flex-wrap gap-4 text-sm",children:[(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("div",{className:"w-4 h-4 bg-blue-100 border border-blue-200 rounded mr-2"}),(0,fn.jsx)("span",{children:"Male"})]}),(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("div",{className:"w-4 h-4 bg-pink-100 border border-pink-200 rounded mr-2"}),(0,fn.jsx)("span",{children:"Female"})]}),(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("div",{className:"w-4 h-4 bg-gradient-to-r from-yellow-100 to-blue-100 border border-yellow-300 rounded mr-2"}),(0,fn.jsx)("span",{children:"Child/Male"})]}),(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("div",{className:"w-4 h-4 bg-gray-50 border border-gray-300 rounded mr-2"}),(0,fn.jsx)("span",{children:"Unavailable"})]})]}),(0,fn.jsxs)("div",{className:"flex flex-wrap gap-3 text-xs mt-2 pt-2 border-t border-gray-200",children:[(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("div",{className:"w-3 h-3 rounded-full mr-1 shadow-sm",style:{backgroundColor:"#fb923c"}}),(0,fn.jsx)("span",{className:"font-medium",children:"Unconfirmed"})]}),(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("div",{className:"w-3 h-3 rounded-full mr-1 shadow-sm",style:{backgroundColor:"#22c55e"}}),(0,fn.jsx)("span",{className:"font-medium",children:"Confirmed"})]}),(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("div",{className:"w-3 h-3 rounded-full mr-1 shadow-sm",style:{backgroundColor:"#15803d"}}),(0,fn.jsx)("span",{className:"font-medium",children:"Double Confirmed"})]}),(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("div",{className:"w-3 h-3 rounded-full mr-1 shadow-sm",style:{backgroundColor:"#2563eb"}}),(0,fn.jsx)("span",{className:"font-medium",children:"Arrived"})]}),(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("div",{className:"w-3 h-3 rounded-full mr-1 shadow-sm",style:{backgroundColor:"#1f2937"}}),(0,fn.jsx)("span",{className:"font-medium",children:"Left"})]}),(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("div",{className:"w-3 h-3 rounded-full mr-1 shadow-sm",style:{backgroundColor:"#ef4444"}}),(0,fn.jsx)("span",{className:"font-medium",children:"No Show"})]}),(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("div",{className:"w-3 h-3 rounded-full mr-1 shadow-sm",style:{backgroundColor:"#8b5cf6"}}),(0,fn.jsx)("span",{className:"font-medium",children:"Review"})]})]})]}),(0,fn.jsxs)("div",{className:"slot-calendar-grid border border-gray-300 rounded-lg overflow-hidden shadow-sm",children:[(0,fn.jsxs)("div",{className:"grid grid-cols-3 bg-gray-50 border-b border-gray-300",children:[(0,fn.jsx)("div",{className:"p-3 font-semibold text-center border-r border-gray-300",children:"TIME"}),(0,fn.jsx)("div",{className:"p-3 font-semibold text-center border-r border-gray-300",children:"SLOT 1"}),(0,fn.jsx)("div",{className:"p-3 font-semibold text-center",children:"SLOT 2"})]}),ld.map((e,t)=>{const s=p(e.time,1),n=p(e.time,2),a=h(e.time,1),d=h(e.time,2),u=a.length>1?a.slice(1):[],f=d.length>1?d.slice(1):[];return(0,fn.jsxs)("div",{className:"grid grid-cols-3 border-b border-gray-200 ".concat(t===ld.length-1?"border-b-0":""),children:[(0,fn.jsx)("div",{className:"p-4 font-medium text-center border-r border-gray-300 bg-gray-50 flex items-center justify-center",children:e.time}),(0,fn.jsxs)("div",{className:"p-4 border-r border-gray-300 ".concat(g(e,s,e.time,1)," ").concat(e.slot1BorderColor," ").concat(m(e.time,1)||"blank"===e.slot1Type?"cursor-not-allowed":"cursor-pointer hover:opacity-80"," transition-opacity min-h-[80px] flex items-center justify-center relative"),onClick:()=>{m(e.time,1)||"blank"===e.slot1Type||(s?l(s):r(e.time,1,e))},children:[m(e.time,1)?(0,fn.jsx)("div",{className:"text-center w-full",children:(0,fn.jsx)("div",{className:"font-semibold text-gray-600 flex items-center justify-center",children:(0,fn.jsx)("span",{className:"text-xs",children:"\ud83d\udd12 Blocked"})})}):"blank"===e.slot1Type?(0,fn.jsx)("div",{className:"text-center w-full",children:(0,fn.jsx)("div",{className:"font-semibold text-gray-500 flex items-center justify-center",children:(0,fn.jsx)("span",{className:"text-xs",children:"Unavailable"})})}):s?(0,fn.jsxs)("div",{className:"text-center w-full",children:[(0,fn.jsxs)("div",{className:"font-semibold text-gray-800 flex items-center justify-center",children:[x(s),(0,fn.jsx)("span",{className:"truncate",children:s.name}),s.hasUnreadSms||s.hasUnreadEmail?(0,fn.jsxs)("span",{className:"relative ml-1.5 flex-shrink-0 animate-pulse",children:[s.hasUnreadSms?(0,fn.jsx)(Gr,{className:"inline-block w-4 h-4 text-green-500"}):(0,fn.jsx)(Wr,{className:"inline-block w-4 h-4 text-blue-500"}),(0,fn.jsx)("span",{className:"absolute -top-1 -right-1 w-2.5 h-2.5 bg-red-500 rounded-full border border-white animate-ping",style:{animationDuration:"1.5s"}}),(0,fn.jsx)("span",{className:"absolute -top-1 -right-1 w-2.5 h-2.5 bg-red-500 rounded-full border border-white"})]}):s.hasReceivedSms||s.hasReceivedEmail?(0,fn.jsx)("span",{className:"ml-1.5 flex-shrink-0",children:s.hasReceivedSms?(0,fn.jsx)(Gr,{className:"inline-block w-3.5 h-3.5 text-gray-400"}):(0,fn.jsx)(Wr,{className:"inline-block w-3.5 h-3.5 text-gray-400"})}):null]}),s.phone&&(0,fn.jsx)("div",{className:"text-xs text-gray-600 mt-1",children:s.phone})]}):(0,fn.jsx)("div",{className:"text-gray-400 text-sm text-center",children:"Click to Book"}),u.length>0&&(0,fn.jsxs)("div",{className:"absolute top-1 right-1",ref:(null===o||void 0===o?void 0:o.time)===e.time&&1===(null===o||void 0===o?void 0:o.slot)?c:null,children:[(0,fn.jsxs)("button",{className:"bg-red-500 text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center shadow-md hover:bg-red-600 transition-colors",onClick:t=>{t.stopPropagation(),i((null===o||void 0===o?void 0:o.time)===e.time&&1===(null===o||void 0===o?void 0:o.slot)?null:{time:e.time,slot:1})},title:"".concat(u.length," more booking(s)"),children:["+",u.length]}),(null===o||void 0===o?void 0:o.time)===e.time&&1===(null===o||void 0===o?void 0:o.slot)&&(0,fn.jsxs)("div",{className:"absolute top-7 right-0 bg-white border border-gray-300 rounded-lg shadow-lg z-50 min-w-[180px] py-1",children:[(0,fn.jsxs)("div",{className:"px-3 py-1 text-xs font-semibold text-gray-500 border-b border-gray-200",children:["+",u.length," more booking",u.length>1?"s":""]}),u.map((e,t)=>(0,fn.jsxs)("button",{className:"w-full text-left px-3 py-2 text-sm hover:bg-gray-100 flex items-center gap-2 transition-colors",onClick:t=>{t.stopPropagation(),i(null),l(e)},children:[x(e),(0,fn.jsx)("span",{className:"truncate font-medium",children:e.name})]},e.id||t))]})]})]}),(0,fn.jsxs)("div",{className:"p-4 ".concat(g(e,n,e.time,2)," ").concat(e.slot2BorderColor," ").concat(m(e.time,2)||"blank"===e.slot2Type?"cursor-not-allowed":"cursor-pointer hover:opacity-80"," transition-opacity min-h-[80px] flex items-center justify-center relative"),onClick:()=>{m(e.time,2)||"blank"===e.slot2Type||(n?l(n):r(e.time,2,e))},children:[m(e.time,2)?(0,fn.jsx)("div",{className:"text-center w-full",children:(0,fn.jsx)("div",{className:"font-semibold text-gray-600 flex items-center justify-center",children:(0,fn.jsx)("span",{className:"text-xs",children:"\ud83d\udd12 Blocked"})})}):"blank"===e.slot2Type?(0,fn.jsx)("div",{className:"text-center w-full",children:(0,fn.jsx)("div",{className:"font-semibold text-gray-500 flex items-center justify-center",children:(0,fn.jsx)("span",{className:"text-xs",children:"Unavailable"})})}):n?(0,fn.jsxs)("div",{className:"text-center w-full",children:[(0,fn.jsxs)("div",{className:"font-semibold text-gray-800 flex items-center justify-center",children:[x(n),(0,fn.jsx)("span",{className:"truncate",children:n.name}),n.hasUnreadSms||n.hasUnreadEmail?(0,fn.jsxs)("span",{className:"relative ml-1.5 flex-shrink-0 animate-pulse",children:[n.hasUnreadSms?(0,fn.jsx)(Gr,{className:"inline-block w-4 h-4 text-green-500"}):(0,fn.jsx)(Wr,{className:"inline-block w-4 h-4 text-blue-500"}),(0,fn.jsx)("span",{className:"absolute -top-1 -right-1 w-2.5 h-2.5 bg-red-500 rounded-full border border-white animate-ping",style:{animationDuration:"1.5s"}}),(0,fn.jsx)("span",{className:"absolute -top-1 -right-1 w-2.5 h-2.5 bg-red-500 rounded-full border border-white"})]}):n.hasReceivedSms||n.hasReceivedEmail?(0,fn.jsx)("span",{className:"ml-1.5 flex-shrink-0",children:n.hasReceivedSms?(0,fn.jsx)(Gr,{className:"inline-block w-3.5 h-3.5 text-gray-400"}):(0,fn.jsx)(Wr,{className:"inline-block w-3.5 h-3.5 text-gray-400"})}):null]}),n.phone&&(0,fn.jsx)("div",{className:"text-xs text-gray-600 mt-1",children:n.phone})]}):(0,fn.jsx)("div",{className:"text-gray-400 text-sm text-center",children:"Click to Book"}),f.length>0&&(0,fn.jsxs)("div",{className:"absolute top-1 right-1",ref:(null===o||void 0===o?void 0:o.time)===e.time&&2===(null===o||void 0===o?void 0:o.slot)?c:null,children:[(0,fn.jsxs)("button",{className:"bg-red-500 text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center shadow-md hover:bg-red-600 transition-colors",onClick:t=>{t.stopPropagation(),i((null===o||void 0===o?void 0:o.time)===e.time&&2===(null===o||void 0===o?void 0:o.slot)?null:{time:e.time,slot:2})},title:"".concat(f.length," more booking(s)"),children:["+",f.length]}),(null===o||void 0===o?void 0:o.time)===e.time&&2===(null===o||void 0===o?void 0:o.slot)&&(0,fn.jsxs)("div",{className:"absolute top-7 right-0 bg-white border border-gray-300 rounded-lg shadow-lg z-50 min-w-[180px] py-1",children:[(0,fn.jsxs)("div",{className:"px-3 py-1 text-xs font-semibold text-gray-500 border-b border-gray-200",children:["+",f.length," more booking",f.length>1?"s":""]}),f.map((e,t)=>(0,fn.jsxs)("button",{className:"w-full text-left px-3 py-2 text-sm hover:bg-gray-100 flex items-center gap-2 transition-colors",onClick:t=>{t.stopPropagation(),i(null),l(e)},children:[x(e),(0,fn.jsx)("span",{className:"truncate font-medium",children:e.name})]},e.id||t))]})]})]})]},e.time)})]})]})},id=[{time:"10:00",slot1Type:"child-male",slot1Emoji:"\ud83d\udc9b\ud83d\udd35",slot2Type:"female",slot2Emoji:"\ud83e\ude77"},{time:"10:30",slot1Type:"child-male",slot1Emoji:"\ud83d\udc9b\ud83d\udd35",slot2Type:"child-male",slot2Emoji:"\ud83d\udc9b\ud83d\udd35"},{time:"11:00",slot1Type:"female",slot1Emoji:"\ud83e\ude77",slot2Type:"child-male",slot2Emoji:"\ud83d\udc9b\ud83d\udd35"},{time:"11:30",slot1Type:"female",slot1Emoji:"\ud83e\ude77",slot2Type:"female",slot2Emoji:"\ud83e\ude77"},{time:"12:00",slot1Type:"child-male",slot1Emoji:"\ud83d\udc9b\ud83d\udd35",slot2Type:"male",slot2Emoji:"\ud83d\udd35"},{time:"12:30",slot1Type:"female",slot1Emoji:"\ud83e\ude77",slot2Type:"female",slot2Emoji:"\ud83e\ude77"},{time:"13:00",slot1Type:"female",slot1Emoji:"\ud83e\ude77",slot2Type:"male",slot2Emoji:"\ud83d\udd35"},{time:"13:30",slot1Type:"female",slot1Emoji:"\ud83e\ude77",slot2Type:"child-male",slot2Emoji:"\ud83d\udc9b\ud83d\udd35"},{time:"14:00",slot1Type:"child-male",slot1Emoji:"\ud83d\udc9b\ud83d\udd35",slot2Type:"child-male",slot2Emoji:"\ud83d\udc9b\ud83d\udd35"},{time:"14:30",slot1Type:"female",slot1Emoji:"\ud83e\ude77",slot2Type:"child-male",slot2Emoji:"\ud83d\udc9b\ud83d\udd35"},{time:"15:00",slot1Type:"female",slot1Emoji:"\ud83e\ude77",slot2Type:"female",slot2Emoji:"\ud83e\ude77"},{time:"15:30",slot1Type:"child-male",slot1Emoji:"\ud83d\udc9b\ud83d\udd35",slot2Type:"child-male",slot2Emoji:"\ud83d\udc9b\ud83d\udd35"},{time:"16:00",slot1Type:"male",slot1Emoji:"\ud83d\udd35",slot2Type:"male",slot2Emoji:"\ud83d\udd35"},{time:"16:30",slot1Type:"male",slot1Emoji:"\ud83d\udd35",slot2Type:"male",slot2Emoji:"\ud83d\udd35"}],cd=e=>{let{weekStart:t,events:s,blockedSlots:n=[],onDayClick:r,onEventClick:l}=e;const[o,i]=(0,a.useState)(null),c=(0,a.useRef)(null);(0,a.useEffect)(()=>{if(!o)return;const e=e=>{c.current&&!c.current.contains(e.target)&&i(null)},t=e=>{"Escape"===e.key&&i(null)};return document.addEventListener("mousedown",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t)}},[o]);const d=(()=>{const e=[],s=new Date(t);for(let t=0;t<7;t++){const n=new Date(s);n.setDate(s.getDate()+t),e.push(n)}return e})(),u=(0,a.useMemo)(()=>{if(!s||0===s.length)return new Map;const e=new Map;return s.forEach(t=>{if(!t.date_booked)return;const s=new Date(t.date_booked).toISOString().split("T")[0],n="".concat(s,"_").concat(t.time_booked||"","_").concat(t.booking_slot||1);e.has(n)||e.set(n,[]),e.get(n).push(t)}),e},[s]),m=(0,a.useMemo)(()=>{if(!n||0===n.length)return new Map;const e=new Map;return n.forEach(t=>{const s=new Date(t.date).toISOString().split("T")[0];e.has(s)||e.set(s,[]),e.get(s).push(t)}),e},[n]),h=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=e.toISOString().split("T")[0],a=m.get(n)||[];return 0!==a.length&&a.some(e=>{if(!e.time_slot){if(s&&e.slot_number)return parseInt(e.slot_number)===parseInt(s);if(!e.slot_number)return!0}if(t&&e.time_slot===t){if(s&&e.slot_number)return parseInt(e.slot_number)===parseInt(s);if(!e.slot_number)return!0}return!1})},p=(e,t,s)=>{const n=e.toISOString().split("T")[0],a="".concat(n,"_").concat(t,"_").concat(s);return u.get(a)||[]},x=(e,t,s)=>{const n=p(e,t,s);return n.length>0?n[0]:null},g=e=>e?(0,fn.jsxs)("div",{className:"text-xs font-medium truncate flex items-center",title:e.name,children:[e.is_confirmed?(0,fn.jsx)(xr,{className:"inline-block w-3 h-3 text-green-600"}):(0,fn.jsx)(wr,{className:"inline-block w-3 h-3 text-orange-500"}),e.hasUnreadSms||e.hasUnreadEmail?(0,fn.jsxs)("span",{className:"relative ml-0.5 flex-shrink-0 animate-pulse",children:[e.hasUnreadSms?(0,fn.jsx)(Gr,{className:"inline-block w-3 h-3 text-green-500"}):(0,fn.jsx)(Wr,{className:"inline-block w-3 h-3 text-blue-500"}),(0,fn.jsx)("span",{className:"absolute -top-0.5 -right-0.5 w-1.5 h-1.5 bg-red-500 rounded-full"})]}):e.hasReceivedSms||e.hasReceivedEmail?(0,fn.jsx)("span",{className:"ml-0.5 flex-shrink-0",children:e.hasReceivedSms?(0,fn.jsx)(Gr,{className:"inline-block w-3 h-3 text-gray-400"}):(0,fn.jsx)(Wr,{className:"inline-block w-3 h-3 text-gray-400"})}):null]}):null,f=(e,t,s,n)=>h(t,s,n)?"bg-gray-300 opacity-60":e?e.has_sale?"bg-blue-400":e.is_confirmed?"bg-green-400":"Arrived"===e.booking_status?"bg-red-400":"Left"===e.booking_status?"bg-gray-400":"bg-orange-400":"bg-white";return(0,fn.jsxs)("div",{className:"weekly-slot-calendar-container",children:[(0,fn.jsx)("div",{className:"mb-4",children:(0,fn.jsxs)("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:["Week of ",t.toLocaleDateString("en-GB",{month:"long",day:"numeric",year:"numeric"})]})}),(0,fn.jsx)("div",{className:"overflow-x-auto",children:(0,fn.jsxs)("div",{className:"min-w-[1200px]",children:[(0,fn.jsxs)("div",{className:"grid grid-cols-[100px_repeat(7,1fr)] gap-0 border border-gray-300 rounded-lg overflow-hidden bg-white",children:[(0,fn.jsx)("div",{className:"bg-gray-50 border-r border-b border-gray-300 p-2 font-semibold text-center text-sm",children:"TIME"}),d.map((e,t)=>{const s=e.toDateString()===(new Date).toDateString(),a=n&&n.some(t=>{const s=e.toISOString().split("T")[0];return new Date(t.date).toISOString().split("T")[0]===s&&!t.time_slot&&!t.slot_number});return(0,fn.jsxs)("div",{className:"bg-gray-50 border-r border-b border-gray-300 p-2 text-center ".concat(a?"bg-gray-300 opacity-60 cursor-not-allowed":"cursor-pointer hover:bg-gray-100"," transition-colors ").concat(6===t?"border-r-0":""," ").concat(s&&!a?"bg-blue-50 font-bold":""),onClick:()=>{a?alert("This day is blocked and cannot be viewed"):r(e)},children:[(0,fn.jsx)("div",{className:"text-xs font-semibold",children:e.toLocaleDateString("en-GB",{weekday:"short"}).toUpperCase()}),(0,fn.jsx)("div",{className:"text-lg ".concat(s?"text-blue-600":""),children:e.getDate()}),(0,fn.jsx)("div",{className:"text-xs text-gray-500 flex justify-center gap-1 items-center",children:a?(0,fn.jsx)("span",{children:"\ud83d\udd12 Blocked"}):(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)("span",{children:"S1"}),(0,fn.jsx)("span",{children:"S2"})]})})]},t)}),id.map((e,t)=>(0,fn.jsxs)(a.Fragment,{children:[(0,fn.jsx)("div",{className:"bg-gray-50 border-r border-gray-300 p-2 text-center text-sm font-medium flex items-center justify-center ".concat(t===id.length-1?"":"border-b"),children:e.time}),d.map((s,n)=>{const a=x(s,e.time,1),d=x(s,e.time,2),u=p(s,e.time,1),m=p(s,e.time,2),b=u.length>1?u.slice(1):[],y=m.length>1?m.slice(1):[],v=s.toISOString().split("T")[0];return(0,fn.jsx)("div",{className:"border-r border-gray-300 p-1 ".concat(t===id.length-1?"":"border-b"," ").concat(6===n?"border-r-0":""),children:(0,fn.jsxs)("div",{className:"grid grid-cols-2 gap-1 h-full",children:[(0,fn.jsxs)("div",{className:"compact-cell ".concat(f(a,s,e.time,1)," rounded ").concat(h(s,e.time,1)||"blank"===e.slot1Type?"cursor-not-allowed":"cursor-pointer hover:opacity-80"," transition-opacity flex items-center justify-center border border-gray-200 relative"),onClick:t=>{t.stopPropagation(),h(s,e.time,1)||"blank"===e.slot1Type||(a?l(a):r(s,e.time,1))},title:h(s,e.time,1)?"Blocked":"blank"===e.slot1Type?"Unavailable":a?"".concat(a.name," - Slot 1").concat(b.length?" (+".concat(b.length," more)"):""):"Book ".concat(e.time," Slot 1 (").concat(e.slot1Type,")"),children:[h(s,e.time,1)?(0,fn.jsx)("span",{className:"text-xs",children:"\ud83d\udd12"}):a?g(a):e.slot1Emoji&&(0,fn.jsx)("span",{className:"text-xs",children:e.slot1Emoji}),b.length>0&&(0,fn.jsxs)("div",{className:"absolute -top-1 -right-1",ref:(null===o||void 0===o?void 0:o.dateStr)===v&&(null===o||void 0===o?void 0:o.time)===e.time&&1===(null===o||void 0===o?void 0:o.slot)?c:null,children:[(0,fn.jsxs)("button",{className:"bg-red-500 text-white font-bold rounded-full flex items-center justify-center shadow-md hover:bg-red-600 transition-colors",style:{fontSize:"9px",width:"16px",height:"16px",lineHeight:"16px"},onClick:t=>{t.stopPropagation(),i((null===o||void 0===o?void 0:o.dateStr)===v&&(null===o||void 0===o?void 0:o.time)===e.time&&1===(null===o||void 0===o?void 0:o.slot)?null:{dateStr:v,time:e.time,slot:1})},title:"".concat(b.length," more booking(s)"),children:["+",b.length]}),(null===o||void 0===o?void 0:o.dateStr)===v&&(null===o||void 0===o?void 0:o.time)===e.time&&1===(null===o||void 0===o?void 0:o.slot)&&(0,fn.jsxs)("div",{className:"absolute top-5 right-0 bg-white border border-gray-300 rounded-lg shadow-lg z-50 min-w-[160px] py-1",children:[(0,fn.jsxs)("div",{className:"px-2 py-1 text-xs font-semibold text-gray-500 border-b border-gray-200",children:["+",b.length," more"]}),b.map((e,t)=>(0,fn.jsx)("button",{className:"w-full text-left px-2 py-1.5 text-xs hover:bg-gray-100 truncate transition-colors",onClick:t=>{t.stopPropagation(),i(null),l(e)},children:e.name},e.id||t))]})]})]}),(0,fn.jsxs)("div",{className:"compact-cell ".concat(f(d,s,e.time,2)," rounded ").concat(h(s,e.time,2)||"blank"===e.slot2Type?"cursor-not-allowed":"cursor-pointer hover:opacity-80"," transition-opacity flex items-center justify-center border border-gray-200 relative"),onClick:t=>{t.stopPropagation(),h(s,e.time,2)||"blank"===e.slot2Type||(d?l(d):r(s,e.time,2))},title:h(s,e.time,2)?"Blocked":"blank"===e.slot2Type?"Unavailable":d?"".concat(d.name," - Slot 2").concat(y.length?" (+".concat(y.length," more)"):""):"Book ".concat(e.time," Slot 2 (").concat(e.slot2Type,")"),children:[h(s,e.time,2)?(0,fn.jsx)("span",{className:"text-xs",children:"\ud83d\udd12"}):d?g(d):e.slot2Emoji&&(0,fn.jsx)("span",{className:"text-xs",children:e.slot2Emoji}),y.length>0&&(0,fn.jsxs)("div",{className:"absolute -top-1 -right-1",ref:(null===o||void 0===o?void 0:o.dateStr)===v&&(null===o||void 0===o?void 0:o.time)===e.time&&2===(null===o||void 0===o?void 0:o.slot)?c:null,children:[(0,fn.jsxs)("button",{className:"bg-red-500 text-white font-bold rounded-full flex items-center justify-center shadow-md hover:bg-red-600 transition-colors",style:{fontSize:"9px",width:"16px",height:"16px",lineHeight:"16px"},onClick:t=>{t.stopPropagation(),i((null===o||void 0===o?void 0:o.dateStr)===v&&(null===o||void 0===o?void 0:o.time)===e.time&&2===(null===o||void 0===o?void 0:o.slot)?null:{dateStr:v,time:e.time,slot:2})},title:"".concat(y.length," more booking(s)"),children:["+",y.length]}),(null===o||void 0===o?void 0:o.dateStr)===v&&(null===o||void 0===o?void 0:o.time)===e.time&&2===(null===o||void 0===o?void 0:o.slot)&&(0,fn.jsxs)("div",{className:"absolute top-5 right-0 bg-white border border-gray-300 rounded-lg shadow-lg z-50 min-w-[160px] py-1",children:[(0,fn.jsxs)("div",{className:"px-2 py-1 text-xs font-semibold text-gray-500 border-b border-gray-200",children:["+",y.length," more"]}),y.map((e,t)=>(0,fn.jsx)("button",{className:"w-full text-left px-2 py-1.5 text-xs hover:bg-gray-100 truncate transition-colors",onClick:t=>{t.stopPropagation(),i(null),l(e)},children:e.name},e.id||t))]})]})]})]})},"".concat(s.toISOString(),"-").concat(e.time))})]},e.time))]}),(0,fn.jsxs)("div",{className:"mt-4 flex flex-wrap gap-4 text-xs",children:[(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("span",{className:"mr-2",children:"\ud83d\udd35"}),(0,fn.jsx)("span",{children:"Male"})]}),(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("span",{className:"mr-2",children:"\ud83e\ude77"}),(0,fn.jsx)("span",{children:"Female"})]}),(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("span",{className:"mr-2",children:"\ud83d\udc9b"}),(0,fn.jsx)("span",{children:"Family"})]}),(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("div",{className:"w-3 h-3 bg-green-400 rounded mr-2"}),(0,fn.jsx)("span",{children:"Confirmed"})]}),(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("div",{className:"w-3 h-3 bg-orange-400 rounded mr-2"}),(0,fn.jsx)("span",{children:"Unconfirmed"})]}),(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("div",{className:"w-3 h-3 bg-blue-400 rounded mr-2"}),(0,fn.jsx)("span",{children:"Sale"})]})]})]})})]})},dd=e=>e.has_sale?"bg-blue-300":"Arrived"===e.booking_status?"bg-blue-400":"Left"===e.booking_status?"bg-gray-400":"No Show"===e.booking_status?"bg-red-400":"No Sale"===e.booking_status?"bg-red-300":"Review"===e.booking_status?"bg-purple-400":"Reschedule"===e.booking_status?"bg-yellow-400":1==e.is_double_confirmed?"bg-green-500":1==e.is_confirmed?"bg-green-400":"bg-orange-300",ud=e=>{const t=dd(e);return t.includes("500")||t.includes("400")?"text-white":"text-gray-800"},md=e=>{let{currentDate:t,events:s,blockedSlots:n=[],onDayClick:r,onEventClick:l}=e;const o=(0,a.useMemo)(()=>{if(!s||0===s.length)return new Map;const e=new Map;return s.forEach(t=>{if(!t.date_booked)return;const s=new Date(t.date_booked).toISOString().split("T")[0];e.has(s)||e.set(s,[]),e.get(s).push(t)}),e},[s]),i=e=>{if(!e)return{slot1:[],slot2:[]};const t=e.toISOString().split("T")[0],s=o.get(t)||[];return{slot1:s.filter(e=>1===e.booking_slot),slot2:s.filter(e=>2===e.booking_slot)}},c=(()=>{const e=t.getFullYear(),s=t.getMonth(),n=new Date(e,s,1),a=new Date(e,s+1,0),r=n.getDay(),l=0===r?6:r-1,o=a.getDate(),i=[];for(let t=0;t<l;t++)i.push(null);for(let t=1;t<=o;t++)i.push(new Date(e,s,t));return i})(),d=t.toLocaleDateString("en-GB",{month:"long",year:"numeric"}),u=new Date;return u.setHours(0,0,0,0),(0,fn.jsxs)("div",{className:"monthly-slot-calendar-container",children:[(0,fn.jsxs)("div",{className:"mb-4",children:[(0,fn.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:d}),(0,fn.jsxs)("div",{className:"flex flex-wrap gap-3 text-xs",children:[(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("div",{className:"w-3 h-3 bg-orange-300 rounded mr-1"}),(0,fn.jsx)("span",{children:"Unconfirmed"})]}),(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("div",{className:"w-3 h-3 bg-green-400 rounded mr-1"}),(0,fn.jsx)("span",{children:"Confirmed"})]}),(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("div",{className:"w-3 h-3 bg-green-500 rounded mr-1"}),(0,fn.jsx)("span",{children:"Double \u2713\u2713"})]}),(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("div",{className:"w-3 h-3 bg-blue-400 rounded mr-1"}),(0,fn.jsx)("span",{children:"Arrived"})]}),(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("div",{className:"w-3 h-3 bg-red-400 rounded mr-1"}),(0,fn.jsx)("span",{children:"No Show"})]}),(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("div",{className:"w-3 h-3 bg-purple-400 rounded mr-1"}),(0,fn.jsx)("span",{children:"Review"})]})]})]}),(0,fn.jsxs)("div",{className:"bg-white border border-gray-300 rounded-lg overflow-hidden shadow-sm",children:[(0,fn.jsx)("div",{className:"grid grid-cols-7 bg-gray-50 border-b border-gray-300",children:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].map(e=>(0,fn.jsx)("div",{className:"p-2 text-center font-semibold text-sm text-gray-700 border-r border-gray-200 last:border-r-0",children:e},e))}),(0,fn.jsx)("div",{className:"grid grid-cols-7",children:c.map((e,t)=>{if(!e)return(0,fn.jsx)("div",{className:"min-h-[100px] border-r border-b border-gray-200 bg-gray-50"},"empty-".concat(t));const{total:s,confirmed:a,slot1Count:o,slot2Count:c}=(e=>{const{slot1:t,slot2:s}=i(e);return{total:t.length+s.length,confirmed:[...t,...s].filter(e=>e.is_confirmed).length,slot1Count:t.length,slot2Count:s.length}})(e),d=e.toDateString()===u.toDateString(),m=e<u,{slot1:h,slot2:p}=i(e),x=(e=>{if(!e||!n||0===n.length)return!1;const t=e.toISOString().split("T")[0];return n.some(e=>new Date(e.date).toISOString().split("T")[0]===t&&!e.time_slot&&!e.slot_number)})(e);return(0,fn.jsxs)("div",{className:"min-h-[100px] border-r border-b border-gray-200 p-2 ".concat(x?"bg-gray-300 opacity-60 cursor-not-allowed":"cursor-pointer hover:bg-gray-50"," transition-colors ").concat(d&&!x?"bg-blue-50 border-2 border-blue-500":""," ").concat(m&&!x?"bg-gray-50":""),onClick:()=>{x?alert("This day is blocked and cannot be viewed"):r(e)},children:[(0,fn.jsxs)("div",{className:"text-sm font-semibold mb-2 flex items-center justify-between ".concat(x?"text-gray-600":d?"text-blue-600":m?"text-gray-400":"text-gray-700"),children:[(0,fn.jsx)("span",{children:e.getDate()}),x&&(0,fn.jsx)("span",{className:"text-xs",children:"\ud83d\udd12"})]}),s>0&&(0,fn.jsxs)("div",{className:"space-y-1",children:[o>0&&(0,fn.jsxs)("div",{className:"flex items-center gap-1",children:[(0,fn.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),(0,fn.jsxs)("span",{className:"text-xs text-gray-600",children:["S1: ",o]})]}),c>0&&(0,fn.jsxs)("div",{className:"flex items-center gap-1",children:[(0,fn.jsx)("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),(0,fn.jsxs)("span",{className:"text-xs text-gray-600",children:["S2: ",c]})]}),a>0&&(0,fn.jsxs)("div",{className:"flex items-center gap-1",children:[(0,fn.jsx)(xr,{className:"w-3 h-3 text-green-600"}),(0,fn.jsx)("span",{className:"text-xs text-green-600",children:a})]}),(0,fn.jsxs)("div",{className:"mt-1 space-y-0.5",children:[[...h,...p].slice(0,3).map((e,t)=>{var s;return(0,fn.jsxs)("div",{className:"text-xs truncate px-1.5 py-0.5 rounded cursor-pointer transition-all hover:opacity-80 ".concat(dd(e)," ").concat(ud(e)),onClick:t=>{t.stopPropagation(),l(e)},title:"".concat(e.name," - ").concat(e.booking_status||(1==e.is_double_confirmed?"Double Confirmed":1==e.is_confirmed?"Confirmed":"Unconfirmed")),children:[e.time_booked?"".concat(e.time_booked.slice(0,5)," "):"",null===(s=e.name)||void 0===s?void 0:s.split(" ")[0],e.hasUnreadSms?(0,fn.jsx)(Gr,{className:"inline-block w-2.5 h-2.5 text-green-500 ml-0.5 animate-pulse"}):e.hasUnreadEmail?(0,fn.jsx)(Wr,{className:"inline-block w-2.5 h-2.5 text-blue-500 ml-0.5 animate-pulse"}):e.hasReceivedSms?(0,fn.jsx)(Gr,{className:"inline-block w-2.5 h-2.5 text-gray-400 ml-0.5"}):e.hasReceivedEmail?(0,fn.jsx)(Wr,{className:"inline-block w-2.5 h-2.5 text-gray-400 ml-0.5"}):null]},e.id)}),s>3&&(0,fn.jsxs)("div",{className:"text-xs text-gray-500 font-medium",children:["+",s-3," more"]})]})]})]},e.toISOString())})})]})]})},hd=["_id"],pd=()=>{var e,t,s,n,r,l,o,i,c,d,u,m,h,p,x,g,f,b,y,v,j,w,N,k,S,C,_,E,T,P,A,D,L,M,R,F,I,O,B,U,z,V,W,q,H,Y,G,$,Q,J,X,Z,ee,te,se,ne,ae,re,le,oe,ie,ce,de,ue,me,he,pe,xe;const{user:ge}=wn(),fe=K(),[be,ye]=Pe(),[ve,je]=(0,a.useState)([]),[we,Ne]=(0,a.useState)(0),[ke,Se]=(0,a.useState)(null),[Ce,_e]=(0,a.useState)(!1),[Ee,Te]=(0,a.useState)(!1),[Ae,De]=(0,a.useState)(!1),[Le,Me]=(0,a.useState)("sms"),[Re,Fe]=(0,a.useState)(!1),[Ie,Oe]=(0,a.useState)(!1),[Be,Ue]=(0,a.useState)(!1),[ze,Ve]=(0,a.useState)("sms"),[We,qe]=(0,a.useState)(!1),[Ye,Ge]=(0,a.useState)(""),[$e,Qe]=(0,a.useState)(""),[Ke,Je]=(0,a.useState)([]),[Xe,Ze]=(0,a.useState)(!1),[et,tt]=(0,a.useState)(!1),[st,nt]=(0,a.useState)(!1),[at,rt]=(0,a.useState)({date_of_birth:"",height_inches:"",chest_inches:"",waist_inches:"",hips_inches:"",eye_color:"",hair_color:"",hair_length:""}),lt=[{time:"10:00",label:"10:00 AM"},{time:"10:30",label:"10:30 AM"},{time:"11:00",label:"11:00 AM"},{time:"11:30",label:"11:30 AM"},{time:"12:00",label:"12:00 PM"},{time:"12:30",label:"12:30 PM"},{time:"13:00",label:"1:00 PM"},{time:"13:30",label:"1:30 PM"},{time:"14:00",label:"2:00 PM"},{time:"14:30",label:"2:30 PM"},{time:"15:00",label:"3:00 PM"},{time:"15:30",label:"3:30 PM"},{time:"16:00",label:"4:00 PM"},{time:"16:30",label:"4:30 PM"}],ot=(0,a.useCallback)(async e=>{if(e){Ze(!0);try{const t=(await gn.get("/api/blocked-slots",{params:{start_date:e,end_date:e}})).data||[],s=(new Date(e),ve.filter(t=>{if(!t.date_booked)return!1;return new Date(t.date_booked).toISOString().split("T")[0]===e})),n=[];lt.forEach(e=>{const a=t.some(t=>(!t.time_slot||t.time_slot===e.time)&&(!t.slot_number||1===parseInt(t.slot_number))),r=s.some(t=>t.time_booked===e.time&&1===parseInt(t.booking_slot)),l=t.some(t=>(!t.time_slot||t.time_slot===e.time)&&(!t.slot_number||2===parseInt(t.slot_number))),o=s.some(t=>t.time_booked===e.time&&2===parseInt(t.booking_slot));a||r||n.push({time:e.time,slot:1,label:"".concat(e.label," - Slot 1")}),l||o||n.push({time:e.time,slot:2,label:"".concat(e.label," - Slot 2")})}),Je(n)}catch(t){console.error("Error fetching available slots:",t);const e=[];lt.forEach(t=>{e.push({time:t.time,slot:1,label:"".concat(t.label," - Slot 1")}),e.push({time:t.time,slot:2,label:"".concat(t.label," - Slot 2")})}),Je(e)}finally{Ze(!1)}}else Je([])},[ve]),it=(0,a.useRef)(new Set),[ct,dt]=(0,a.useState)(new Set),[ut,mt]=(0,a.useState)(!1),[ht,pt]=(0,a.useState)(()=>{const e=yi();return{dateStr:e.toISOString(),date:e}}),[xt,gt]=(0,a.useState)(new Date),ft=(0,a.useRef)(null),bt=(0,a.useRef)(new Set),yt=(0,a.useRef)(!0),vt=(0,a.useRef)(0),jt=(0,a.useRef)(null),{socket:wt,subscribeToCalendarUpdates:Nt,subscribeToLeadUpdates:kt,isConnected:St,emitCalendarUpdate:Ct}=Ga(),[_t,Et]=(0,a.useState)({_id:"",name:"",phone:"",email:"",postcode:"",status:"New",notes:"",image_url:"",isReschedule:!1,booking_slot:1,time_booked:""}),[Tt,Pt]=(0,a.useState)(!1),[At,Dt]=(0,a.useState)(!1),[Lt,Mt]=(0,a.useState)(!1),[Rt,Ft]=(0,a.useState)(null),[It,Ot]=(0,a.useState)(!1),[Bt,Ut]=(0,a.useState)(null),[zt,Vt]=(0,a.useState)(null),[Wt,qt]=(0,a.useState)(!1),[Ht,Yt]=(0,a.useState)([]),[Gt,$t]=(0,a.useState)([]),[Qt,Kt]=(0,a.useState)(null),[Jt,Xt]=(0,a.useState)(!1),[Zt,es]=(0,a.useState)(null),[ts,ss]=(0,a.useState)(!1),[ns,as]=(0,a.useState)(""),[rs,ls]=(0,a.useState)(!0),[os,is]=(0,a.useState)(!0),[cs,ds]=(0,a.useState)(null),[us,ms]=(0,a.useState)([]),[hs,ps]=(0,a.useState)(null),[xs,gs]=(0,a.useState)([]),[fs,bs]=(0,a.useState)(!1),[ys,vs]=(0,a.useState)("primary"),js=(0,a.useMemo)(()=>cs&&us.length?us.find(e=>e._id===cs)||us[0]:null,[cs,us]),ws=!1!==(null===js||void 0===js?void 0:js.sendEmail),Ns=!1!==(null===js||void 0===js?void 0:js.sendSMS),[ks,Ss]=(0,a.useState)(!1),[Cs,_s]=(0,a.useState)(!1),[Es,Ts]=(0,a.useState)(""),[Ps,As]=(0,a.useState)(()=>localStorage.getItem("calendarView")||"monthly"),[Ds,Ls]=(0,a.useState)(()=>{const e=localStorage.getItem("calendarDate");if(e)try{const t=new Date(e);if(!isNaN(t.getTime()))return t}catch(ey){}return yi()}),[Ms,Rs]=(0,a.useState)(1),[Fs,Is]=(0,a.useState)(""),[Os,Bs]=(0,a.useState)([]),[Us,zs]=(0,a.useState)(!1),[Vs,Ws]=(0,a.useState)("Duplicate"),[qs,Hs]=(0,a.useState)(!1),[Ys,Gs]=(0,a.useState)(null),[$s,Qs]=(0,a.useState)([]),[Ks,Js]=(0,a.useState)(0),[Xs,Zs]=(0,a.useState)(!1),[en,tn]=(0,a.useState)(!1),[sn,nn]=(0,a.useState)(null),[an,rn]=(0,a.useState)(!1),ln=(0,a.useRef)(null),[on,cn]=(0,a.useState)(!1),[dn,un]=(0,a.useState)(!1),[mn,hn]=(0,a.useState)(0),[pn,xn]=(0,a.useState)({current:0,total:0,currentFileName:""}),[bn,yn]=(0,a.useState)(!1),vn=(0,a.useRef)(null),[jn,Nn]=(0,a.useState)(null),[kn,Sn]=(0,a.useState)("all"),Cn=[{id:"headshots",label:"Headshots",icon:"\ud83d\udc64"},{id:"zcard",label:"Z-Card",icon:"\ud83d\udcc7"},{id:"best-pics",label:"Best Pics",icon:"\u2b50"}],[_n,En]=(0,a.useState)(!1),[Tn,Pn]=(0,a.useState)(0),An=(0,a.useRef)(null),Dn=(0,a.useCallback)(()=>{_e(!1),ye({},{replace:!0}),Yt([]),$t([]),Qs([]),Js(0),setTimeout(()=>{jt.current&&jt.current(!0)},100)},[ye]),Ln=(0,a.useCallback)(function(e,t){if(t&&"attended"===(null===e||void 0===e?void 0:e.toLowerCase()))return"#2563eb";if(t)return"#2563eb";switch(null===e||void 0===e?void 0:e.toLowerCase()){case"new":case"rescheduled":case"reschedule":return"#f97316";case"unconfirmed":return"#fb923c";case"double confirmed":return"#15803d";case"confirmed":return"#22c55e";case"unassigned":default:return"#6b7280";case"booked":return"#3b82f6";case"arrived":case"attended":case"complete":return"#2563eb";case"left":return"#1f2937";case"on show":return"#f59e0b";case"no sale":return"#b91c1c";case"cancelled":return"#f43f5e";case"no show":case"not interested":return"#ef4444";case"review":case"assigned":case"callback":return"#8b5cf6";case"contacted":return"#06b6d4";case"interested":return"#10b981"}},[]),Mn=(0,a.useCallback)(async()=>{try{var e;let t,s;if("daily"===Ps){const e=Ds.toISOString().split("T")[0];t=e,s=e}else if("weekly"===Ps){const e=new Date(Ds),n=e.getDay(),a=e.getDate()-n+(0===n?-6:1);e.setDate(a),t=e.toISOString().split("T")[0];const r=new Date(e);r.setDate(e.getDate()+6),s=r.toISOString().split("T")[0]}else{const e=new Date(Ds.getFullYear(),Ds.getMonth(),1),n=new Date(Ds.getFullYear(),Ds.getMonth()+1,0);t=e.toISOString().split("T")[0],s=n.toISOString().split("T")[0]}const n=await gn.get("/api/blocked-slots",{params:{start_date:t,end_date:s}});Bs(n.data||[]),console.log("\ud83d\udd12 Fetched ".concat((null===(e=n.data)||void 0===e?void 0:e.length)||0," blocked slots for ").concat(t," to ").concat(s))}catch(t){console.error("Error fetching blocked slots:",t),Bs([])}},[Ds,Ps]),Rn=(0,a.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(e&&(console.log("\ud83d\udcc5 Force refresh: Clearing calendar cache"),it.current=new Set,dt(new Set),je([])),_n&&!e)return void console.log("\ud83d\udcc5 Calendar: Fetch already in progress, skipping...");const t=Date.now();if(!e&&t-vt.current<3e3)console.log("\ud83d\udcc5 Calendar: Fetch debounced, too soon since last fetch");else{An.current&&(clearTimeout(An.current),An.current=null),En(!0),vt.current=t;try{console.log("\ud83d\udcc5 Fetching calendar events...");const t=new Date,s=new Date(t);s.setFullYear(s.getFullYear()-5),s.setMonth(0),s.setDate(1),s.setHours(0,0,0,0);const n=new Date(t);n.setFullYear(n.getFullYear()+5),n.setMonth(11),n.setDate(31),n.setHours(23,59,59,999);const a="ALL_BOOKINGS";if(!e&&it.current.has(a))return console.log("\ud83d\udcc5 All bookings already loaded, skipping fetch"),void En(!1);const r="&start=".concat(s.toISOString(),"&end=").concat(n.toISOString());console.log("\ud83d\udcc5 Fetching ALL bookings from ".concat(s.toLocaleDateString()," to ").concat(n.toLocaleDateString()," (10 year range)"));const l=e?"?t=".concat(Date.now()).concat(r,"&limit=10000"):"".concat(r,"&limit=10000"),o=await gn.get("/api/leads/calendar".concat(l),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))},timeout:15e3}),i=o.data.leads||[];console.log("\ud83d\udcc5 Received ".concat(i.length," leads from server")),0===i.length?console.log("\ud83d\udcc5 No leads received from server. Full response:",o.data):console.log("\ud83d\udcc5 Leads received:",i.map(e=>({name:e.name,status:e.status,date_booked:e.date_booked,time_booked:e.time_booked,booking_slot:e.booking_slot})));const c=i.filter(e=>e?!!e.id||(console.warn("\u26a0\ufe0f Lead missing ID:",e),!1):(console.warn("\u26a0\ufe0f Skipping null/undefined lead"),!1)),d=c.filter(e=>e.image_url&&""!==e.image_url);console.log("\ud83d\udcf8 Calendar: ".concat(d.length," out of ").concat(c.length," leads have image_url")),d.length>0&&console.log("\ud83d\udcf8 Sample leads with images:",d.slice(0,3).map(e=>{var t;return{name:e.name,image_url:e.image_url,hasImageUrl:!!e.image_url,imageUrlLength:null===(t=e.image_url)||void 0===t?void 0:t.length}}));const u=c.filter(e=>"image_url"in e);console.log("\ud83d\udcf8 Leads with image_url property: ".concat(u.length,"/").concat(c.length));const m=c.filter(e=>{const t=e.date_booked&&null!==e.date_booked&&"null"!==e.date_booked,s="Booked"===e.status&&!e.date_booked,n=!e.deleted_at,a="Cancelled"!==e.status&&"Rejected"!==e.status;return(t||s)&&n&&a}).map(e=>{var t;let s;if(e.date_booked&&null!==e.date_booked&&"null"!==e.date_booked){if(s=new Date(e.date_booked),isNaN(s.getTime()))return console.warn("Invalid date for lead ".concat(e.name,": ").concat(e.date_booked)),null}else{if("Booked"!==e.status)return null;e.updated_at?s=new Date(e.updated_at):(s=new Date,s.setHours(9,0,0,0))}const n=new Date(s);n.setMinutes(n.getMinutes()+30);let a,r=e.booking_history||[];if(!Array.isArray(r))try{r="string"===typeof r?JSON.parse(r):[]}catch(ey){console.warn("Failed to parse bookingHistory:",ey),r=[]}const l=e.date_booked&&null!==e.date_booked&&"null"!==e.date_booked;a=e.booking_status?e.booking_status:"Booked"===e.status?!l&&e.updated_at?"Booked":l?e.is_confirmed?"Confirmed":"Unconfirmed":"Unassigned":e.status;const o=e.is_double_confirmed||!1;o&&"Confirmed"===a&&(a="Double Confirmed");return{id:e.id,title:"".concat(e.name," - ").concat(a||e.status),start:s.toISOString(),end:n.toISOString(),allDay:!1,backgroundColor:Ln(a,e.hasSale,e.is_confirmed,o),borderColor:Ln(a,e.hasSale,e.is_confirmed,o),name:e.name,phone:e.phone,email:e.email,date_booked:e.date_booked,time_booked:e.time_booked,booking_slot:e.booking_slot,is_confirmed:e.is_confirmed,is_double_confirmed:o,booking_status:e.booking_status,has_sale:e.hasSale,hasUnreadSms:e.has_unread_sms||!1,hasUnreadEmail:e.has_unread_email||!1,hasReceivedSms:e.has_received_sms||!1,hasReceivedEmail:e.has_received_email||!1,extendedProps:{lead:He(He({},e),{},{bookingHistory:r}),phone:e.phone,status:e.status,displayStatus:a,booker:(null===(t=e.booker)||void 0===t?void 0:t.name)||e.booker_name||"N/A",isConfirmed:e.is_confirmed||!1,isDoubleConfirmed:o}}}).filter(e=>null!==e);console.log("\ud83d\udcc5 Calendar: Created ".concat(m.length," server events")),m.length>0&&console.log("\ud83d\udcc5 Sample event structure:",{id:m[0].id,name:m[0].name,date_booked:m[0].date_booked,time_booked:m[0].time_booked,booking_slot:m[0].booking_slot,start:m[0].start});const h=new Set,p=m.filter(e=>h.has(e.id)?(console.warn("\ud83d\udcc5 Duplicate event found for lead: ".concat(e.title)),!1):(h.add(e.id),!0));console.log("\ud83d\udcc5 Calendar: Final events array has ".concat(p.length," unique events")),it.current.add(a),dt(new Set(it.current)),console.log("\ud83d\udcc5 Marked all bookings as loaded (".concat(p.length," events)")),je(e=>{const t=new Set(e.map(e=>e.id)),s=p.filter(e=>!t.has(e.id)),n=[...e,...s];return console.log("\ud83d\udcc5 Merging ".concat(s.length," new events with ").concat(e.length," existing events = ").concat(n.length," total events")),n}),setTimeout(()=>{qn(p)},50)}catch(s){if(console.group("\u274c Calendar Events Fetch Error"),console.error("Detailed Error:",s),s.response)switch(console.error("Response Status:",s.response.status),console.error("Response Data:",s.response.data),console.error("Response Headers:",s.response.headers),s.response.status){case 401:console.error("Authentication failed. Token may be expired.");break;case 403:console.error("Access denied. Check user permissions.");break;case 404:console.error("Calendar endpoint not found.");break;case 500:console.error("Server-side error occurred.");break;default:console.error("Unexpected status code: ".concat(s.response.status))}else s.request?console.error("No response received:",s.request):console.error("Error setting up request:",s.message);console.groupEnd(),je(e=>0===e.length?(console.warn("\ud83d\udcc5 No events could be loaded. Check your connection or permissions."),[]):e)}finally{En(!1)}}},[Ln,_n]);(0,a.useEffect)(()=>{(async()=>{try{var e;console.log("\ud83d\udccb Fetching booking confirmation templates...");const t=await gn.get("/api/templates?type=booking_confirmation&isActive=true",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});console.log("\ud83d\udccb Templates response:",t.data),console.log("\ud83d\udccb Number of templates:",(null===(e=t.data)||void 0===e?void 0:e.length)||0),ms(t.data||[]),t.data&&t.data.length>0?(ds(t.data[0]._id),console.log("\ud83d\udccb Default template selected:",t.data[0].name,t.data[0]._id)):console.warn("\u26a0\ufe0f No active booking confirmation templates found")}catch(t){console.error("\u274c Error fetching booking templates:",t),ms([])}})()},[]),(0,a.useEffect)(()=>{(async()=>{try{const e=await gn.get("/api/templates?type=secondary_confirmation&isActive=true",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});gs(e.data||[])}catch(e){console.error("Error fetching secondary templates:",e),gs([])}})()},[]);const Fn=(0,a.useRef)(!1);(0,a.useEffect)(()=>{const e=be.get("eventId");if(e){if(e&&ve.length>0&&!Fn.current){const t=ve.find(t=>t.id===e);t?(Se(t),_e(!0),Fn.current=!0):ye({},{replace:!0})}}else Fn.current=!1},[be,ve,ye]);const In=(0,a.useRef)(!1);(0,a.useEffect)(()=>{if(In.current)return;const e=setTimeout(()=>{console.log("\ud83d\udcc5 Initial calendar data fetch"),Rn(!0),In.current=!0},100),t=localStorage.getItem("bookingLead");if(t){bs(!1);try{const e=JSON.parse(t),s=e.id;bt.current.has(s)?(Et({_id:s,name:e.name||"",phone:e.phone||"",email:e.email||"",postcode:e.postcode||"",status:"Booked",notes:e.notes||"",image_url:e.image_url||"",isReschedule:e.isReschedule||!1}),localStorage.removeItem("bookingLead")):(console.log("\ud83d\udcca Loading booking data from localStorage:",e),Et({_id:s,name:e.name||"",phone:e.phone||"",email:e.email||"",postcode:e.postcode||"",status:"Booked",notes:e.notes||"",image_url:e.image_url||"",isReschedule:e.isReschedule||!1}),console.log("\ud83d\udcca Set leadForm with ID:",s),bt.current.add(s),localStorage.removeItem("bookingLead"),setTimeout(()=>{var t;const s=e.isReschedule||"booked"===(null===(t=e.currentStatus)||void 0===t?void 0:t.toLowerCase())?"reschedule":"book",n="Lead data for ".concat(e.name," has been loaded. Click on a time slot to ").concat(s," the appointment.");alert(n)},500))}catch(s){console.error("Error parsing lead data:",s),localStorage.removeItem("bookingLead")}}return localStorage.getItem("calendarRefreshTrigger")&&(console.log("\ud83d\udcc5 Calendar: Refresh trigger detected, refreshing events"),Rn(),localStorage.removeItem("calendarRefreshTrigger")),()=>{clearTimeout(e)}},[]),(0,a.useEffect)(()=>{Mn()},[Ds,Ps,Mn]),(0,a.useEffect)(()=>{if("daily"===Ps&&Os.length>0){const e=Ds.toISOString().split("T")[0];Os.some(t=>new Date(t.date).toISOString().split("T")[0]===e&&!t.time_slot&&!t.slot_number)&&(yt.current||alert("This day is blocked and cannot be viewed"),As("monthly"))}yt.current&&Os.length>0&&(yt.current=!1)},[Ps,Ds,Os]),(0,a.useEffect)(()=>{localStorage.setItem("calendarView",Ps),localStorage.setItem("calendarDate",Ds.toISOString())},[Ps,Ds]),(0,a.useEffect)(()=>{jt.current=Rn},[Rn]),(0,a.useEffect)(()=>{let e=null,t=null,s=null,n=null;const a=()=>{e&&clearTimeout(e),e=setTimeout(()=>{jt.current()},5e3)};return Nt&&(s=Nt(e=>{var t,s,n,r;if(console.log("\ud83d\udcc5 Calendar: Real-time calendar update received",e),gt(new Date),"status_changed"===(null===(t=e.data)||void 0===t?void 0:t.type)&&null!==(s=e.data)&&void 0!==s&&s.event){const t=e.data.event,s=e.data.lead;je(e=>e.map(e=>{var n,a;return e.id===t.id||s&&(null===(n=e.extendedProps)||void 0===n||null===(a=n.lead)||void 0===a?void 0:a.id)===s.id?He(He(He({},e),t),{},{extendedProps:He(He(He({},e.extendedProps),t.extendedProps),{},{lead:s||e.extendedProps.lead})}):e})),Se(e=>{var n,a;return e&&(e.id===t.id||s&&(null===(n=e.extendedProps)||void 0===n||null===(a=n.lead)||void 0===a?void 0:a.id)===s.id)?He(He(He({},e),t),{},{extendedProps:He(He(He({},e.extendedProps),t.extendedProps),{},{lead:s||e.extendedProps.lead})}):e}),console.log("\ud83d\udcc5 Calendar: Status updated in real-time")}else if("status_changed"===(null===(n=e.data)||void 0===n?void 0:n.type)&&null===(null===(r=e.data)||void 0===r?void 0:r.event)){const t=e.data.lead;t&&(je(e=>e.filter(e=>{var s,n;return e.id!==t.id&&(null===(s=e.extendedProps)||void 0===s||null===(n=s.lead)||void 0===n?void 0:n.id)!==t.id})),Se(e=>{var s,n;return!e||e.id!==t.id&&(null===(s=e.extendedProps)||void 0===s||null===(n=s.lead)||void 0===n?void 0:n.id)!==t.id?e:(Dn(),null)}),console.log("\ud83d\udcc5 Calendar: Event cancelled in real-time"))}else a()})),kt&&(n=kt(e=>{var t;switch(console.log("\ud83d\udcc5 Calendar: Real-time lead update received",e),gt(new Date),e.type){case"LEAD_CREATED":case"LEAD_DELETED":console.log("\ud83d\udcc5 Calendar: Refreshing events due to",e.type),a();break;case"LEAD_UPDATED":const s=null===(t=e.data)||void 0===t?void 0:t.lead;s&&s.date_booked&&(console.log("\ud83d\udcc5 Calendar: Refreshing events due to booking-related update"),a());break;case"LEAD_ASSIGNED":case"NOTES_UPDATED":case"messages_read":console.log("\ud83d\udcc5 Calendar: Skipping refresh for",e.type)}})),t=setInterval(()=>{a()},3e5),()=>{s&&s(),n&&n(),t&&clearInterval(t),e&&clearTimeout(e)}},[Nt,kt,Dn]);const On=(0,a.useCallback)(()=>{An.current&&clearTimeout(An.current),An.current=setTimeout(()=>{Rn()},3e3)},[Rn]);(0,a.useEffect)(()=>{if(!wt)return;const e=e=>{try{var t,s;if(!e||!e.leadId)return;const n="email"===e.channel||"EMAIL_RECEIVED"===e.type;if(je(t=>t.map(t=>t.id===e.leadId?He(He({},t),{},n?{hasUnreadEmail:!0,hasReceivedEmail:!0}:{hasUnreadSms:!0,hasReceivedSms:!0}):t)),Ne(e=>e+1),!ke)return;const a=null===(t=ke.extendedProps)||void 0===t||null===(s=t.lead)||void 0===s?void 0:s.id;if(a&&e.leadId===a){const t=ke.extendedProps.lead.bookingHistory||ke.extendedProps.lead.booking_history||[],s=n?"EMAIL_RECEIVED":"SMS_RECEIVED";if(!t.some(t=>{try{var s,n;return t&&("SMS_RECEIVED"===t.action||"EMAIL_RECEIVED"===t.action)&&((null===(s=t.details)||void 0===s?void 0:s.body)||(null===(n=t.details)||void 0===n?void 0:n.message))===e.content&&new Date(t.timestamp).getTime()===new Date(e.timestamp).getTime()}catch(a){return!1}})){const a={action:s,timestamp:e.timestamp,details:{body:e.content,subject:e.subject||"",sender:e.phone||e.email,direction:"received",channel:n?"email":"sms",status:"received",read:!1}},r=[...t,a],l=He(He({},ke.extendedProps.lead),{},{bookingHistory:r});Se(e=>e?He(He(He({},e),n?{hasUnreadEmail:!0}:{hasUnreadSms:!0}),{},{extendedProps:He(He({},e.extendedProps),{},{lead:l})}):e)}}}catch(n){}},t=e=>{if(console.log("\ud83d\udce7 ========== MESSAGE SENT NOTIFICATION =========="),console.log("\ud83d\udce7 Status:",e.status),console.log("\ud83d\udce7 Type:",e.type),console.log("\ud83d\udce7 Lead ID:",e.leadId),console.log("\ud83d\udce7 Channels:",e.channels),"success"===e.status?(console.log("\ud83d\udce7 Email Account:",e.emailAccountName),console.log("\ud83d\udce7 Email Account Key:",e.emailAccount),console.log("\ud83d\udce7 SMS Provider:",e.smsProvider)):console.log("\ud83d\udce7 Error:",e.error),console.log("\ud83d\udce7 =============================================="),"success"===e.status){const t=[];e.channels.email&&t.push("Email via ".concat(e.emailAccountName||"email")),e.channels.sms&&t.push("SMS via ".concat(e.smsProvider||"SMS"));const s="\u2705 ".concat(e.message||"Booking confirmation sent: "+t.join(" and "));alert(s)}else"error"===e.status&&alert("\u274c ".concat(e.message||"Failed to send booking confirmation"))};return wt.on("sms_received",e),wt.on("message_received",e),wt.on("message_sent",t),()=>{wt.off("sms_received",e),wt.off("message_received",e),wt.off("message_sent",t)}},[wt,ke]),(0,a.useEffect)(()=>{var e,t;if(!Ce||!ke)return;const s=(null===(e=ke.extendedProps)||void 0===e||null===(t=e.lead)||void 0===t?void 0:t.id)||ke.id;if(!s)return;(async()=>{try{var e,t;const n=(null===(e=(await gn.get("/api/leads/".concat(s,"/messages"),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))},timeout:5e3})).data)||void 0===e?void 0:e.messages)||[];Se(e=>{var t,s;return e?He(He({},e),{},{hasUnreadSms:!1,hasUnreadEmail:!1,extendedProps:He(He({},e.extendedProps),{},{lead:He(He({},e.extendedProps.lead),{},{bookingHistory:n.length>0?n:(null===(t=e.extendedProps)||void 0===t||null===(s=t.lead)||void 0===s?void 0:s.bookingHistory)||[]})})}):e}),je(e=>e.map(e=>e.id===s?He(He({},e),{},{hasUnreadSms:!1,hasUnreadEmail:!1}):e));const a=null===ke||void 0===ke||null===(t=ke.extendedProps)||void 0===t?void 0:t.lead;null!==a&&void 0!==a&&a.phone?Me("sms"):null!==a&&void 0!==a&&a.email&&Me("email")}catch(ey){}})()},[Ce,null===ke||void 0===ke?void 0:ke.id]);const Bn=(0,a.useCallback)(async function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!e)return Qs([]),void Js(0);if("admin"===(null===ge||void 0===ge?void 0:ge.role)||"viewer"===(null===ge||void 0===ge?void 0:ge.role)||"photographer"===(null===ge||void 0===ge?void 0:ge.role)){ln.current=e,t?Zs(!0):rn(!0);try{const r={leadId:e,limit:20,cursor:s||void 0,fields:"minimal"};n&&"all"!==n&&(r.folderPath=n);const l={leadId:e};n&&"all"!==n&&(l.folderPath=n);const[o,i]=await Promise.all([gn.get("/api/photos",{params:r}),t?gn.get("/api/photos/count",{params:l}):Promise.resolve(null)]);if(ln.current!==e)return void console.log("\ud83d\udcf8 Ignoring stale photo response for lead:",e);if(o.data.success){const e=o.data.photos||[];var a;if(t)Qs(e),void 0!==(null===i||void 0===i||null===(a=i.data)||void 0===a?void 0:a.count)&&Js(i.data.count);else Qs(t=>[...t,...e]);tn(o.data.hasMore||!1),nn(o.data.nextCursor||null)}}catch(r){console.error("Error fetching photos:",r),ln.current===e&&t&&(Qs([]),Js(0))}finally{ln.current===e&&(Zs(!1),rn(!1))}}},[null===ge||void 0===ge?void 0:ge.role]),Un=(0,a.useCallback)(()=>{var e,t;null!==(e=ke.extendedProps)&&void 0!==e&&null!==(t=e.lead)&&void 0!==t&&t.id&&en&&!an&&sn&&Bn(ke.extendedProps.lead.id,!1,sn,kn)},[ke,en,an,sn,Bn,kn]),zn=async e=>{var t,s;if(!e||0===e.length)return;if(null===ke||void 0===ke||null===(t=ke.extendedProps)||void 0===t||null===(s=t.lead)||void 0===s||!s.id)return void alert("No lead selected for photo upload");if(!jn)return void alert("Please select a folder first");const n=ke.extendedProps.lead.id,a=Array.from(e),r=a.length;un(!0),hn(0),xn({current:0,total:r,currentFileName:""});let l=0,o=0;for(let c=0;c<a.length;c++){const e=a[c];xn({current:c+1,total:r,currentFileName:e.name.length>25?e.name.substring(0,22)+"...":e.name});try{const t=new FormData;t.append("photo",e),t.append("leadId",n),t.append("folderPath",jn),await gn.post("/api/photos/upload",t),l++}catch(i){console.error("Error uploading ".concat(e.name,":"),i),o++}hn(Math.round((c+1)/r*100))}un(!1),hn(0),xn({current:0,total:0,currentFileName:""}),cn(!1),Nn(null),Bn(n,!0,null,kn),o>0?alert("Uploaded ".concat(l," of ").concat(r," photos. ").concat(o," failed.")):l>0&&alert("Successfully uploaded ".concat(l," photo").concat(l>1?"s":"","!"))},Vn=e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?yn(!0):"dragleave"===e.type&&yn(!1)},Wn=async(e,t)=>{if(t.stopPropagation(),window.confirm("Are you sure you want to delete this photo? This cannot be undone."))try{const t=await gn.delete("/api/photos/".concat(e));t.data.success?(Qs(t=>t.filter(t=>t.id!==e)),Js(e=>Math.max(0,e-1))):alert("Failed to delete photo: "+(t.data.message||"Unknown error"))}catch(a){var s,n;console.error("Error deleting photo:",a),alert("Error deleting photo: "+((null===(s=a.response)||void 0===s||null===(n=s.data)||void 0===n?void 0:n.message)||a.message))}};(0,a.useEffect)(()=>{var e,t;Ce&&null!==ke&&void 0!==ke&&null!==(e=ke.extendedProps)&&void 0!==e&&null!==(t=e.lead)&&void 0!==t&&t.id?(tn(!1),nn(null),Sn("all"),Nn(null),Bn(ke.extendedProps.lead.id,!0,null,"all")):(Qs([]),Js(0),tn(!1),nn(null),Sn("all"))},[Ce,ke,Bn]),(0,a.useEffect)(()=>{var e,t;Ce&&null!==ke&&void 0!==ke&&null!==(e=ke.extendedProps)&&void 0!==e&&null!==(t=e.lead)&&void 0!==t&&t.id&&(tn(!1),nn(null),Bn(ke.extendedProps.lead.id,!0,null,kn))},[kn]);const qn=e=>{const t=localStorage.getItem("highlightBooking");if(t)try{const s=JSON.parse(t),n=e.find(e=>{var t,n;return e.id===s.leadId||(null===(t=e.extendedProps)||void 0===t||null===(n=t.lead)||void 0===n?void 0:n.name)===s.leadName});setTimeout(()=>{var e;const t=null===(e=ft.current)||void 0===e?void 0:e.getApi();t&&(t.gotoDate(s.date),n&&setTimeout(()=>{Se(n),_e(!0)},500)),alert("Navigated to ".concat(s.leadName,"'s booking on ").concat(new Date(s.date).toLocaleDateString()))},1e3),localStorage.removeItem("highlightBooking")}catch(s){console.error("Error parsing highlight booking data:",s),localStorage.removeItem("highlightBooking")}},Hn=e=>{switch(null===e||void 0===e?void 0:e.toLowerCase()){case"new":default:return"status-badge status-new";case"confirmed":case"booked":return"status-badge status-booked";case"attended":case"complete":return"status-badge status-attended";case"cancelled":case"no show":return"status-badge status-cancelled";case"reschedule":return"status-badge status-reschedule"}},Yn=e=>e?{id:e.id,title:e.title,start:e.start?new Date(e.start):null,end:e.end?new Date(e.end):null,allDay:!!e.allDay,backgroundColor:e.backgroundColor,borderColor:e.borderColor,extendedProps:He({},e.extendedProps||{})}:null,Gn=e=>{const{name:t,value:s}=e.target;Et(e=>He(He({},e),{},{[t]:s}))},$n=async()=>{const e=ve.filter(e=>{var t;return null===(t=e.extendedProps)||void 0===t?void 0:t.isPending});for(const s of e)try{const e=He(He({},s.extendedProps.lead),{},{date_booked:s.start.toISOString(),status:"Booked"}),t=await gn.post("/api/leads",e);if(t.data.success||t.data.lead){const e=t.data.lead||t.data;je(t=>t.map(t=>t.id===s.id?He(He({},t),{},{id:e.id,title:t.title.replace(" (Pending)",""),backgroundColor:Ln("Booked",e.hasSale),borderColor:Ln("Booked",e.hasSale),extendedProps:He(He({},t.extendedProps),{},{lead:e,isPending:!1,isConfirmed:!0})}):t))}}catch(t){console.log("Failed to sync pending booking for ".concat(s.extendedProps.lead.name))}},Qn=async e=>{var t;if(!ke||null===(t=ke.extendedProps)||void 0===t||!t.lead)return void alert("No lead data available for this event.");if("admin"!==(null===ge||void 0===ge?void 0:ge.role)&&"booker"!==(null===ge||void 0===ge?void 0:ge.role)&&"viewer"!==(null===ge||void 0===ge?void 0:ge.role))return void alert("Access denied. You do not have permission to change booking status.");if("booker"===(null===ge||void 0===ge?void 0:ge.role)){var s,n;const t="Confirmed"===e||"Unconfirmed"===e,a="Cancelled"===e,r=(null===(s=ke.extendedProps)||void 0===s||null===(n=s.lead)||void 0===n?void 0:n.booker)===ge.id;if(!t&&!a&&!r)return void alert("Access denied. You can only change Confirmed/Unconfirmed/Cancelled status on any booking, or other statuses on leads assigned to you.")}const a=ke.extendedProps.lead.name||ke.title.split(" - ")[0],r=ke.extendedProps.status;if("Cancelled"===e){const e="Are you sure you want to cancel ".concat(a,"'s appointment?\n\n")+'This will:\n\u2022 Remove the booking from the calendar\n\u2022 Clear all booking information (date, time, slot)\n\u2022 Move the lead status to "Cancelled"\n\u2022 Save the booking details to history for tracking\n\u2022 Allow the lead to be reassigned later\n\nThis action cannot be undone.';if(!window.confirm(e))return}else if("Confirmed"===e){if(!window.confirm("Are you sure you want to confirm ".concat(a,"'s appointment?\n\nThis will mark the booking as confirmed but keep it on the calendar.")))return}else if("Unconfirmed"===e){if(!window.confirm("Set ".concat(a,"'s appointment to Unconfirmed?")))return}else if(!window.confirm("Are you sure you want to change ".concat(a,"'s status to \"").concat(e,'"?')))return;const l=He({},ke),o=[...ve];let i=He({},ke.extendedProps.lead);if(i=He(He({},i),{},"Cancelled"===e?{status:"Cancelled",cancellation_reason:"Appointment cancelled via calendar",date_booked:null,time_booked:null,booking_slot:null,is_confirmed:null,booking_status:null}:"Double Confirmed"===e?{status:"Booked",is_confirmed:1,is_double_confirmed:1,booking_status:null}:"Confirmed"===e?{status:"Booked",is_confirmed:1,is_double_confirmed:0,booking_status:null}:"Unconfirmed"===e?{status:"Booked",is_confirmed:0,is_double_confirmed:0,booking_status:null}:"Reschedule"===e||"Arrived"===e||"Left"===e||"No Show"===e||"No Sale"===e||"Review"===e?{status:"Booked",booking_status:e,is_confirmed:"Reschedule"===e?0:"Review"===e?i.is_confirmed:null}:{status:e,booking_status:null}),"Cancelled"===e)je(e=>e.filter(e=>e.id!==ke.id)),Dn(),Ct({type:"status_changed",lead:He(He({},ke.extendedProps.lead),i),event:null,oldStatus:r,newStatus:"Cancelled",timestamp:new Date});else{var c;const t="Double Confirmed"===e?"".concat(a," - Booked (Double Confirmed)"):"Confirmed"===e?"".concat(a," - Booked (Confirmed)"):"Unconfirmed"===e?"".concat(a," - Booked (Unconfirmed)"):"".concat(a," - ").concat(e),s=He(He({},ke.extendedProps.lead),i),n="Confirmed"===e||"Double Confirmed"===e?1:"Unconfirmed"===e?0:ke.is_confirmed,l="Double Confirmed"===e?1:0,o="Reschedule"===e||"Arrived"===e||"Left"===e||"No Show"===e||"No Sale"===e||"Review"===e?e:null,d=He(He({},ke),{},{title:t,backgroundColor:Ln(e,s.hasSale,"Confirmed"===e||"Double Confirmed"===e,"Double Confirmed"===e),borderColor:Ln(e,s.hasSale,"Confirmed"===e||"Double Confirmed"===e,"Double Confirmed"===e),is_confirmed:n,is_double_confirmed:l,booking_status:o,has_sale:s.has_sale||ke.has_sale||!1,name:s.name||ke.name,time_booked:s.time_booked||ke.time_booked,date_booked:s.date_booked||ke.date_booked,booking_slot:s.booking_slot||ke.booking_slot,extendedProps:He(He({},ke.extendedProps),{},{status:"Double Confirmed"===e||"Confirmed"===e||"Unconfirmed"===e||"Reschedule"===e||"Arrived"===e||"Left"===e||"No Show"===e||"No Sale"===e||"Review"===e?"Booked":e,displayStatus:e,isConfirmed:"Confirmed"===e||"Double Confirmed"===e||"Unconfirmed"!==e&&((null===(c=ke.extendedProps)||void 0===c?void 0:c.isConfirmed)||!1),isDoubleConfirmed:"Double Confirmed"===e,bookingStatus:o,lead:s})});je(e=>e.map(e=>e.id===ke.id?d:e)),Se(d),Ne(e=>e+1),Ct({type:"status_changed",lead:s,event:d,oldStatus:r,newStatus:"Cancelled"===e?"Cancelled":"Confirmed"===e?"Booked":e,timestamp:new Date})}(async()=>{try{const s=await gn.put("/api/leads/".concat(ke.id),i);if(s.data.success||s.data.lead){const n=s.data.lead||s.data;if("Cancelled"!==e){var t;const s="Confirmed"===e?"".concat(a," - Booked (Confirmed)"):"Unconfirmed"===e?"".concat(a," - Booked (Unconfirmed)"):"".concat(a," - ").concat(e),r=He(He({},ke),{},{title:s,backgroundColor:Ln("Confirmed"===e?"Booked":"Unconfirmed"===e?"Unconfirmed":e,n.hasSale,"Confirmed"===e),borderColor:Ln("Confirmed"===e?"Booked":"Unconfirmed"===e?"Unconfirmed":e,n.hasSale,"Confirmed"===e),date_booked:n.date_booked||ke.date_booked,time_booked:n.time_booked||ke.time_booked,booking_slot:n.booking_slot||ke.booking_slot,is_confirmed:n.is_confirmed,is_double_confirmed:n.is_double_confirmed||0,booking_status:n.booking_status||null,name:n.name||ke.name,phone:n.phone||ke.phone,email:n.email||ke.email,extendedProps:He(He({},ke.extendedProps),{},{status:"Confirmed"===e||"Unconfirmed"===e||"Reschedule"===e||"Arrived"===e||"Left"===e||"No Show"===e||"No Sale"===e?"Booked":e,displayStatus:e,isConfirmed:"Confirmed"===e||"Unconfirmed"!==e&&("Reschedule"===e||"Arrived"===e||"Left"===e||"No Show"===e||"No Sale"===e?"Reschedule"===e?0:null:(null===(t=ke.extendedProps)||void 0===t?void 0:t.isConfirmed)||!1),bookingStatus:"Reschedule"===e||"Arrived"===e||"Left"===e||"No Show"===e||"No Sale"===e?e:void 0,lead:n})});je(e=>e.map(e=>e.id===ke.id?r:e)),Se(r),Ne(e=>e+1)}setTimeout(()=>{On()},2e3)}}catch(n){console.error("Error updating event status:",n),je(o),Se(l),Ne(e=>e+1);let e="Failed to update status. Changes have been reverted. Please try again.";var s;if(n.response)e="Server error: ".concat((null===(s=n.response.data)||void 0===s?void 0:s.message)||n.response.statusText,". Changes have been reverted.");else e=n.request?"Network error: Could not reach server. Changes have been reverted.":"Error: ".concat(n.message,". Changes have been reverted.");alert(e)}})()},Kn=()=>{if(null===ke||void 0===ke||!ke.start)return[];const e=new Date(ke.start),t=new Date(e.getFullYear(),e.getMonth(),e.getDate()),s=new Date(t);return s.setDate(s.getDate()+1),ve.filter(e=>{const n=new Date(e.start);return n>=t&&n<s}).sort((e,t)=>new Date(e.start)-new Date(t.start))},Jn=()=>{const e=Kn(),t=e.findIndex(e=>e.id===ke.id);if(t>0){var s,n;const a=e[t-1];console.log("\ud83d\udcf8 Navigating to previous event:",a.title,"Image URL:",null===(s=a.extendedProps)||void 0===s||null===(n=s.lead)||void 0===n?void 0:n.image_url),Se(Yn(a))}},Xn=()=>{const e=Kn(),t=e.findIndex(e=>e.id===ke.id);if(t<e.length-1){var s,n;const a=e[t+1];console.log("\ud83d\udcf8 Navigating to next event:",a.title,"Image URL:",null===(s=a.extendedProps)||void 0===s||null===(n=s.lead)||void 0===n?void 0:n.image_url),Se(Yn(a))}};(0,a.useEffect)(()=>{var e;if(null!==ke&&void 0!==ke&&null!==(e=ke.extendedProps)&&void 0!==e&&e.lead){const e=ke.extendedProps.lead;rt({date_of_birth:e.date_of_birth?e.date_of_birth.split("T")[0]:"",height_inches:e.height_inches||"",chest_inches:e.chest_inches||"",waist_inches:e.waist_inches||"",hips_inches:e.hips_inches||"",eye_color:e.eye_color||"",hair_color:e.hair_color||"",hair_length:e.hair_length||""}),tt(!1)}},[ke]);const Zn=()=>{if(!ht)return null;const e=ht.date,t=new Date(e);return t.setHours(t.getHours()+1),{date:e.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),time:"".concat(e.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})," - ").concat(t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}))}};return(0,fn.jsxs)("div",{className:"space-y-3 sm:space-y-4 lg:space-y-6",children:[(0,fn.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 sm:gap-4",children:[(0,fn.jsx)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-4 w-full sm:w-auto",children:(0,fn.jsxs)("div",{className:"w-full sm:w-auto",children:[(0,fn.jsxs)("div",{className:"flex flex-wrap items-center gap-2 sm:gap-3",children:[(0,fn.jsx)("h1",{className:"text-lg sm:text-xl font-semibold text-gray-900",children:"Calendar"}),(0,fn.jsxs)("div",{className:"flex items-center space-x-1 sm:space-x-2",children:[(0,fn.jsx)("div",{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full ".concat(St?"bg-green-500 animate-pulse":"bg-red-500")}),(0,fn.jsx)("span",{className:"text-xs ".concat(St?"text-green-600":"text-red-600"),children:St?"Live":"Offline"})]}),(0,fn.jsx)("div",{className:"hidden sm:flex items-center space-x-2 sm:space-x-3 text-xs text-gray-500",children:(0,fn.jsxs)("span",{children:["\ud83d\udcc5 ",ve.length]})})]}),(0,fn.jsxs)("p",{className:"text-xs sm:text-sm text-gray-500 mt-1",children:[ve.length," events \u2022 Updated ",xt.toLocaleTimeString()]})]})}),(0,fn.jsx)("div",{className:"flex items-center space-x-2 sm:space-x-4 w-full sm:w-auto overflow-x-auto",children:(0,fn.jsxs)("div",{className:"flex items-center space-x-2 text-xs sm:text-sm text-gray-600 whitespace-nowrap",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,fn.jsx)("div",{className:"w-2 h-2 sm:w-3 sm:h-3 bg-blue-500 rounded"}),(0,fn.jsx)("span",{className:"hidden sm:inline",children:"New"})]}),(0,fn.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,fn.jsx)("div",{className:"w-2 h-2 sm:w-3 sm:h-3 bg-green-500 rounded"}),(0,fn.jsx)("span",{className:"hidden sm:inline",children:"Booked"})]}),(0,fn.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,fn.jsx)("div",{className:"w-2 h-2 sm:w-3 sm:h-3 bg-purple-500 rounded"}),(0,fn.jsx)("span",{className:"hidden sm:inline",children:"Attended"})]}),(0,fn.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,fn.jsx)("div",{className:"w-2 h-2 sm:w-3 sm:h-3 bg-red-500 rounded"}),(0,fn.jsx)("span",{className:"hidden sm:inline",children:"Cancelled"})]})]})})]}),(0,fn.jsxs)("div",{className:"mb-3 sm:mb-4 flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between",children:[(0,fn.jsxs)("div",{className:"relative w-full sm:max-w-md",children:[(0,fn.jsx)("div",{className:"absolute inset-y-0 left-0 pl-2 sm:pl-3 flex items-center pointer-events-none",children:(0,fn.jsx)(sl,{className:"h-4 w-4 sm:h-5 sm:w-5 text-gray-400"})}),(0,fn.jsx)("input",{type:"text",value:Es,onChange:e=>Ts(e.target.value),placeholder:"Search leads...",className:"block w-full pl-8 sm:pl-10 pr-8 sm:pr-10 py-2 border border-gray-300 rounded-md text-sm bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500"}),Es&&(0,fn.jsx)("div",{className:"absolute inset-y-0 right-0 pr-2 sm:pr-3 flex items-center",children:(0,fn.jsx)("button",{onClick:()=>Ts(""),className:"text-gray-400 hover:text-gray-600 focus:outline-none touch-target",children:(0,fn.jsx)(jl,{className:"h-4 w-4 sm:h-5 sm:w-5"})})}),Es&&(0,fn.jsxs)("p",{className:"mt-2 text-xs sm:text-sm text-gray-600",children:["Found ",ve.filter(e=>{var t,s,n,a,r;const l=Es.toLowerCase(),o=(null===(t=e.extendedProps)||void 0===t||null===(s=t.lead)||void 0===s?void 0:s.name)||e.title||"",i=(null===(n=e.extendedProps)||void 0===n?void 0:n.phone)||"",c=(null===(a=e.extendedProps)||void 0===a||null===(r=a.lead)||void 0===r?void 0:r.email)||"";return o.toLowerCase().includes(l)||i.includes(l)||c.toLowerCase().includes(l)}).length," results"]})]}),"timeGridDay"===Ps&&(0,fn.jsxs)("button",{onClick:async()=>{try{const e=ft.current.getApi().getDate(),t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0"),a="".concat(t,"-").concat(s,"-").concat(n);console.log("\ud83d\udce5 Exporting calendar for ".concat(a,"...")),console.log("\ud83d\udcc5 View date:",e),console.log("\ud83d\udcc5 Formatted date string:",a);const r=await gn.get("/api/leads/calendar/export-csv?date=".concat(a),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))},responseType:"blob"}),l=window.URL.createObjectURL(new Blob([r.data])),o=document.createElement("a");o.href=l,o.setAttribute("download","calendar_".concat(a,".csv")),document.body.appendChild(o),o.click(),o.remove(),window.URL.revokeObjectURL(l),console.log("\u2705 Calendar exported successfully for ".concat(a))}catch(e){console.error("Error exporting calendar:",e),alert("Failed to export calendar. Please try again.")}},className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors whitespace-nowrap",children:[(0,fn.jsx)(Cr,{className:"h-4 w-4"}),(0,fn.jsx)("span",{className:"text-sm font-medium",children:"Export Day to CSV"})]})]}),(0,fn.jsx)("div",{className:"mobile-card mb-4",children:(0,fn.jsxs)("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[(0,fn.jsxs)("div",{className:"flex gap-2",children:[(0,fn.jsx)("button",{onClick:()=>As("monthly"),className:"px-4 py-2 rounded-md font-medium transition-colors ".concat("monthly"===Ps?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:"Monthly"}),(0,fn.jsx)("button",{onClick:()=>As("weekly"),className:"px-4 py-2 rounded-md font-medium transition-colors ".concat("weekly"===Ps?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:"Weekly"}),(0,fn.jsx)("button",{onClick:()=>As("daily"),className:"px-4 py-2 rounded-md font-medium transition-colors ".concat("daily"===Ps?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:"Daily"})]}),(0,fn.jsxs)("div",{className:"flex items-center gap-4",children:[(0,fn.jsx)("button",{onClick:()=>{const e=new Date(Ds);if("daily"===Ps){e.setDate(e.getDate()-1);const t=30;let s=0;for(;s<t;){const t=e.toISOString().split("T")[0];if(!Os.some(e=>new Date(e.date).toISOString().split("T")[0]===t&&!e.time_slot&&!e.slot_number))break;e.setDate(e.getDate()-1),s++}}else"weekly"===Ps?e.setDate(e.getDate()-7):e.setMonth(e.getMonth()-1);Ls(e),Rn(!0)},className:"p-2 rounded-md bg-gray-200 hover:bg-gray-300 transition-colors",children:(0,fn.jsx)(br,{className:"h-5 w-5"})}),(0,fn.jsx)("button",{onClick:()=>{Ls(yi()),Rn(!0)},className:"px-4 py-2 rounded-md bg-gray-200 hover:bg-gray-300 transition-colors font-medium",children:"Today"}),(0,fn.jsx)("button",{onClick:()=>{const e=new Date(Ds);if("daily"===Ps){e.setDate(e.getDate()+1);const t=30;let s=0;for(;s<t;){const t=e.toISOString().split("T")[0];if(!Os.some(e=>new Date(e.date).toISOString().split("T")[0]===t&&!e.time_slot&&!e.slot_number))break;e.setDate(e.getDate()+1),s++}}else"weekly"===Ps?e.setDate(e.getDate()+7):e.setMonth(e.getMonth()+1);Ls(e),Rn(!0)},className:"p-2 rounded-md bg-gray-200 hover:bg-gray-300 transition-colors",children:(0,fn.jsx)(yr,{className:"h-5 w-5"})})]})]})}),(0,fn.jsx)("div",{className:"mobile-card overflow-x-auto",children:"monthly"===Ps?(0,fn.jsx)(md,{currentDate:Ds,blockedSlots:Os,events:ve.filter(e=>{if(!e.date_booked)return!1;if(Es){const t=Es.toLowerCase(),s=e.name||"",n=e.phone||"",a=e.email||"";return s.toLowerCase().includes(t)||n.includes(t)||a.toLowerCase().includes(t)}return!0}),onDayClick:e=>{const t=e.toISOString().split("T")[0];Os.some(e=>new Date(e.date).toISOString().split("T")[0]===t&&!e.time_slot&&!e.slot_number)?alert("This day is blocked and cannot be viewed"):(console.log("Day clicked:",e),Ls(e),As("daily"))},onEventClick:e=>{console.log("Event clicked:",e);const t=ve.find(t=>t.id===e.id);t?(Se(t),_e(!0),Fn.current=!0,ye({eventId:e.id},{replace:!0})):console.error("Could not find full event data for:",e.id)}},"monthly-calendar-".concat(we)):"daily"===Ps?(0,fn.jsx)(od,{selectedDate:Ds,blockedSlots:Os,events:ve.filter(e=>{if(!e.date_booked)return!1;const t=new Date(e.date_booked),s=Ds.toISOString().split("T")[0],n=t.toISOString().split("T")[0];if(Es){const t=Es.toLowerCase(),a=e.name||"",r=e.phone||"",l=e.email||"",o=a.toLowerCase().includes(t)||r.includes(t)||l.toLowerCase().includes(t);return n===s&&o}return n===s}),onSlotClick:(e,t,s)=>{console.log("Slot clicked:",e,t,s),Is(e),Rs(t);const n=e.split(":"),a=n.length>0?parseInt(n[0],10):0,r=n.length>1?parseInt(n[1],10):0,l=new Date(Ds);l.setHours(a,r,0,0),pt({dateStr:l.toISOString(),date:l}),Et(He(He({},_t),{},{time_booked:e,booking_slot:t,date_booked:Ds.toISOString().split("T")[0]})),bs(!_t._id),mt(!0)},onEventClick:e=>{console.log("Event clicked:",e);const t=ve.find(t=>t.id===e.id);t?(Se(t),_e(!0),Fn.current=!0,ye({eventId:e.id},{replace:!0})):console.error("Could not find full event data for:",e.id)}},"slot-calendar-".concat(we)):(0,fn.jsx)(cd,{weekStart:(()=>{const e=new Date(Ds),t=e.getDay(),s=e.getDate()-t+(0===t?-6:1);return new Date(e.setDate(s))})(),blockedSlots:Os,events:ve.filter(e=>{if(!e.date_booked)return!1;if(Es){const t=Es.toLowerCase(),s=e.name||"",n=e.phone||"",a=e.email||"";return s.toLowerCase().includes(t)||n.includes(t)||a.toLowerCase().includes(t)}return!0}),onDayClick:(e,t,s)=>{if(console.log("Day/slot clicked:",e,t,s),t&&s){Is(t),Rs(s);const n=t.split(":"),a=n.length>0?parseInt(n[0],10):0,r=n.length>1?parseInt(n[1],10):0,l=new Date(e);l.setHours(a,r,0,0),pt({dateStr:l.toISOString(),date:l}),Ls(e),Et(He(He({},_t),{},{time_booked:t,booking_slot:s,date_booked:e.toISOString().split("T")[0]})),bs(!_t._id),mt(!0)}else{const t=e.toISOString().split("T")[0];if(Os.some(e=>new Date(e.date).toISOString().split("T")[0]===t&&!e.time_slot&&!e.slot_number))return void alert("This day is blocked and cannot be viewed");Ls(e),As("daily")}},onEventClick:e=>{console.log("Event clicked:",e);const t=ve.find(t=>t.id===e.id);t?(Se(t),_e(!0),Fn.current=!0,ye({eventId:e.id},{replace:!0})):console.error("Could not find full event data for:",e.id)}})}),ut&&ht&&(0,fn.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 h-full w-full z-50 flex items-center justify-center p-2 sm:p-4",children:(0,fn.jsxs)("div",{className:"relative mx-auto p-6 border w-full max-w-5xl shadow-lg rounded-lg bg-white calendar-modal-scroll max-h-[95vh] overflow-y-auto",children:[(0,fn.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:_t._id?_t.isReschedule?"Reschedule Appointment":"Book Existing Lead":"Create New Booking"}),(0,fn.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:_t._id?_t.isReschedule?"Choose a new date and time for the appointment":"Schedule appointment for existing lead":"Fill in the lead information for the booking"})]}),(0,fn.jsx)("button",{onClick:()=>mt(!1),className:"text-gray-400 hover:text-gray-600 p-1",children:(0,fn.jsx)(jl,{className:"h-6 w-6"})})]}),(0,fn.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,fn.jsxs)("div",{className:"space-y-6",children:[(0,fn.jsx)("h4",{className:"text-md font-medium text-gray-900 border-b pb-2",children:"Lead Information"}),(0,fn.jsxs)("div",{className:"space-y-4",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Name ",(0,fn.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,fn.jsxs)("div",{className:"relative",children:[(0,fn.jsx)(gl,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),(0,fn.jsx)("input",{type:"text",name:"name",value:_t.name,onChange:Gn,className:"pl-10 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter full name",required:!0})]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Phone ",(0,fn.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,fn.jsxs)("div",{className:"relative",children:[(0,fn.jsx)(Jr,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),(0,fn.jsx)("input",{type:"tel",name:"phone",value:_t.phone,onChange:Gn,className:"pl-10 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter phone number",required:!0})]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,fn.jsxs)("div",{className:"relative",children:[(0,fn.jsx)(Wr,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),(0,fn.jsx)("input",{type:"email",name:"email",value:_t.email,onChange:Gn,className:"pl-10 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter email address"})]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Postcode"}),(0,fn.jsxs)("div",{className:"relative",children:[(0,fn.jsx)(qr,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),(0,fn.jsx)("input",{type:"text",name:"postcode",value:_t.postcode,onChange:Gn,className:"pl-10 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter postcode"})]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),(0,fn.jsxs)("select",{name:"status",value:_t.status,onChange:Gn,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,fn.jsx)("option",{value:"New",children:"New"}),(0,fn.jsx)("option",{value:"Contacted",children:"Contacted"}),(0,fn.jsx)("option",{value:"Booked",children:"Booked"}),(0,fn.jsx)("option",{value:"Attended",children:"Attended"}),(0,fn.jsx)("option",{value:"Cancelled",children:"Cancelled"})]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),(0,fn.jsxs)("div",{className:"relative",children:[(0,fn.jsx)(Dr,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),(0,fn.jsx)("textarea",{name:"notes",value:_t.notes,onChange:Gn,rows:"3",className:"pl-10 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Additional notes..."})]})]})]})]}),(0,fn.jsxs)("div",{className:"space-y-6",children:[(0,fn.jsx)("h4",{className:"text-md font-medium text-gray-900 border-b pb-2",children:"Booking Preview"}),(0,fn.jsxs)("div",{className:"bg-white border rounded-lg p-4",children:[(0,fn.jsx)("p",{className:"text-sm font-medium text-gray-900 mb-2",children:"Send booking confirmation via"}),(0,fn.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,fn.jsxs)("label",{className:"inline-flex items-center space-x-2",children:[(0,fn.jsx)("input",{type:"checkbox",className:"h-4 w-4 text-indigo-600 border-gray-300 rounded",checked:rs,onChange:e=>ls(e.target.checked)}),(0,fn.jsx)("span",{className:"text-sm text-gray-700",children:"Email"})]}),(0,fn.jsxs)("label",{className:"inline-flex items-center space-x-2",children:[(0,fn.jsx)("input",{type:"checkbox",className:"h-4 w-4 text-indigo-600 border-gray-300 rounded",checked:os,onChange:e=>is(e.target.checked)}),(0,fn.jsx)("span",{className:"text-sm text-gray-700",children:"Text (SMS)"})]})]}),(0,fn.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"Both are checked by default. Uncheck to prevent sending."}),(rs||os)&&(0,fn.jsxs)("div",{className:"mt-3",children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Template"}),us.length>0?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)("select",{value:cs||"",onChange:e=>ds(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",children:us.map(e=>(0,fn.jsxs)("option",{value:e._id,children:[e.name," ","secondary"===e.emailAccount?"(Diary@edgetalent.co.uk)":"(Primary)"]},e._id))}),(0,fn.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Emails sent via Gmail API"}),rs&&!ws&&(0,fn.jsx)("p",{className:"text-xs text-amber-600 mt-1",children:"\u26a0\ufe0f This template has email disabled - email will not be sent"}),os&&!Ns&&(0,fn.jsx)("p",{className:"text-xs text-amber-600 mt-1",children:"\u26a0\ufe0f This template has SMS disabled - SMS will not be sent"})]}):(0,fn.jsx)("div",{className:"text-sm text-amber-600 bg-amber-50 border border-amber-200 rounded-md p-3",children:"\u26a0\ufe0f No active booking confirmation templates found. Please create one in the Templates page."})]})]}),(0,fn.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 space-y-4",children:[(0,fn.jsxs)("div",{className:"space-y-4",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"New Date"}),(0,fn.jsx)("input",{type:"date",value:ht?ht.dateStr?ht.dateStr.slice(0,10):ht instanceof Date?ht.toISOString().slice(0,10):"":"",onChange:e=>{if(e.target.value){const t=new Date(e.target.value+"T12:00:00");pt({dateStr:t.toISOString(),date:t})}},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"New Time"}),(0,fn.jsx)("select",{value:_t.time_booked||(ht&&ht.date?"".concat(String(ht.date.getHours()).padStart(2,"0"),":").concat(String(ht.date.getMinutes()).padStart(2,"0")):"10:00"),onChange:e=>{const t=e.target.value,[s,n]=t.split(":").map(Number);if(ht){const e=ht.date||ht,t=new Date(e);t.setHours(s,n,0,0),pt({dateStr:t.toISOString(),date:t})}Et(He(He({},_t),{},{time_booked:t}))},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:["10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30"].map(e=>{const[t,s]=e.split(":").map(Number),n=t>=12?"PM":"AM",a="".concat(0===t?12:t>12?t-12:t,":").concat(String(s).padStart(2,"0")," ").concat(n);return(0,fn.jsx)("option",{value:e,children:a},e)})}),(0,fn.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Only times available on the calendar are shown"})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Booking Slot"}),(0,fn.jsxs)("select",{value:_t.booking_slot||1,onChange:e=>{Et(He(He({},_t),{},{booking_slot:parseInt(e.target.value)})),Rs(parseInt(e.target.value))},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,fn.jsx)("option",{value:1,children:"Slot 1"}),(0,fn.jsx)("option",{value:2,children:"Slot 2"})]}),(0,fn.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Select which slot column to book the appointment in"})]})]}),(0,fn.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,fn.jsx)(hr,{className:"h-5 w-5 text-blue-500"}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("p",{className:"font-medium text-gray-900",children:"Date & Time"}),(0,fn.jsx)("p",{className:"text-sm text-gray-600",children:null===(e=Zn())||void 0===e?void 0:e.date}),(0,fn.jsx)("p",{className:"text-sm text-gray-600",children:null===(t=Zn())||void 0===t?void 0:t.time})]})]}),_t.name&&(0,fn.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,fn.jsx)(gl,{className:"h-5 w-5 text-green-500"}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("p",{className:"font-medium text-gray-900",children:"Client"}),(0,fn.jsx)("p",{className:"text-sm text-gray-600",children:_t.name})]})]}),_t.phone&&(0,fn.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,fn.jsx)(Jr,{className:"h-5 w-5 text-purple-500"}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("p",{className:"font-medium text-gray-900",children:"Phone"}),(0,fn.jsx)("p",{className:"text-sm text-gray-600",children:_t.phone})]})]}),_t.email&&(0,fn.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,fn.jsx)(Wr,{className:"h-5 w-5 text-orange-500"}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("p",{className:"font-medium text-gray-900",children:"Email"}),(0,fn.jsx)("p",{className:"text-sm text-gray-600",children:_t.email})]})]}),_t.postcode&&(0,fn.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,fn.jsx)(qr,{className:"h-5 w-5 text-red-500"}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("p",{className:"font-medium text-gray-900",children:"Postcode"}),(0,fn.jsx)("p",{className:"text-sm text-gray-600",children:_t.postcode})]})]}),(0,fn.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,fn.jsx)("div",{className:"w-5 h-5 rounded ".concat(Ln(_t.status,_t.hasSale)),style:{backgroundColor:Ln(_t.status,_t.hasSale)}}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("p",{className:"font-medium text-gray-900",children:"Status"}),(0,fn.jsx)("span",{className:Hn(_t.status),children:_t.status})]})]}),_t.notes&&(0,fn.jsxs)("div",{className:"pt-2 border-t border-gray-200",children:[(0,fn.jsx)("p",{className:"font-medium text-gray-900 mb-1",children:"Notes"}),(0,fn.jsx)("p",{className:"text-sm text-gray-600",children:_t.notes})]})]})]})]}),(0,fn.jsxs)("div",{className:"mt-8 flex justify-end space-x-3 pt-6 border-t",children:[(0,fn.jsx)("button",{onClick:()=>mt(!1),className:"btn-secondary",children:"Cancel"}),(0,fn.jsx)("button",{onClick:async()=>{if(Cs)return void console.log("\ud83d\udcca Booking already in progress, ignoring duplicate request");if(!_t.name||!_t.phone)return void alert("Please fill in required fields (Name and Phone)");console.log("\ud83d\udcc5 ========== SAVE BOOKING START =========="),console.log("\ud83d\udcc5 Lead Form:",_t),console.log("\ud83d\udcc5 Is Reschedule:",_t.isReschedule),console.log("\ud83d\udcc5 Send Email:",rs),console.log("\ud83d\udcc5 Send SMS:",os),console.log("\ud83d\udcc5 Selected Template ID:",cs),console.log("\ud83d\udcc5 Available Templates:",us.map(e=>({id:e._id,name:e.name}))),console.log("\ud83d\udcc5 ========================================"),_s(!0);const e=ht.date||new Date(ht.dateStr),t=new Date(e);t.setMinutes(t.getMinutes()+30);const s=e.getFullYear(),n=e.getMonth(),a=e.getDate(),r=e.getHours(),l=e.getMinutes(),o=new Date(s,n,a,r,l,0,0),i=new Date(s,n,a,r,l+30,0,0),c="".concat(s,"-").concat(String(n+1).padStart(2,"0"),"-").concat(String(a).padStart(2,"0"),"T").concat(String(r).padStart(2,"0"),":").concat(String(l).padStart(2,"0"),":00.000Z");console.log("\ud83d\udd50 Time Debug:",{originalSelectedDate:ht,selectedDateTime:e.toISOString(),selectedDateTimeLocal:e.toLocaleString(),selectedDateTimeUTC:e.toUTCString(),localDateTime:o.toISOString(),localDateTimeLocal:o.toLocaleString(),endDateTime:t.toISOString(),endDateTimeLocal:t.toLocaleString(),timezoneOffset:e.getTimezoneOffset(),hour:e.getHours(),minute:e.getMinutes(),localHour:o.getHours(),localMinute:o.getMinutes()});const d="temp_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9));try{const e=JSON.parse(localStorage.getItem("user"))||{};console.log("\ud83d\udcca Booking Debug Info:",{leadFormId:_t._id,leadFormIdType:typeof _t._id,leadFormIdLength:_t._id?_t._id.length:0,isExistingLead:_t._id&&""!==_t._id,leadForm:_t,selectedDateTime:o.toISOString()});const{_id:t}=_t,s=He(He(He({},Si(_t,hd)),{},{date_booked:c,time_booked:_t.time_booked||"".concat(String(r).padStart(2,"0"),":").concat(String(l).padStart(2,"0")),booking_slot:_t.booking_slot||Ms||1},t&&""!==t?{_id:t}:{}),{},{status:"Booked",is_confirmed:(_t.isReschedule,0),booker:e._id||e.id||"507f1f77bcf86cd799439012"},_t.isReschedule&&{booking_status:"Reschedule",rescheduleReason:"Appointment rescheduled via calendar to ".concat(o.toLocaleString())});console.log("\ud83d\udcca Creating/updating lead with data:",{hasExistingId:!!t,finalData:s}),console.log("\ud83d\udce4 Sending booking request with:",He(He({},s),{},{sendEmail:rs,sendSms:os,templateId:cs}));const n=await gn.post("/api/leads",He(He({},s),{},{sendEmail:rs,sendSms:os,templateId:cs,secondaryTemplateId:fs?hs:null}));if(console.log("\u2705 Booking API response:",n.data),n.data.success||n.data.lead||n.data){const t=n.data.lead||n.data,s=n.data.isExistingLead||!1,a=t.is_confirmed?"Confirmed":"Unconfirmed",r={id:t.id||d,name:_t.name,title:"".concat(_t.name," - ").concat(a),phone:_t.phone,email:_t.email,date_booked:t.date_booked||c,time_booked:t.time_booked||_t.time_booked,booking_slot:t.booking_slot||_t.booking_slot||1,status:"Booked",is_confirmed:t.is_confirmed||!1,booking_status:t.booking_status,has_sale:t.has_sale||t.hasSale||0,image_url:t.image_url,notes:t.notes,postcode:t.postcode,start:o,end:i,backgroundColor:Ln(a,t.hasSale,t.is_confirmed),borderColor:Ln(a,t.hasSale,t.is_confirmed),extendedProps:{lead:He(He({},t),{},{bookingHistory:Array.isArray(t.bookingHistory)?t.bookingHistory:t.booking_history||[]}),phone:_t.phone,status:"Booked",displayStatus:a,booker:e.name||"Current User",isConfirmed:t.is_confirmed||!1}};je(e=>{const n=e.filter(e=>e.id!==d);return[...s?n.filter(e=>e.id!==t.id):n,r]}),Ct({type:"booking_created",lead:t,event:r,timestamp:new Date});const l=s?"\u2705 Appointment updated successfully for ".concat(_t.name,"!"):"\u2705 Appointment booked successfully for ".concat(_t.name,"!");alert(l),console.log("\ud83d\udcc5 Booking action: ".concat(s?"Updated existing lead":"Created new lead"," for ").concat(_t.name)),setTimeout(()=>{console.log("\ud83d\udcc5 Refreshing calendar after booking to ensure consistency"),Rn()},2e3),setTimeout(()=>{console.log("\ud83d\udcc5 Second refresh to catch any delayed updates"),Rn()},5e3)}}catch(x){var u,m,h,p;if(console.error("Error creating booking:",x),console.error("Error details:",{status:null===(u=x.response)||void 0===u?void 0:u.status,message:null===(m=x.response)||void 0===m||null===(h=m.data)||void 0===h?void 0:h.message,data:null===(p=x.response)||void 0===p?void 0:p.data,formData:_t}),x.response&&400===x.response.status)return void alert("\u274c Booking failed: ".concat(x.response.data.message||"Invalid data provided"));if(x.response&&401===x.response.status)return void alert("\u274c Authentication required. Please log in again.");if(x.response&&403===x.response.status)return void alert("\u274c Access denied. You don't have permission to create bookings.");const e={id:d,title:"".concat(_t.name," - Booked (Pending)"),start:o,end:i,backgroundColor:"#FFA500",borderColor:"#FFA500",extendedProps:{lead:_t,phone:_t.phone,status:"Booked",booker:"Current User",isPending:!0}};je(t=>[...t,e]),"NETWORK_ERROR"!==x.code&&navigator.onLine?alert("\u26a0\ufe0f Booking created locally for ".concat(_t.name,". Please check your connection.")):alert("\ud83d\udcf1 Booking saved locally for ".concat(_t.name,". Will sync when connection is restored.")),setTimeout(()=>{$n()},5e3)}finally{_s(!1)}Et({_id:"",name:"",phone:"",email:"",postcode:"",status:"New",notes:"",image_url:""}),mt(!1),_s(!1),ps(null),bs(!1),setTimeout(()=>{Rn()},500)},className:"btn-primary",children:_t._id?"Book Appointment":"Save Booking"})]})]})}),Ce&&ke&&ke.start&&(console.log("\ud83d\uddbc\ufe0f Modal opened - Full selectedEvent:",{id:ke.id,title:ke.title,hasExtendedProps:!!ke.extendedProps,hasLead:!(null===(ea=ke.extendedProps)||void 0===ea||!ea.lead),leadKeys:null!==(ta=ke.extendedProps)&&void 0!==ta&&ta.lead?Object.keys(ke.extendedProps.lead):[],image_url:null===(sa=ke.extendedProps)||void 0===sa||null===(na=sa.lead)||void 0===na?void 0:na.image_url,image_url_type:typeof(null===(aa=ke.extendedProps)||void 0===aa||null===(ra=aa.lead)||void 0===ra?void 0:ra.image_url),image_url_length:null===(la=ke.extendedProps)||void 0===la||null===(oa=la.lead)||void 0===oa||null===(ia=oa.image_url)||void 0===ia?void 0:ia.length}),!0)&&(0,fn.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm z-50 flex items-center justify-center p-2 sm:p-4",children:(0,fn.jsxs)("div",{className:"relative w-full max-w-5xl bg-white rounded-lg shadow-2xl max-h-[95vh] overflow-y-auto calendar-modal-scroll flex flex-col",children:[(0,fn.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 p-3 sm:p-4",children:[(0,fn.jsxs)("div",{className:"flex-1 mb-2 sm:mb-0 mt-10 sm:mt-0",children:[(0,fn.jsxs)("h3",{className:"text-lg sm:text-xl font-bold text-white mb-1 flex items-center flex-wrap",children:[(null===(s=ke.extendedProps)||void 0===s||null===(n=s.lead)||void 0===n?void 0:n.name)||ke.title,(null===(r=ke.extendedProps)||void 0===r||null===(l=r.lead)||void 0===l?void 0:l.age)&&(0,fn.jsxs)("span",{className:"text-white/90 font-normal ml-2",children:["(",ke.extendedProps.lead.age,")"]}),ke.hasUnreadSms||ke.hasUnreadEmail?(0,fn.jsxs)("span",{className:"relative ml-2 animate-pulse",children:[ke.hasUnreadSms?(0,fn.jsx)(Gr,{className:"inline-block w-5 h-5 text-green-300"}):(0,fn.jsx)(Wr,{className:"inline-block w-5 h-5 text-yellow-300"}),(0,fn.jsx)("span",{className:"absolute -top-1 -right-1 w-2.5 h-2.5 bg-red-500 rounded-full animate-ping",style:{animationDuration:"1.5s"}}),(0,fn.jsx)("span",{className:"absolute -top-1 -right-1 w-2.5 h-2.5 bg-red-500 rounded-full"})]}):ke.hasReceivedSms||ke.hasReceivedEmail?(0,fn.jsx)("span",{className:"ml-2",children:ke.hasReceivedSms?(0,fn.jsx)(Gr,{className:"inline-block w-4 h-4 text-white/50"}):(0,fn.jsx)(Wr,{className:"inline-block w-4 h-4 text-white/50"})}):null]}),(0,fn.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,fn.jsx)("span",{className:"".concat(Hn(null===(o=ke.extendedProps)||void 0===o?void 0:o.status)," px-3 py-1 rounded-lg text-sm font-medium"),children:(null===(i=ke.extendedProps)||void 0===i?void 0:i.status)||"Scheduled"}),(null===(c=ke.extendedProps)||void 0===c?void 0:c.isConfirmed)&&(0,fn.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-white/20 text-white",children:[(0,fn.jsx)(gr,{className:"h-4 w-4 mr-2"}),"Confirmed"]})]}),((null===(d=ke.extendedProps)||void 0===d||null===(u=d.lead)||void 0===u?void 0:u.booked_at)||(null===(m=ke.extendedProps)||void 0===m||null===(h=m.lead)||void 0===h?void 0:h.created_at))&&(0,fn.jsxs)("p",{className:"text-white/80 text-xs mt-1",children:["Booked on: ",new Date(ke.extendedProps.lead.booked_at||ke.extendedProps.lead.created_at).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})]})]}),(0,fn.jsxs)("div",{className:"relative ml-0 sm:ml-4 absolute top-3 right-3 sm:static",children:[(0,fn.jsx)("div",{className:"cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>{var e,t;null!==(e=ke.extendedProps)&&void 0!==e&&null!==(t=e.lead)&&void 0!==t&&t.image_url&&(console.log("\ud83d\uddbc\ufe0f Opening image:",ke.extendedProps.lead.image_url),Gs(ke.extendedProps.lead.image_url))},children:(0,fn.jsx)(Ui,{src:Ai(null===(g=ke.extendedProps)||void 0===g||null===(f=g.lead)||void 0===f?void 0:f.image_url,"optimized"),alt:(null===(b=ke.extendedProps)||void 0===b||null===(y=b.lead)||void 0===y?void 0:y.name)||ke.title,className:"w-16 h-16 sm:w-20 sm:h-20 rounded-xl border-2 border-white shadow-lg object-cover",fallbackClassName:"w-16 h-16 sm:w-20 sm:h-20 rounded-xl border-2 border-white shadow-lg bg-white flex items-center justify-center",lazy:!1,preload:!0,onError:()=>{var e,t;console.error("\u274c Image failed to load:",null===(e=ke.extendedProps)||void 0===e||null===(t=e.lead)||void 0===t?void 0:t.image_url)},onLoad:()=>{var e,t;console.log("\u2705 Image loaded successfully:",null===(e=ke.extendedProps)||void 0===e||null===(t=e.lead)||void 0===t?void 0:t.image_url)}},"".concat(ke.id,"-").concat((null===(p=ke.extendedProps)||void 0===p||null===(x=p.lead)||void 0===x?void 0:x.image_url)||"no-image"))}),(0,fn.jsx)("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 sm:w-5 sm:h-5 rounded-full border-2 border-white shadow-lg ".concat("Attended"===(null===(v=ke.extendedProps)||void 0===v?void 0:v.status)?"bg-green-500":"Booked"===(null===(j=ke.extendedProps)||void 0===j?void 0:j.status)?"bg-blue-500":"Cancelled"===(null===(w=ke.extendedProps)||void 0===w?void 0:w.status)?"bg-red-500":"bg-gray-400")})]}),(()=>{const e=(()=>{const e=Kn(),t=e.findIndex(e=>e.id===ke.id);return{canGoPrevious:t>0,canGoNext:t<e.length-1,currentIndex:t+1,totalEvents:e.length}})();return(0,fn.jsxs)("div",{className:"absolute top-3 left-1/2 transform -translate-x-1/2 flex space-x-1 sm:space-x-2 z-10",children:[(0,fn.jsx)("button",{onClick:Jn,disabled:!e.canGoPrevious,className:"p-1.5 sm:p-2 rounded-full bg-white/20 backdrop-blur-sm transition-all duration-200 ".concat(e.canGoPrevious?"text-white hover:text-gray-900 hover:bg-white/40 shadow-lg":"text-white/30 cursor-not-allowed bg-white/10"),title:"Previous booking",children:(0,fn.jsx)(br,{className:"h-4 w-4 sm:h-5 sm:w-5"})}),(0,fn.jsx)("button",{onClick:Dn,className:"p-1.5 sm:p-2 rounded-full bg-white/20 backdrop-blur-sm text-white hover:text-gray-900 hover:bg-white/40 transition-all duration-200 shadow-lg",title:"Close",children:(0,fn.jsx)(jl,{className:"h-4 w-4 sm:h-5 sm:w-5"})}),(0,fn.jsx)("button",{onClick:Xn,disabled:!e.canGoNext,className:"p-1.5 sm:p-2 rounded-full bg-white/20 backdrop-blur-sm transition-all duration-200 ".concat(e.canGoNext?"text-white hover:text-gray-900 hover:bg-white/40 shadow-lg":"text-white/30 cursor-not-allowed bg-white/10"),title:"Next booking",children:(0,fn.jsx)(yr,{className:"h-4 w-4 sm:h-5 sm:w-5"})})]})})()]}),(0,fn.jsxs)("div",{className:"p-4 flex-1",children:[(0,fn.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("h4",{className:"text-sm font-bold text-gray-900 mb-3 flex items-center",children:[(0,fn.jsx)(gl,{className:"h-4 w-4 mr-2 text-indigo-600"}),"Contact Information"]}),(0,fn.jsxs)("div",{className:"space-y-3",children:[(0,fn.jsx)("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg p-3",children:(0,fn.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,fn.jsx)("div",{className:"w-8 h-8 rounded-lg bg-indigo-500 flex items-center justify-center flex-shrink-0",children:(0,fn.jsx)(hr,{className:"h-4 w-4 text-white"})}),(0,fn.jsxs)("div",{className:"flex-1",children:[(0,fn.jsx)("p",{className:"text-xs font-medium text-indigo-600 uppercase tracking-wide",children:"Appointment Date & Time"}),(0,fn.jsx)("p",{className:"text-sm font-bold text-gray-900",children:ke.start?new Date(ke.start).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):"Date not available"}),(0,fn.jsxs)("p",{className:"text-xs text-gray-600 flex items-center",children:[(0,fn.jsx)(wr,{className:"h-3 w-3 mr-1"}),ke.start?(e=>{const t=new Date(e.start),s=e.end?new Date(e.end):t;return"".concat(t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})," - ").concat(s.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}))})(ke):"Time not available"]})]})]})}),(null===(N=ke.extendedProps)||void 0===N?void 0:N.phone)&&(0,fn.jsx)("div",{className:"bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg p-3",children:(0,fn.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,fn.jsx)("div",{className:"w-8 h-8 rounded-lg bg-purple-500 flex items-center justify-center flex-shrink-0",children:(0,fn.jsx)(Jr,{className:"h-4 w-4 text-white"})}),(0,fn.jsxs)("div",{className:"flex-1",children:[(0,fn.jsx)("p",{className:"text-xs font-medium text-purple-600 uppercase tracking-wide",children:"Phone Number"}),(0,fn.jsx)("p",{className:"text-sm font-bold text-gray-900",children:ke.extendedProps.phone}),(0,fn.jsx)("a",{href:"tel:".concat(ke.extendedProps.phone),className:"text-xs text-purple-600 hover:text-purple-800 transition-colors",children:"Click to call \u2192"})]})]})}),(null===(k=ke.extendedProps)||void 0===k||null===(S=k.lead)||void 0===S?void 0:S.email)&&(0,fn.jsx)("div",{className:"bg-gradient-to-r from-pink-50 to-rose-50 rounded-lg p-3",children:(0,fn.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,fn.jsx)("div",{className:"w-8 h-8 rounded-lg bg-pink-500 flex items-center justify-center flex-shrink-0",children:(0,fn.jsx)(Wr,{className:"h-4 w-4 text-white"})}),(0,fn.jsxs)("div",{className:"flex-1",children:[(0,fn.jsx)("p",{className:"text-xs font-medium text-pink-600 uppercase tracking-wide",children:"Email Address"}),(0,fn.jsx)("p",{className:"text-sm font-bold text-gray-900 break-all",children:ke.extendedProps.lead.email}),(0,fn.jsx)("a",{href:"mailto:".concat(ke.extendedProps.lead.email),className:"text-xs text-pink-600 hover:text-pink-800 transition-colors",children:"Send email \u2192"})]})]})}),(null===(C=ke.extendedProps)||void 0===C||null===(_=C.lead)||void 0===_?void 0:_.postcode)&&(0,fn.jsx)("div",{className:"bg-gradient-to-r from-orange-50 to-amber-50 rounded-lg p-3",children:(0,fn.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,fn.jsx)("div",{className:"w-8 h-8 rounded-lg bg-orange-500 flex items-center justify-center flex-shrink-0",children:(0,fn.jsx)(qr,{className:"h-4 w-4 text-white"})}),(0,fn.jsxs)("div",{className:"flex-1",children:[(0,fn.jsx)("p",{className:"text-xs font-medium text-orange-600 uppercase tracking-wide",children:"Postcode"}),(0,fn.jsx)("p",{className:"text-sm font-bold text-gray-900",children:ke.extendedProps.lead.postcode}),(0,fn.jsx)("a",{href:"https://maps.google.com/maps?q=".concat(ke.extendedProps.lead.postcode),target:"_blank",rel:"noopener noreferrer",className:"text-xs text-orange-600 hover:text-orange-800 transition-colors",children:"View on map \u2192"})]})]})}),(0,fn.jsxs)("div",{className:"mt-4 bg-gradient-to-br from-slate-50 via-gray-50 to-zinc-100 rounded-xl p-4 border border-gray-200 shadow-sm",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,fn.jsxs)("h5",{className:"text-xs font-bold text-gray-700 uppercase tracking-widest flex items-center",children:[(0,fn.jsx)("span",{className:"w-6 h-6 rounded-full bg-gradient-to-r from-gray-800 to-gray-600 flex items-center justify-center mr-2",children:(0,fn.jsx)(gl,{className:"h-3 w-3 text-white"})}),"Model Stats"]}),(0,fn.jsxs)("button",{onClick:()=>tt(!et),className:"text-xs text-gray-500 hover:text-gray-700 transition-colors flex items-center gap-1",children:[(0,fn.jsx)(_r,{className:"h-3 w-3"}),et?"Cancel":"Edit"]})]}),et?(0,fn.jsxs)("div",{className:"space-y-3",children:[(0,fn.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Date of Birth"}),(0,fn.jsx)("input",{type:"date",value:at.date_of_birth||"",onChange:e=>rt(He(He({},at),{},{date_of_birth:e.target.value})),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-transparent transition-all"})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Height (inches)"}),(0,fn.jsx)("input",{type:"number",value:at.height_inches||"",onChange:e=>rt(He(He({},at),{},{height_inches:e.target.value})),placeholder:"e.g. 65",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-transparent transition-all"})]})]}),(0,fn.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Chest (inches)"}),(0,fn.jsx)("input",{type:"number",value:at.chest_inches||"",onChange:e=>rt(He(He({},at),{},{chest_inches:e.target.value})),placeholder:"e.g. 34",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-transparent transition-all"})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Waist (inches)"}),(0,fn.jsx)("input",{type:"number",value:at.waist_inches||"",onChange:e=>rt(He(He({},at),{},{waist_inches:e.target.value})),placeholder:"e.g. 28",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-transparent transition-all"})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Hips (inches)"}),(0,fn.jsx)("input",{type:"number",value:at.hips_inches||"",onChange:e=>rt(He(He({},at),{},{hips_inches:e.target.value})),placeholder:"e.g. 36",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-transparent transition-all"})]})]}),(0,fn.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Eye Color"}),(0,fn.jsxs)("select",{value:at.eye_color||"",onChange:e=>rt(He(He({},at),{},{eye_color:e.target.value})),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-transparent transition-all",children:[(0,fn.jsx)("option",{value:"",children:"Select..."}),(0,fn.jsx)("option",{value:"Brown",children:"Brown"}),(0,fn.jsx)("option",{value:"Blue",children:"Blue"}),(0,fn.jsx)("option",{value:"Green",children:"Green"}),(0,fn.jsx)("option",{value:"Hazel",children:"Hazel"}),(0,fn.jsx)("option",{value:"Grey",children:"Grey"}),(0,fn.jsx)("option",{value:"Amber",children:"Amber"})]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Hair Color"}),(0,fn.jsxs)("select",{value:at.hair_color||"",onChange:e=>rt(He(He({},at),{},{hair_color:e.target.value})),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-transparent transition-all",children:[(0,fn.jsx)("option",{value:"",children:"Select..."}),(0,fn.jsx)("option",{value:"Black",children:"Black"}),(0,fn.jsx)("option",{value:"Brown",children:"Brown"}),(0,fn.jsx)("option",{value:"Blonde",children:"Blonde"}),(0,fn.jsx)("option",{value:"Red",children:"Red"}),(0,fn.jsx)("option",{value:"Auburn",children:"Auburn"}),(0,fn.jsx)("option",{value:"Grey",children:"Grey"}),(0,fn.jsx)("option",{value:"White",children:"White"})]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Hair Length"}),(0,fn.jsxs)("select",{value:at.hair_length||"",onChange:e=>rt(He(He({},at),{},{hair_length:e.target.value})),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-400 focus:border-transparent transition-all",children:[(0,fn.jsx)("option",{value:"",children:"Select..."}),(0,fn.jsx)("option",{value:"Bald",children:"Bald"}),(0,fn.jsx)("option",{value:"Buzz",children:"Buzz"}),(0,fn.jsx)("option",{value:"Short",children:"Short"}),(0,fn.jsx)("option",{value:"Medium",children:"Medium"}),(0,fn.jsx)("option",{value:"Long",children:"Long"}),(0,fn.jsx)("option",{value:"Very Long",children:"Very Long"})]})]})]}),(0,fn.jsx)("button",{onClick:async()=>{if(null!==ke&&void 0!==ke&&ke.id){nt(!0);try{const e=await gn.put("/api/leads/".concat(ke.id),{date_of_birth:at.date_of_birth||null,height_inches:at.height_inches?parseInt(at.height_inches):null,chest_inches:at.chest_inches?parseInt(at.chest_inches):null,waist_inches:at.waist_inches?parseInt(at.waist_inches):null,hips_inches:at.hips_inches?parseInt(at.hips_inches):null,eye_color:at.eye_color||null,hair_color:at.hair_color||null,hair_length:at.hair_length||null});if(e.data.success||e.data.lead){e.data.lead||e.data;je(e=>e.map(e=>e.id===ke.id?He(He({},e),{},{extendedProps:He(He({},e.extendedProps),{},{lead:He(He({},e.extendedProps.lead),{},{date_of_birth:at.date_of_birth,height_inches:at.height_inches,chest_inches:at.chest_inches,waist_inches:at.waist_inches,hips_inches:at.hips_inches,eye_color:at.eye_color,hair_color:at.hair_color,hair_length:at.hair_length})})}):e)),Se(e=>e?He(He({},e),{},{extendedProps:He(He({},e.extendedProps),{},{lead:He(He({},e.extendedProps.lead),{},{date_of_birth:at.date_of_birth,height_inches:at.height_inches,chest_inches:at.chest_inches,waist_inches:at.waist_inches,hips_inches:at.hips_inches,eye_color:at.eye_color,hair_color:at.hair_color,hair_length:at.hair_length})})}):null),tt(!1),alert("Model stats saved successfully!")}}catch(e){console.error("Error saving stats:",e),alert("Failed to save stats. Please try again.")}finally{nt(!1)}}},disabled:st,className:"w-full mt-2 px-4 py-2 bg-gradient-to-r from-gray-800 to-gray-700 text-white text-sm font-medium rounded-lg hover:from-gray-700 hover:to-gray-600 transition-all disabled:opacity-50 flex items-center justify-center gap-2",children:st?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Saving..."]}):(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(gr,{className:"h-4 w-4"}),"Save Stats"]})})]}):(0,fn.jsxs)("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2",children:[(0,fn.jsxs)("div",{className:"flex justify-between items-center py-1.5 border-b border-gray-200",children:[(0,fn.jsx)("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"DOB"}),(0,fn.jsx)("span",{className:"text-sm font-medium text-gray-900",children:null!==(E=ke.extendedProps)&&void 0!==E&&null!==(T=E.lead)&&void 0!==T&&T.date_of_birth?new Date(ke.extendedProps.lead.date_of_birth).toLocaleDateString("en-GB"):"\u2014"})]}),(0,fn.jsxs)("div",{className:"flex justify-between items-center py-1.5 border-b border-gray-200",children:[(0,fn.jsx)("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Height"}),(0,fn.jsx)("span",{className:"text-sm font-medium text-gray-900",children:null!==(P=ke.extendedProps)&&void 0!==P&&null!==(A=P.lead)&&void 0!==A&&A.height_inches?"".concat(ke.extendedProps.lead.height_inches,'"'):"\u2014"})]}),(0,fn.jsxs)("div",{className:"flex justify-between items-center py-1.5 border-b border-gray-200",children:[(0,fn.jsx)("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Chest"}),(0,fn.jsx)("span",{className:"text-sm font-medium text-gray-900",children:null!==(D=ke.extendedProps)&&void 0!==D&&null!==(L=D.lead)&&void 0!==L&&L.chest_inches?"".concat(ke.extendedProps.lead.chest_inches,'"'):"\u2014"})]}),(0,fn.jsxs)("div",{className:"flex justify-between items-center py-1.5 border-b border-gray-200",children:[(0,fn.jsx)("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Waist"}),(0,fn.jsx)("span",{className:"text-sm font-medium text-gray-900",children:null!==(M=ke.extendedProps)&&void 0!==M&&null!==(R=M.lead)&&void 0!==R&&R.waist_inches?"".concat(ke.extendedProps.lead.waist_inches,'"'):"\u2014"})]}),(0,fn.jsxs)("div",{className:"flex justify-between items-center py-1.5 border-b border-gray-200",children:[(0,fn.jsx)("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Hips"}),(0,fn.jsx)("span",{className:"text-sm font-medium text-gray-900",children:null!==(F=ke.extendedProps)&&void 0!==F&&null!==(I=F.lead)&&void 0!==I&&I.hips_inches?"".concat(ke.extendedProps.lead.hips_inches,'"'):"\u2014"})]}),(0,fn.jsxs)("div",{className:"flex justify-between items-center py-1.5 border-b border-gray-200",children:[(0,fn.jsx)("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Eyes"}),(0,fn.jsx)("span",{className:"text-sm font-medium text-gray-900",children:(null===(O=ke.extendedProps)||void 0===O||null===(B=O.lead)||void 0===B?void 0:B.eye_color)||"\u2014"})]}),(0,fn.jsxs)("div",{className:"flex justify-between items-center py-1.5 border-b border-gray-200",children:[(0,fn.jsx)("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Hair"}),(0,fn.jsx)("span",{className:"text-sm font-medium text-gray-900",children:(null===(U=ke.extendedProps)||void 0===U||null===(z=U.lead)||void 0===z?void 0:z.hair_color)||"\u2014"})]}),(0,fn.jsxs)("div",{className:"col-span-2 flex justify-between items-center py-1.5",children:[(0,fn.jsx)("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Hair Length"}),(0,fn.jsx)("span",{className:"text-sm font-medium text-gray-900",children:(null===(V=ke.extendedProps)||void 0===V||null===(W=V.lead)||void 0===W?void 0:W.hair_length)||"\u2014"})]})]})]})]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("h4",{className:"text-sm font-bold text-gray-900 mb-3 flex items-center",children:[(0,fn.jsx)(al,{className:"h-4 w-4 mr-2 text-indigo-600"}),"Details & Actions"]}),(0,fn.jsxs)("div",{className:"space-y-3",children:[(0,fn.jsxs)("div",{className:"bg-white border border-gray-100 rounded-lg p-3",children:[(0,fn.jsx)("h5",{className:"text-sm font-bold text-gray-900 mb-2",children:"Booking confirmation channels"}),(0,fn.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,fn.jsxs)("label",{className:"inline-flex items-center space-x-2",children:[(0,fn.jsx)("input",{type:"checkbox",className:"h-4 w-4 text-indigo-600 border-gray-300 rounded",checked:rs,onChange:e=>ls(e.target.checked)}),(0,fn.jsx)("span",{className:"text-sm text-gray-700",children:"Email"})]}),(0,fn.jsxs)("label",{className:"inline-flex items-center space-x-2",children:[(0,fn.jsx)("input",{type:"checkbox",className:"h-4 w-4 text-indigo-600 border-gray-300 rounded",checked:os,onChange:e=>is(e.target.checked)}),(0,fn.jsx)("span",{className:"text-sm text-gray-700",children:"Text (SMS)"})]})]}),(0,fn.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"These settings apply when you reschedule from this modal."}),(rs||os)&&(0,fn.jsxs)("div",{className:"mt-3",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"primary"===ys?"Booking Confirmation":"Secondary Confirmation"}),xs&&xs.length>0&&(0,fn.jsxs)("button",{type:"button",onClick:()=>vs("primary"===ys?"secondary":"primary"),className:"flex items-center space-x-2 px-3 py-1.5 text-sm font-semibold rounded-lg shadow-sm transition-all duration-200 ".concat("primary"===ys?"bg-gradient-to-r from-purple-500 to-pink-500 text-white hover:from-purple-600 hover:to-pink-600":"bg-gradient-to-r from-indigo-500 to-blue-500 text-white hover:from-indigo-600 hover:to-blue-600"),children:[(0,fn.jsx)(el,{className:"h-4 w-4"}),(0,fn.jsxs)("span",{children:["Switch to ","primary"===ys?"Confirm":"Primary"]})]})]}),"primary"===ys?us.length>0?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)("select",{value:cs||"",onChange:e=>ds(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm",children:us.map(e=>(0,fn.jsxs)("option",{value:e._id,children:[e.name," ","secondary"===e.emailAccount?"(Diary)":"(Primary)"]},e._id))}),rs&&!ws&&(0,fn.jsx)("p",{className:"text-xs text-amber-600 mt-1",children:"\u26a0\ufe0f This template has email disabled"}),os&&!Ns&&(0,fn.jsx)("p",{className:"text-xs text-amber-600 mt-1",children:"\u26a0\ufe0f This template has SMS disabled"})]}):(0,fn.jsx)("div",{className:"text-xs text-amber-600 bg-amber-50 border border-amber-200 rounded-md p-2",children:"\u26a0\ufe0f No active booking templates found"}):(0,fn.jsxs)("select",{value:hs||"",onChange:e=>ps(e.target.value||null),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 text-sm",children:[(0,fn.jsx)("option",{value:"",children:"None - No secondary email"}),xs.map(e=>(0,fn.jsx)("option",{value:e._id,children:e.name},e._id))]}),(0,fn.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"primary"===ys?"Main booking confirmation":"Optional additional email"})]}),(null===(q=ke.extendedProps)||void 0===q||null===(H=q.lead)||void 0===H?void 0:H.date_booked)&&(0,fn.jsx)("div",{className:"mt-3 pt-3 border-t border-gray-200",children:"primary"===ys?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsxs)("button",{onClick:async()=>{var e;if(!ke||null===(e=ke.extendedProps)||void 0===e||!e.lead)return void alert("No lead data available for this event.");const t=ke.extendedProps.lead.id||ke.id,s=ke.extendedProps.lead.name||ke.title.split(" - ")[0];if(t){if(window.confirm("Resend welcome pack to ".concat(s,"?\n\nThis will send the booking confirmation email and SMS using the selected template.")))try{const e=await gn.post("/api/leads/".concat(t,"/resend-welcome-pack"),{templateId:cs||(us.length>0?us[0]._id:null)});if(e.data.success){const t=[];e.data.emailSent&&t.push("Email"),e.data.smsSent&&t.push("SMS"),alert("\u2705 Welcome pack resent successfully via ".concat(t.join(" and "),"!")),setTimeout(()=>{Rn()},1e3)}else alert("\u274c Failed to resend welcome pack: ".concat(e.data.message||"Unknown error"))}catch(r){var n,a;console.error("Error resending welcome pack:",r),alert("\u274c Error resending welcome pack: ".concat((null===(n=r.response)||void 0===n||null===(a=n.data)||void 0===a?void 0:a.message)||r.message||"Unknown error"))}}else alert("Unable to identify lead ID.")},className:"w-full flex items-center justify-center space-x-2 px-4 py-2 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-lg hover:from-indigo-600 hover:to-purple-700 transition-all duration-200 shadow-md hover:shadow-lg",title:"Resend welcome pack (booking confirmation email and SMS)",children:[(0,fn.jsx)(nl,{className:"h-4 w-4"}),(0,fn.jsx)("span",{className:"text-sm font-medium",children:"Resend Welcome Pack"})]}),(0,fn.jsx)("p",{className:"text-xs text-gray-500 mt-1 text-center",children:"Sends booking confirmation via email and SMS"})]}):(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsxs)("button",{onClick:async()=>{var e,t;if(!ke||null===(e=ke.extendedProps)||void 0===e||!e.lead)return void alert("No lead data available for this event.");if(!hs)return void alert("Please select a template first.");const s=ke.extendedProps.lead.id||ke.id,n=ke.extendedProps.lead.name||ke.title.split(" - ")[0],a=(null===(t=xs.find(e=>e._id===hs))||void 0===t?void 0:t.name)||"Template";if(s){if(window.confirm('Send "'.concat(a,'" to ').concat(n,"?")))try{const e=await gn.post("/api/leads/".concat(s,"/resend-welcome-pack"),{templateId:hs});if(e.data.success){const t=[];e.data.emailSent&&t.push("Email"),e.data.smsSent&&t.push("SMS"),alert('\u2705 "'.concat(a,'" sent successfully via ').concat(t.join(" and "),"!")),setTimeout(()=>{Rn()},1e3)}else alert("\u274c Failed to send template: ".concat(e.data.message||"Unknown error"))}catch(o){var r,l;console.error("Error sending template:",o),alert("\u274c Error sending template: ".concat((null===(r=o.response)||void 0===r||null===(l=r.data)||void 0===l?void 0:l.message)||o.message||"Unknown error"))}}else alert("Unable to identify lead ID.")},disabled:!hs,className:"w-full flex items-center justify-center space-x-2 px-4 py-2 rounded-lg transition-all duration-200 shadow-md hover:shadow-lg ".concat(hs?"bg-gradient-to-r from-purple-500 to-pink-500 text-white hover:from-purple-600 hover:to-pink-600":"bg-gray-200 text-gray-400 cursor-not-allowed"),title:"Send selected template",children:[(0,fn.jsx)(nl,{className:"h-4 w-4"}),(0,fn.jsx)("span",{className:"text-sm font-medium",children:"Send"})]}),(0,fn.jsx)("p",{className:"text-xs text-gray-500 mt-1 text-center",children:hs?"Send selected template to customer":"Select a template above"})]})})]}),(null===(Y=ke.extendedProps)||void 0===Y?void 0:Y.booker)&&(0,fn.jsx)("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg p-3",children:(0,fn.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,fn.jsx)("div",{className:"w-8 h-8 rounded-lg bg-green-500 flex items-center justify-center flex-shrink-0",children:(0,fn.jsx)(gl,{className:"h-4 w-4 text-white"})}),(0,fn.jsxs)("div",{className:"flex-1",children:[(0,fn.jsx)("p",{className:"text-xs font-medium text-green-600 uppercase tracking-wide",children:"Assigned To"}),(0,fn.jsx)("p",{className:"text-sm font-bold text-gray-900",children:ke.extendedProps.booker}),(0,fn.jsx)("p",{className:"text-xs text-green-600",children:"Account Manager"})]})]})}),(0,fn.jsxs)("div",{className:"bg-white border border-gray-100 rounded-lg p-3",children:[(0,fn.jsxs)("h5",{className:"text-sm font-bold text-gray-900 mb-2 flex items-center",children:[(0,fn.jsx)(ar,{className:"h-4 w-4 mr-2 text-indigo-600"}),"Quick Status Update"]}),((e,t,s,n,a,r,l)=>{const o="Booked"===(null===(e=ke.extendedProps)||void 0===e?void 0:e.status),i=null===(t=ke.extendedProps)||void 0===t?void 0:t.isConfirmed,c=(null===(s=ke.extendedProps)||void 0===s?void 0:s.isDoubleConfirmed)||(null===(n=ke.extendedProps)||void 0===n||null===(a=n.lead)||void 0===a?void 0:a.is_double_confirmed);let d=(null===(r=ke.extendedProps)||void 0===r?void 0:r.displayStatus)||(null===(l=ke.extendedProps)||void 0===l?void 0:l.bookingStatus);if(!d)if(o&&c)d="Double Confirmed";else if(o&&i)d="Confirmed";else if(o&&!1===i)d="Unconfirmed";else if(o)d="Booked";else{var u;d=(null===(u=ke.extendedProps)||void 0===u?void 0:u.status)||"Unknown"}const m="admin"===(null===ge||void 0===ge?void 0:ge.role)||"viewer"===(null===ge||void 0===ge?void 0:ge.role)||"booker"===(null===ge||void 0===ge?void 0:ge.role),h="admin"===(null===ge||void 0===ge?void 0:ge.role)||"viewer"===(null===ge||void 0===ge?void 0:ge.role),p=[{value:"Unconfirmed",label:"Unconfirmed",color:"#fb923c",permission:m},{value:"Confirmed",label:"Confirmed \u2713",color:"#22c55e",permission:m},{value:"Double Confirmed",label:"Double Confirmed \u2713\u2713",color:"#15803d",permission:m},{value:"Arrived",label:"Arrived",color:"#2563eb",permission:h},{value:"Left",label:"Left",color:"#1f2937",permission:h},{value:"No Show",label:"No Show",color:"#ef4444",permission:h},{value:"No Sale",label:"No Sale",color:"#b91c1c",permission:h},{value:"Review",label:"Review",color:"#8b5cf6",permission:h},{value:"Cancelled",label:"Cancelled",color:"#f43f5e",permission:m}],x=()=>{const e=p.find(e=>e.value===d);return(null===e||void 0===e?void 0:e.color)||"#6b7280"};return(0,fn.jsxs)("div",{className:"space-y-3",children:[(0,fn.jsxs)("div",{className:"relative",children:[(0,fn.jsx)("select",{value:d,onChange:e=>{const t=e.target.value;"Review"===t?qe(!0):Qn(t)},className:"w-full px-4 py-3 rounded-lg border-2 border-gray-200 bg-white text-sm font-semibold appearance-none cursor-pointer hover:border-gray-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all",style:{paddingLeft:"40px",borderLeftWidth:"4px",borderLeftColor:x()},children:p.filter(e=>e.permission).map(e=>(0,fn.jsx)("option",{value:e.value,style:{color:e.color},children:e.label},e.value))}),(0,fn.jsx)("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 rounded-full shadow-sm border-2 border-white",style:{backgroundColor:x()}}),(0,fn.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none",children:(0,fn.jsx)(fr,{className:"h-5 w-5 text-gray-400"})})]}),(0,fn.jsx)("div",{className:"grid grid-cols-3 gap-2 text-xs",children:p.slice(0,6).map(e=>(0,fn.jsxs)("div",{className:"flex items-center space-x-1.5",children:[(0,fn.jsx)("div",{className:"w-3 h-3 rounded-full flex-shrink-0 shadow-sm",style:{backgroundColor:e.color}}),(0,fn.jsx)("span",{className:"text-gray-700 font-medium truncate",children:e.value.replace(" Confirmed","")})]},e.value))})]})})()]})]})]})]}),(0,fn.jsx)("div",{className:"mt-4 pt-3 border-t border-gray-200",children:(0,fn.jsxs)("div",{className:"flex flex-col space-y-3",children:[((e,t,s,n,a,r)=>{const l=null!==(e=null!==(t=null===(s=ke.extendedProps)||void 0===s||null===(n=s.lead)||void 0===n?void 0:n.bookingHistory)&&void 0!==t?t:null===(a=ke.extendedProps)||void 0===a||null===(r=a.lead)||void 0===r?void 0:r.booking_history)&&void 0!==e?e:[];let o=[];try{Array.isArray(l)?o=l:"string"===typeof l?o=l.trim()?JSON.parse(l):[]:l&&"object"===typeof l&&(o=Array.isArray(l)?l:[])}catch(ey){o=[]}const i=Array.isArray(o)?o.filter(e=>["SMS_SENT","SMS_RECEIVED","SMS_FAILED","EMAIL_SENT","EMAIL_RECEIVED"].includes(e.action)):[];return 0===i.length?null:(0,fn.jsx)("div",{className:"bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg p-3",children:(0,fn.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,fn.jsx)("div",{className:"w-8 h-8 rounded-lg bg-blue-500 flex items-center justify-center flex-shrink-0",children:(0,fn.jsx)(Gr,{className:"h-4 w-4 text-white"})}),(0,fn.jsx)("div",{className:"flex-1",children:(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,fn.jsx)("p",{className:"text-xs font-medium text-gray-600 uppercase tracking-wide",children:"Messages"}),(0,fn.jsx)("span",{className:"text-xs bg-blue-200 text-blue-700 px-2 py-0.5 rounded-full",children:i.length})]}),(()=>{const e=i.some(e=>e.action.startsWith("SMS")),t=i.some(e=>e.action.startsWith("EMAIL"));return(0,fn.jsxs)("div",{className:"flex items-center space-x-1",children:[e&&(0,fn.jsx)("span",{className:"text-[10px] bg-blue-100 text-blue-600 px-1.5 py-0.5 rounded",children:"SMS"}),t&&(0,fn.jsx)("span",{className:"text-[10px] bg-indigo-100 text-indigo-600 px-1.5 py-0.5 rounded",children:"Email"})]})})()]}),((e,t,s,n,a,r,l,o)=>{const c=i[i.length-1],d=i.some(e=>e.action.startsWith("SMS")),u=i.some(e=>e.action.startsWith("EMAIL"));return(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsxs)("div",{onClick:()=>{Ve(d&&!u?"sms":u?"email":"sms"),Ue(!0)},className:"cursor-pointer bg-white rounded-lg p-2 md:p-3 lg:p-4 shadow-sm border border-blue-200 hover:border-blue-400 hover:shadow-md transition-all group",children:[(0,fn.jsxs)("div",{className:"flex items-start space-x-1 md:space-x-2",children:[(0,fn.jsx)("div",{className:"w-6 h-6 rounded-full flex items-center justify-center flex-shrink-0 ".concat(["SMS_SENT","EMAIL_SENT"].includes(c.action)?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-600"),children:["SMS_SENT","EMAIL_SENT"].includes(c.action)?(0,fn.jsx)("span",{className:"text-xs font-bold",children:"Y"}):(0,fn.jsx)(gl,{className:"w-3 h-3"})}),(0,fn.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-1 md:space-x-2 mb-1",children:[(0,fn.jsx)("span",{className:"text-xs md:text-sm font-medium text-gray-700",children:["SMS_SENT","EMAIL_SENT"].includes(c.action)?"You":(null===(e=ke.extendedProps)||void 0===e||null===(t=e.lead)||void 0===t?void 0:t.name)||"Customer"}),(0,fn.jsx)("span",{className:"text-[10px] ".concat(c.action.startsWith("EMAIL")?"text-indigo-500":"text-blue-500"),children:c.action.startsWith("EMAIL")?"Email":"SMS"})]}),(0,fn.jsx)("p",{className:"text-xs md:text-sm text-gray-600 truncate group-hover:text-gray-800 transition-colors",children:_l((null===(s=c.details)||void 0===s?void 0:s.body)||(null===(n=c.details)||void 0===n?void 0:n.message)||"No content")})]})]}),(0,fn.jsxs)("div",{className:"mt-2 pt-2 border-t border-gray-100 flex items-center justify-between",children:[(0,fn.jsx)("span",{className:"text-xs text-gray-400",children:(()=>{try{if(!c.timestamp)return"";const e=new Date(c.timestamp);if(isNaN(e.getTime()))return"";const t=new Date,s=(t-e)/36e5;if(s<1){const s=Math.floor((t-e)/6e4);return s<=0?"Just now":"".concat(s,"m ago")}return s<24?e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):e.toLocaleDateString([],{month:"short",day:"numeric"})}catch(e){return""}})()}),(0,fn.jsxs)("span",{className:"text-xs font-medium text-blue-600 group-hover:text-blue-700 flex items-center",children:["View all messages",(0,fn.jsx)(yr,{className:"w-3 h-3 ml-0.5"})]})]})]}),(0,fn.jsxs)("div",{className:"mt-2 flex space-x-2",children:[(null===(a=ke.extendedProps)||void 0===a||null===(r=a.lead)||void 0===r?void 0:r.phone)&&(0,fn.jsxs)("button",{onClick:()=>{Ve("sms"),Ue(!0)},className:"flex-1 flex items-center justify-center space-x-1 px-3 py-2 bg-blue-500 text-white text-xs font-medium rounded-lg hover:bg-blue-600 transition-colors",children:[(0,fn.jsx)(Gr,{className:"w-3 h-3"}),(0,fn.jsx)("span",{children:"Reply SMS"})]}),(null===(l=ke.extendedProps)||void 0===l||null===(o=l.lead)||void 0===o?void 0:o.email)&&(0,fn.jsxs)("button",{onClick:()=>{Ve("email"),Ue(!0)},className:"flex-1 flex items-center justify-center space-x-1 px-3 py-2 bg-indigo-500 text-white text-xs font-medium rounded-lg hover:bg-indigo-600 transition-colors",children:[(0,fn.jsx)(Wr,{className:"w-3 h-3"}),(0,fn.jsx)("span",{children:"Reply Email"})]})]})]})})()]})})]})})})(),(0,fn.jsx)("div",{className:"bg-gradient-to-r from-gray-50 to-slate-50 rounded-lg p-3",children:(0,fn.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,fn.jsx)("div",{className:"w-8 h-8 rounded-lg bg-gray-500 flex items-center justify-center flex-shrink-0",children:(0,fn.jsx)(Dr,{className:"h-4 w-4 text-white"})}),(0,fn.jsxs)("div",{className:"flex-1",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-1 cursor-pointer hover:bg-gray-100 -mx-2 px-2 py-1 rounded transition-colors",onClick:()=>!ts&&De(!Ae),children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,fn.jsx)("p",{className:"text-xs font-medium text-gray-600 uppercase tracking-wide",children:"Notes"}),!ts&&(Ae?(0,fn.jsx)(vr,{className:"h-4 w-4 text-gray-600"}):(0,fn.jsx)(fr,{className:"h-4 w-4 text-gray-600"}))]}),!ts&&(0,fn.jsxs)("button",{onClick:e=>{e.stopPropagation(),(()=>{var e,t;const s=(null===(e=ke.extendedProps)||void 0===e||null===(t=e.lead)||void 0===t?void 0:t.notes)||"";as(s),De(!0),ss(!0)})()},className:"text-sm text-blue-600 hover:text-blue-800 font-medium flex items-center space-x-1 hover:bg-blue-50 px-2 py-1 rounded transition-colors",children:[(0,fn.jsx)(Er,{className:"h-3 w-3"}),(0,fn.jsx)("span",{children:"Edit Notes"})]})]}),Ae&&(0,fn.jsx)(fn.Fragment,{children:ts?(0,fn.jsxs)("div",{className:"space-y-3",children:[(0,fn.jsxs)("div",{className:"relative",children:[(0,fn.jsx)("textarea",{value:ns,onChange:e=>as(e.target.value),rows:"6",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none break-words",placeholder:"Add detailed notes about this lead...",autoFocus:!0}),(0,fn.jsxs)("div",{className:"absolute bottom-2 right-2 text-xs text-gray-400",children:[ns.length," characters"]})]}),(0,fn.jsxs)("div",{className:"flex items-center justify-between",children:[(0,fn.jsx)("div",{className:"text-xs text-gray-500",children:"All users can edit notes \u2022 Changes appear in booking history"}),(0,fn.jsxs)("div",{className:"flex space-x-2",children:[(0,fn.jsx)("button",{onClick:async()=>{var e,t;if(null===ke||void 0===ke||!ke.id)return;const s=(null===(e=ke.extendedProps)||void 0===e||null===(t=e.lead)||void 0===t?void 0:t.notes)||"",n=ns.trim();if(s!==n){Ss(!0);try{const e=await gn.patch("/api/leads/".concat(ke.id,"/notes"),{notes:n,oldNotes:s});je(e=>e.map(e=>e.id===ke.id?He(He({},e),{},{extendedProps:He(He({},e.extendedProps),{},{lead:He(He({},e.extendedProps.lead),{},{notes:n})})}):e)),Se(e=>He(He({},e),{},{extendedProps:He(He({},e.extendedProps),{},{lead:He(He({},e.extendedProps.lead),{},{notes:n})})})),ss(!1);alert("Notes ".concat(s?"modified":"added"," successfully by ").concat(e.data.updatedBy,"!"))}catch(r){var a;console.error("Error updating notes:",r),403===(null===(a=r.response)||void 0===a?void 0:a.status)?alert("Access denied. You may not have permission to edit this lead."):alert("Failed to update notes. Please try again.")}finally{Ss(!1)}}else ss(!1)},disabled:ks,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 text-sm font-medium flex items-center space-x-1",children:ks?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),(0,fn.jsx)("span",{children:"Saving..."})]}):(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(gr,{className:"h-3 w-3"}),(0,fn.jsx)("span",{children:"Save Notes"})]})}),(0,fn.jsx)("button",{onClick:()=>{ss(!1),as("")},className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 text-sm font-medium",children:"Cancel"})]})]})]}):(0,fn.jsx)("div",{className:"mt-2",children:null!==(G=ke.extendedProps)&&void 0!==G&&null!==($=G.lead)&&void 0!==$&&$.notes?(0,fn.jsxs)("div",{className:"max-h-64 overflow-y-auto",children:[(0,fn.jsx)("p",{className:"text-base text-gray-900 leading-relaxed whitespace-pre-wrap break-words",children:ke.extendedProps.lead.notes}),(0,fn.jsx)("div",{className:"mt-2 text-xs text-gray-500",children:'Click "Edit Notes" to modify'})]}):(0,fn.jsxs)("div",{className:"text-center py-4",children:[(0,fn.jsx)("p",{className:"text-base text-gray-500 italic",children:"No notes available"}),(0,fn.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:'Click "Edit Notes" to add notes'})]})})})]})]})}),Zt&&(0,fn.jsxs)("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:[(0,fn.jsx)("h4",{className:"font-bold text-blue-700 mb-2",children:"Sale Details"}),(0,fn.jsxs)("div",{className:"text-sm text-blue-900",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("b",{children:"Amount:"})," \xa3",Zt.saleAmount]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("b",{children:"Payment Method:"})," ",Zt.paymentMethod]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("b",{children:"Notes:"})," ",Zt.notes||"None"]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("b",{children:"Recorded By:"})," ",null===(Q=Zt.user)||void 0===Q?void 0:Q.name]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("b",{children:"Date:"})," ",new Date(Zt.bookingDate).toLocaleDateString()]})]})]}),(null===(J=ke.extendedProps)||void 0===J||null===(X=J.lead)||void 0===X?void 0:X.bookingHistory)&&Array.isArray(ke.extendedProps.lead.bookingHistory)&&(()=>{const e=ke.extendedProps.lead.bookingHistory.filter(e=>["EMAIL_SENT","EMAIL_RECEIVED","SMS_SENT","SMS_RECEIVED"].includes(e.action));return 0===e.length?null:(0,fn.jsxs)("div",{className:"bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl p-4 mt-4",children:[(0,fn.jsx)("div",{className:"flex items-center justify-between mb-2 cursor-pointer hover:bg-blue-100/50 -mx-2 px-2 py-1 rounded transition-colors",onClick:()=>Fe(!Re),children:(0,fn.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,fn.jsx)("h4",{className:"text-base font-bold text-blue-700",children:"Message History"}),(0,fn.jsx)("span",{className:"text-xs text-blue-500 bg-blue-200/50 px-1.5 py-0.5 rounded-full",children:e.length}),Re?(0,fn.jsx)(vr,{className:"h-4 w-4 text-blue-700"}):(0,fn.jsx)(fr,{className:"h-4 w-4 text-blue-700"})]})}),Re&&(0,fn.jsx)("div",{className:"max-h-48 overflow-y-auto space-y-2",children:e.sort((e,t)=>new Date(t.timestamp)-new Date(e.timestamp)).map((e,t)=>{var s,n,a,r,l;return(0,fn.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,fn.jsx)("div",{className:"mt-0.5",children:e.action.startsWith("EMAIL")?(0,fn.jsx)(Wr,{className:"h-4 w-4 ".concat("EMAIL_RECEIVED"===e.action?"text-green-600":"text-indigo-500")}):(0,fn.jsx)(Gr,{className:"h-4 w-4 ".concat("SMS_RECEIVED"===e.action?"text-green-500":"text-blue-500")})}),(0,fn.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,fn.jsxs)("div",{className:"text-xs font-semibold text-gray-700",children:["EMAIL_SENT"===e.action&&"Email Sent","EMAIL_RECEIVED"===e.action&&"Email Received","SMS_SENT"===e.action&&"SMS Sent","SMS_RECEIVED"===e.action&&"SMS Received",(0,fn.jsx)("span",{className:"ml-2 text-gray-400 font-normal",children:new Date(e.timestamp).toLocaleString()})]}),(null===(s=e.details)||void 0===s?void 0:s.subject)&&(0,fn.jsxs)("div",{className:"text-xs text-gray-500 truncate",children:["Subject: ",e.details.subject]}),(0,fn.jsxs)("div",{className:"text-xs text-gray-600 truncate",children:[null===(n=e.details)||void 0===n||null===(a=n.body)||void 0===a?void 0:a.slice(0,100),((null===(r=e.details)||void 0===r||null===(l=r.body)||void 0===l?void 0:l.length)||0)>100?"...":""]})]})]},t)})})]})})()]})}),("admin"===(null===ge||void 0===ge?void 0:ge.role)||"viewer"===(null===ge||void 0===ge?void 0:ge.role)||"photographer"===(null===ge||void 0===ge?void 0:ge.role))&&(null===(Z=ke.extendedProps)||void 0===Z||null===(ee=Z.lead)||void 0===ee?void 0:ee.id)&&(0,fn.jsxs)("div",{className:"mt-6",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,fn.jsxs)("h4",{className:"text-sm font-bold text-gray-900 flex items-center",children:[(0,fn.jsx)(Fr,{className:"h-4 w-4 mr-2 text-indigo-600"}),"Client Photos",$s.length>0&&(0,fn.jsx)("span",{className:"ml-2 bg-indigo-100 text-indigo-700 text-xs px-2 py-0.5 rounded-full",children:$s.length})]}),("photographer"===(null===ge||void 0===ge?void 0:ge.role)||"admin"===(null===ge||void 0===ge?void 0:ge.role))&&(0,fn.jsxs)("button",{onClick:()=>cn(!on),className:"flex items-center space-x-1 px-3 py-1.5 rounded-lg text-xs font-medium transition-all ".concat(on?"bg-indigo-600 text-white":"bg-indigo-100 text-indigo-700 hover:bg-indigo-200"),children:[(0,fn.jsx)(pl,{className:"h-3.5 w-3.5"}),(0,fn.jsx)("span",{children:on?"Close":"Upload"})]})]}),on&&("photographer"===(null===ge||void 0===ge?void 0:ge.role)||"admin"===(null===ge||void 0===ge?void 0:ge.role))&&(0,fn.jsx)("div",{className:"mb-4",children:jn||dn?(0,fn.jsxs)("div",{children:[jn&&!dn&&(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-2 px-2",children:[(0,fn.jsxs)("span",{className:"text-sm text-gray-600",children:["Uploading to: ",(0,fn.jsxs)("span",{className:"font-semibold text-indigo-700",children:[null===(te=Cn.find(e=>e.id===jn))||void 0===te?void 0:te.icon," ",null===(se=Cn.find(e=>e.id===jn))||void 0===se?void 0:se.label]})]}),(0,fn.jsx)("button",{onClick:()=>Nn(null),className:"text-xs text-indigo-600 hover:text-indigo-800 font-medium",children:"Change"})]}),(0,fn.jsx)("div",{onDragEnter:Vn,onDragLeave:Vn,onDragOver:Vn,onDrop:e=>{e.preventDefault(),e.stopPropagation(),yn(!1),e.dataTransfer.files&&e.dataTransfer.files.length>0&&zn(e.dataTransfer.files)},className:"border-2 border-dashed rounded-lg p-6 text-center transition-all ".concat(bn?"border-indigo-500 bg-indigo-50":"border-gray-300 bg-gray-50 hover:border-indigo-400"),children:dn?(0,fn.jsxs)("div",{className:"space-y-3 py-2",children:[(0,fn.jsxs)("div",{className:"relative mx-auto w-12 h-12",children:[(0,fn.jsx)(pr,{className:"h-12 w-12 text-indigo-600"}),(0,fn.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,fn.jsx)("div",{className:"w-16 h-16 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin"})})]}),(0,fn.jsxs)("div",{className:"text-center",children:[(0,fn.jsxs)("p",{className:"text-lg font-semibold text-indigo-700",children:["Uploading ",pn.current," of ",pn.total]}),pn.currentFileName&&(0,fn.jsx)("p",{className:"text-xs text-gray-500 mt-1 font-mono",children:pn.currentFileName})]}),(0,fn.jsxs)("div",{className:"w-full",children:[(0,fn.jsxs)("div",{className:"flex justify-between text-xs text-gray-500 mb-1",children:[(0,fn.jsxs)("span",{children:[mn,"% complete"]}),(0,fn.jsxs)("span",{children:[pn.total-pn.current," remaining"]})]}),(0,fn.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-3 overflow-hidden",children:(0,fn.jsx)("div",{className:"h-full rounded-full transition-all duration-300 ease-out relative overflow-hidden",style:{width:"".concat(mn,"%"),background:"linear-gradient(90deg, #4F46E5, #7C3AED)"},children:(0,fn.jsx)("div",{className:"absolute inset-0 opacity-30",style:{backgroundImage:"linear-gradient(45deg, rgba(255,255,255,.15) 25%, transparent 25%, transparent 50%, rgba(255,255,255,.15) 50%, rgba(255,255,255,.15) 75%, transparent 75%, transparent)",backgroundSize:"1rem 1rem",animation:"progress-stripes 1s linear infinite"}})})})]}),(0,fn.jsx)("p",{className:"text-xs text-gray-400 text-center",children:"Please don't close this window"})]}):(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(pl,{className:"h-8 w-8 mx-auto text-gray-400 mb-2"}),(0,fn.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Drag & drop photos here"}),(0,fn.jsx)("p",{className:"text-xs text-gray-500 mb-3",children:"or click to select files"}),(0,fn.jsx)("input",{type:"file",ref:vn,multiple:!0,accept:"image/*,video/*",onChange:e=>zn(e.target.files),className:"hidden"}),(0,fn.jsx)("button",{onClick:()=>{var e;return null===(e=vn.current)||void 0===e?void 0:e.click()},className:"px-4 py-2 bg-indigo-600 text-white rounded-lg text-sm font-medium hover:bg-indigo-700 transition-colors",children:"Select Photos"})]})})]}):(0,fn.jsxs)("div",{className:"bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg p-4",children:[(0,fn.jsx)("h5",{className:"text-sm font-semibold text-gray-700 text-center mb-3",children:"Select Folder for Photos"}),(0,fn.jsx)("div",{className:"grid grid-cols-2 gap-2",children:Cn.map(e=>(0,fn.jsxs)("button",{onClick:()=>Nn(e.id),className:"flex items-center justify-center space-x-2 px-3 py-3 bg-white border-2 border-gray-200 rounded-lg hover:border-indigo-500 hover:bg-indigo-50 transition-all text-sm font-medium text-gray-700 hover:text-indigo-700",children:[(0,fn.jsx)("span",{className:"text-lg",children:e.icon}),(0,fn.jsx)("span",{children:e.label})]},e.id))})]})}),Xs?(0,fn.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 text-center",children:[(0,fn.jsx)("div",{className:"animate-spin h-6 w-6 border-2 border-indigo-500 border-t-transparent rounded-full mx-auto mb-2"}),(0,fn.jsx)("p",{className:"text-gray-500 text-sm",children:"Loading photos..."})]}):Ks>0||"all"!==kn?(0,fn.jsxs)("div",{className:"flex gap-3",children:[(0,fn.jsxs)("div",{className:"w-20 flex-shrink-0 space-y-1",children:[(0,fn.jsx)("button",{onClick:()=>Sn("all"),className:"w-full px-2 py-1.5 rounded-lg text-xs font-medium transition-all text-left ".concat("all"===kn?"bg-indigo-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"Full Shoot"}),Cn.map(e=>(0,fn.jsxs)("button",{onClick:()=>Sn(e.id),className:"w-full px-2 py-1.5 rounded-lg text-xs font-medium transition-all text-left ".concat(kn===e.id?"bg-indigo-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[(0,fn.jsx)("span",{className:"mr-1",children:e.icon}),(0,fn.jsx)("span",{className:"truncate",children:e.label})]},e.id))]}),(0,fn.jsx)("div",{className:"flex-1 min-w-0",children:$s.length>0?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)("div",{className:"grid grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2",children:$s.map(e=>{const t=e.cloudinary_secure_url||e.cloudinary_url;return(0,fn.jsxs)("div",{className:"relative group cursor-pointer rounded-lg overflow-hidden border-2 border-gray-200 hover:border-blue-400 transition-all bg-gray-100",style:{aspectRatio:"1"},onClick:()=>Gs(t),children:[(0,fn.jsx)(gc,{src:t,alt:e.description||"Client photo",size:"thumb",className:"w-full h-full object-cover",useBlur:!0,threshold:100,onError:e=>{e&&e.target&&e.target.style&&(e.target.style.opacity="0.3")}}),(0,fn.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-opacity flex items-center justify-center z-10 pointer-events-none",children:(0,fn.jsx)(Fr,{className:"h-6 w-6 text-white opacity-0 group-hover:opacity-100 transition-opacity"})}),("admin"===(null===ge||void 0===ge?void 0:ge.role)||"photographer"===(null===ge||void 0===ge?void 0:ge.role))&&(0,fn.jsx)("button",{onClick:t=>Wn(e.id,t),className:"absolute top-1 right-1 p-1.5 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity z-20 hover:bg-red-600 shadow-lg",title:"Delete photo",children:(0,fn.jsx)(cl,{className:"h-3 w-3"})})]},e.id)})}),en&&(0,fn.jsx)("div",{className:"mt-3 text-center",children:(0,fn.jsx)("button",{onClick:Un,disabled:an,className:"px-4 py-2 bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200 transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:an?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)("div",{className:"animate-spin h-4 w-4 border-2 border-indigo-500 border-t-transparent rounded-full inline-block mr-2"}),"Loading..."]}):"Load More Photos (".concat($s.length," loaded)")})})]}):(0,fn.jsxs)("div",{className:"bg-gray-100 rounded-lg p-4 text-center",children:[(0,fn.jsx)(Fr,{className:"h-6 w-6 mx-auto text-gray-300 mb-2"}),(0,fn.jsx)("p",{className:"text-gray-500 text-sm",children:"No photos in this folder"})]})})]}):(0,fn.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 text-center",children:[(0,fn.jsx)(Fr,{className:"h-8 w-8 mx-auto text-gray-300 mb-2"}),(0,fn.jsx)("p",{className:"text-gray-500 text-sm",children:"No photos uploaded yet"}),("photographer"===(null===ge||void 0===ge?void 0:ge.role)||"admin"===(null===ge||void 0===ge?void 0:ge.role))&&!on&&(0,fn.jsx)("button",{onClick:()=>cn(!0),className:"mt-2 text-indigo-600 text-sm hover:text-indigo-800",children:"Upload photos now"})]})]}),(0,fn.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-200 space-y-2",children:[("viewer"===(null===ge||void 0===ge?void 0:ge.role)||"admin"===(null===ge||void 0===ge?void 0:ge.role))&&$s.length>0&&(0,fn.jsxs)("div",{className:"flex space-x-2",children:[(0,fn.jsxs)("button",{onClick:()=>{Xt(!1),qt(!0)},className:"flex-1 flex items-center justify-center space-x-1 px-3 py-2 bg-gradient-to-r from-purple-500 to-indigo-500 text-white rounded-lg hover:from-purple-600 hover:to-indigo-600 transition-all duration-300 shadow text-xs font-medium",children:[(0,fn.jsx)(Fr,{className:"h-4 w-4"}),(0,fn.jsxs)("span",{children:["View Gallery (",Ks||$s.length,")"]})]}),(0,fn.jsxs)("button",{onClick:()=>{var e,t;const s=null===ke||void 0===ke||null===(e=ke.extendedProps)||void 0===e||null===(t=e.lead)||void 0===t?void 0:t.id,n="selectedPhotos_".concat(s),a=localStorage.getItem(n);let r=[];if(a)try{r=JSON.parse(a)}catch(ey){console.warn("Failed to parse saved photo selection:",ey)}Yt(r),$t([]),Kt(null),Xt(!0),qt(!0)},className:"flex-1 flex items-center justify-center space-x-1 px-3 py-2 bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-lg hover:from-green-600 hover:to-emerald-600 transition-all duration-300 shadow text-xs font-medium",children:[(0,fn.jsx)(xr,{className:"h-4 w-4"}),(0,fn.jsx)("span",{children:"Start Sale"})]})]}),(0,fn.jsxs)("div",{className:"flex space-x-2",children:["Cancelled"!==(null===(ne=ke.extendedProps)||void 0===ne?void 0:ne.status)&&(0,fn.jsxs)("button",{onClick:()=>(()=>{var e,t;if(!ke||null===(e=ke.extendedProps)||void 0===e||!e.lead)return void alert("No lead data available for this event.");const s=ke.extendedProps.lead.name||ke.title.split(" - ")[0];if(window.confirm("Are you sure you want to reschedule ".concat(s,"'s appointment?"))){if(console.log("\ud83d\udcc5 Starting reschedule for:",s),console.log("\ud83d\udcc5 Current template selected:",cs),console.log("\ud83d\udcc5 Available templates:",us.length),Et({_id:ke.extendedProps.lead.id,name:ke.extendedProps.lead.name||"",phone:ke.extendedProps.lead.phone||"",email:ke.extendedProps.lead.email||"",postcode:ke.extendedProps.lead.postcode||"",status:"Booked",notes:ke.extendedProps.lead.notes||"",image_url:ke.extendedProps.lead.image_url||"",isReschedule:!0}),Dn(),ls(!0),is(!0),!cs&&us.length>0&&(console.log("\u26a0\ufe0f No template selected, setting default template:",us[0].name),ds(us[0]._id)),mt(!0),ke.start){const e=new Date(ke.start);pt({dateStr:e.toISOString(),date:e})}console.log("\ud83d\udcc5 Reschedule modal opened - Template ID:",cs||(null===(t=us[0])||void 0===t?void 0:t._id))}})(),className:"flex-1 flex items-center justify-center space-x-1 px-3 py-2 bg-gradient-to-r from-orange-400 to-amber-400 text-white rounded-lg hover:from-orange-500 hover:to-amber-500 transition-all duration-300 shadow text-xs font-medium",children:[(0,fn.jsx)(wr,{className:"h-4 w-4"}),(0,fn.jsx)("span",{children:"Reschedule"})]}),"viewer"!==(null===ge||void 0===ge?void 0:ge.role)&&(0,fn.jsxs)("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),fe("/leads/".concat(ke.id))},className:"flex-1 flex items-center justify-center space-x-1 px-3 py-2 bg-gradient-to-r from-indigo-500 to-purple-500 text-white rounded-lg hover:from-indigo-600 hover:to-purple-600 transition-all duration-300 shadow text-xs font-medium",children:[(0,fn.jsx)(Tr,{className:"h-4 w-4"}),(0,fn.jsx)("span",{children:"View Lead Details"})]})]})]})]})]})}),Be&&(null===ke||void 0===ke||null===(ae=ke.extendedProps)||void 0===ae?void 0:ae.lead)&&(0,fn.jsx)(rd,{isOpen:Be,onClose:()=>Ue(!1),lead:ke.extendedProps.lead,initialChannel:ze}),Tt&&ke&&(null===(re=ke.extendedProps)||void 0===re?void 0:re.lead)&&(0,fn.jsx)(Ec,{isOpen:Tt,onClose:()=>Pt(!1),lead:ke.extendedProps.lead,existingSale:Zt,onSaveSuccess:()=>{Pt(!1),Dn(),alert(Zt?"Sale updated successfully!":"Sale recorded successfully!"),Qn("Attended"),On()}}),We&&ke&&(0,fn.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",children:(0,fn.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md mx-4 overflow-hidden",children:[(0,fn.jsxs)("div",{className:"bg-gradient-to-r from-purple-500 to-indigo-600 px-6 py-4",children:[(0,fn.jsxs)("h3",{className:"text-lg font-bold text-white flex items-center",children:[(0,fn.jsx)(hr,{className:"h-5 w-5 mr-2"}),"Schedule Review Appointment"]}),(0,fn.jsx)("p",{className:"text-purple-100 text-sm mt-1",children:"Keep the original slot and schedule a review date"})]}),(0,fn.jsxs)("div",{className:"p-6 space-y-4",children:[(0,fn.jsx)("div",{className:"bg-purple-50 rounded-lg p-3 border border-purple-100",children:(0,fn.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,fn.jsx)("span",{className:"font-semibold text-gray-800",children:"Original Booking:"})," ",null!==(le=ke.extendedProps)&&void 0!==le&&null!==(oe=le.lead)&&void 0!==oe&&oe.date_booked?new Date(ke.extendedProps.lead.date_booked).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short"}):"N/A"," ","at ",(null===(ie=ke.extendedProps)||void 0===ie||null===(ce=ie.lead)||void 0===ce?void 0:ce.time_booked)||"N/A"]})}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Review Date"}),(0,fn.jsx)("input",{type:"date",value:Ye,onChange:e=>{const t=e.target.value;Ge(t),Qe(""),t?ot(t):Je([])},className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",min:(new Date).toISOString().split("T")[0]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Review Time ",Xe&&(0,fn.jsx)("span",{className:"text-purple-500",children:"(Loading...)"})]}),(0,fn.jsxs)("select",{value:$e,onChange:e=>Qe(e.target.value),disabled:!Ye||Xe,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 disabled:bg-gray-100 disabled:cursor-not-allowed",children:[(0,fn.jsx)("option",{value:"",children:Ye?Xe?"Loading available slots...":0===Ke.length?"No available slots":"Select an available time":"Select a date first"}),Ke.map((e,t)=>(0,fn.jsxs)("option",{value:"".concat(e.time,"|").concat(e.slot),children:[e.label," ",1===e.slot?"(Slot 1)":"(Slot 2)"]},"".concat(e.time,"-").concat(e.slot,"-").concat(t)))]}),Ye&&!Xe&&0===Ke.length&&(0,fn.jsx)("p",{className:"text-sm text-red-500 mt-1",children:"No available slots on this date. Please select another date."}),Ye&&!Xe&&Ke.length>0&&(0,fn.jsxs)("p",{className:"text-sm text-green-600 mt-1",children:[Ke.length," slot(s) available"]})]})]}),(0,fn.jsxs)("div",{className:"px-6 py-4 bg-gray-50 border-t border-gray-100 flex justify-end space-x-3",children:[(0,fn.jsx)("button",{onClick:()=>{qe(!1),Ge(""),Qe(""),Je([])},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),(0,fn.jsx)("button",{onClick:async()=>{if(Ye&&$e)try{var e,t;const s=null===(e=ke.extendedProps)||void 0===e||null===(t=e.lead)||void 0===t?void 0:t.id,[n,a]=$e.split("|");await gn.put("/api/leads/".concat(s),He(He({},ke.extendedProps.lead),{},{review_date:Ye,review_time:n,review_slot:parseInt(a),booking_status:"Review"})),qe(!1),Ge(""),Qe(""),Je([]),Qn("Review"),alert("Review scheduled for ".concat(new Date(Ye).toLocaleDateString("en-GB")," at ").concat(n," (Slot ").concat(a,")"))}catch(s){console.error("Error scheduling review:",s),alert("Failed to schedule review. Please try again.")}else alert("Please select both a date and time for the review.")},disabled:!Ye||!$e||Xe,className:"px-4 py-2 text-sm font-medium text-white bg-gradient-to-r from-purple-500 to-indigo-600 rounded-lg hover:from-purple-600 hover:to-indigo-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:"Schedule Review"})]})]})}),At&&ke&&(null===(de=ke.extendedProps)||void 0===de?void 0:de.lead)&&(0,fn.jsx)(Bc,{isOpen:At,onClose:()=>{Dt(!1),0===Ht.length&&Kt(null)},lead:ke.extendedProps.lead,selectedPhotoCount:Ht.length,selectedPhotoIds:Ht,initialPackage:Qt,onTrimSelection:()=>{Dt(!1),Xt(!0),qt(!0)},onPackageSelected:e=>{Kt(e),Dt(!1),Xt(!0),qt(!0)},onChangeImages:e=>{Kt(e),Dt(!1),Xt(!0),qt(!0)},onSendContract:e=>{var t;Kt(e.package),Vt({subtotal:e.totals.subtotal,vatAmount:e.totals.vatAmount,total:e.totals.total}),Dt(!1),Ut(null===ke||void 0===ke||null===(t=ke.extendedProps)||void 0===t?void 0:t.lead),Ot(!0)}}),Wt&&(null===ke||void 0===ke||null===(ue=ke.extendedProps)||void 0===ue?void 0:ue.lead)&&(0,fn.jsx)(vc,{isOpen:Wt,onClose:()=>{qt(!1),Xt(!1)},photos:$s,leadId:ke.extendedProps.lead.id,leadName:ke.extendedProps.lead.name||"Client",initialSelectedIds:Ht,imageLimit:null!==(me=null===Qt||void 0===Qt?void 0:Qt.imageCount)&&void 0!==me?me:null===Qt||void 0===Qt?void 0:Qt.image_count,selectionMode:Jt,onDeletePhoto:"admin"===(null===ge||void 0===ge?void 0:ge.role)||"photographer"===(null===ge||void 0===ge?void 0:ge.role)?Wn:null,onProceedToPackage:(e,t)=>{var s,n;Yt(e),$t(t);const a=null===ke||void 0===ke||null===(s=ke.extendedProps)||void 0===s||null===(n=s.lead)||void 0===n?void 0:n.id;a&&e.length>0&&localStorage.setItem("selectedPhotos_".concat(a),JSON.stringify(e)),qt(!1),Dt(!0)}}),Lt&&Rt&&(0,fn.jsx)(Yc,{isOpen:Lt,onClose:()=>Mt(!1),invoice:Rt,lead:null===ke||void 0===ke||null===(he=ke.extendedProps)||void 0===he?void 0:he.lead,onPaymentRecorded:e=>{Ft(e)},onSignatureSaved:e=>{Ft(e)},onComplete:e=>{Ft(e),Mt(!1),Dn(),alert("Sale completed successfully!"),Qn("Attended"),On()}}),It&&Bt&&Qt&&(0,fn.jsx)(ad,{isOpen:It,onClose:()=>{Ot(!1),Ut(null),Vt(null)},lead:Bt,packageData:Qt,invoiceData:zt,selectedPhotoIds:Ht,onContractSent:e=>{console.log("Contract sent:",e);const t=null===Bt||void 0===Bt?void 0:Bt.id;t&&localStorage.removeItem("selectedPhotos_".concat(t))},onBackToPackages:()=>{Ot(!1),Ut(null),Vt(null),Dt(!0)},onBackToPhotos:()=>{Ot(!1),Ut(null),Vt(null),Xt(!0),qt(!0)}}),Us&&(0,fn.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50",children:(0,fn.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 w-96",children:[(0,fn.jsx)("h2",{className:"text-lg font-bold mb-4",children:"Reject Lead"}),(0,fn.jsx)("label",{className:"block mb-2 font-medium",children:"Reason:"}),(0,fn.jsxs)("select",{className:"w-full border rounded px-3 py-2 mb-4",value:Vs,onChange:e=>Ws(e.target.value),children:[(0,fn.jsx)("option",{value:"Duplicate",children:"Duplicate"}),(0,fn.jsx)("option",{value:"Already Booked",children:"Already Booked"}),(0,fn.jsx)("option",{value:"Far South",children:"Far South"}),(0,fn.jsx)("option",{value:"Photo",children:"Photo"}),(0,fn.jsx)("option",{value:"Not Interested",children:"Not Interested"}),(0,fn.jsx)("option",{value:"Wrong Number",children:"Wrong Number"}),(0,fn.jsx)("option",{value:"Other",children:"Other"})]}),(0,fn.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,fn.jsx)("button",{className:"px-4 py-2 bg-gray-300 rounded hover:bg-gray-400",onClick:()=>zs(!1),disabled:qs,children:"Cancel"}),(0,fn.jsx)("button",{className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",disabled:qs,onClick:async()=>{if(null!==ke&&void 0!==ke&&ke.id){Hs(!0);try{const e=await gn.patch("/api/leads/".concat(ke.id,"/reject"),{reason:Vs});if(e.data.success||e.data.lead){const e=ke.extendedProps.lead.name||ke.title.split(" - ")[0];je(e=>e.filter(e=>e.id!==ke.id)),Dn(),zs(!1),alert("\u274c Successfully rejected ".concat(e,'. The lead has been moved to "Rejected" status.')),setTimeout(()=>{On()},1500)}}catch(e){console.error("Error rejecting lead:",e),alert("Failed to reject lead. Please try again.")}finally{Hs(!1)}}},children:qs?"Rejecting...":"Confirm Reject"})]})]})}),Ys&&(0,fn.jsx)(zi,{src:Ys,alt:(null===ke||void 0===ke||null===(pe=ke.extendedProps)||void 0===pe||null===(xe=pe.lead)||void 0===xe?void 0:xe.name)||"Lead Photo",onClose:()=>Gs(null)})]});var ea,ta,sa,na,aa,ra,la,oa,ia},xd=()=>{const{user:e}=wn(),{socket:t}=Ga(),[s,n]=(0,a.useState)({leadsAssigned:0,totalBooked:0,attended:0,salesMade:0,totalRevenue:0,averageSale:0,bookingRate:0,showUpRate:0,salesConversionRate:0}),[r,l]=(0,a.useState)([]),[o,i]=(0,a.useState)([]),[c,d]=(0,a.useState)([]),[u,m]=(0,a.useState)(!1),[h,p]=(0,a.useState)(()=>{const t=(()=>{const e=new Date;return{startDate:e.toISOString().split("T")[0],endDate:e.toISOString().split("T")[0]}})();return{startDate:t.startDate,endDate:t.endDate,userId:"admin"===(null===e||void 0===e?void 0:e.role)?"all":(null===e||void 0===e?void 0:e.id)||""}}),[x,g]=(0,a.useState)([]),[f,b]=(0,a.useState)("daily"),[y,v]=(0,a.useState)(null),j=(0,a.useCallback)(async()=>{try{const e=await gn.get("/api/users");g([{id:"all",name:"All Users"},...e.data])}catch(e){console.error("Error fetching users:",e),g([{id:"all",name:"All Users"}])}},[]),w=(0,a.useCallback)(async()=>{m(!0);try{var e,t;const s=new Date(h.startDate);s.setHours(0,0,0,0);const a=new Date(h.endDate);a.setHours(23,59,59,999);const r=s.toISOString(),o=a.toISOString();console.log("\ud83d\udcca Reports fetching data with date range:",{startDate:h.startDate,endDate:h.endDate,startUTC:r,endUTC:o});const[c,u,m,p]=await Promise.all([gn.get("/api/users"),gn.get("/api/leads/public",{params:{created_at_start:r,created_at_end:o,limit:1e4}}),gn.get("/api/leads/public",{params:{booked_at_start:r,booked_at_end:o,limit:1e4}}),gn.get("/api/sales",{params:{startDate:r,endDate:o}}).catch(e=>(console.warn("Failed to fetch sales, using empty array:",e),{data:[]}))]),x=c.data||[],g=(null===(e=u.data)||void 0===e?void 0:e.leads)||[],f=(null===(t=m.data)||void 0===t?void 0:t.leads)||[],b=Array.isArray(p.data)?p.data:[],y=new Map;g.forEach(e=>{y.set(e.id,e)}),f.forEach(e=>{y.has(e.id)||y.set(e.id,e)});const j=Array.from(y.values()),w="all"===h.userId?j:j.filter(e=>e.created_by_user_id===h.userId),_="all"===h.userId?b:b.filter(e=>e.user_id===h.userId);console.log("\ud83d\udcca Reports raw data:",{users:x.length,createdLeads:g.length,bookedLeads:f.length,mergedLeads:j.length,filteredLeads:w.length,allSales:b.length,filteredSales:_.length,userFilter:h.userId,dateRange:{start:h.startDate,end:h.endDate},utcRange:{start:r,end:o}}),"all"!==h.userId&&(console.log("\ud83d\udd0d User filter active: ".concat(h.userId)),console.log("   Filtered leads: ".concat(w.length," (from ").concat(j.length," total)")),console.log("   Filtered sales: ".concat(_.length," (from ").concat(b.length," total)"))),g.length>0&&console.log("\ud83d\udcca Sample created lead:",{id:g[0].id,created_by_user_id:g[0].created_by_user_id,booker_id:g[0].booker_id,status:g[0].status}),f.length>0&&console.log("\ud83d\udcca Sample booked lead:",{id:f[0].id,created_by_user_id:f[0].created_by_user_id,booker_id:f[0].booker_id,status:f[0].status}),b.length>0&&console.log("\ud83d\udcca Sample sale:",{id:b[0].id,user_id:b[0].user_id,lead_id:b[0].lead_id});const E=N(w,_,x),T=k(w,_),P=S(w,_),A=C(_,j,x);n(E),l(T),i(P),d(A),v(new Date),console.log("\ud83d\udcca Reports processed data:",{kpis:E,dailyDays:T.length,monthlyWeeks:P.length,sales:A.length}),T.length>0&&(console.log("\ud83d\udcca Daily breakdown summary:"),T.slice(0,3).forEach(e=>{console.log("   ".concat(e.date,": Assigned=").concat(e.assigned,", Booked=").concat(e.booked,", Sales=").concat(e.sales))}),T.length>3&&console.log("   ... and ".concat(T.length-3," more days")))}catch(s){console.error("Error fetching report data:",s)}m(!1)},[h]);(0,a.useEffect)(()=>{"admin"===(null===e||void 0===e?void 0:e.role)&&j(),w()},[e,j,w]),(0,a.useEffect)(()=>{if(t){const e=e=>{console.log("\ud83d\udcca Reports: Real-time update received",e),w(),v(new Date)};return t.on("lead_created",e),t.on("lead_updated",e),t.on("lead_deleted",e),t.on("sale_created",e),t.on("sale_updated",e),t.on("stats_update_needed",e),()=>{t.off("lead_created",e),t.off("lead_updated",e),t.off("lead_deleted",e),t.off("sale_created",e),t.off("sale_updated",e),t.off("stats_update_needed",e)}}},[t,w]);const N=(e,t,s)=>{const n=e.filter(e=>e.created_at),a=e.filter(e=>e.ever_booked),r=e.filter(e=>{var t;return["attended","complete"].includes(null===(t=e.status)||void 0===t?void 0:t.toLowerCase())}),l=t.length,o=t.reduce((e,t)=>e+(t.amount||t.total_amount||0),0),i=l>0?o/l:0,c=n.length>0?Math.round(a.length/n.length*100):0,d=a.length>0?Math.round(r.length/a.length*100):0,u=r.length>0?Math.round(l/r.length*100):0;return{leadsAssigned:n.length,totalBooked:a.length,attended:r.length,salesMade:l,totalRevenue:o,averageSale:i,bookingRate:c,showUpRate:d,salesConversionRate:u}},k=(e,t)=>{const s={};console.log("\ud83d\udcca Calculating daily breakdown:"),console.log("   Leads:",e.length),console.log("   Sales:",t.length),e.forEach(e=>{if(e.created_at){const t=new Date(e.created_at).toISOString().split("T")[0];s[t]||(s[t]={date:t,dayName:new Date(t).toLocaleDateString("en-US",{weekday:"long"}),assigned:0,booked:0,sales:0,revenue:0}),s[t].assigned+=1}if(e.ever_booked){const t=e.booked_at?new Date(e.booked_at).toISOString().split("T")[0]:new Date(e.created_at).toISOString().split("T")[0];s[t]||(s[t]={date:t,dayName:new Date(t).toLocaleDateString("en-US",{weekday:"long"}),assigned:0,booked:0,sales:0,revenue:0}),s[t].booked+=1}});let n=0;t.forEach(e=>{if(e.created_at){const t=new Date(e.created_at).toISOString().split("T")[0];s[t]||(s[t]={date:t,dayName:new Date(t).toLocaleDateString("en-US",{weekday:"long"}),assigned:0,booked:0,sales:0,revenue:0}),s[t].sales+=1,s[t].revenue+=e.amount||e.total_amount||0,n+=1}}),console.log("   Sales processed for daily breakdown:",n);const a=Object.values(s).sort((e,t)=>new Date(e.date)-new Date(t.date));return console.log("\ud83d\udcca Daily breakdown result:",a.length,"days with data"),a},S=(e,t)=>{const s={};return e.forEach(e=>{if(e.created_at){var t;const n=new Date(e.created_at),a=new Date(n),r=n.getDay(),l=0===r?-6:1-r;a.setDate(n.getDate()+l),a.setHours(0,0,0,0);const o=new Date(a);o.setDate(a.getDate()+6),o.setHours(23,59,59,999);const i=a.toISOString().split("T")[0],c="Week ".concat(Math.ceil(a.getDate()/7));s[i]||(s[i]={weekNumber:i,weekLabel:c,weekStart:a.toISOString().split("T")[0],weekEnd:o.toISOString().split("T")[0],assigned:0,booked:0,attended:0,sales:0,revenue:0}),s[i].assigned+=1,["attended","complete"].includes(null===(t=e.status)||void 0===t?void 0:t.toLowerCase())&&e.booked_at&&(s[i].attended+=1)}if(e.ever_booked){const t=e.booked_at?new Date(e.booked_at):new Date(e.created_at),n=new Date(t),a=t.getDay(),r=0===a?-6:1-a;n.setDate(t.getDate()+r),n.setHours(0,0,0,0);const l=new Date(n);l.setDate(n.getDate()+6),l.setHours(23,59,59,999);const o=n.toISOString().split("T")[0],i="Week ".concat(Math.ceil(n.getDate()/7));s[o]||(s[o]={weekNumber:o,weekLabel:i,weekStart:n.toISOString().split("T")[0],weekEnd:l.toISOString().split("T")[0],assigned:0,booked:0,attended:0,sales:0,revenue:0}),s[o].booked+=1}}),t.forEach(e=>{if(e.created_at){const t=new Date(e.created_at),n=new Date(t),a=t.getDay(),r=0===a?-6:1-a;n.setDate(t.getDate()+r),n.setHours(0,0,0,0);const l=n.toISOString().split("T")[0];s[l]&&(s[l].sales+=1,s[l].revenue+=e.amount||e.total_amount||0)}}),Object.values(s).sort((e,t)=>new Date(e.weekStart)-new Date(t.weekStart))},C=(e,t,s)=>{const n=s.reduce((e,t)=>(e[t.id]=t,e),{}),a=t.reduce((e,t)=>(e[t.id]=t,e),{});return e.map(e=>{const t=a[e.lead_id],s=n[e.user_id];return{saleId:e.id,clientName:(null===t||void 0===t?void 0:t.name)||e.lead_name||"Unknown",phone:(null===t||void 0===t?void 0:t.phone)||e.lead_phone||"N/A",bookedDate:(null===t||void 0===t?void 0:t.booked_at)||(null===t||void 0===t?void 0:t.date_booked)||(null===t||void 0===t?void 0:t.created_at),saleDate:e.created_at,saleAmount:e.amount||e.total_amount||0,paymentMethod:e.payment_method||"N/A",user:(null===s||void 0===s?void 0:s.name)||"Unknown"}})},_=(e,t)=>{p(s=>He(He({},s),{},{[e]:t}))},E=e=>new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP"}).format(e);return(0,fn.jsxs)("div",{className:"space-y-6",children:[(0,fn.jsxs)("div",{className:"flex justify-between items-center",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"\ud83d\udcca KPI Reports & Analytics"}),(0,fn.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["Comprehensive booking, performance, and sales tracking",y&&(0,fn.jsxs)("span",{className:"ml-2 text-green-600",children:["\u2022 Updated ",y.toLocaleTimeString()]})]})]}),(0,fn.jsxs)("button",{onClick:()=>{var e;const t="\nCRM KPI Report\nGenerated: ".concat((new Date).toLocaleDateString(),"\nPeriod: ").concat(h.startDate," - ").concat(h.endDate,"\nUser: ").concat("all"===h.userId?"All Users":(null===(e=x.find(e=>e.id===h.userId))||void 0===e?void 0:e.name)||"Unknown","\n\nKEY PERFORMANCE INDICATORS:\n- Leads Assigned: ").concat(s.leadsAssigned,"\n- Total Bookings Made: ").concat(s.totalBooked,"\n- Attended: ").concat(s.attended,"\n- Sales Made: ").concat(s.salesMade,"\n- Total Revenue: \xa3").concat(s.totalRevenue.toFixed(2),"\n- Average Sale: \xa3").concat(s.averageSale.toFixed(2),"\n- Booking Rate: ").concat(s.bookingRate,"%\n- Show Up Rate: ").concat(s.showUpRate,"%\n- Sales Conversion: ").concat(s.salesConversionRate,"%\n\nDAILY BREAKDOWN:\n").concat(r.map(e=>"".concat(e.date," (").concat(e.dayName,"): Assigned: ").concat(e.assigned,", Booked: ").concat(e.booked,", Sales: ").concat(e.sales,", Revenue: \xa3").concat(e.revenue.toFixed(2))).join("\n"),"\n\nSALES DETAILS:\n").concat(c.map(e=>"".concat(e.clientName," - \xa3").concat(e.saleAmount.toFixed(2)," - ").concat(new Date(e.saleDate).toLocaleDateString())).join("\n"),"\n\nLast Updated: ").concat(y?y.toLocaleString():"Never","\n    "),n=new Blob([t],{type:"text/plain"}),a=URL.createObjectURL(n),l=document.createElement("a");l.href=a,l.download="kpi-report-".concat((new Date).toISOString().split("T")[0],".txt"),l.click(),URL.revokeObjectURL(a)},className:"btn-primary flex items-center space-x-2",children:[(0,fn.jsx)(Cr,{className:"h-4 w-4"}),(0,fn.jsx)("span",{children:"Export Report"})]})]}),(0,fn.jsxs)("div",{className:"card",children:[(0,fn.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Report Filters"}),(0,fn.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[(0,fn.jsx)(hr,{className:"inline h-4 w-4 mr-1"}),"Start Date"]}),(0,fn.jsx)("input",{type:"date",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:h.startDate,onChange:e=>_("startDate",e.target.value)})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[(0,fn.jsx)(hr,{className:"inline h-4 w-4 mr-1"}),"End Date"]}),(0,fn.jsx)("input",{type:"date",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:h.endDate,onChange:e=>_("endDate",e.target.value)})]}),"admin"===(null===e||void 0===e?void 0:e.role)&&(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[(0,fn.jsx)(gl,{className:"inline h-4 w-4 mr-1"}),"User"]}),(0,fn.jsx)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:h.userId,onChange:e=>_("userId",e.target.value),children:x.map(e=>(0,fn.jsx)("option",{value:e.id,children:e.name},e.id))})]}),(0,fn.jsx)("div",{className:"flex items-end",children:(0,fn.jsx)("button",{onClick:()=>{w()},disabled:u,className:"btn-primary w-full flex items-center justify-center space-x-2",children:u?(0,fn.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(el,{className:"h-4 w-4"}),(0,fn.jsx)("span",{children:"Generate Report"})]})})})]})]}),(0,fn.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,fn.jsxs)("div",{className:"card text-center bg-gradient-to-br from-blue-50 to-blue-100",children:[(0,fn.jsx)("div",{className:"flex items-center justify-center mb-2",children:(0,fn.jsx)(gl,{className:"h-8 w-8 text-blue-600"})}),(0,fn.jsx)("div",{className:"text-3xl font-bold text-blue-900",children:s.leadsAssigned}),(0,fn.jsx)("div",{className:"text-sm text-blue-700 font-medium mt-1",children:"Leads Assigned"})]}),(0,fn.jsxs)("div",{className:"card text-center bg-gradient-to-br from-green-50 to-green-100",children:[(0,fn.jsx)("div",{className:"flex items-center justify-center mb-2",children:(0,fn.jsx)(hr,{className:"h-8 w-8 text-green-600"})}),(0,fn.jsx)("div",{className:"text-3xl font-bold text-green-900",children:s.totalBooked}),(0,fn.jsx)("div",{className:"text-sm text-green-700 font-medium mt-1",children:"Total Bookings Made"})]}),(0,fn.jsxs)("div",{className:"card text-center bg-gradient-to-br from-purple-50 to-purple-100",children:[(0,fn.jsx)("div",{className:"flex items-center justify-center mb-2",children:(0,fn.jsx)(gr,{className:"h-8 w-8 text-purple-600"})}),(0,fn.jsx)("div",{className:"text-3xl font-bold text-purple-900",children:s.attended}),(0,fn.jsx)("div",{className:"text-sm text-purple-700 font-medium mt-1",children:"Attended"})]}),(0,fn.jsxs)("div",{className:"card text-center bg-gradient-to-br from-yellow-50 to-yellow-100",children:[(0,fn.jsx)("div",{className:"flex items-center justify-center mb-2",children:(0,fn.jsx)(Sr,{className:"h-8 w-8 text-yellow-600"})}),(0,fn.jsx)("div",{className:"text-3xl font-bold text-yellow-900",children:s.salesMade}),(0,fn.jsx)("div",{className:"text-sm text-yellow-700 font-medium mt-1",children:"Sales Made"})]}),(0,fn.jsxs)("div",{className:"card text-center bg-gradient-to-br from-red-50 to-red-100",children:[(0,fn.jsx)("div",{className:"flex items-center justify-center mb-2",children:(0,fn.jsx)(Sr,{className:"h-8 w-8 text-red-600"})}),(0,fn.jsx)("div",{className:"text-3xl font-bold text-red-900",children:E(s.totalRevenue)}),(0,fn.jsx)("div",{className:"text-sm text-red-700 font-medium mt-1",children:"Total Revenue"})]}),(0,fn.jsxs)("div",{className:"card text-center bg-gradient-to-br from-indigo-50 to-indigo-100",children:[(0,fn.jsx)("div",{className:"flex items-center justify-center mb-2",children:(0,fn.jsx)(il,{className:"h-8 w-8 text-indigo-600"})}),(0,fn.jsxs)("div",{className:"text-3xl font-bold text-indigo-900",children:[s.bookingRate,"%"]}),(0,fn.jsx)("div",{className:"text-sm text-indigo-700 font-medium mt-1",children:"Booking Rate"})]}),(0,fn.jsxs)("div",{className:"card text-center bg-gradient-to-br from-pink-50 to-pink-100",children:[(0,fn.jsx)("div",{className:"flex items-center justify-center mb-2",children:(0,fn.jsx)(gr,{className:"h-8 w-8 text-pink-600"})}),(0,fn.jsxs)("div",{className:"text-3xl font-bold text-pink-900",children:[s.showUpRate,"%"]}),(0,fn.jsx)("div",{className:"text-sm text-pink-700 font-medium mt-1",children:"Show Up Rate"})]}),(0,fn.jsxs)("div",{className:"card text-center bg-gradient-to-br from-teal-50 to-teal-100",children:[(0,fn.jsx)("div",{className:"flex items-center justify-center mb-2",children:(0,fn.jsx)(cr,{className:"h-8 w-8 text-teal-600"})}),(0,fn.jsxs)("div",{className:"text-3xl font-bold text-teal-900",children:[s.salesConversionRate,"%"]}),(0,fn.jsx)("div",{className:"text-sm text-teal-700 font-medium mt-1",children:"Sales Conversion"})]})]}),(0,fn.jsxs)("div",{className:"card",children:[(0,fn.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-6 flex items-center",children:[(0,fn.jsx)(dl,{className:"h-5 w-5 mr-2 text-blue-600"}),"Conversion Funnel"]}),(0,fn.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[{label:"Leads",value:s.leadsAssigned,color:"bg-blue-500",percentage:100},{label:"Booked",value:s.totalBooked,color:"bg-green-500",percentage:s.bookingRate},{label:"Attended",value:s.attended,color:"bg-purple-500",percentage:s.showUpRate},{label:"Sales",value:s.salesMade,color:"bg-yellow-500",percentage:s.salesConversionRate},{label:"Revenue",value:E(s.totalRevenue),color:"bg-red-500",percentage:100}].map((e,t)=>(0,fn.jsxs)("div",{className:"text-center",children:[(0,fn.jsxs)("div",{className:"".concat(e.color," rounded-lg p-4 text-white mb-2"),children:[(0,fn.jsx)("div",{className:"text-2xl font-bold",children:e.value}),(0,fn.jsx)("div",{className:"text-sm opacity-90",children:e.label})]}),t<4&&(0,fn.jsxs)("div",{className:"text-sm font-medium text-gray-600",children:[e.percentage,"% \u2192"]})]},e.label))})]}),(0,fn.jsxs)("div",{className:"flex space-x-2",children:[(0,fn.jsx)("button",{className:"px-4 py-2 rounded-lg font-semibold ".concat("daily"===f?"bg-blue-600 text-white":"bg-gray-100 text-gray-700"),onClick:()=>b("daily"),children:"Daily Breakdown"}),(0,fn.jsx)("button",{className:"px-4 py-2 rounded-lg font-semibold ".concat("monthly"===f?"bg-blue-600 text-white":"bg-gray-100 text-gray-700"),onClick:()=>b("monthly"),children:"Monthly Breakdown"})]}),"daily"===f&&(0,fn.jsxs)("div",{className:"card",children:[(0,fn.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Daily Breakdown"}),(0,fn.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"\ud83d\udccc Assigned = Leads created/assigned | Booked = Bookings made | Sales/Revenue = Total conversions"}),(0,fn.jsx)("div",{className:"overflow-x-auto",children:(0,fn.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,fn.jsx)("thead",{className:"bg-gray-50",children:(0,fn.jsxs)("tr",{children:[(0,fn.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Date"}),(0,fn.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Day"}),(0,fn.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Assigned"}),(0,fn.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Booked"}),(0,fn.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Sales"}),(0,fn.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Revenue"})]})}),(0,fn.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:r.map(e=>(0,fn.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.date}),(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-medium",children:e.dayName}),(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-blue-600 font-semibold",children:e.assigned}),(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-green-600 font-semibold",children:e.booked}),(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-yellow-600 font-semibold",children:e.sales}),(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-red-600 font-semibold",children:E(e.revenue)})]},e.date))})]})})]}),"monthly"===f&&(0,fn.jsxs)("div",{className:"card",children:[(0,fn.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Monthly/Weekly Breakdown"}),(0,fn.jsx)("div",{className:"overflow-x-auto",children:(0,fn.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,fn.jsx)("thead",{className:"bg-gray-50",children:(0,fn.jsxs)("tr",{children:[(0,fn.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Week"}),(0,fn.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Period"}),(0,fn.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Assigned"}),(0,fn.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Booked"}),(0,fn.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Attended"}),(0,fn.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Sales"}),(0,fn.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Revenue"})]})}),(0,fn.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:o.map(e=>(0,fn.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-medium",children:e.weekLabel}),(0,fn.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:[e.weekStart," to ",e.weekEnd]}),(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-blue-600 font-semibold",children:e.assigned}),(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-green-600 font-semibold",children:e.booked}),(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-purple-600 font-semibold",children:e.attended}),(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-yellow-600 font-semibold",children:e.sales}),(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-red-600 font-semibold",children:E(e.revenue)})]},e.weekNumber))})]})})]}),(0,fn.jsxs)("div",{className:"card",children:[(0,fn.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-6 flex items-center",children:[(0,fn.jsx)(Sr,{className:"h-5 w-5 mr-2 text-green-600"}),"Sales from Bookings"]}),(0,fn.jsx)("div",{className:"mb-4 p-4 bg-green-50 rounded-lg border border-green-200",children:(0,fn.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("div",{className:"text-sm text-green-700 font-medium",children:"Total Sales"}),(0,fn.jsx)("div",{className:"text-2xl font-bold text-green-900",children:c.length})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("div",{className:"text-sm text-green-700 font-medium",children:"Total Revenue"}),(0,fn.jsx)("div",{className:"text-2xl font-bold text-green-900",children:E(c.reduce((e,t)=>e+t.saleAmount,0))})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("div",{className:"text-sm text-green-700 font-medium",children:"Average Sale"}),(0,fn.jsx)("div",{className:"text-2xl font-bold text-green-900",children:E(c.length>0?c.reduce((e,t)=>e+t.saleAmount,0)/c.length:0)})]})]})}),c.length>0?(0,fn.jsx)("div",{className:"overflow-x-auto",children:(0,fn.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,fn.jsx)("thead",{className:"bg-gray-50",children:(0,fn.jsxs)("tr",{children:[(0,fn.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Client"}),(0,fn.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Phone"}),(0,fn.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Booked Date"}),(0,fn.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Sale Date"}),(0,fn.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Amount"}),(0,fn.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Payment"})]})}),(0,fn.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(e=>(0,fn.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-medium",children:e.clientName}),(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:e.phone}),(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:e.bookedDate?new Date(e.bookedDate).toLocaleDateString("en-GB"):"N/A"}),(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:new Date(e.saleDate).toLocaleDateString("en-GB")}),(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-green-600 font-bold",children:E(e.saleAmount)}),(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:e.paymentMethod})]},e.saleId))})]})}):(0,fn.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,fn.jsx)(Sr,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),(0,fn.jsx)("p",{children:"No sales data available for this period"})]})]})]})},gd=()=>{var e,t,s,n,r,l;const o=$(),i=K(),{user:c}=wn(),[d,u]=(0,a.useState)([]),[m,h]=(0,a.useState)(!0),[p,x]=(0,a.useState)(!1),[g,f]=(0,a.useState)(null),[b,y]=(0,a.useState)(!1),[v,j]=(0,a.useState)(null),[w,N]=(0,a.useState)([]),[k,S]=(0,a.useState)(""),[C,_]=(0,a.useState)([]),[E,T]=(0,a.useState)([]),P=(0,a.useRef)(null),A=(0,a.useRef)(null),D=(0,a.useRef)(null),L=(0,a.useRef)(null),[M,R]=(0,a.useState)({name:"",type:"admin"===(null===c||void 0===c?void 0:c.role)?"booking_confirmation":"custom",subject:"",emailBody:"",smsBody:"",reminderDays:5,sendEmail:!0,sendSMS:!0,isActive:!0,emailAccount:"",attachments:[]}),[F,I]=(0,a.useState)((null===(e=o.state)||void 0===e?void 0:e.category)||"All");(0,a.useEffect)(()=>{var e;null!==(e=o.state)&&void 0!==e&&e.category&&I(o.state.category)},[null===(t=o.state)||void 0===t?void 0:t.category]),(0,a.useEffect)(()=>{O(),U(),B(),"admin"===(null===c||void 0===c?void 0:c.role)&&z()},[c]),(0,a.useEffect)(()=>{p&&M.type&&U(M.type)},[M.type,p]);const O=async()=>{try{console.log("\ud83d\udd04 Fetching templates...");const e=await fetch("/api/templates",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache"},cache:"no-store"});if(e.ok){const t=await e.json();console.log("\ud83d\udce5 Fetched templates:",t.length,"templates"),u(t)}else console.error("\u274c Failed to fetch templates:",e.status,e.statusText)}catch(e){console.error("Error fetching templates:",e)}finally{h(!1)}},B=async()=>{try{const e=await fetch("/api/email-accounts/dropdown",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(e.ok){const t=await e.json();T(t)}}catch(e){console.error("Error fetching email accounts:",e)}},U=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{const t=e?"?type=".concat(e):"",s=await fetch("/api/templates/variables/list".concat(t),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(s.ok){const e=await s.json();_(e)}}catch(t){console.error("Error fetching variables:",t)}},z=async()=>{try{const e=await fetch("/api/leads?limit=100",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(e.ok){const t=await e.json();N(t.leads)}}catch(e){console.error("Error fetching leads:",e)}},V=()=>{R({name:"",type:"admin"===(null===c||void 0===c?void 0:c.role)?"booking_confirmation":"custom",subject:"",emailBody:"",smsBody:"",reminderDays:5,sendEmail:!0,sendSMS:!0,isActive:!0,emailAccount:"",attachments:[]})},W=(e,t)=>{L.current=t.current},q="admin"!==(null===c||void 0===c?void 0:c.role);return(0,fn.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,fn.jsxs)("div",{className:"max-w-7xl mx-auto p-6",children:[(0,fn.jsx)("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:(0,fn.jsxs)("div",{className:"flex justify-between items-center",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Message Templates"}),(0,fn.jsx)("p",{className:"text-gray-600 mt-2",children:"Manage email and SMS templates for automatic messaging"})]}),(0,fn.jsxs)("div",{className:"flex items-center gap-3",children:[(0,fn.jsxs)("button",{onClick:()=>i("/bookers-templates"),className:"bg-indigo-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-indigo-700",title:"Manage templates for Lead Details",children:[(0,fn.jsx)(Tr,{})," Bookers Templates"]}),(0,fn.jsxs)("button",{onClick:()=>{f(null),V(),x(!0)},className:"bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-blue-700",children:[(0,fn.jsx)(Zr,{})," New Template"]})]})]})}),m?(0,fn.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,fn.jsxs)("div",{className:"animate-pulse",children:[(0,fn.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/4 mb-4"}),(0,fn.jsxs)("div",{className:"space-y-3",children:[(0,fn.jsx)("div",{className:"h-4 bg-gray-200 rounded"}),(0,fn.jsx)("div",{className:"h-4 bg-gray-200 rounded w-5/6"})]})]})}):!m&&(()=>{let e=d||[];if(q){e=e.filter(e=>e.user_id===(null===c||void 0===c?void 0:c.id));const t=["booking_confirmation","reschedule","cancellation"];e=e.filter(e=>!t.includes(e.type))}const t=((e,t)=>{if(!e||!Array.isArray(e))return{"Diary Templates":[],"Sale Templates":[],"Lead Details Templates":[]};const s="admin"!==t,n={"Diary Templates":["booking_confirmation","reschedule","cancellation","secondary_confirmation"],"Bookers Templates":["no_answer","no_photo","invitation_email"],"Sale Templates":["sale_confirmation","sale_followup","sale","sale_notification","sale_paid_in_full","sale_followup_paid","sale_finance_agreement","sale_followup_finance","contract_signing","contract_delivery"],Receipts:["receipt","sale_receipt","payment_receipt"],"Lead Details Templates":["custom","booker"]},a={"Diary Templates":[],"Bookers Templates":[],"Sale Templates":[],Receipts:[],"Lead Details Templates":[]};return e.forEach(e=>{let t=!1;for(const[s,r]of Object.entries(n))if(r.includes(e.type)){a[s].push(e),t=!0;break}t||a["Diary Templates"].push(e)}),s&&(delete a["Diary Templates"],delete a["Bookers Templates"]),a})("All"===F?e:e.filter(e=>{const t=Object.entries({"Diary Templates":["booking_confirmation","reschedule","cancellation","secondary_confirmation"],"Bookers Templates":["no_answer","no_photo","invitation_email"],"Sale Templates":["sale_confirmation","sale_followup","sale","sale_notification","sale_paid_in_full","sale_followup_paid","sale_finance_agreement","sale_followup_finance","contract_signing","contract_delivery"],"Lead Details Templates":["custom","booker"]}).find(t=>{let[s,n]=t;return n.includes(e.type)});return t?t[0]===F:"Diary Templates"===F}),null===c||void 0===c?void 0:c.role);return Object.entries(t).map(e=>{let[t,s]=e;return s&&s.length>0&&(0,fn.jsxs)("div",{className:"mb-8",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,fn.jsx)("h2",{className:"text-xl font-bold",children:t}),"Lead Details Templates"===t&&(0,fn.jsxs)("button",{onClick:()=>i("/bookers-templates"),className:"text-sm text-indigo-600 hover:text-indigo-800 flex items-center gap-1 font-medium",children:[(0,fn.jsx)(Tr,{className:"h-4 w-4"}),"Manage in Bookers Templates"]})]}),(0,fn.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map(e=>{var s;return(0,fn.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,fn.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:e.name}),(0,fn.jsx)("p",{className:"text-sm text-gray-500 capitalize",children:e.type.replace("_"," ")}),(null===(s=e.creator)||void 0===s?void 0:s.name)&&"Bookers Templates"===t&&(0,fn.jsxs)("p",{className:"text-xs text-blue-600 mt-1",children:[(0,fn.jsx)("span",{className:"font-medium",children:"By:"})," ",e.creator.name]})]}),(0,fn.jsxs)("div",{className:"flex items-center gap-2",children:[e.sendEmail&&(0,fn.jsx)(Wr,{className:"text-blue-500"}),e.sendSMS&&(0,fn.jsx)(Jr,{className:"text-green-500"}),e.attachments&&(()=>{try{const t=JSON.parse(e.attachments);return Array.isArray(t)&&t.length>0&&(0,fn.jsxs)("div",{className:"flex items-center gap-1 text-purple-600",title:"".concat(t.length," attachment(s)"),children:[(0,fn.jsx)("span",{className:"text-xs",children:"\ud83d\udcce"}),(0,fn.jsx)("span",{className:"text-xs font-medium",children:t.length})]})}catch(ey){return null}})()]})]}),(0,fn.jsx)("div",{className:"mb-4",children:(0,fn.jsx)("p",{className:"text-sm text-gray-600 line-clamp-2",children:e.subject})}),(0,fn.jsxs)("div",{className:"flex items-center justify-between",children:[(0,fn.jsx)("div",{className:"flex items-center gap-2",children:(0,fn.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat(e.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.isActive?"Active":"Inactive"})}),(0,fn.jsxs)("div",{className:"flex items-center gap-2",children:[(0,fn.jsx)("button",{onClick:()=>(e=>{j({template:{name:e.name,type:e.type,subject:e.subject,emailBody:e.emailBody||e.email_body,smsBody:e.smsBody||e.sms_body,sendEmail:e.sendEmail||e.send_email,sendSMS:e.sendSMS||e.send_sms}}),y(!0)})(e),className:"p-2 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded",title:"Preview",children:(0,fn.jsx)(Ar,{})}),(0,fn.jsx)("button",{onClick:()=>(async e=>{f(e);let t=[];if(e._id)try{const s=await fetch("/api/templates/".concat(e._id),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(s.ok){const e=await s.json();if(e.attachments)try{t=JSON.parse(e.attachments)}catch(ey){console.warn("Failed to parse attachments:",ey)}}}catch(s){console.error("Error loading template attachments:",s)}R({name:e.name,type:e.type,subject:e.subject,emailBody:e.emailBody,smsBody:e.smsBody,reminderDays:e.reminderDays||5,sendEmail:e.sendEmail,sendSMS:e.sendSMS,isActive:e.isActive,emailAccount:e.email_account||e.emailAccount||"",attachments:Array.isArray(t)?t:[]}),x(!0)})(e),className:"p-2 text-gray-600 hover:text-green-600 hover:bg-green-50 rounded",title:"Edit",children:(0,fn.jsx)(Er,{})}),(0,fn.jsx)("button",{onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this template?"))try{const t=await fetch("/api/templates/".concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(t.ok)O();else{const e=await t.json();alert(e.message||"Error deleting template")}}catch(t){console.error("Error deleting template:",t),alert("Error deleting template")}})(e._id),className:"p-2 text-gray-600 hover:text-red-600 hover:bg-red-50 rounded",title:"Delete",children:(0,fn.jsx)(cl,{})})]})]}),"admin"===(null===c||void 0===c?void 0:c.role)&&(0,fn.jsx)("div",{className:"mt-4 pt-4 border-t",children:(0,fn.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,fn.jsxs)("select",{value:k,onChange:e=>S(e.target.value),className:"px-2 py-1 border border-gray-300 rounded text-xs max-w-xs w-48 focus:ring-1 focus:ring-purple-400",style:{minWidth:0},children:[(0,fn.jsx)("option",{value:"",children:"Select lead to test..."},"select-lead-placeholder"),(w||[]).map((e,t)=>(0,fn.jsxs)("option",{value:e.id,children:[e.name," (",e.email,")"]},"lead-".concat(e.id||t)))]}),(0,fn.jsxs)("button",{onClick:()=>(async e=>{if(k)try{const t=await fetch("/api/templates/".concat(e._id,"/test/").concat(k),{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(t.ok)alert("Test message sent successfully!");else{const e=await t.json();alert(e.message||"Error sending test message")}}catch(t){console.error("Error testing template:",t),alert("Error sending test message")}else alert("Please select a lead to test with")})(e),disabled:!k,className:"px-2 py-1 bg-purple-600 text-white rounded text-xs flex items-center gap-1 hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed",title:"Send test message",style:{minWidth:0},children:[(0,fn.jsx)(nl,{size:14})," Test"]})]})})]},"template-".concat(e._id))})})]},t)})})(),p&&(0,fn.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm overflow-y-auto h-full w-full z-50",children:(0,fn.jsxs)("div",{className:"relative top-5 mx-auto p-0 border-0 w-full max-w-6xl shadow-2xl rounded-2xl bg-white overflow-hidden",children:[(0,fn.jsx)("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6",children:(0,fn.jsxs)("div",{className:"flex justify-between items-center",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("h3",{className:"text-2xl font-bold",children:g?"Edit Template":"Create New Template"}),(0,fn.jsx)("p",{className:"text-blue-100 mt-1",children:g?"Update your message template":"Design beautiful messages for your CRM"})]}),(0,fn.jsx)("button",{onClick:()=>x(!1),className:"text-white hover:text-blue-200 p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-all",children:(0,fn.jsx)(jl,{className:"h-6 w-6"})})]})}),(0,fn.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{var t,s;const e=g?"/api/templates/".concat(g._id):"/api/templates",n=g?"PUT":"POST";console.log("\ud83d\udce4 Sending template data:",{url:e,method:n,templateId:null===g||void 0===g?void 0:g._id,formData:He(He({},M),{},{emailBody:(null===(t=M.emailBody)||void 0===t?void 0:t.substring(0,50))+"...",smsBody:(null===(s=M.smsBody)||void 0===s?void 0:s.substring(0,50))+"..."})});const a=await fetch(e,{method:n,headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify(M)});if(a.ok){const e=await a.json();console.log("\u2705 Template saved successfully. Response:",{id:e._id||e.id,name:e.name,type:e.type}),x(!1),f(null),V(),await O(),alert("Template saved successfully! Changes will be applied to future messages.")}else{const e=await a.json();console.error("\u274c Save failed:",e),alert(e.message||"Error saving template")}}catch(n){console.error("\u274c Error saving template:",n),alert("Error saving template")}},className:"p-6",children:[(0,fn.jsxs)("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-8",children:[(0,fn.jsx)("div",{className:"xl:col-span-1",children:(0,fn.jsxs)("div",{className:"bg-gray-50 rounded-xl p-6 h-fit",children:[(0,fn.jsxs)("h4",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[(0,fn.jsx)(al,{className:"text-blue-600"}),"Template Settings"]}),(0,fn.jsxs)("div",{className:"space-y-4",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:["Template Name ",(0,fn.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,fn.jsx)("input",{type:"text",name:"name",value:M.name,onChange:e=>R(He(He({},M),{},{name:e.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",placeholder:"Enter template name",required:!0})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:["Template Type ",(0,fn.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,fn.jsxs)("select",{name:"type",value:M.type,onChange:e=>R(He(He({},M),{},{type:e.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",required:!0,children:[!q&&(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)("option",{value:"booking_confirmation",children:"\ud83d\udcc5 Booking Confirmation"},"booking_confirmation"),(0,fn.jsx)("option",{value:"secondary_confirmation",children:"\ud83d\udccb Secondary Confirmation"},"secondary_confirmation"),(0,fn.jsx)("option",{value:"reschedule",children:"\ud83d\udd04 Reschedule"},"reschedule"),(0,fn.jsx)("option",{value:"cancellation",children:"\ud83d\udeab Cancellation"},"cancellation")]}),(0,fn.jsx)("option",{value:"sale_confirmation",children:"\ud83d\udcb0 Sale Confirmation"},"sale_confirmation"),(0,fn.jsx)("option",{value:"sale_followup",children:"\ud83d\udcde Sale Follow-up"},"sale_followup"),(0,fn.jsx)("option",{value:"sale_paid_in_full",children:"\ud83c\udf89 Paid in Full - Welcome"},"sale_paid_in_full"),(0,fn.jsx)("option",{value:"sale_followup_paid",children:"\u2705 Paid in Full - Follow-up"},"sale_followup_paid"),(0,fn.jsx)("option",{value:"sale_finance_agreement",children:"\ud83d\udccb Finance Agreement - Welcome"},"sale_finance_agreement"),(0,fn.jsx)("option",{value:"sale_followup_finance",children:"\ud83d\udcb3 Finance Agreement - Follow-up"},"sale_followup_finance"),(0,fn.jsx)("option",{value:"contract_signing",children:"\ud83d\udcdd Contract Signing"},"contract_signing"),(0,fn.jsx)("option",{value:"contract_delivery",children:"\ud83d\udce6 Contract Delivery (Photos + PDF)"},"contract_delivery"),(0,fn.jsx)("option",{value:"receipt",children:"\ud83e\uddfe Receipt"},"receipt"),(0,fn.jsx)("option",{value:"sale_receipt",children:"\ud83e\uddfe Sale Receipt"},"sale_receipt"),(0,fn.jsx)("option",{value:"payment_receipt",children:"\ud83e\uddfe Payment Receipt"},"payment_receipt"),(0,fn.jsx)("option",{value:"custom",children:"\ud83d\udcdd Custom Template"},"custom"),(0,fn.jsx)("option",{value:"booker",children:"\ud83d\udc64 Booker Template"},"booker")]})]}),(0,fn.jsxs)("div",{className:"space-y-3",children:[(0,fn.jsxs)("label",{className:"flex items-center justify-between p-3 bg-white rounded-lg border border-gray-200 hover:border-blue-300 transition-all",children:[(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)(Wr,{className:"text-blue-600 mr-3"}),(0,fn.jsx)("span",{className:"font-medium",children:"Send Email"})]}),(0,fn.jsx)("input",{type:"checkbox",checked:M.sendEmail,onChange:e=>R(He(He({},M),{},{sendEmail:e.target.checked})),className:"w-5 h-5 text-blue-600 rounded focus:ring-blue-500"})]}),(0,fn.jsxs)("label",{className:"flex items-center justify-between p-3 bg-white rounded-lg border border-gray-200 hover:border-blue-300 transition-all",children:[(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)(Jr,{className:"text-green-600 mr-3"}),(0,fn.jsx)("span",{className:"font-medium",children:"Send SMS"})]}),(0,fn.jsx)("input",{type:"checkbox",checked:M.sendSMS,onChange:e=>R(He(He({},M),{},{sendSMS:e.target.checked})),className:"w-5 h-5 text-green-600 rounded focus:ring-green-500"})]}),(0,fn.jsxs)("label",{className:"flex items-center justify-between p-3 bg-white rounded-lg border border-gray-200 hover:border-blue-300 transition-all",children:[(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("div",{className:"w-3 h-3 bg-green-500 rounded-full mr-3"}),(0,fn.jsx)("span",{className:"font-medium",children:"Active"})]}),(0,fn.jsx)("input",{type:"checkbox",checked:M.isActive,onChange:e=>R(He(He({},M),{},{isActive:e.target.checked})),className:"w-5 h-5 text-green-600 rounded focus:ring-green-500"})]}),M.sendEmail&&(0,fn.jsxs)("div",{className:"p-3 bg-white rounded-lg border border-gray-200",children:[(0,fn.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Email Account"}),(0,fn.jsxs)("select",{value:M.emailAccount,onChange:e=>R(He(He({},M),{},{emailAccount:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",children:[(0,fn.jsx)("option",{value:"",children:"\ud83d\udc64 Use User's Assigned Account (Recommended)"}),E.filter(e=>e.isEnvVar).length>0&&(0,fn.jsx)("optgroup",{label:"Email Accounts",children:E.filter(e=>e.isEnvVar).map(e=>(0,fn.jsxs)("option",{value:e.id,children:["\ud83d\udce7 ",e.name," (",e.email,")"]},e.id))}),E.filter(e=>!e.isEnvVar).length>0&&(0,fn.jsx)("optgroup",{label:"Database Accounts",children:E.filter(e=>!e.isEnvVar).map(e=>(0,fn.jsxs)("option",{value:e.id,children:["\ud83d\udce7 ",e.name," (",e.email,")",e.is_default?" \u2b50":""]},e.id))})]}),(0,fn.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:""===M.emailAccount?"Email will be sent from the account assigned to the user sending it":"Email will always be sent from the selected account"})]}),(0,fn.jsxs)("div",{className:"p-4 bg-white rounded-lg border border-gray-200",children:[(0,fn.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,fn.jsx)("div",{className:"w-4 h-4 bg-purple-500 rounded"}),(0,fn.jsx)("span",{className:"font-medium",children:"Email Attachments"}),(0,fn.jsxs)("span",{className:"text-xs bg-gray-100 px-2 py-1 rounded-full",children:[(Array.isArray(M.attachments)?M.attachments:[]).length," files"]})]}),(0,fn.jsxs)("div",{className:"mb-3",children:[(0,fn.jsx)("input",{type:"file",multiple:!0,accept:".pdf,.doc,.docx,.png,.jpg,.jpeg,.gif,.csv,.xlsx,.xls,.txt",onChange:async e=>{const t=Array.from(e.target.files||[]);if(0===t.length)return;const s=e.target.nextElementSibling;s&&(s.textContent="Uploading...");const n=[];for(const r of t)try{const e=new FormData;e.append("file",r);const t=await fetch("/api/templates/".concat((null===g||void 0===g?void 0:g._id)||"new","/attachments"),{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:e});if(t.ok){const e=await t.json();n.push(e)}else console.error("Upload failed for:",r.name)}catch(a){console.error("Upload error for:",r.name,a)}R(e=>He(He({},e),{},{attachments:Array.isArray(e.attachments)?[...e.attachments,...n]:n})),s&&(s.textContent="Choose Files"),e.target.value=""},className:"w-full text-sm file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 cursor-pointer",id:"attachment-upload"}),(0,fn.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:"Supported: PDF, Word, Images, CSV, Excel files (max 25MB per file)"})]}),(0,fn.jsxs)("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:[(Array.isArray(M.attachments)?M.attachments:[]).map((e,t)=>{var s,n,a,r,l,o,i;return(0,fn.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg border",children:[(0,fn.jsxs)("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[(0,fn.jsx)("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0",children:null!==(s=e.mimetype)&&void 0!==s&&s.includes("pdf")?"\ud83d\udcc4":null!==(n=e.mimetype)&&void 0!==n&&n.includes("word")||null!==(a=e.mimetype)&&void 0!==a&&a.includes("document")?"\ud83d\udcdd":null!==(r=e.mimetype)&&void 0!==r&&r.includes("image")?"\ud83d\uddbc\ufe0f":null!==(l=e.mimetype)&&void 0!==l&&l.includes("spreadsheet")||null!==(o=e.mimetype)&&void 0!==o&&o.includes("excel")?"\ud83d\udcca":"\ud83d\udcce"}),(0,fn.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,fn.jsx)("div",{className:"font-medium text-sm truncate",title:e.originalName||e.filename,children:e.originalName||e.filename}),(0,fn.jsxs)("div",{className:"text-xs text-gray-500 flex items-center gap-2",children:[(0,fn.jsx)("span",{children:e.size?"".concat((e.size/1024/1024).toFixed(1)," MB"):"Unknown size"}),e.mimetype&&(0,fn.jsx)("span",{className:"bg-gray-200 px-1 rounded text-xs",children:null===(i=e.mimetype.split("/")[1])||void 0===i?void 0:i.toUpperCase()})]})]})]}),(0,fn.jsxs)("div",{className:"flex items-center gap-2 flex-shrink-0",children:[(0,fn.jsx)("a",{href:e.url,target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:text-blue-800 text-xs font-medium",title:"Download/View",children:"View"}),(0,fn.jsx)("button",{type:"button",className:"text-red-600 hover:text-red-800 text-xs font-medium",onClick:()=>{window.confirm("Remove this attachment?")&&R(e=>He(He({},e),{},{attachments:(Array.isArray(e.attachments)?e.attachments:[]).filter((e,s)=>s!==t)}))},title:"Remove attachment",children:"Remove"})]})]},t)}),(!M.attachments||0===M.attachments.length)&&(0,fn.jsxs)("div",{className:"text-center py-6 text-gray-500",children:[(0,fn.jsx)("div",{className:"text-2xl mb-2",children:"\ud83d\udcce"}),(0,fn.jsx)("div",{className:"text-sm",children:"No attachments yet"}),(0,fn.jsx)("div",{className:"text-xs",children:"Files will be sent with every email"})]})]})]})]})]}),(0,fn.jsxs)("div",{className:"mt-6",children:[(0,fn.jsx)("h5",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Available Variables"}),(0,fn.jsx)("div",{className:"bg-white rounded-lg border border-gray-200 max-h-48 overflow-y-auto",children:(0,fn.jsx)("div",{className:"p-3",children:C.map(e=>(0,fn.jsxs)("button",{type:"button",onClick:()=>(e=>{let t=null,s=null;const n=document.activeElement;if(!n||"TEXTAREA"!==n.tagName&&"INPUT"!==n.tagName?L.current?(t=L.current,s=t.name):M.sendEmail&&P.current?(t=P.current,s="emailBody"):M.sendSMS&&A.current&&(t=A.current,s="smsBody"):(t=n,s=n.name),!t||!s)if(M.sendEmail&&P.current)P.current.focus(),t=P.current,s="emailBody";else{if(!M.sendSMS||!A.current)return void console.warn("No target field available for variable insertion");A.current.focus(),t=A.current,s="smsBody"}const a=t.selectionStart||0,r=t.selectionEnd||0,l=M[s]||"",o=l.substring(0,a)+e+l.substring(r);R(e=>He(He({},e),{},{[s]:o})),setTimeout(()=>{t.focus();const s=a+e.length;t.setSelectionRange(s,s)},0)})(e.name),className:"w-full text-left p-2 hover:bg-blue-50 rounded text-sm transition-all group",title:e.description,children:[(0,fn.jsx)("div",{className:"font-mono text-blue-600 group-hover:text-blue-700",children:e.name}),(0,fn.jsx)("div",{className:"text-gray-500 text-xs",children:e.description})]},"variable-".concat(e.name)))})})]})]})}),(0,fn.jsxs)("div",{className:"xl:col-span-2 space-y-6",children:[M.sendEmail&&(0,fn.jsxs)("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[(0,fn.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,fn.jsx)("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,fn.jsx)(Wr,{className:"text-blue-600"})}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Email Content"}),(0,fn.jsx)("p",{className:"text-sm text-gray-500",children:"Design your email message"})]})]}),(0,fn.jsxs)("div",{className:"space-y-4",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Subject Line"}),(0,fn.jsx)("input",{ref:D,name:"subject",type:"text",value:M.subject,onChange:e=>R(He(He({},M),{},{subject:e.target.value})),onFocus:()=>W(0,D),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",placeholder:"Enter email subject",required:!0})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Email Body"}),(0,fn.jsx)("textarea",{ref:P,name:"emailBody",value:M.emailBody,onChange:e=>R(He(He({},M),{},{emailBody:e.target.value})),onFocus:()=>W(0,P),rows:12,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-mono text-sm transition-all resize-none",placeholder:"Write your email content here...",required:!0})]})]})]}),M.sendSMS&&(0,fn.jsxs)("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[(0,fn.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,fn.jsx)("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center",children:(0,fn.jsx)(Jr,{className:"text-green-600"})}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"SMS Content"}),(0,fn.jsx)("p",{className:"text-sm text-gray-500",children:"Design your SMS message"})]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"SMS Message"}),(0,fn.jsx)("textarea",{ref:A,name:"smsBody",value:M.smsBody,onChange:e=>R(He(He({},M),{},{smsBody:e.target.value})),onFocus:()=>W(0,A),rows:6,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 font-mono text-sm transition-all resize-none",placeholder:"Write your SMS content here...",required:!0}),(0,fn.jsxs)("div",{className:"flex justify-between items-center mt-2",children:[(0,fn.jsxs)("p",{className:"text-xs text-gray-500",children:["Character count: ",(0,fn.jsxs)("span",{className:"font-semibold ".concat((M.smsBody||"").length>160?"text-red-500":"text-green-600"),children:[(M.smsBody||"").length,"/160"]})]}),(0,fn.jsxs)("div",{className:"text-xs text-gray-400",children:[Math.ceil((M.smsBody||"").length/160)," message(s)"]})]})]})]}),(M.emailBody||M.smsBody)&&(0,fn.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-xl p-6",children:[(0,fn.jsx)("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Live Preview"}),(0,fn.jsxs)("div",{className:"space-y-4",children:[M.emailBody&&(0,fn.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[(0,fn.jsxs)("div",{className:"text-sm font-semibold text-gray-600 p-3 bg-gray-50 border-b flex items-center justify-between",children:[(0,fn.jsx)("span",{children:"Email Preview:"}),(0,fn.jsx)("span",{className:"text-xs text-gray-400",children:"Rendered HTML"})]}),M.emailBody.includes("<")&&M.emailBody.includes(">")?(0,fn.jsx)("div",{className:"p-4",children:(0,fn.jsx)("iframe",{title:"Email Preview",srcDoc:M.emailBody,className:"w-full border-0 rounded",style:{minHeight:"400px",maxHeight:"600px"},sandbox:"allow-same-origin"})}):(0,fn.jsx)("div",{className:"p-4 text-sm text-gray-800 whitespace-pre-wrap",children:M.emailBody})]}),M.smsBody&&(0,fn.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[(0,fn.jsx)("div",{className:"text-sm font-semibold text-gray-600 p-3 bg-gray-50 border-b",children:"SMS Preview:"}),(0,fn.jsx)("div",{className:"p-4",children:(0,fn.jsx)("div",{className:"max-w-xs mx-auto bg-gray-100 rounded-2xl p-4",children:(0,fn.jsx)("div",{className:"bg-green-500 text-white rounded-2xl rounded-br-sm p-3 text-sm",children:M.smsBody})})})]})]})]})]})]}),(0,fn.jsxs)("div",{className:"mt-8 flex justify-end gap-4 pt-6 border-t border-gray-200",children:[(0,fn.jsx)("button",{type:"button",onClick:()=>x(!1),className:"px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-all font-medium",children:"Cancel"}),(0,fn.jsxs)("button",{type:"submit",className:"px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all font-medium flex items-center gap-2 shadow-lg",children:[(0,fn.jsx)(tl,{className:"w-4 h-4"}),g?"Update Template":"Create Template"]})]})]})]})}),b&&v&&(0,fn.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:(0,fn.jsxs)("div",{className:"bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden shadow-2xl",children:[(0,fn.jsx)("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6",children:(0,fn.jsxs)("div",{className:"flex justify-between items-center",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("h2",{className:"text-2xl font-bold",children:"Template Preview"}),(0,fn.jsxs)("p",{className:"text-blue-100 mt-1",children:[v.template.name," - ",null===(s=v.template.type)||void 0===s?void 0:s.replace("_"," ")]})]}),(0,fn.jsx)("button",{onClick:()=>y(!1),className:"text-white hover:text-blue-200 p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-all",children:(0,fn.jsx)(jl,{className:"h-6 w-6"})})]})}),(0,fn.jsx)("div",{className:"p-6 overflow-y-auto",style:{maxHeight:"calc(90vh - 100px)"},children:(0,fn.jsxs)("div",{className:"space-y-6",children:[!1!==v.template.sendEmail&&v.template.emailBody&&(0,fn.jsxs)("div",{className:"border border-gray-200 rounded-xl overflow-hidden",children:[(0,fn.jsxs)("div",{className:"bg-gray-50 px-4 py-3 border-b flex items-center gap-2",children:[(0,fn.jsx)(Wr,{className:"text-blue-600"}),(0,fn.jsx)("span",{className:"font-semibold text-gray-700",children:"Email Preview"})]}),(0,fn.jsxs)("div",{className:"px-4 py-3 bg-gray-50 border-b",children:[(0,fn.jsx)("span",{className:"text-sm text-gray-500",children:"Subject:"}),(0,fn.jsx)("span",{className:"ml-2 font-medium",children:v.template.subject||"(No subject)"})]}),(0,fn.jsx)("div",{className:"p-4 bg-white",children:null!==(n=v.template.emailBody)&&void 0!==n&&n.includes("<")&&null!==(r=v.template.emailBody)&&void 0!==r&&r.includes(">")?(0,fn.jsx)("iframe",{title:"Email Preview",srcDoc:v.template.emailBody,className:"w-full border border-gray-200 rounded-lg",style:{minHeight:"400px",maxHeight:"500px"},sandbox:"allow-same-origin"}):(0,fn.jsx)("div",{className:"whitespace-pre-wrap text-sm text-gray-800 p-4 bg-gray-50 rounded-lg",children:v.template.emailBody||"(No email content)"})})]}),!1!==v.template.sendSMS&&v.template.smsBody&&(0,fn.jsxs)("div",{className:"border border-gray-200 rounded-xl overflow-hidden",children:[(0,fn.jsxs)("div",{className:"bg-gray-50 px-4 py-3 border-b flex items-center gap-2",children:[(0,fn.jsx)(Jr,{className:"text-green-600"}),(0,fn.jsx)("span",{className:"font-semibold text-gray-700",children:"SMS Preview"}),(0,fn.jsxs)("span",{className:"ml-auto text-xs text-gray-400",children:[(null===(l=v.template.smsBody)||void 0===l?void 0:l.length)||0," characters"]})]}),(0,fn.jsx)("div",{className:"p-6 bg-gradient-to-b from-gray-100 to-gray-200 flex justify-center",children:(0,fn.jsxs)("div",{className:"w-72 bg-white rounded-3xl shadow-xl overflow-hidden border-4 border-gray-800",children:[(0,fn.jsx)("div",{className:"bg-gray-800 h-6 flex justify-center items-end pb-1",children:(0,fn.jsx)("div",{className:"w-20 h-4 bg-black rounded-b-xl"})}),(0,fn.jsxs)("div",{className:"p-4 min-h-[200px] bg-gray-50",children:[(0,fn.jsx)("div",{className:"text-xs text-gray-400 text-center mb-3",children:"Edge Talent"}),(0,fn.jsx)("div",{className:"bg-green-500 text-white rounded-2xl rounded-bl-sm p-3 text-sm shadow-md",children:v.template.smsBody||"(No SMS content)"}),(0,fn.jsx)("div",{className:"text-xs text-gray-400 text-right mt-1",children:"Just now"})]}),(0,fn.jsx)("div",{className:"bg-white h-8 flex justify-center items-center",children:(0,fn.jsx)("div",{className:"w-24 h-1 bg-gray-300 rounded-full"})})]})})]}),!v.template.emailBody&&!v.template.smsBody&&(0,fn.jsxs)("div",{className:"text-center py-12 text-gray-500",children:[(0,fn.jsx)("div",{className:"text-4xl mb-3",children:"\ud83d\udced"}),(0,fn.jsx)("p",{children:"This template has no content yet."})]})]})})]})})]})})},fd=()=>{const{user:e}=wn(),t=K(),[s,n]=(0,a.useState)([]),[r,l]=(0,a.useState)(!0),[o,i]=(0,a.useState)(!1),[c,d]=(0,a.useState)(null),[u,m]=(0,a.useState)(!1),[h,p]=(0,a.useState)(null),[x,g]=(0,a.useState)([]),[f,b]=(0,a.useState)([]),[y,v]=(0,a.useState)({name:"",type:"no_answer",subject:"",emailBody:"",smsBody:"",reminderDays:5,sendEmail:!0,sendSMS:!1,isActive:!0,emailAccount:""});(0,a.useEffect)(()=>{j(),w(),N()},[e]);const j=async()=>{try{const t="admin"===(null===e||void 0===e?void 0:e.role)?"/api/templates":"/api/templates?bookersOnly=true",s=await fetch(t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(s.ok){const t=await s.json(),a="admin"===(null===e||void 0===e?void 0:e.role)?["no_answer","no_photo","invitation_email","custom","booker"]:["no_answer","no_photo","invitation_email"];n(t.filter(e=>a.includes(e.type)))}}catch(t){console.error("Error fetching templates:",t)}finally{l(!1)}},w=async()=>{try{const e=await fetch("/api/templates/variables/list",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(e.ok){const t=await e.json();g(t)}}catch(e){console.error("Error fetching variables:",e)}},N=async()=>{try{const e=await fetch("/api/email-accounts/dropdown",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(e.ok){const t=await e.json();b(t)}}catch(e){console.error("Error fetching email accounts:",e)}},k=()=>{v({name:"",type:"no_answer",subject:"",emailBody:"",smsBody:"",reminderDays:5,sendEmail:!0,sendSMS:!1,isActive:!0,emailAccount:""})};return(0,fn.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,fn.jsxs)("div",{className:"max-w-7xl mx-auto p-6",children:[(0,fn.jsx)("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:(0,fn.jsxs)("div",{className:"flex justify-between items-center",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Booker Templates"}),(0,fn.jsx)("p",{className:"text-gray-600 mt-2",children:"admin"===(null===e||void 0===e?void 0:e.role)?"View and manage all bookers' templates":"Create and manage your personal templates"}),(0,fn.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:[(0,fn.jsx)("span",{className:"font-medium",children:"No Answer:"}),' Triggered when status = "No answer" |',(0,fn.jsx)("span",{className:"font-medium ml-2",children:"No Photo:"}),' Triggered when status = "No photo" |',(0,fn.jsx)("span",{className:"font-medium ml-2",children:"Invitation Email:"})," Quick button in messages"]})]}),(0,fn.jsxs)("div",{className:"flex items-center gap-3",children:[(0,fn.jsxs)("button",{onClick:()=>t("/templates"),className:"flex items-center gap-2 px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 shadow",title:"View all other templates (Diary, Retargeting, Sale)",children:[(0,fn.jsx)(Tr,{})," All Templates"]}),(0,fn.jsxs)("button",{onClick:()=>{d(null),k(),i(!0)},className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 shadow",children:[(0,fn.jsx)(Zr,{})," New Template"]})]})]})}),(0,fn.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r?(0,fn.jsx)("div",{children:"Loading..."}):0===s.length?(0,fn.jsxs)("div",{className:"col-span-full text-center py-12",children:[(0,fn.jsx)("div",{className:"text-gray-400 text-5xl mb-4",children:"\ud83d\udcdd"}),(0,fn.jsx)("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"No templates yet"}),(0,fn.jsx)("p",{className:"text-gray-500",children:"Create your first template to get started!"})]}):s.map(t=>{var s;return(0,fn.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 flex flex-col gap-4",children:[(0,fn.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[t.sendEmail&&(0,fn.jsx)(Wr,{className:"text-blue-500",title:"Email"}),t.sendSMS&&(0,fn.jsx)(Jr,{className:"text-green-500",title:"SMS"}),(0,fn.jsx)("span",{className:"text-lg font-semibold",children:t.name})]}),"admin"===(null===e||void 0===e?void 0:e.role)&&(null===(s=t.creator)||void 0===s?void 0:s.name)&&(0,fn.jsxs)("div",{className:"text-xs text-blue-600 -mt-2",children:[(0,fn.jsx)("span",{className:"font-medium",children:"By:"})," ",t.creator.name]}),(0,fn.jsx)("div",{className:"text-gray-700 text-sm line-clamp-3",children:t.smsBody||t.emailBody}),(0,fn.jsxs)("div",{className:"flex gap-2 mt-auto",children:[(0,fn.jsx)("button",{onClick:()=>(e=>{p(e),m(!0)})(t),className:"p-2 hover:bg-gray-100 rounded",title:"Preview",children:(0,fn.jsx)(Ar,{})}),(0,fn.jsx)("button",{onClick:()=>(e=>{d(e),v({name:e.name,type:e.type,subject:e.subject,emailBody:e.emailBody,smsBody:e.smsBody,reminderDays:e.reminderDays||5,sendEmail:e.sendEmail,sendSMS:e.sendSMS,isActive:e.isActive,emailAccount:e.email_account||e.emailAccount||""}),i(!0)})(t),className:"p-2 hover:bg-gray-100 rounded",title:"Edit",children:(0,fn.jsx)(Er,{})}),(0,fn.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this template?"))try{const t=await fetch("/api/templates/".concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(t.ok)j();else{const e=await t.json();alert(e.message||"Error deleting template")}}catch(t){console.error("Error deleting template:",t),alert("Error deleting template")}})(t._id),className:"p-2 hover:bg-gray-100 rounded text-red-600",title:"Delete",children:(0,fn.jsx)(cl,{})})]})]},t._id)})}),o&&(0,fn.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,fn.jsxs)("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[(0,fn.jsx)("div",{className:"p-6 border-b",children:(0,fn.jsxs)("div",{className:"flex justify-between items-center",children:[(0,fn.jsx)("h2",{className:"text-2xl font-bold",children:c?"Edit Your Template":"Create New Template"}),(0,fn.jsx)("button",{onClick:()=>i(!1),className:"p-2 hover:bg-gray-100 rounded",children:(0,fn.jsx)(jl,{})})]})}),(0,fn.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{const e=c?"/api/templates/".concat(c._id||c.id):"/api/templates",t=c?"PUT":"POST",s=y.type&&["no_answer","no_photo","invitation_email"].includes(y.type)?y.type:"no_answer",n=await fetch(e,{method:t,headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify(He(He({},y),{},{type:s}))});if(n.ok)alert("Template saved successfully!"),i(!1),d(null),k(),j();else{const e=await n.json();alert(e.message||"Error saving template")}}catch(t){console.error("Error saving template:",t),alert("Error saving template")}},className:"p-6",children:[(0,fn.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,fn.jsxs)("div",{className:"space-y-4",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Template Name"}),(0,fn.jsx)("input",{type:"text",value:y.name,onChange:e=>v(He(He({},y),{},{name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Template Type"}),(0,fn.jsxs)("select",{value:y.type,onChange:e=>v(He(He({},y),{},{type:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,children:[(0,fn.jsx)("option",{value:"no_answer",children:"\ud83d\udcde No Answer (Auto-triggered when status = No answer)"}),(0,fn.jsx)("option",{value:"no_photo",children:"\ud83d\udcf7 No Photo (Auto-triggered when status = No photo)"}),(0,fn.jsx)("option",{value:"invitation_email",children:"\ud83d\udce7 Invitation Email (Quick button in messages)"})]}),(0,fn.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"no_answer"===y.type?'This template triggers with confirmation when you change a lead status to "No answer"':"no_photo"===y.type?'This template triggers with confirmation when you change a lead status to "No photo"':"This template appears as a quick button in the Lead Details message section"})]}),(0,fn.jsxs)("div",{className:"flex items-center gap-4",children:[(0,fn.jsxs)("label",{className:"flex items-center",children:[(0,fn.jsx)("input",{type:"checkbox",checked:y.sendEmail,onChange:e=>v(He(He({},y),{},{sendEmail:e.target.checked})),className:"mr-2"}),(0,fn.jsx)("span",{className:"text-sm",children:"Send Email"})]}),(0,fn.jsxs)("label",{className:"flex items-center",children:[(0,fn.jsx)("input",{type:"checkbox",checked:y.sendSMS,onChange:e=>v(He(He({},y),{},{sendSMS:e.target.checked})),className:"mr-2"}),(0,fn.jsx)("span",{className:"text-sm",children:"Send SMS"})]}),(0,fn.jsxs)("label",{className:"flex items-center",children:[(0,fn.jsx)("input",{type:"checkbox",checked:y.isActive,onChange:e=>v(He(He({},y),{},{isActive:e.target.checked})),className:"mr-2"}),(0,fn.jsx)("span",{className:"text-sm",children:"Active"})]})]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Available Variables"}),(0,fn.jsx)("div",{className:"bg-gray-50 p-4 rounded-lg max-h-60 overflow-y-auto",children:(0,fn.jsx)("div",{className:"grid grid-cols-1 gap-2",children:x.map(e=>(0,fn.jsxs)("button",{type:"button",onClick:()=>(e=>{const t=document.activeElement;if(t&&"TEXTAREA"===t.tagName){const s=t.selectionStart,n=t.selectionEnd,a=t.value,r=a.substring(0,s)+"{{".concat(e,"}}")+a.substring(n),l=t.name;v(e=>He(He({},e),{},{[l]:r})),setTimeout(()=>{t.value=r,t.setSelectionRange(s+e.length+4,s+e.length+4),t.focus();const n=new Event("input",{bubbles:!0});t.dispatchEvent(n)},0)}else v(t=>He(He({},t),{},{smsBody:t.smsBody+"{{".concat(e,"}}"),emailBody:t.emailBody+"{{".concat(e,"}}")}))})(e.name),className:"text-left p-2 hover:bg-gray-100 rounded text-sm",title:e.description,children:[(0,fn.jsx)("div",{className:"font-mono text-blue-600",children:e.name}),(0,fn.jsx)("div",{className:"text-gray-600 text-xs",children:e.description})]},e.name))})})]})]}),y.sendEmail&&(0,fn.jsxs)("div",{className:"mt-6 space-y-4",children:[(0,fn.jsxs)("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[(0,fn.jsx)(Wr,{})," Email Content"]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Subject Line"}),(0,fn.jsx)("input",{type:"text",value:y.subject,onChange:e=>v(He(He({},y),{},{subject:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Body"}),(0,fn.jsx)("textarea",{name:"emailBody",value:y.emailBody,onChange:e=>v(He(He({},y),{},{emailBody:e.target.value})),rows:8,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-mono text-sm",required:!0})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Send From Email Account"}),(0,fn.jsxs)("select",{value:y.emailAccount,onChange:e=>v(He(He({},y),{},{emailAccount:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",children:[(0,fn.jsx)("option",{value:"",children:"\ud83d\udc64 Use User's Assigned Account (Recommended)"}),f.filter(e=>e.isEnvVar).length>0&&(0,fn.jsx)("optgroup",{label:"Email Accounts",children:f.filter(e=>e.isEnvVar).map(e=>(0,fn.jsxs)("option",{value:e.id,children:["\ud83d\udce7 ",e.name," (",e.email,")"]},e.id))}),f.filter(e=>!e.isEnvVar).length>0&&(0,fn.jsx)("optgroup",{label:"Database Accounts",children:f.filter(e=>!e.isEnvVar).map(e=>(0,fn.jsxs)("option",{value:e.id,children:["\ud83d\udce7 ",e.name," (",e.email,")",e.is_default?" \u2b50":""]},e.id))})]}),(0,fn.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:""===y.emailAccount?"Email will be sent from the account assigned to the user sending it":"Email will always be sent from the selected account"})]})]}),y.sendSMS&&(0,fn.jsxs)("div",{className:"mt-6 space-y-4",children:[(0,fn.jsxs)("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[(0,fn.jsx)(Jr,{})," SMS Content"]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"SMS Message"}),(0,fn.jsx)("textarea",{name:"smsBody",value:y.smsBody,onChange:e=>v(He(He({},y),{},{smsBody:e.target.value})),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-mono text-sm",required:!0})]})]}),(0,fn.jsxs)("div",{className:"mt-6 flex justify-end gap-2",children:[(0,fn.jsx)("button",{type:"button",onClick:()=>i(!1),className:"px-4 py-2 rounded bg-gray-200 text-gray-700 hover:bg-gray-300",children:"Cancel"}),(0,fn.jsxs)("button",{type:"submit",className:"px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700",children:[(0,fn.jsx)(tl,{className:"inline mr-1"})," Save"]})]})]})]})}),u&&h&&(0,fn.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,fn.jsxs)("div",{className:"bg-white rounded-lg max-w-lg w-full p-6",children:[(0,fn.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,fn.jsxs)("h3",{className:"text-xl font-bold",children:["Preview: ",h.name]}),(0,fn.jsx)("button",{onClick:()=>m(!1),className:"p-2 hover:bg-gray-100 rounded",children:(0,fn.jsx)(jl,{})})]}),h.sendEmail&&(0,fn.jsxs)("div",{className:"mb-4",children:[(0,fn.jsx)("h4",{className:"font-semibold mb-1",children:"Email"}),(0,fn.jsxs)("div",{className:"border rounded p-2 bg-gray-50",children:[(0,fn.jsxs)("div",{className:"font-bold mb-1",children:["Subject: ",h.subject]}),(0,fn.jsx)("div",{className:"whitespace-pre-line font-mono text-sm",children:h.emailBody})]})]}),h.sendSMS&&(0,fn.jsxs)("div",{children:[(0,fn.jsx)("h4",{className:"font-semibold mb-1",children:"SMS"}),(0,fn.jsx)("div",{className:"border rounded p-2 bg-gray-50",children:(0,fn.jsx)("div",{className:"whitespace-pre-line font-mono text-sm",children:h.smsBody})})]})]})})]})})},bd=e=>{let{isOpen:t,onClose:s,agreement:n,onSuccess:r}=e;const[l,o]=(0,a.useState)({amount:"",paymentMethod:"Card",reference:"",notes:""}),[i,c]=(0,a.useState)(!1);if(!t||!n)return null;const d=e=>new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP"}).format(e||0);return(0,fn.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,fn.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,fn.jsxs)("div",{className:"mt-3",children:[(0,fn.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,fn.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Record Payment"}),(0,fn.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600",children:(0,fn.jsx)(jl,{className:"h-6 w-6"})})]}),(0,fn.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 mb-4",children:[(0,fn.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"Agreement Summary"}),(0,fn.jsxs)("div",{className:"space-y-1 text-sm text-gray-600",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("strong",{children:"Customer:"})," ",n.lead_name]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("strong",{children:"Agreement:"})," ",n.agreement_number]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("strong",{children:"Remaining Balance:"})," ",d(n.remaining_amount)]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("strong",{children:"Next Due:"})," ",(u=n.next_payment_date,new Date(u).toLocaleDateString("en-GB"))]})]})]}),(0,fn.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!l.amount||parseFloat(l.amount)<=0)alert("Please enter a valid payment amount");else{c(!0);try{201===(await gn.post("/api/finance/payment",{financeId:n.id,leadId:n.lead_id,amount:parseFloat(l.amount),paymentMethod:l.paymentMethod,reference:l.reference,notes:l.notes})).status&&(alert("Payment recorded successfully!"),o({amount:"",paymentMethod:"Card",reference:"",notes:""}),r(),s())}catch(i){var t,a;console.error("Error recording payment:",i),alert((null===(t=i.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||"Error recording payment")}finally{c(!1)}}},className:"space-y-4",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Payment Amount"}),(0,fn.jsxs)("div",{className:"mt-1 relative",children:[(0,fn.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,fn.jsx)(Sr,{className:"h-5 w-5 text-gray-400"})}),(0,fn.jsx)("input",{type:"number",step:"0.01",min:"0.01",max:n.remaining_amount,value:l.amount,onChange:e=>o(He(He({},l),{},{amount:e.target.value})),className:"block w-full pl-10 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0.00",required:!0})]}),(0,fn.jsxs)("p",{className:"mt-1 text-sm text-gray-500",children:["Maximum: ",d(n.remaining_amount)]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Payment Method"}),(0,fn.jsxs)("div",{className:"mt-1 relative",children:[(0,fn.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,fn.jsx)(kr,{className:"h-5 w-5 text-gray-400"})}),(0,fn.jsxs)("select",{value:l.paymentMethod,onChange:e=>o(He(He({},l),{},{paymentMethod:e.target.value})),className:"block w-full pl-10 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,fn.jsx)("option",{value:"Card",children:"Card"}),(0,fn.jsx)("option",{value:"Cash",children:"Cash"}),(0,fn.jsx)("option",{value:"Bank Transfer",children:"Bank Transfer"}),(0,fn.jsx)("option",{value:"Cheque",children:"Cheque"}),(0,fn.jsx)("option",{value:"Other",children:"Other"})]})]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Reference"}),(0,fn.jsx)("input",{type:"text",value:l.reference,onChange:e=>o(He(He({},l),{},{reference:e.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Transaction reference (optional)"})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Notes"}),(0,fn.jsx)("textarea",{value:l.notes,onChange:e=>o(He(He({},l),{},{notes:e.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"3",placeholder:"Additional notes (optional)"})]}),(0,fn.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,fn.jsx)("button",{type:"button",onClick:s,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200",disabled:i,children:"Cancel"}),(0,fn.jsx)("button",{type:"submit",disabled:i,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:i?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Recording..."]}):(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(Sr,{className:"h-4 w-4"}),"Record Payment"]})})]})]})]})})});var u},yd=()=>{var e;const[t,s]=(0,a.useState)([]),[n,r]=(0,a.useState)(!0),[l,o]=(0,a.useState)(!1),[i,c]=(0,a.useState)(null),[d,u]=(0,a.useState)(null),[m,h]=(0,a.useState)(!1),[p,x]=(0,a.useState)(!1),[g,f]=(0,a.useState)(null),[b,y]=(0,a.useState)({}),[v,j]=(0,a.useState)([]),[w,N]=(0,a.useState)([]),[k,S]=(0,a.useState)([]),[C,_]=(0,a.useState)({leadId:"",saleId:"",totalAmount:"",paymentAmount:"",frequency:"monthly",startDate:"",dueDay:1,gracePeriodDays:5,lateFeeAmount:0,notes:"",emailReminders:!0,smsReminders:!0});(0,a.useEffect)(()=>{E(),T(),P(),A(),D()},[]);const E=async()=>{try{const e=await gn.get("/api/finance/agreements");s(e.data)}catch(e){console.error("Error fetching agreements:",e)}finally{r(!1)}},T=async()=>{try{const e=await gn.get("/api/finance/stats");y(e.data)}catch(e){console.error("Error fetching stats:",e)}},P=async()=>{try{const e=await gn.get("/api/finance/due-payments");j(e.data)}catch(e){console.error("Error fetching due payments:",e)}},A=async()=>{try{const e=await gn.get("/api/finance/overdue");N(e.data)}catch(e){console.error("Error fetching overdue payments:",e)}},D=async()=>{try{const e=await gn.get("/api/leads");S(e.data)}catch(e){console.error("Error fetching leads:",e)}},L=()=>{_({leadId:"",saleId:"",totalAmount:"",paymentAmount:"",frequency:"monthly",startDate:"",dueDay:1,gracePeriodDays:5,lateFeeAmount:0,notes:"",emailReminders:!0,smsReminders:!0})},M=e=>new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP"}).format(e||0),R=e=>new Date(e).toLocaleDateString("en-GB"),F=e=>{switch(e){case"active":return"text-green-600 bg-green-100";case"completed":return"text-blue-600 bg-blue-100";case"defaulted":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},I=e=>({weekly:"Weekly","bi-weekly":"Bi-weekly",monthly:"Monthly","bi-monthly":"Bi-monthly",quarterly:"Quarterly"}[e]||e);return n?(0,fn.jsx)("div",{className:"min-h-screen bg-gray-50 p-6",children:(0,fn.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,fn.jsxs)("div",{className:"animate-pulse",children:[(0,fn.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-6"}),(0,fn.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[1,2,3].map(e=>(0,fn.jsx)("div",{className:"h-24 bg-gray-200 rounded"},e))}),(0,fn.jsx)("div",{className:"h-96 bg-gray-200 rounded"})]})})}):(0,fn.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,fn.jsxs)("div",{className:"max-w-7xl mx-auto p-6",children:[(0,fn.jsx)("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:(0,fn.jsxs)("div",{className:"flex justify-between items-center",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Finance Management"}),(0,fn.jsx)("p",{className:"text-gray-600 mt-2",children:"Manage finance agreements and payment schedules"})]}),(0,fn.jsxs)("button",{onClick:()=>{c(null),L(),o(!0)},className:"bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-blue-700",children:[(0,fn.jsx)(Zr,{})," New Agreement"]})]})}),(0,fn.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,fn.jsx)("div",{className:"bg-white/90 backdrop-blur-sm rounded-2xl shadow-lg border border-blue-200 p-6 hover:shadow-xl transition-all duration-300 hover:-translate-y-1",children:(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("div",{className:"p-4 bg-gradient-to-br from-blue-400 to-blue-600 rounded-2xl shadow-lg",children:(0,fn.jsx)(Sr,{className:"h-8 w-8 text-white"})}),(0,fn.jsxs)("div",{className:"ml-6",children:[(0,fn.jsx)("p",{className:"text-sm font-semibold text-gray-600 uppercase tracking-wide",children:"Total Financed"}),(0,fn.jsx)("p",{className:"text-3xl font-bold text-gray-900 mt-1",children:M((null===b||void 0===b?void 0:b.total_financed)||0)}),(0,fn.jsx)("p",{className:"text-xs text-blue-600 font-medium mt-1",children:"Active agreements"})]})]})}),(0,fn.jsx)("div",{className:"bg-white/90 backdrop-blur-sm rounded-2xl shadow-lg border border-green-200 p-6 hover:shadow-xl transition-all duration-300 hover:-translate-y-1",children:(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("div",{className:"p-4 bg-gradient-to-br from-green-400 to-green-600 rounded-2xl shadow-lg",children:(0,fn.jsx)(xr,{className:"h-8 w-8 text-white"})}),(0,fn.jsxs)("div",{className:"ml-6",children:[(0,fn.jsx)("p",{className:"text-sm font-semibold text-gray-600 uppercase tracking-wide",children:"Total Paid"}),(0,fn.jsx)("p",{className:"text-3xl font-bold text-gray-900 mt-1",children:M((null===b||void 0===b?void 0:b.total_collected)||0)}),(0,fn.jsx)("p",{className:"text-xs text-green-600 font-medium mt-1",children:"\u2197 Collected so far"})]})]})}),(0,fn.jsx)("div",{className:"bg-white/90 backdrop-blur-sm rounded-2xl shadow-lg border border-red-200 p-6 hover:shadow-xl transition-all duration-300 hover:-translate-y-1",children:(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("div",{className:"p-4 bg-gradient-to-br from-red-400 to-red-600 rounded-2xl shadow-lg",children:(0,fn.jsx)(rr,{className:"h-8 w-8 text-white"})}),(0,fn.jsxs)("div",{className:"ml-6",children:[(0,fn.jsx)("p",{className:"text-sm font-semibold text-gray-600 uppercase tracking-wide",children:"Unpaid Amount"}),(0,fn.jsx)("p",{className:"text-3xl font-bold text-gray-900 mt-1",children:M((null===b||void 0===b?void 0:b.total_outstanding)||0)}),(0,fn.jsx)("p",{className:"text-xs text-red-600 font-medium mt-1",children:"Outstanding balance"})]})]})}),(0,fn.jsx)("div",{className:"bg-white/90 backdrop-blur-sm rounded-2xl shadow-lg border border-orange-200 p-6 hover:shadow-xl transition-all duration-300 hover:-translate-y-1",children:(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("div",{className:"p-4 bg-gradient-to-br from-orange-400 to-orange-600 rounded-2xl shadow-lg",children:(0,fn.jsx)(wr,{className:"h-8 w-8 text-white"})}),(0,fn.jsxs)("div",{className:"ml-6",children:[(0,fn.jsx)("p",{className:"text-sm font-semibold text-gray-600 uppercase tracking-wide",children:"Due This Month"}),(0,fn.jsx)("p",{className:"text-3xl font-bold text-gray-900 mt-1",children:M((null===b||void 0===b?void 0:b.total_due_this_month)||0)}),(0,fn.jsxs)("p",{className:"text-xs text-orange-600 font-medium mt-1",children:[(null===b||void 0===b?void 0:b.agreements_due_this_month)||0," payments"]})]})]})})]}),(0,fn.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8",children:[(0,fn.jsxs)("div",{className:"lg:col-span-2 bg-white/90 backdrop-blur-sm rounded-2xl shadow-lg border border-gray-200 p-6",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,fn.jsxs)("h2",{className:"text-xl font-bold text-gray-900 flex items-center",children:[(0,fn.jsx)(dl,{className:"h-6 w-6 text-blue-600 mr-3"}),"Payment Performance"]}),(0,fn.jsx)("div",{className:"flex space-x-2",children:(0,fn.jsxs)("span",{className:"px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium",children:[null!==b&&void 0!==b&&b.total_collected&&null!==b&&void 0!==b&&b.total_financed?Math.round(b.total_collected/b.total_financed*100):0,"% Collected"]})})]}),(0,fn.jsxs)("div",{className:"space-y-4",children:[(0,fn.jsxs)("div",{className:"flex justify-between items-center",children:[(0,fn.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"Collection Progress"}),(0,fn.jsxs)("span",{className:"text-sm text-gray-500",children:[M((null===b||void 0===b?void 0:b.total_collected)||0)," of ",M((null===b||void 0===b?void 0:b.total_financed)||0)]})]}),(0,fn.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-3",children:(0,fn.jsx)("div",{className:"bg-gradient-to-r from-green-400 to-green-600 h-3 rounded-full transition-all duration-500",style:{width:"".concat(null!==b&&void 0!==b&&b.total_collected&&null!==b&&void 0!==b&&b.total_financed?b.total_collected/b.total_financed*100:0,"%")}})})]}),(0,fn.jsxs)("div",{className:"grid grid-cols-2 gap-4 mt-6",children:[(0,fn.jsxs)("div",{className:"bg-gradient-to-br from-blue-50 to-purple-50 p-4 rounded-xl border border-blue-200",children:[(0,fn.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Active Agreements"}),(0,fn.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:(null===b||void 0===b?void 0:b.active_agreements)||0})]}),(0,fn.jsxs)("div",{className:"bg-gradient-to-br from-green-50 to-blue-50 p-4 rounded-xl border border-green-200",children:[(0,fn.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Avg Payment"}),(0,fn.jsx)("p",{className:"text-2xl font-bold text-green-600",children:M((null===b||void 0===b?void 0:b.avg_payment_amount)||0)})]})]})]}),(0,fn.jsxs)("div",{className:"bg-white/90 backdrop-blur-sm rounded-2xl shadow-lg border border-gray-200 p-6",children:[(0,fn.jsxs)("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center",children:[(0,fn.jsx)(ur,{className:"h-5 w-5 text-red-600 mr-2"}),"Payment Alerts"]}),(0,fn.jsxs)("div",{className:"space-y-4",children:[w&&w.length>0&&(0,fn.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("p",{className:"text-sm font-medium text-red-800",children:"Overdue Payments"}),(0,fn.jsx)("p",{className:"text-2xl font-bold text-red-600",children:w.length})]}),(0,fn.jsx)(rr,{className:"h-8 w-8 text-red-500"})]}),(0,fn.jsx)("p",{className:"text-xs text-red-600 mt-2",children:"Require immediate attention"})]}),v&&v.length>0&&(0,fn.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("p",{className:"text-sm font-medium text-yellow-800",children:"Due Soon"}),(0,fn.jsx)("p",{className:"text-2xl font-bold text-yellow-600",children:v.length})]}),(0,fn.jsx)(wr,{className:"h-8 w-8 text-yellow-500"})]}),(0,fn.jsx)("p",{className:"text-xs text-yellow-600 mt-2",children:"Next 7 days"})]}),(0,fn.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("p",{className:"text-sm font-medium text-blue-800",children:"On Track"}),(0,fn.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:Math.max(0,((null===b||void 0===b?void 0:b.active_agreements)||0)-((null===w||void 0===w?void 0:w.length)||0)-((null===v||void 0===v?void 0:v.length)||0))})]}),(0,fn.jsx)(xr,{className:"h-8 w-8 text-blue-500"})]}),(0,fn.jsx)("p",{className:"text-xs text-blue-600 mt-2",children:"Up to date"})]})]})]})]}),(v&&v.length>0||w&&w.length>0)&&(0,fn.jsxs)("div",{className:"mb-6 space-y-3",children:[w&&w.length>0&&(0,fn.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)(rr,{className:"h-5 w-5 text-red-400"}),(0,fn.jsxs)("div",{className:"ml-3",children:[(0,fn.jsxs)("h3",{className:"text-sm font-medium text-red-800",children:[w.length," Overdue Payment",1!==w.length?"s":""]}),(0,fn.jsx)("p",{className:"text-sm text-red-700 mt-1",children:"These payments are past due and require immediate attention."})]})]})}),v&&v.length>0&&(0,fn.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)(wr,{className:"h-5 w-5 text-yellow-400"}),(0,fn.jsxs)("div",{className:"ml-3",children:[(0,fn.jsxs)("h3",{className:"text-sm font-medium text-yellow-800",children:[v.length," Payment",1!==v.length?"s":""," Due Soon"]}),(0,fn.jsx)("p",{className:"text-sm text-yellow-700 mt-1",children:"These payments are due within the next 7 days."})]})]})})]}),(0,fn.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,fn.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,fn.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"Finance Agreements"})}),(0,fn.jsx)("div",{className:"overflow-x-auto",children:(0,fn.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,fn.jsx)("thead",{className:"bg-gray-50",children:(0,fn.jsxs)("tr",{children:[(0,fn.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Agreement"}),(0,fn.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),(0,fn.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,fn.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Payment"}),(0,fn.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Next Due"}),(0,fn.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,fn.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,fn.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:t&&t.length>0?t.map(e=>(0,fn.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,fn.jsxs)("div",{children:[(0,fn.jsx)("div",{className:"text-sm font-medium text-gray-900",children:(null===e||void 0===e?void 0:e.agreement_number)||"N/A"}),(0,fn.jsx)("div",{className:"text-sm text-gray-500",children:I((null===e||void 0===e?void 0:e.payment_frequency)||"monthly")})]})}),(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,fn.jsxs)("div",{children:[(0,fn.jsx)("div",{className:"text-sm font-medium text-gray-900",children:(null===e||void 0===e?void 0:e.lead_name)||"N/A"}),(0,fn.jsx)("div",{className:"text-sm text-gray-500",children:(null===e||void 0===e?void 0:e.lead_email)||"N/A"})]})}),(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,fn.jsxs)("div",{children:[(0,fn.jsx)("div",{className:"text-sm font-medium text-gray-900",children:M((null===e||void 0===e?void 0:e.total_amount)||0)}),(0,fn.jsxs)("div",{className:"text-sm text-gray-500",children:[M((null===e||void 0===e?void 0:e.remaining_balance)||0)," remaining"]})]})}),(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,fn.jsx)("div",{className:"text-sm text-gray-900",children:M((null===e||void 0===e?void 0:e.monthly_payment)||0)})}),(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,fn.jsx)("div",{className:"text-sm text-gray-900",children:null!==e&&void 0!==e&&e.next_payment_date?R(e.next_payment_date):"N/A"})}),(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,fn.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat(F((null===e||void 0===e?void 0:e.status)||"active")),children:(null===e||void 0===e?void 0:e.status)||"active"})}),(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,fn.jsxs)("div",{className:"flex space-x-2",children:[(0,fn.jsx)("button",{onClick:()=>(async e=>{try{const t=await gn.get("/api/finance/agreement/".concat(e.id));u(t.data),h(!0)}catch(t){console.error("Error fetching agreement details:",t)}})(e),className:"text-blue-600 hover:text-blue-900",title:"View Details",children:(0,fn.jsx)(Ar,{className:"h-4 w-4"})}),(0,fn.jsx)("button",{onClick:()=>(e=>{var t;c(e),_({leadId:e.lead_id,saleId:e.sale_id||"",totalAmount:e.total_amount,paymentAmount:e.monthly_payment,frequency:e.payment_frequency,startDate:(null===(t=e.start_date)||void 0===t?void 0:t.split("T")[0])||"",dueDay:1,gracePeriodDays:5,lateFeeAmount:0,notes:e.notes||"",emailReminders:!0,smsReminders:!0}),o(!0)})(e),className:"text-indigo-600 hover:text-indigo-900",title:"Edit Agreement",children:(0,fn.jsx)(Er,{className:"h-4 w-4"})}),(null===e||void 0===e?void 0:e.remaining_balance)>0&&(0,fn.jsx)("button",{onClick:()=>(e=>{f(e),x(!0)})(e),className:"text-green-600 hover:text-green-900",title:"Record Payment",children:(0,fn.jsx)(Sr,{className:"h-4 w-4"})})]})})]},e.id)):(0,fn.jsx)("tr",{children:(0,fn.jsx)("td",{colSpan:"7",className:"px-6 py-4 text-center text-gray-500",children:"No finance agreements found"})})})]})})]})]}),l&&(0,fn.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,fn.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,fn.jsxs)("div",{className:"mt-3",children:[(0,fn.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:i?"Edit Finance Agreement":"New Finance Agreement"}),(0,fn.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{const e=He(He({},C),{},{totalAmount:parseFloat(C.totalAmount)||0,paymentAmount:parseFloat(C.paymentAmount)||0,dueDay:parseInt(C.dueDay)||1,gracePeriodDays:parseInt(C.gracePeriodDays)||5,lateFeeAmount:parseFloat(C.lateFeeAmount)||0});if(!e.leadId||!e.totalAmount||!e.paymentAmount)return void alert("Please fill in all required fields");console.log("\ud83d\udce4 Submitting finance agreement:",e);const t=i?"/api/finance/agreement/".concat(i.id):"/api/finance/agreement",s=i?"PUT":"POST",n=await gn({method:s,url:t,data:e,headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});200!==n.status&&201!==n.status||(o(!1),c(null),L(),E(),T())}catch(n){var t,s;console.error("Error saving agreement:",n),alert((null===(t=n.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||"Error saving agreement")}},className:"space-y-4",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Lead"}),(0,fn.jsxs)("select",{value:C.leadId,onChange:e=>_(He(He({},C),{},{leadId:e.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2",required:!0,children:[(0,fn.jsx)("option",{value:"",children:"Select a lead"}),k&&k.length>0?k.map(e=>(0,fn.jsxs)("option",{value:e.id,children:[e.name," - ",e.email]},e.id)):(0,fn.jsx)("option",{value:"",disabled:!0,children:"No leads available"})]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Total Amount"}),(0,fn.jsx)("input",{type:"number",step:"0.01",value:C.totalAmount,onChange:e=>_(He(He({},C),{},{totalAmount:e.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2",required:!0})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Payment Amount"}),(0,fn.jsx)("input",{type:"number",step:"0.01",value:C.paymentAmount,onChange:e=>_(He(He({},C),{},{paymentAmount:e.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2",required:!0})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Frequency"}),(0,fn.jsxs)("select",{value:C.frequency,onChange:e=>_(He(He({},C),{},{frequency:e.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2",required:!0,children:[(0,fn.jsx)("option",{value:"weekly",children:"Weekly"}),(0,fn.jsx)("option",{value:"bi-weekly",children:"Bi-weekly"}),(0,fn.jsx)("option",{value:"monthly",children:"Monthly"}),(0,fn.jsx)("option",{value:"bi-monthly",children:"Bi-monthly"}),(0,fn.jsx)("option",{value:"quarterly",children:"Quarterly"})]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Start Date"}),(0,fn.jsx)("input",{type:"date",value:C.startDate,onChange:e=>_(He(He({},C),{},{startDate:e.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2",required:!0})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Due Day"}),(0,fn.jsx)("input",{type:"number",min:"1",max:"31",value:C.dueDay,onChange:e=>_(He(He({},C),{},{dueDay:parseInt(e.target.value)})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"})]}),(0,fn.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,fn.jsxs)("label",{className:"flex items-center",children:[(0,fn.jsx)("input",{type:"checkbox",checked:C.emailReminders,onChange:e=>_(He(He({},C),{},{emailReminders:e.target.checked})),className:"rounded border-gray-300 text-blue-600"}),(0,fn.jsx)("span",{className:"ml-2 text-sm text-gray-700",children:"Email Reminders"})]}),(0,fn.jsxs)("label",{className:"flex items-center",children:[(0,fn.jsx)("input",{type:"checkbox",checked:C.smsReminders,onChange:e=>_(He(He({},C),{},{smsReminders:e.target.checked})),className:"rounded border-gray-300 text-blue-600"}),(0,fn.jsx)("span",{className:"ml-2 text-sm text-gray-700",children:"SMS Reminders"})]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Notes"}),(0,fn.jsx)("textarea",{value:C.notes,onChange:e=>_(He(He({},C),{},{notes:e.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2",rows:"3"})]}),(0,fn.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,fn.jsx)("button",{type:"button",onClick:()=>o(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200",children:"Cancel"}),(0,fn.jsx)("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700",children:i?"Update":"Create"})]})]})]})})}),m&&d&&(0,fn.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,fn.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-3/4 max-w-4xl shadow-lg rounded-md bg-white",children:(0,fn.jsxs)("div",{className:"mt-3",children:[(0,fn.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,fn.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Finance Agreement Details"}),(0,fn.jsx)("button",{onClick:()=>h(!1),className:"text-gray-400 hover:text-gray-600",children:(0,fn.jsx)(jl,{className:"h-6 w-6"})})]}),(0,fn.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("h4",{className:"font-medium text-gray-900 mb-3",children:"Agreement Information"}),(0,fn.jsxs)("dl",{className:"space-y-2",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"Agreement Number"}),(0,fn.jsx)("dd",{className:"text-sm text-gray-900",children:(null===d||void 0===d?void 0:d.agreement_number)||"N/A"})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"Customer"}),(0,fn.jsx)("dd",{className:"text-sm text-gray-900",children:(null===d||void 0===d?void 0:d.lead_name)||"N/A"})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"Total Amount"}),(0,fn.jsx)("dd",{className:"text-sm text-gray-900",children:M((null===d||void 0===d?void 0:d.total_amount)||0)})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"Payment Amount"}),(0,fn.jsx)("dd",{className:"text-sm text-gray-900",children:M((null===d||void 0===d?void 0:d.monthly_payment)||0)})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"Frequency"}),(0,fn.jsx)("dd",{className:"text-sm text-gray-900",children:I((null===d||void 0===d?void 0:d.payment_frequency)||"monthly")})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"Start Date"}),(0,fn.jsx)("dd",{className:"text-sm text-gray-900",children:null!==d&&void 0!==d&&d.start_date?R(d.start_date):"N/A"})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"Next Payment Due"}),(0,fn.jsx)("dd",{className:"text-sm text-gray-900",children:null!==d&&void 0!==d&&d.next_payment_date?R(d.next_payment_date):"N/A"})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"Status"}),(0,fn.jsx)("dd",{className:"text-sm text-gray-900",children:(0,fn.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat(F((null===d||void 0===d?void 0:d.status)||"active")),children:(null===d||void 0===d?void 0:d.status)||"active"})})]})]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("h4",{className:"font-medium text-gray-900 mb-3",children:"Payment Summary"}),(0,fn.jsxs)("dl",{className:"space-y-2",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"Total Paid"}),(0,fn.jsx)("dd",{className:"text-sm text-gray-900",children:M((null===d||void 0===d?void 0:d.total_paid)||0)})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"Remaining Amount"}),(0,fn.jsx)("dd",{className:"text-sm text-gray-900",children:M((null===d||void 0===d?void 0:d.remaining_balance)||0)})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"Payment Count"}),(0,fn.jsx)("dd",{className:"text-sm text-gray-900",children:(null===d||void 0===d||null===(e=d.payments)||void 0===e?void 0:e.length)||0})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"Last Payment"}),(0,fn.jsx)("dd",{className:"text-sm text-gray-900",children:null!==d&&void 0!==d&&d.payments&&d.payments.length>0?R(d.payments[0].payment_date):"No payments yet"})]})]}),(null===d||void 0===d?void 0:d.payments)&&d.payments.length>0&&(0,fn.jsxs)("div",{className:"mt-4",children:[(0,fn.jsx)("h5",{className:"font-medium text-gray-900 mb-2",children:"Payment History"}),(0,fn.jsx)("div",{className:"space-y-2",children:d.payments.map(e=>(0,fn.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,fn.jsx)("span",{children:R(e.payment_date)}),(0,fn.jsx)("span",{className:"font-medium",children:M(e.amount_paid)})]},e.id))})]})]})]}),(0,fn.jsx)("div",{className:"mt-6 flex justify-end",children:(0,fn.jsx)("button",{onClick:()=>h(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200",children:"Close"})})]})})}),(0,fn.jsx)(bd,{isOpen:p,onClose:()=>{x(!1),f(null)},agreement:g,onSuccess:()=>{E(),T(),P(),A()}})]})},vd=e=>{let{isOpen:t,onClose:s,selectedSales:n,onSuccess:r}=e;const[l,o]=(0,a.useState)([]),[i,c]=(0,a.useState)(""),[d,u]=(0,a.useState)(!1),[m,h]=(0,a.useState)(!1),[p,x]=(0,a.useState)(null),[g,f]=(0,a.useState)(!1),[b,y]=(0,a.useState)("both"),[v,j]=(0,a.useState)(""),[w,N]=(0,a.useState)(""),[k,S]=(0,a.useState)("");(0,a.useEffect)(()=>{t&&C()},[t]),(0,a.useEffect)(()=>{i&&_()},[i]);const C=async()=>{try{u(!0);const e=await gn.get("/api/templates",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}),t=[...new Set(n.map(e=>e.payment_type))],s=e.data.filter(e=>t.includes("full_payment")&&t.includes("finance")?["sale_paid_in_full","sale_followup_paid","sale_finance_agreement","sale_followup_finance","sale_confirmation","sale_followup","sale_notification"].includes(e.type):t.includes("full_payment")?["sale_paid_in_full","sale_followup_paid","sale_confirmation","sale_followup","sale_notification"].includes(e.type):!!t.includes("finance")&&["sale_finance_agreement","sale_followup_finance","sale_confirmation","sale_followup","sale_notification"].includes(e.type));o(s)}catch(e){console.error("Error fetching templates:",e)}finally{u(!1)}},_=async()=>{if(i)try{const e=l.find(e=>e._id===i);e&&(j(e.subject||""),N(e.emailBody||""),S(e.smsBody||""),y(e.sendEmail&&e.sendSMS?"both":e.sendEmail?"email":"sms"))}catch(e){console.error("Error loading template:",e)}},E=e=>{switch(e){case"full_payment":return"Paid in Full";case"finance":return"Finance Agreement";default:return(null===e||void 0===e?void 0:e.replace("_"," "))||"Unknown"}},T=e=>{switch(e){case"full_payment":return"bg-green-100 text-green-800";case"finance":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}};return t?(0,fn.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,fn.jsxs)("div",{className:"relative top-10 mx-auto p-6 border w-full max-w-4xl shadow-lg rounded-md bg-white",children:[(0,fn.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,fn.jsxs)("h3",{className:"text-xl font-semibold text-gray-900",children:["Send Communication to ",n.length," Customer",1!==n.length?"s":""]}),(0,fn.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600",children:(0,fn.jsx)(jl,{className:"h-6 w-6"})})]}),(0,fn.jsxs)("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[(0,fn.jsxs)("div",{className:"flex items-center mb-3",children:[(0,fn.jsx)(fl,{className:"h-5 w-5 text-gray-600 mr-2"}),(0,fn.jsx)("span",{className:"font-medium text-gray-700",children:"Selected Customers:"})]}),(0,fn.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[n.slice(0,6).map((e,t)=>(0,fn.jsxs)("div",{className:"flex items-center justify-between p-2 bg-white rounded border",children:[(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center text-sm font-medium text-blue-600",children:t+1}),(0,fn.jsxs)("div",{className:"ml-3",children:[(0,fn.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.lead_name}),(0,fn.jsx)("div",{className:"text-xs text-gray-500",children:e.lead_email})]})]}),(0,fn.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat(T(e.payment_type)),children:E(e.payment_type)})]},e.id)),n.length>6&&(0,fn.jsxs)("div",{className:"text-sm text-gray-500 italic",children:["+",n.length-6," more customers"]})]})]}),(0,fn.jsxs)("div",{className:"mb-6",children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Template"}),(0,fn.jsxs)("select",{value:i,onChange:e=>c(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:d,children:[(0,fn.jsx)("option",{value:"",children:"Choose a template..."}),l.map(e=>(0,fn.jsxs)("option",{value:e._id,children:[e.name," (",e.type.replace(/_/g," "),")"]},e._id))]})]}),(0,fn.jsxs)("div",{className:"mb-6",children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Communication Type"}),(0,fn.jsxs)("div",{className:"flex space-x-4",children:[(0,fn.jsxs)("label",{className:"flex items-center",children:[(0,fn.jsx)("input",{type:"radio",value:"email",checked:"email"===b,onChange:e=>y(e.target.value),className:"mr-2"}),(0,fn.jsx)(Wr,{className:"h-4 w-4 text-blue-600 mr-1"}),"Email Only"]}),(0,fn.jsxs)("label",{className:"flex items-center",children:[(0,fn.jsx)("input",{type:"radio",value:"sms",checked:"sms"===b,onChange:e=>y(e.target.value),className:"mr-2"}),(0,fn.jsx)(Jr,{className:"h-4 w-4 text-green-600 mr-1"}),"SMS Only"]}),(0,fn.jsxs)("label",{className:"flex items-center",children:[(0,fn.jsx)("input",{type:"radio",value:"both",checked:"both"===b,onChange:e=>y(e.target.value),className:"mr-2"}),(0,fn.jsx)(Wr,{className:"h-4 w-4 text-blue-600 mr-1"}),(0,fn.jsx)(Jr,{className:"h-4 w-4 text-green-600 mr-1"}),"Both"]})]})]}),("email"===b||"both"===b)&&(0,fn.jsxs)("div",{className:"mb-6",children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Subject"}),(0,fn.jsx)("input",{type:"text",value:v,onChange:e=>j(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter email subject..."})]}),("email"===b||"both"===b)&&(0,fn.jsxs)("div",{className:"mb-6",children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Body"}),(0,fn.jsx)("textarea",{value:w,onChange:e=>N(e.target.value),rows:8,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter email body..."})]}),("sms"===b||"both"===b)&&(0,fn.jsxs)("div",{className:"mb-6",children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"SMS Body"}),(0,fn.jsx)("textarea",{value:k,onChange:e=>S(e.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter SMS message..."}),(0,fn.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Character count: ",k.length," (SMS limit: 160 characters)"]})]}),(0,fn.jsxs)("div",{className:"flex justify-between items-center",children:[(0,fn.jsx)("div",{className:"flex space-x-3",children:(0,fn.jsxs)("button",{onClick:async()=>{if(i&&0!==n.length)try{u(!0);const e=await gn.post("/api/templates/".concat(i,"/preview"),{sales:n.slice(0,3)},{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});x(e.data),f(!0)}catch(e){console.error("Error generating preview:",e)}finally{u(!1)}},disabled:!i||d,className:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 disabled:opacity-50 flex items-center",children:[(0,fn.jsx)(Ar,{className:"h-4 w-4 mr-2"}),"Preview"]})}),(0,fn.jsxs)("div",{className:"flex space-x-3",children:[(0,fn.jsx)("button",{onClick:s,className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400",children:"Cancel"}),(0,fn.jsx)("button",{onClick:async()=>{if(i&&0!==n.length)try{h(!0);const e={templateId:i,sales:n.map(e=>({id:e.id,payment_type:e.payment_type,lead_name:e.lead_name,lead_email:e.lead_email,lead_phone:e.lead_phone,amount:e.amount,sale_date:e.sale_created_at||e.created_at})),communicationType:b,customSubject:v,customEmailBody:w,customSmsBody:k},t=await gn.post("/api/sales/bulk-communication",e,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});let a="".concat(t.data.message,"\n\n").concat(t.data.note||"");t.data.errorCount>0&&(a+="\n\nErrors:",t.data.results.forEach(e=>{e.error&&(a+="\n\u2022 ".concat(e.customerName||e.saleId,": ").concat(e.error))})),alert(a),r(),s()}catch(e){console.error("Error sending communications:",e),alert("Error sending communications. Please try again.")}finally{h(!1)}},disabled:!i||m||0===n.length,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 flex items-center",children:m?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Sending..."]}):(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(nl,{className:"h-4 w-4 mr-2"}),"Send to ",n.length," Customer",1!==n.length?"s":""]})})]})]}),g&&p&&(0,fn.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,fn.jsxs)("div",{className:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white",children:[(0,fn.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,fn.jsx)("h4",{className:"text-lg font-medium text-gray-900",children:"Preview"}),(0,fn.jsx)("button",{onClick:()=>f(!1),className:"text-gray-400 hover:text-gray-600",children:(0,fn.jsx)(jl,{className:"h-6 w-6"})})]}),(0,fn.jsx)("div",{className:"space-y-4",children:p.map((e,t)=>(0,fn.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,fn.jsx)("span",{className:"font-medium text-gray-700",children:e.customerName}),(0,fn.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat(T(e.paymentType)),children:E(e.paymentType)})]}),("email"===b||"both"===b)&&(0,fn.jsxs)("div",{className:"mb-3",children:[(0,fn.jsx)("div",{className:"text-sm font-medium text-gray-600 mb-1",children:"Email Preview:"}),(0,fn.jsxs)("div",{className:"text-sm text-gray-800 bg-gray-50 p-2 rounded",children:[(0,fn.jsxs)("div",{className:"font-medium",children:["Subject: ",e.emailSubject]}),(0,fn.jsx)("div",{className:"mt-2 whitespace-pre-wrap",children:e.emailBody})]})]}),("sms"===b||"both"===b)&&(0,fn.jsxs)("div",{children:[(0,fn.jsx)("div",{className:"text-sm font-medium text-gray-600 mb-1",children:"SMS Preview:"}),(0,fn.jsx)("div",{className:"text-sm text-gray-800 bg-gray-50 p-2 rounded",children:e.smsBody})]})]},t))})]})})]})}):null},jd=e=>{let{bookingHistory:t,title:s="Message History",maxHeight:n="max-h-48"}=e;if(!t||!Array.isArray(t))return null;const a=t.filter(e=>["EMAIL_SENT","EMAIL_RECEIVED","SMS_SENT","SMS_RECEIVED"].includes(e.action)).sort((e,t)=>new Date(t.timestamp)-new Date(e.timestamp));return 0===a.length?(0,fn.jsxs)("div",{className:"bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl p-4 mt-4",children:[(0,fn.jsx)("h4",{className:"text-base font-bold text-blue-700 mb-2",children:s}),(0,fn.jsx)("div",{className:"text-xs text-gray-400 italic",children:"No messages yet"})]}):(0,fn.jsxs)("div",{className:"bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl p-4 mt-4 ".concat(n," overflow-y-auto"),children:[(0,fn.jsx)("h4",{className:"text-base font-bold text-blue-700 mb-2",children:s}),a.slice(0,10).map((e,t)=>{var s,n,a;return(0,fn.jsxs)("div",{className:"flex items-start space-x-2 mb-2 last:mb-0",children:[(0,fn.jsxs)("div",{className:"mt-1",children:[["EMAIL_SENT","EMAIL_RECEIVED"].includes(e.action)&&(0,fn.jsx)(Wr,{className:"h-4 w-4 ".concat("EMAIL_SENT"===e.action?"text-blue-500":"text-green-600")}),["SMS_SENT","SMS_RECEIVED"].includes(e.action)&&(0,fn.jsx)(Gr,{className:"h-4 w-4 ".concat("SMS_SENT"===e.action?"text-blue-400":"text-green-400")})]}),(0,fn.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,fn.jsxs)("div",{className:"text-xs text-gray-700 font-semibold",children:["EMAIL_SENT"===e.action&&"Email Sent","EMAIL_RECEIVED"===e.action&&"Email Received","SMS_SENT"===e.action&&"Text Sent","SMS_RECEIVED"===e.action&&"Text Received",(0,fn.jsx)("span",{className:"ml-2 text-gray-400 font-normal",children:new Date(e.timestamp).toLocaleString()})]}),(null===(s=e.details)||void 0===s?void 0:s.subject)&&(0,fn.jsxs)("div",{className:"text-xs text-gray-500 truncate",children:[(0,fn.jsx)("b",{children:"Subject:"})," ",e.details.subject]}),(0,fn.jsxs)("div",{className:"text-xs text-gray-600 truncate",children:[(0,fn.jsx)("b",{children:"Message:"})," ",null!==(n=e.details)&&void 0!==n&&n.body?"No content available"===e.details.body?(0,fn.jsx)("span",{className:"italic text-gray-400",children:e.details.body}):(0,fn.jsxs)(fn.Fragment,{children:[e.details.body.slice(0,80),e.details.body.length>80?"...":""]}):(0,fn.jsx)("span",{className:"italic text-gray-400",children:"No message content"})]}),(0,fn.jsxs)("div",{className:"text-[10px] text-gray-400",children:["sent"===(null===(a=e.details)||void 0===a?void 0:a.direction)?"To":"From",": ",e.performedByName]})]})]},t)})]})},wd=()=>{var e,t,s,n,r,l,o,i;const{user:c}=wn(),{socket:d}=Ga(),[u,m]=(0,a.useState)([]),[h,p]=(0,a.useState)({}),[x,g]=(0,a.useState)(!0),[f,b]=(0,a.useState)("all"),[y,v]=(0,a.useState)("this_month"),[j,w]=(0,a.useState)(null),[N,k]=(0,a.useState)(!1),[S,C]=(0,a.useState)(!1),[_,E]=(0,a.useState)(!1),[T,P]=(0,a.useState)(!1),[A,D]=(0,a.useState)(new Set),[L,M]=(0,a.useState)(!1),[R,F]=(0,a.useState)(!1),[I,O]=(0,a.useState)(!1),[B,U]=(0,a.useState)("details"),[z,V]=(0,a.useState)(null),[W,q]=(0,a.useState)(!1),[H,Y]=(0,a.useState)(!1),[G,$]=(0,a.useState)({totalAmount:"",paymentAmount:"",frequency:"monthly",startDate:(new Date).toISOString().split("T")[0],notes:""});(0,a.useEffect)(()=>{Q(),K()},[y,f]),(0,a.useEffect)(()=>{if(d)return d.on("sales_deleted",e=>{console.log("\ud83d\udce1 Received sales_deleted event:",e),Q(),K()}),d.on("sale_created",e=>{console.log("\ud83d\udce1 Received sale_created event:",e),Q(),K()}),()=>{d.off("sales_deleted"),d.off("sale_created")}},[d]);const Q=async()=>{try{console.log("\ud83d\udd0d Fetching sales with params:",{dateRange:y,paymentType:"all"===f?void 0:f});const e=await gn.get("/api/sales",{params:{dateRange:y,paymentType:"all"===f?void 0:f}});console.log("\ud83d\udcca Sales data received:",e.data),e.data&&e.data.length>0&&(console.log("\ud83d\udd0d SALES USER ATTRIBUTION DEBUG:"),e.data.slice(0,3).forEach((e,t)=>{const s=e.user_name||(e.user_id?"User ".concat(e.user_id.slice(-4)):"System");console.log("   Sale ".concat(t+1,": ID=").concat(e.id.slice(-8),", user_id=").concat(e.user_id,', user_name="').concat(e.user_name,'", display="').concat(s,'"'))})),m(e.data)}catch(e){console.error("\u274c Error fetching sales:",e)}},K=async()=>{try{console.log("\ud83d\udcc8 Fetching stats with params:",{dateRange:y,paymentType:"all"===f?void 0:f});const e=await gn.get("/api/sales/stats",{params:{dateRange:y,paymentType:"all"===f?void 0:f}});console.log("\ud83d\udcca Stats data received:",e.data),p(e.data)}catch(e){console.error("\u274c Error fetching stats:",e)}finally{g(!1)}},J=async e=>{w(e),V(null),U("details"),Y(!1),k(!0),await(async e=>{try{q(!0);const t=await gn.get("/api/sales/".concat(e,"/details"));t.data.success&&V(t.data.sale)}catch(t){console.error("\u274c Error fetching sale details:",t),V(null)}finally{q(!1)}})(e.id)},X=e=>new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP"}).format(e),Z=e=>{if(!e)return"-";const t=new Date(e);return isNaN(t.getTime())?"-":t.toLocaleDateString("en-GB",{year:"numeric",month:"short",day:"numeric"})},ee=async e=>{if(window.confirm("Are you sure you want to delete this sale? This action cannot be undone."))try{console.log("\ud83d\uddd1\ufe0f Attempting to delete sale:",e);const t=await gn.delete("/api/sales/".concat(e),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});console.log("\ud83d\udce5 Delete response:",t),console.log("\ud83d\udce5 Response data:",t.data),t.data&&t.data.message?(console.log("\u2705 Delete successful:",t.data.message),alert(t.data.message),await Q(),await K()):(console.log("\u26a0\ufe0f Unexpected response format:",t.data),await Q(),await K(),alert("Sale deleted successfully"))}catch(l){var t;if(console.error("\u274c Error deleting sale:",l),console.error("\u274c Error response:",l.response),console.error("\u274c Error response data:",null===(t=l.response)||void 0===t?void 0:t.data),l.response){var s,n;const e=(null===(s=l.response.data)||void 0===s?void 0:s.message)||(null===(n=l.response.data)||void 0===n?void 0:n.error)||"Unknown server error";var a,r;if(e.includes("Failed to delete sale"))alert("Failed to delete sale: "+((null===(a=l.response.data)||void 0===a?void 0:a.error)||(null===(r=l.response.data)||void 0===r?void 0:r.details)||"Unknown error"));else alert("Failed to delete sale: "+e)}else l.request?alert("Failed to delete sale: No response from server"):alert("Failed to delete sale: "+l.message)}},te=e=>{if(!e||"string"!==typeof e)return"bg-gray-100 text-gray-800";switch(e.toLowerCase()){case"card":return"bg-green-100 text-green-800";case"cash":return"bg-yellow-100 text-yellow-800";case"finance":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},se=e=>{if(!e||"string"!==typeof e)return"Unknown";switch(e.toLowerCase()){case"card":return"Card";case"cash":return"Cash";case"finance":return"Finance";default:return e}},ne=u.filter(e=>"all"===f||e.payment_type===f);return console.log("\ud83d\udd0d Debug Info:",{totalSales:u.length,filteredSales:ne.length,currentFilter:f,stats:h,salesData:u.map(e=>({name:e.lead_name,amount:e.amount,paymentType:e.payment_type}))}),x?(0,fn.jsx)("div",{className:"flex justify-center items-center min-h-screen",children:(0,fn.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-500"})}):(0,fn.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50",children:(0,fn.jsxs)("div",{className:"p-6 max-w-7xl mx-auto",children:[(0,fn.jsx)("div",{className:"mb-8",children:(0,fn.jsxs)("div",{className:"flex items-center justify-between",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("h1",{className:"text-4xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-2",children:"Sales Overview"}),(0,fn.jsx)("p",{className:"text-gray-600 text-lg",children:"Track completed sales and revenue performance"})]}),(0,fn.jsx)("div",{className:"flex items-center space-x-3",children:(0,fn.jsxs)("div",{className:"bg-white/80 backdrop-blur-sm px-4 py-2 rounded-full border border-blue-200",children:[(0,fn.jsx)("span",{className:"text-sm text-gray-600",children:"Last updated: "}),(0,fn.jsx)("span",{className:"text-sm font-medium text-blue-600",children:(new Date).toLocaleTimeString()})]})})]})}),(0,fn.jsxs)("div",{className:"grid gap-6 mb-8 ".concat("admin"===(null===c||void 0===c?void 0:c.role)?"grid-cols-1 md:grid-cols-2 lg:grid-cols-4":"grid-cols-1 md:grid-cols-2"),children:[(0,fn.jsx)("div",{className:"bg-white/80 backdrop-blur-sm p-6 rounded-2xl shadow-lg border border-green-200 hover:shadow-xl transition-all duration-300 hover:-translate-y-1",children:(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("div",{className:"p-4 bg-gradient-to-br from-green-400 to-green-600 rounded-2xl shadow-lg",children:(0,fn.jsx)(Sr,{className:"h-8 w-8 text-white"})}),(0,fn.jsxs)("div",{className:"ml-6",children:[(0,fn.jsx)("p",{className:"text-sm font-semibold text-gray-600 uppercase tracking-wide",children:"Total Revenue"}),(0,fn.jsx)("p",{className:"text-3xl font-bold text-gray-900 mt-1",children:X(h.totalRevenue||0)}),"admin"===(null===c||void 0===c?void 0:c.role)&&(0,fn.jsx)("p",{className:"text-xs text-green-600 font-medium mt-1",children:"\u2197 +12% from last month"})]})]})}),"admin"===(null===c||void 0===c?void 0:c.role)&&(0,fn.jsx)("div",{className:"bg-white/80 backdrop-blur-sm p-6 rounded-2xl shadow-lg border border-blue-200 hover:shadow-xl transition-all duration-300 hover:-translate-y-1",children:(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("div",{className:"p-4 bg-gradient-to-br from-blue-400 to-blue-600 rounded-2xl shadow-lg",children:(0,fn.jsx)(dl,{className:"h-8 w-8 text-white"})}),(0,fn.jsxs)("div",{className:"ml-6",children:[(0,fn.jsx)("p",{className:"text-sm font-semibold text-gray-600 uppercase tracking-wide",children:"Total Sales"}),(0,fn.jsx)("p",{className:"text-3xl font-bold text-gray-900 mt-1",children:h.totalSales||0}),(0,fn.jsx)("p",{className:"text-xs text-blue-600 font-medium mt-1",children:"\u2197 +8% from last month"})]})]})}),(0,fn.jsx)("div",{className:"bg-white/80 backdrop-blur-sm p-6 rounded-2xl shadow-lg border border-purple-200 hover:shadow-xl transition-all duration-300 hover:-translate-y-1",children:(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("div",{className:"p-4 bg-gradient-to-br from-purple-400 to-purple-600 rounded-2xl shadow-lg",children:(0,fn.jsx)(kr,{className:"h-8 w-8 text-white"})}),(0,fn.jsxs)("div",{className:"ml-6",children:[(0,fn.jsx)("p",{className:"text-sm font-semibold text-gray-600 uppercase tracking-wide",children:"admin"===(null===c||void 0===c?void 0:c.role)?"Avg Sale Value":"Your Avg Sale"}),(0,fn.jsx)("p",{className:"text-3xl font-bold text-gray-900 mt-1",children:X(h.averageSaleValue||0)}),"admin"===(null===c||void 0===c?void 0:c.role)&&(0,fn.jsx)("p",{className:"text-xs text-purple-600 font-medium mt-1",children:"\u2197 +5% from last month"})]})]})}),"admin"===(null===c||void 0===c?void 0:c.role)&&(0,fn.jsx)("div",{className:"bg-white/80 backdrop-blur-sm p-6 rounded-2xl shadow-lg border border-orange-200 hover:shadow-xl transition-all duration-300 hover:-translate-y-1",children:(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("div",{className:"p-4 bg-gradient-to-br from-orange-400 to-orange-600 rounded-2xl shadow-lg",children:(0,fn.jsx)(hr,{className:"h-8 w-8 text-white"})}),(0,fn.jsxs)("div",{className:"ml-6",children:[(0,fn.jsx)("p",{className:"text-sm font-semibold text-gray-600 uppercase tracking-wide",children:"Finance Agreements"}),(0,fn.jsx)("p",{className:"text-3xl font-bold text-gray-900 mt-1",children:h.financeAgreements||0}),(0,fn.jsx)("p",{className:"text-xs text-orange-600 font-medium mt-1",children:"\u2197 +3% from last month"})]})]})})]}),(0,fn.jsx)("div",{className:"mb-8",children:(0,fn.jsx)("div",{className:"bg-white/80 backdrop-blur-sm p-6 rounded-2xl shadow-lg border border-gray-200",children:(0,fn.jsxs)("div",{className:"flex flex-wrap gap-6 items-center",children:[(0,fn.jsxs)("div",{className:"flex gap-3",children:[(0,fn.jsxs)("label",{className:"text-sm font-semibold text-gray-700 flex items-center",children:[(0,fn.jsx)(Lr,{className:"mr-2 h-4 w-4"}),"Payment Type:"]}),["all","full_payment","finance"].map(e=>(0,fn.jsx)("button",{onClick:()=>b(e),className:"px-4 py-2 rounded-xl text-sm font-semibold capitalize transition-all duration-200 ".concat(f===e?"bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg transform scale-105":"bg-gray-100 text-gray-700 hover:bg-gray-200 hover:scale-105"),children:e.replace("_"," ")},e))]}),(0,fn.jsxs)("div",{className:"flex gap-3",children:[(0,fn.jsxs)("label",{className:"text-sm font-semibold text-gray-700 flex items-center",children:[(0,fn.jsx)(hr,{className:"mr-2 h-4 w-4"}),"Period:"]}),(0,fn.jsxs)("select",{value:y,onChange:e=>v(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-xl text-sm font-medium focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white shadow-sm hover:shadow-md transition-all duration-200",children:[(0,fn.jsx)("option",{value:"today",children:"Today"}),(0,fn.jsx)("option",{value:"this_week",children:"This Week"}),(0,fn.jsx)("option",{value:"last_week",children:"Last Week"}),(0,fn.jsx)("option",{value:"this_month",children:"This Month"}),(0,fn.jsx)("option",{value:"last_month",children:"Last Month"}),(0,fn.jsx)("option",{value:"this_quarter",children:"This Quarter"}),(0,fn.jsx)("option",{value:"this_year",children:"This Year"})]})]})]})})}),(0,fn.jsxs)("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg border border-gray-200 overflow-hidden",children:[(0,fn.jsx)("div",{className:"bg-gradient-to-r from-gray-50 to-blue-50 px-6 py-4 border-b border-gray-200",children:(0,fn.jsxs)("div",{className:"flex justify-between items-center",children:[(0,fn.jsxs)("h2",{className:"text-xl font-bold text-gray-900 flex items-center",children:[(0,fn.jsx)(dl,{className:"h-6 w-6 text-blue-600 mr-3"}),"Sales History"]}),A.size>0&&(0,fn.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,fn.jsx)("div",{className:"bg-blue-100 px-3 py-1 rounded-full",children:(0,fn.jsxs)("span",{className:"text-sm font-medium text-blue-700",children:[A.size," selected"]})}),(0,fn.jsxs)("button",{onClick:()=>O(!0),className:"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white px-4 py-2 rounded-xl flex items-center space-x-2 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-105",children:[(0,fn.jsx)(nl,{className:"h-4 w-4"}),(0,fn.jsx)("span",{className:"font-semibold",children:"Send Communication"})]}),(0,fn.jsxs)("button",{onClick:()=>M(!0),className:"bg-gradient-to-r from-red-500 to-pink-600 hover:from-red-600 hover:to-pink-700 text-white px-4 py-2 rounded-xl flex items-center space-x-2 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-105",children:[(0,fn.jsx)(cl,{className:"h-4 w-4"}),(0,fn.jsx)("span",{className:"font-semibold",children:"Delete Selected"})]})]})]})}),(0,fn.jsx)("div",{className:"overflow-x-auto",children:(0,fn.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,fn.jsx)("thead",{className:"bg-gradient-to-r from-gray-50 to-blue-50",children:(0,fn.jsxs)("tr",{children:[(0,fn.jsx)("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider w-12",children:(0,fn.jsx)("input",{type:"checkbox",checked:A.size===ne.length&&ne.length>0,onChange:()=>{A.size===ne.length?D(new Set):D(new Set(ne.map(e=>e.id)))},className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded shadow-sm"})}),(0,fn.jsx)("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Customer"}),(0,fn.jsx)("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Sale Date"}),(0,fn.jsx)("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Amount"}),(0,fn.jsx)("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Payment Method"}),(0,fn.jsx)("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Sales Agent"}),(0,fn.jsx)("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Actions"})]})}),(0,fn.jsx)("tbody",{className:"bg-white divide-y divide-gray-100",children:ne.map(e=>(0,fn.jsxs)("tr",{className:"hover:bg-blue-50/50 transition-colors duration-200 ".concat(A.has(e.id)?"bg-blue-50 border-l-4 border-blue-500":""),children:[(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,fn.jsx)("input",{type:"checkbox",checked:A.has(e.id),onChange:()=>(e=>{const t=new Set(A);t.has(e)?t.delete(e):t.add(e),D(t)})(e.id),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"})}),(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("div",{className:"flex-shrink-0 h-10 w-10",children:(0,fn.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:(0,fn.jsx)(gl,{className:"h-5 w-5 text-gray-600"})})}),(0,fn.jsxs)("div",{className:"ml-4",children:[(0,fn.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.lead_name||"Unknown"}),(0,fn.jsx)("div",{className:"text-sm text-gray-500",children:e.lead_email})]})]})}),(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,fn.jsx)("div",{className:"text-sm text-gray-900",children:Z(e.sale_created_at||e.created_at)})}),(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,fn.jsx)("div",{className:"text-sm font-medium text-gray-900",children:X(e.amount)})}),(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,fn.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat(te(e.payment_method)),children:se(e.payment_method)})}),(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,fn.jsx)("div",{className:"text-sm text-gray-900",children:e.user_name||(e.user_id?"User ".concat(e.user_id.slice(-4)):"System")})}),(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,fn.jsxs)("div",{className:"flex space-x-2",children:[(0,fn.jsx)("button",{onClick:()=>J(e),className:"p-2 bg-blue-100 hover:bg-blue-200 text-blue-600 rounded-lg transition-all duration-200 hover:scale-110 shadow-sm hover:shadow-md",title:"View Details",children:(0,fn.jsx)(Ar,{className:"h-4 w-4"})}),"full_payment"===e.payment_type&&(0,fn.jsx)("button",{onClick:()=>(e=>{w(e),$({totalAmount:e.amount,paymentAmount:"",frequency:"monthly",startDate:(new Date).toISOString().split("T")[0],notes:"Finance agreement for ".concat(e.lead_name)}),C(!0)})(e),className:"p-2 bg-green-100 hover:bg-green-200 text-green-600 rounded-lg transition-all duration-200 hover:scale-110 shadow-sm hover:shadow-md",title:"Convert to Finance",children:(0,fn.jsx)(Zr,{className:"h-4 w-4"})}),(0,fn.jsx)("button",{onClick:()=>ee(e.id),className:"p-2 bg-red-100 hover:bg-red-200 text-red-600 rounded-lg transition-all duration-200 hover:scale-110 shadow-sm hover:shadow-md",title:"Delete Sale",children:(0,fn.jsx)(cl,{className:"h-4 w-4"})})]})})]},e.id))})]})})]}),N&&j&&(0,fn.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm overflow-y-auto h-full w-full z-50",children:(0,fn.jsxs)("div",{className:"relative top-10 mx-auto p-0 w-11/12 md:w-4/5 lg:w-3/4 shadow-2xl rounded-2xl bg-white overflow-hidden",children:[(0,fn.jsxs)("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 p-6",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between",children:[(0,fn.jsx)("h3",{className:"text-2xl font-bold text-white",children:"Sale Details"}),(0,fn.jsx)("button",{onClick:()=>k(!1),className:"text-white hover:text-gray-200 transition-colors duration-200",children:(0,fn.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,fn.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,fn.jsxs)("div",{className:"flex space-x-4 mt-4",children:[(0,fn.jsx)("button",{onClick:()=>U("details"),className:"px-4 py-2 rounded-lg font-semibold transition-all duration-200 ".concat("details"===B?"bg-white text-blue-600 shadow-md":"bg-white/20 text-white hover:bg-white/30"),children:"Sale Details"}),(0,fn.jsxs)("button",{onClick:()=>U("communications"),className:"px-4 py-2 rounded-lg font-semibold transition-all duration-200 ".concat("communications"===B?"bg-white text-blue-600 shadow-md":"bg-white/20 text-white hover:bg-white/30"),children:["Communications (",Array.isArray(null===j||void 0===j||null===(e=j.lead)||void 0===e?void 0:e.booking_history)?j.lead.booking_history.filter(e=>["EMAIL_SENT","EMAIL_RECEIVED","SMS_SENT","SMS_RECEIVED"].includes(e.action)).length:0,")"]})]})]}),(0,fn.jsx)("div",{className:"p-6",children:"details"===B?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,fn.jsxs)("div",{className:"bg-gradient-to-br from-blue-50 to-purple-50 p-6 rounded-2xl border border-blue-200",children:[(0,fn.jsxs)("h4",{className:"font-bold text-gray-800 mb-4 flex items-center",children:[(0,fn.jsx)(gl,{className:"h-5 w-5 text-blue-600 mr-2"}),"Customer Information"]}),(0,fn.jsxs)("div",{className:"space-y-3",children:[(0,fn.jsxs)("div",{className:"flex justify-between",children:[(0,fn.jsx)("span",{className:"font-semibold text-gray-600",children:"Name:"}),(0,fn.jsx)("span",{className:"text-gray-900",children:j.lead_name})]}),(0,fn.jsxs)("div",{className:"flex justify-between",children:[(0,fn.jsx)("span",{className:"font-semibold text-gray-600",children:"Email:"}),(0,fn.jsx)("span",{className:"text-gray-900",children:j.lead_email})]}),(0,fn.jsxs)("div",{className:"flex justify-between",children:[(0,fn.jsx)("span",{className:"font-semibold text-gray-600",children:"Phone:"}),(0,fn.jsx)("span",{className:"text-gray-900",children:j.lead_phone})]})]})]}),(0,fn.jsxs)("div",{className:"bg-gradient-to-br from-green-50 to-blue-50 p-6 rounded-2xl border border-green-200",children:[(0,fn.jsxs)("h4",{className:"font-bold text-gray-800 mb-4 flex items-center",children:[(0,fn.jsx)(Sr,{className:"h-5 w-5 text-green-600 mr-2"}),"Sale Information"]}),(0,fn.jsxs)("div",{className:"space-y-3",children:[(0,fn.jsxs)("div",{className:"flex justify-between",children:[(0,fn.jsx)("span",{className:"font-semibold text-gray-600",children:"Sale Date:"}),(0,fn.jsx)("span",{className:"text-gray-900",children:Z(j.sale_created_at||j.created_at)})]}),(0,fn.jsxs)("div",{className:"flex justify-between",children:[(0,fn.jsx)("span",{className:"font-semibold text-gray-600",children:"Amount:"}),(0,fn.jsx)("span",{className:"text-gray-900 font-bold text-green-600",children:X(j.amount)})]}),(0,fn.jsxs)("div",{className:"flex justify-between items-center",children:[(0,fn.jsx)("span",{className:"font-semibold text-gray-600",children:"Payment Method:"}),(0,fn.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat(te(j.payment_method)),children:se(j.payment_method)})]}),(0,fn.jsxs)("div",{className:"flex justify-between",children:[(0,fn.jsx)("span",{className:"font-semibold text-gray-600",children:"Sales Agent:"}),(0,fn.jsx)("span",{className:"text-gray-900",children:j.user_name})]}),(null===z||void 0===z||null===(t=z.contract)||void 0===t||null===(s=t.contract_data)||void 0===s?void 0:s.authCode)&&(0,fn.jsxs)("div",{className:"flex justify-between",children:[(0,fn.jsx)("span",{className:"font-semibold text-gray-600",children:"Auth Code:"}),(0,fn.jsx)("span",{className:"text-gray-900 font-mono bg-gray-100 px-2 py-0.5 rounded",children:z.contract.contract_data.authCode})]})]})]})]}),(0,fn.jsxs)("div",{className:"mt-6 bg-gradient-to-br from-purple-50 to-pink-50 p-6 rounded-2xl border border-purple-200",children:[(0,fn.jsxs)("h4",{className:"font-bold text-gray-800 mb-4 flex items-center",children:[(0,fn.jsx)(Dr,{className:"h-5 w-5 text-purple-600 mr-2"}),"Contract Information"]}),W?(0,fn.jsxs)("div",{className:"flex items-center justify-center py-4",children:[(0,fn.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-purple-500"}),(0,fn.jsx)("span",{className:"ml-2 text-gray-600",children:"Loading contract details..."})]}):null!==z&&void 0!==z&&z.contract?(0,fn.jsxs)("div",{className:"space-y-3",children:[(0,fn.jsxs)("div",{className:"flex justify-between items-center",children:[(0,fn.jsx)("span",{className:"font-semibold text-gray-600",children:"Status:"}),(0,fn.jsx)("span",{className:"flex items-center px-3 py-1 rounded-full text-sm font-semibold ".concat("signed"===z.contract.status?"bg-green-100 text-green-800":"sent"===z.contract.status?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:"signed"===z.contract.status?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(xr,{className:"h-4 w-4 mr-1"})," Signed"]}):"sent"===z.contract.status?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(wr,{className:"h-4 w-4 mr-1"})," Pending Signature"]}):z.contract.status})]}),z.contract.signed_at&&(0,fn.jsxs)("div",{className:"flex justify-between",children:[(0,fn.jsx)("span",{className:"font-semibold text-gray-600",children:"Signed At:"}),(0,fn.jsx)("span",{className:"text-gray-900",children:Z(z.contract.signed_at)})]}),z.contract.signed_pdf_url?(0,fn.jsxs)("div",{className:"flex justify-between items-center",children:[(0,fn.jsx)("span",{className:"font-semibold text-gray-600",children:"Signed Contract:"}),(0,fn.jsxs)("a",{href:z.contract.signed_pdf_url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg hover:from-purple-600 hover:to-pink-600 transition-all duration-200 shadow-md hover:shadow-lg",children:[(0,fn.jsx)(Cr,{className:"h-4 w-4 mr-2"}),"Download PDF"]})]}):"signed"===z.contract.status&&z.contract.contract_token?(0,fn.jsxs)("div",{className:"flex justify-between items-center",children:[(0,fn.jsx)("span",{className:"font-semibold text-gray-600",children:"Signed Contract:"}),(0,fn.jsxs)("a",{href:"/api/contracts/preview/".concat(z.contract.contract_token),target:"_blank",rel:"noopener noreferrer",className:"flex items-center px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all duration-200 shadow-md hover:shadow-lg",children:[(0,fn.jsx)(Ar,{className:"h-4 w-4 mr-2"}),"View PDF"]})]}):"signed"===z.contract.status?(0,fn.jsxs)("div",{className:"flex justify-between items-center",children:[(0,fn.jsx)("span",{className:"font-semibold text-gray-600",children:"Signed Contract:"}),(0,fn.jsx)("span",{className:"text-orange-600 text-sm",children:"PDF not available - contact admin"})]}):null,z.contract.signing_url&&"signed"!==z.contract.status&&(0,fn.jsxs)("div",{className:"flex justify-between items-center",children:[(0,fn.jsx)("span",{className:"font-semibold text-gray-600",children:"Signing Link:"}),(0,fn.jsxs)("a",{href:z.contract.signing_url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all duration-200 shadow-md hover:shadow-lg",children:[(0,fn.jsx)(Tr,{className:"h-4 w-4 mr-2"}),"Open Signing Page"]})]})]}):(0,fn.jsx)("p",{className:"text-gray-500 italic",children:"No contract associated with this sale"})]}),(0,fn.jsxs)("div",{className:"mt-6 bg-gradient-to-br from-orange-50 to-yellow-50 p-6 rounded-2xl border border-orange-200",children:[(0,fn.jsxs)("h4",{className:"font-bold text-gray-800 mb-4 flex items-center",children:[(0,fn.jsx)(Fr,{className:"h-5 w-5 text-orange-600 mr-2"}),"Selected Photos",(null===z||void 0===z||null===(n=z.selected_photos)||void 0===n?void 0:n.length)>0&&(0,fn.jsxs)("span",{className:"ml-2 px-2 py-0.5 bg-orange-200 text-orange-800 text-xs rounded-full",children:[z.selected_photos.length," photos"]})]}),W?(0,fn.jsxs)("div",{className:"flex items-center justify-center py-4",children:[(0,fn.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-orange-500"}),(0,fn.jsx)("span",{className:"ml-2 text-gray-600",children:"Loading photos..."})]}):(null===z||void 0===z||null===(r=z.selected_photos)||void 0===r?void 0:r.length)>0?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:(H?z.selected_photos:z.selected_photos.slice(0,4)).map(e=>(0,fn.jsxs)("div",{className:"relative group",children:[(0,fn.jsx)(gc,{src:Ai(e.cloudinary_secure_url||e.cloudinary_url,"thumbnail"),alt:e.filename||"Selected photo",className:"w-full h-32 object-cover rounded-lg shadow-md group-hover:shadow-xl transition-all duration-200",fallbackSrc:e.cloudinary_secure_url||e.cloudinary_url}),(0,fn.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-200 rounded-lg flex items-center justify-center",children:(0,fn.jsx)("a",{href:e.cloudinary_secure_url||e.cloudinary_url,target:"_blank",rel:"noopener noreferrer",className:"opacity-0 group-hover:opacity-100 p-2 bg-white rounded-full shadow-lg transition-all duration-200",children:(0,fn.jsx)(Tr,{className:"h-4 w-4 text-gray-700"})})})]},e.id))}),z.selected_photos.length>4&&!H&&(0,fn.jsxs)("button",{onClick:()=>Y(!0),className:"mt-4 w-full flex items-center justify-center space-x-2 px-4 py-2 bg-orange-100 hover:bg-orange-200 text-orange-700 rounded-lg transition-colors duration-200",children:[(0,fn.jsx)(fr,{className:"h-4 w-4"}),(0,fn.jsxs)("span",{children:["Show ",z.selected_photos.length-4," more photos"]})]}),H&&z.selected_photos.length>4&&(0,fn.jsxs)("button",{onClick:()=>Y(!1),className:"mt-4 w-full flex items-center justify-center space-x-2 px-4 py-2 bg-orange-100 hover:bg-orange-200 text-orange-700 rounded-lg transition-colors duration-200",children:[(0,fn.jsx)(fr,{className:"h-4 w-4 rotate-180"}),(0,fn.jsx)("span",{children:"Show less"})]})]}):(0,fn.jsx)("p",{className:"text-gray-500 italic",children:"No photos selected for this sale"})]}),j.notes&&!(null!==z&&void 0!==z&&null!==(l=z.parsed_notes)&&void 0!==l&&l.auto_created)&&(0,fn.jsxs)("div",{className:"mt-6 bg-gray-50 p-4 rounded-xl border border-gray-200",children:[(0,fn.jsx)("h4",{className:"font-bold text-gray-800 mb-2",children:"Notes"}),(0,fn.jsx)("p",{className:"text-gray-600",children:j.notes})]}),(0,fn.jsxs)("div",{className:"flex justify-end space-x-3 mt-8",children:[(0,fn.jsxs)("button",{onClick:()=>(async e=>{if(e)try{E(!0),await gn.post("/api/sales/".concat(e.id,"/send-receipt/email"),{email:e.lead_email},{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}),alert("Email receipt sent")}catch(t){console.error("Failed to resend email receipt:",t),alert("Failed to send email receipt")}finally{E(!1)}})(j),disabled:_,className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl hover:from-blue-600 hover:to-blue-700 disabled:opacity-50 flex items-center transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-105",title:"Resend Email Receipt",children:[(0,fn.jsx)(Wr,{className:"h-4 w-4 mr-2"}),_?"Sending...":"Resend Email"]}),(0,fn.jsxs)("button",{onClick:()=>(async e=>{if(e)try{P(!0),await gn.post("/api/sales/".concat(e.id,"/send-receipt/sms"),{phone:e.lead_phone},{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}),alert("SMS receipt sent")}catch(t){console.error("Failed to resend sms receipt:",t),alert("Failed to send SMS receipt")}finally{P(!1)}})(j),disabled:T,className:"px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl hover:from-green-600 hover:to-green-700 disabled:opacity-50 flex items-center transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-105",title:"Resend SMS Receipt",children:[(0,fn.jsx)(Gr,{className:"h-4 w-4 mr-2"}),T?"Sending...":"Resend SMS"]}),(0,fn.jsxs)("button",{onClick:()=>{k(!1),ee(j.id)},className:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-xl hover:from-red-600 hover:to-red-700 flex items-center transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-105",title:"Delete Sale",children:[(0,fn.jsx)(cl,{className:"h-4 w-4 mr-2"}),"Delete Sale"]}),(0,fn.jsx)("button",{onClick:()=>k(!1),className:"px-6 py-3 bg-gradient-to-r from-gray-400 to-gray-500 text-white rounded-xl hover:from-gray-500 hover:to-gray-600 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-105",children:"Close"})]})]}):(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(jd,{bookingHistory:null===j||void 0===j||null===(o=j.lead)||void 0===o?void 0:o.booking_history,title:"Communications History for ".concat(j.lead_name),maxHeight:"max-h-96"}),(0,fn.jsx)("div",{className:"flex justify-end space-x-3 mt-8",children:(0,fn.jsx)("button",{onClick:()=>k(!1),className:"px-6 py-3 bg-gradient-to-r from-gray-400 to-gray-500 text-white rounded-xl hover:from-gray-500 hover:to-gray-600 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-105",children:"Close"})})]})})]})}),S&&j&&(0,fn.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,fn.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-11/12 md:w-2/3 lg:w-1/2 shadow-lg rounded-md bg-white",children:(0,fn.jsxs)("div",{className:"mt-3",children:[(0,fn.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Create Finance Agreement"}),(0,fn.jsxs)("p",{className:"text-sm text-gray-600 mb-4",children:["Convert this sale to a finance agreement for ",null===(i=j.lead)||void 0===i?void 0:i.name]}),(0,fn.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Total Amount"}),(0,fn.jsx)("input",{type:"number",value:G.totalAmount,onChange:e=>$(He(He({},G),{},{totalAmount:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0.00"})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["weekly"===G.frequency?"Weekly":"Monthly"," Payment Amount"]}),(0,fn.jsx)("input",{type:"number",value:G.paymentAmount,onChange:e=>$(He(He({},G),{},{paymentAmount:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter custom payment amount",step:"0.01",min:"0"}),(0,fn.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Set how much the customer will pay each ","weekly"===G.frequency?"week":"month"]})]})]}),(0,fn.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Frequency"}),(0,fn.jsxs)("select",{value:G.frequency,onChange:e=>$(He(He({},G),{},{frequency:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,fn.jsx)("option",{value:"weekly",children:"Weekly"}),(0,fn.jsx)("option",{value:"monthly",children:"Monthly"})]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Date"}),(0,fn.jsx)("input",{type:"date",value:G.startDate,onChange:e=>$(He(He({},G),{},{startDate:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),G.totalAmount&&G.paymentAmount&&(0,fn.jsxs)("div",{className:"bg-gray-50 p-4 rounded-md border",children:[(0,fn.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Payment Summary"}),(0,fn.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("span",{className:"text-gray-600",children:"Total Amount:"}),(0,fn.jsxs)("span",{className:"font-medium ml-2",children:["\xa3",parseFloat(G.totalAmount).toFixed(2)]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("span",{className:"text-gray-600",children:["weekly"===G.frequency?"Weekly":"Monthly"," Payment:"]}),(0,fn.jsxs)("span",{className:"font-medium ml-2",children:["\xa3",parseFloat(G.paymentAmount||0).toFixed(2)]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("span",{className:"text-gray-600",children:"Number of Payments:"}),(0,fn.jsx)("span",{className:"font-medium ml-2",children:G.paymentAmount>0?Math.ceil(parseFloat(G.totalAmount)/parseFloat(G.paymentAmount)):0})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("span",{className:"text-gray-600",children:"Duration:"}),(0,fn.jsx)("span",{className:"font-medium ml-2",children:G.paymentAmount>0?"weekly"===G.frequency?"".concat(Math.ceil(parseFloat(G.totalAmount)/parseFloat(G.paymentAmount))," weeks"):"".concat(Math.ceil(parseFloat(G.totalAmount)/parseFloat(G.paymentAmount))," months"):"0 months"})]})]})]}),(0,fn.jsxs)("div",{className:"mt-4",children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),(0,fn.jsx)("textarea",{value:G.notes,onChange:e=>$(He(He({},G),{},{notes:e.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Additional notes..."})]}),(0,fn.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,fn.jsx)("button",{onClick:()=>C(!1),className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400",children:"Cancel"}),(0,fn.jsx)("button",{onClick:async()=>{try{await gn.post("/api/finance",{leadId:j.lead_id,totalAmount:parseFloat(G.totalAmount),paymentAmount:parseFloat(G.paymentAmount),frequency:G.frequency,startDate:G.startDate,notes:G.notes}),C(!1),$({totalAmount:"",paymentAmount:"",frequency:"monthly",startDate:(new Date).toISOString().split("T")[0],notes:""}),Q(),K()}catch(e){console.error("Error creating finance agreement:",e)}},className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",children:"Create Finance Agreement"})]})]})})}),L&&(0,fn.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,fn.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,fn.jsxs)("div",{className:"mt-3 text-center",children:[(0,fn.jsx)("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100",children:(0,fn.jsx)(cl,{className:"h-6 w-6 text-red-600"})}),(0,fn.jsx)("h3",{className:"text-lg font-medium text-gray-900 mt-4",children:"Delete Selected Sales"}),(0,fn.jsx)("div",{className:"mt-2 px-7 py-3",children:(0,fn.jsxs)("p",{className:"text-sm text-gray-500",children:["Are you sure you want to delete ",A.size," selected sale",1!==A.size?"s":"","? This action cannot be undone."]})}),(0,fn.jsxs)("div",{className:"items-center px-4 py-3 flex justify-center space-x-4",children:[(0,fn.jsx)("button",{onClick:()=>M(!1),className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-300",disabled:R,children:"Cancel"}),(0,fn.jsx)("button",{onClick:async()=>{if(0!==A.size){F(!0);try{const e=await fetch("/api/sales/bulk-delete",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify({saleIds:Array.from(A)})});if(console.log("\ud83d\udce5 Bulk delete response:",e),e.ok){const t=await e.json();console.log("\ud83d\udce5 Bulk delete response data:",t),await Q(),await K(),D(new Set),M(!1);const s=t.message||"Successfully deleted ".concat(A.size," sales");alert(s),console.log("\u2705 Successfully deleted ".concat(A.size," sales"))}else{const t=await e.json();console.error("\u274c Failed to delete sales:",t);const s=t.message||t.error||"Unknown error";s.includes("Failed to delete sales")?alert("Failed to delete sales: "+(t.error||t.details||"Unknown error")):alert("Failed to delete sales: "+s)}}catch(e){console.error("Error deleting sales:",e),alert("Error deleting sales. Please try again.")}finally{F(!1)}}},className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500",disabled:R,children:R?"Deleting...":"Delete"})]})]})})}),(0,fn.jsx)(vd,{isOpen:I,onClose:()=>O(!1),selectedSales:Array.from(A).map(e=>u.find(t=>t.id===e)).filter(Boolean),onSuccess:()=>{Q(),K()}})]})})},Nd=()=>{const{user:e}=wn(),{socket:t}=Ga(),[s,n]=(0,a.useState)("email"),[r,l]=(0,a.useState)([]),[o,i]=(0,a.useState)([]),[c,d]=(0,a.useState)(null),[u,m]=(0,a.useState)(!0),[h,p]=(0,a.useState)(""),[x,g]=(0,a.useState)(""),[f,b]=(0,a.useState)(!1),[y,v]=(0,a.useState)(new Set),[j,w]=(0,a.useState)(!1);(0,a.useEffect)(()=>{try{const e=localStorage.getItem("readMessageIds");if(e){const t=JSON.parse(e);Array.isArray(t)&&v(new Set(t))}}catch(e){console.warn("Error loading read message IDs:",e)}finally{w(!0)}},[]),(0,a.useEffect)(()=>{if(j)try{localStorage.setItem("readMessageIds",JSON.stringify(Array.from(y)))}catch(e){console.warn("Error saving read message IDs:",e)}},[y,j]);const N=(0,a.useCallback)(e=>{const t=new Map;return e.forEach(e=>{if(!e.leadId)return;let n;if("email"===s&&"email"===e.type){const t=(e.subject||"").replace(/^(re|fwd?|fw):\s*/i,"").trim().toLowerCase();n="email_".concat(e.leadId,"_").concat(t)}else{if("sms"!==s||"sms"!==e.type)return;n="sms_".concat(e.leadId)}t.has(n)||t.set(n,{id:n,leadId:e.leadId,leadName:e.leadName,leadEmail:e.leadEmail,leadPhone:e.leadPhone,subject:e.subject||"",messages:[],lastMessage:null,unreadCount:0,timestamp:null,type:s});const a=t.get(n);a.messages.push(e),y.has(e.id)||e.isRead||a.unreadCount++;const r=new Date(e.timestamp||e.created_at);(!a.timestamp||r>a.timestamp)&&(a.lastMessage=e,a.timestamp=r)}),Array.from(t.values()).sort((e,t)=>t.timestamp-e.timestamp)},[s,y]),k=(0,a.useCallback)(async()=>{try{m(!0);const e=await gn.get("/api/messages-list"),t=(e.data.messages||[]).map(e=>He(He({},e),{},{isRead:y.has(e.id)||!0===e.read_status}));l(t);const s=N(t);i(s)}catch(e){console.error("Error fetching messages:",e),l([]),i([])}finally{m(!1)}},[y,N]);(0,a.useEffect)(()=>{j&&k()},[j,k]),(0,a.useEffect)(()=>{const e=N(r);i(e),d(null)},[s,r,N]),(0,a.useEffect)(()=>{if(!j)return;const e=setInterval(k,3e5);return()=>clearInterval(e)},[j,k]),(0,a.useEffect)(()=>{if(!t)return;const e=e=>{("email"===s&&"email"===e.type||"sms"===s&&"sms"===e.type)&&k()};return t.on("message_received",e),t.on("email_received",e),t.on("sms_received",e),()=>{t.off("message_received",e),t.off("email_received",e),t.off("sms_received",e)}},[t,s,k]);const S=e=>{d(e),(async e=>{const t=e.messages.filter(e=>!y.has(e.id));for(const n of t)try{await gn.put("/api/messages-list/".concat(n.id,"/read")),v(e=>new Set([...e,n.id]))}catch(s){console.error("Error marking message as read:",s)}})(e),g("")},C=o.filter(e=>{var t,s,n,a,r;if(!h)return!0;const l=h.toLowerCase();return(null===(t=e.leadName)||void 0===t?void 0:t.toLowerCase().includes(l))||(null===(s=e.leadEmail)||void 0===s?void 0:s.toLowerCase().includes(l))||(null===(n=e.leadPhone)||void 0===n?void 0:n.includes(l))||(null===(a=e.subject)||void 0===a?void 0:a.toLowerCase().includes(l))||(null===(r=e.messages)||void 0===r?void 0:r.some(e=>{var t;return null===(t=e.content)||void 0===t?void 0:t.toLowerCase().includes(l)}))}),_=e=>{if(!e)return"Just now";const t=new Date(e),s=(new Date-t)/36e5;return s<24?t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):s<48?"Yesterday":t.toLocaleDateString()},E=o.filter(e=>"email"===e.type&&e.unreadCount>0).length,T=o.filter(e=>"sms"===e.type&&e.unreadCount>0).length;return(0,fn.jsxs)("div",{className:"h-screen flex flex-col bg-gray-50",children:[(0,fn.jsx)("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:(0,fn.jsxs)("div",{className:"flex items-center justify-between",children:[(0,fn.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Messages"}),(0,fn.jsxs)("button",{onClick:k,disabled:u,className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:[(0,fn.jsx)(el,{className:"h-4 w-4 mr-2 ".concat(u?"animate-spin":"")}),"Refresh"]})]})}),(0,fn.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,fn.jsxs)("div",{className:"w-80 bg-white border-r border-gray-200 flex flex-col",children:[(0,fn.jsxs)("div",{className:"flex border-b border-gray-200",children:[(0,fn.jsxs)("button",{onClick:()=>n("email"),className:"flex-1 px-4 py-3 text-sm font-medium flex items-center justify-center space-x-2 ".concat("email"===s?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"),children:[(0,fn.jsx)(Wr,{className:"h-4 w-4"}),(0,fn.jsx)("span",{children:"Emails"}),E>0&&(0,fn.jsx)("span",{className:"ml-1 px-2 py-0.5 text-xs font-semibold bg-blue-100 text-blue-800 rounded-full",children:E})]}),(0,fn.jsxs)("button",{onClick:()=>n("sms"),className:"flex-1 px-4 py-3 text-sm font-medium flex items-center justify-center space-x-2 ".concat("sms"===s?"text-green-600 border-b-2 border-green-600 bg-green-50":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"),children:[(0,fn.jsx)(Gr,{className:"h-4 w-4"}),(0,fn.jsx)("span",{children:"SMS"}),T>0&&(0,fn.jsx)("span",{className:"ml-1 px-2 py-0.5 text-xs font-semibold bg-green-100 text-green-800 rounded-full",children:T})]})]}),(0,fn.jsx)("div",{className:"p-3 border-b border-gray-200",children:(0,fn.jsxs)("div",{className:"relative",children:[(0,fn.jsx)(sl,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,fn.jsx)("input",{type:"text",placeholder:"Search conversations...",value:h,onChange:e=>p(e.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]})}),(0,fn.jsx)("div",{className:"flex-1 overflow-y-auto",children:u?(0,fn.jsx)("div",{className:"flex items-center justify-center h-32",children:(0,fn.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):0===C.length?(0,fn.jsxs)("div",{className:"text-center py-12 px-4",children:[(0,fn.jsx)("div",{className:"text-gray-400 mb-2",children:"email"===s?(0,fn.jsx)(Wr,{className:"h-12 w-12 mx-auto"}):(0,fn.jsx)(Gr,{className:"h-12 w-12 mx-auto"})}),(0,fn.jsxs)("p",{className:"text-sm text-gray-500",children:["No ","email"===s?"emails":"messages"," found"]})]}):C.map(e=>{var t;return(0,fn.jsxs)("div",{onClick:()=>S(e),className:"px-4 py-3 border-b border-gray-100 cursor-pointer transition-all ".concat((null===c||void 0===c?void 0:c.id)===e.id?"bg-blue-50 border-l-4 border-l-blue-600":e.unreadCount>0?"bg-blue-50/50 hover:bg-blue-50":"hover:bg-gray-50"),children:[(0,fn.jsxs)("div",{className:"flex items-start justify-between mb-1",children:[(0,fn.jsx)("p",{className:"text-sm font-medium truncate ".concat(e.unreadCount>0?"text-gray-900 font-semibold":"text-gray-700"),children:e.leadName}),(0,fn.jsx)("span",{className:"text-xs text-gray-500 ml-2 flex-shrink-0",children:_(e.timestamp)})]}),"email"===s&&e.subject&&(0,fn.jsx)("p",{className:"text-xs mb-1 truncate ".concat(e.unreadCount>0?"text-gray-900 font-medium":"text-gray-600"),children:e.subject}),(0,fn.jsx)("p",{className:"text-xs text-gray-500 truncate",children:Tl((null===(t=e.lastMessage)||void 0===t?void 0:t.content)||"",60)}),e.unreadCount>0&&(0,fn.jsx)("div",{className:"mt-1 flex items-center space-x-1",children:(0,fn.jsxs)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800",children:[e.unreadCount," unread"]})})]},e.id)})})]}),(0,fn.jsx)("div",{className:"flex-1 flex flex-col bg-gray-50",children:c?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsxs)("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,fn.jsx)("button",{onClick:()=>d(null),className:"lg:hidden text-gray-500 hover:text-gray-700",children:(0,fn.jsx)(br,{className:"h-5 w-5"})}),(0,fn.jsxs)("div",{className:"flex-1",children:[(0,fn.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:c.leadName}),"email"===s?(0,fn.jsx)("p",{className:"text-sm text-gray-500",children:c.leadEmail}):(0,fn.jsx)("p",{className:"text-sm text-gray-500",children:c.leadPhone})]}),(0,fn.jsx)("div",{className:"flex items-center space-x-2",children:(0,fn.jsx)("button",{className:"p-2 text-gray-400 hover:text-yellow-500 hover:bg-gray-100 rounded-lg",children:(0,fn.jsx)(ol,{className:"h-5 w-5"})})})]}),"email"===s&&c.subject&&(0,fn.jsxs)("p",{className:"mt-2 text-sm font-medium text-gray-700",children:["Subject: ",c.subject]})]}),(0,fn.jsx)("div",{className:"flex-1 overflow-y-auto px-6 py-4 space-y-4",children:c.messages.sort((e,t)=>new Date(e.timestamp||e.created_at)-new Date(t.timestamp||t.created_at)).map((e,t)=>{var n;return(0,fn.jsxs)("div",{className:"rounded-lg shadow-sm border p-4 ".concat("sent"===e.direction?"bg-blue-50 border-blue-200 ml-12":"bg-white border-gray-200 mr-12"),children:[(0,fn.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,fn.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ".concat("sent"===e.direction?"bg-blue-600":"bg-gray-600"),children:(0,fn.jsx)("span",{className:"text-white text-sm font-medium",children:"sent"===e.direction?"Y":((null===(n=e.leadName)||void 0===n?void 0:n[0])||"?").toUpperCase()})}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"sent"===e.direction?"You":e.leadName}),(0,fn.jsx)("p",{className:"text-xs text-gray-500",children:"sent"===e.direction?c.leadEmail||c.leadPhone:"email"===s?c.leadEmail:c.leadPhone})]})]}),(0,fn.jsxs)("div",{className:"flex items-center space-x-2 text-xs text-gray-500",children:[(0,fn.jsx)(wr,{className:"h-3 w-3"}),(0,fn.jsx)("span",{children:_(e.timestamp||e.created_at)})]})]}),(0,fn.jsx)("div",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:e.content})]},e.id||t)})}),(0,fn.jsxs)("div",{className:"bg-white border-t border-gray-200 px-6 py-4",children:[(0,fn.jsxs)("div",{className:"mb-3",children:[(0,fn.jsxs)("p",{className:"text-sm text-gray-600 mb-2",children:["Reply to ","email"===s?c.leadEmail:c.leadPhone]}),(0,fn.jsx)("textarea",{value:x,onChange:e=>g(e.target.value),placeholder:"Type your ".concat("email"===s?"email":"message"," here..."),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"})]}),(0,fn.jsxs)("div",{className:"flex items-center justify-between",children:[(0,fn.jsx)("div",{className:"flex items-center space-x-2",children:"email"===s&&(0,fn.jsx)("button",{className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg",children:(0,fn.jsx)(Qr,{className:"h-5 w-5"})})}),(0,fn.jsx)("button",{onClick:async()=>{if(x.trim()&&c)try{b(!0),"email"===s?await gn.post("/api/messages/send-email",{leadId:c.leadId,to:c.leadEmail,subject:c.subject.startsWith("Re:")?c.subject:"Re: ".concat(c.subject),body:x}):await gn.post("/api/messages/send-sms",{leadId:c.leadId,to:c.leadPhone,message:x}),g(""),setTimeout(k,1e3)}catch(e){console.error("Error sending reply:",e),alert("Failed to send message")}finally{b(!1)}},disabled:!x.trim()||f,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:f?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Sending..."]}):(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(nl,{className:"h-4 w-4 mr-2"}),"Send ","email"===s?"Email":"SMS"]})})]})]})]}):(0,fn.jsx)("div",{className:"flex-1 flex items-center justify-center text-gray-400",children:(0,fn.jsxs)("div",{className:"text-center",children:["email"===s?(0,fn.jsx)(Wr,{className:"h-16 w-16 mx-auto mb-4"}):(0,fn.jsx)(Gr,{className:"h-16 w-16 mx-auto mb-4"}),(0,fn.jsx)("p",{className:"text-lg font-medium",children:"Select a conversation"}),(0,fn.jsxs)("p",{className:"text-sm mt-1",children:["Choose a ","email"===s?"email thread":"conversation"," from the list to view messages"]})]})})})]})]})},kd=(0,a.createContext)({});function Sd(e){const t=(0,a.useRef)(null);return null===t.current&&(t.current=e()),t.current}const Cd="undefined"!==typeof window,_d=Cd?a.useLayoutEffect:a.useEffect,Ed=(0,a.createContext)(null);function Td(e){return"object"===typeof e&&null!==e}function Pd(e){return Td(e)&&"offsetHeight"in e}const Ad=(0,a.createContext)({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});function Dd(e,t){if("function"===typeof e)return e(t);null!==e&&void 0!==e&&(e.current=t)}function Ld(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return a.useCallback(function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return e=>{let s=!1;const n=t.map(t=>{const n=Dd(t,e);return s||"function"!==typeof n||(s=!0),n});if(s)return()=>{for(let e=0;e<n.length;e++){const s=n[e];"function"===typeof s?s():Dd(t[e],null)}}}}(...t),t)}class Md extends a.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const e=t.offsetParent,s=Pd(e)&&e.offsetWidth||0,n=this.props.sizeRef.current;n.height=t.offsetHeight||0,n.width=t.offsetWidth||0,n.top=t.offsetTop,n.left=t.offsetLeft,n.right=s-n.width-n.left}return null}componentDidUpdate(){}render(){return this.props.children}}function Rd(e){let{children:t,isPresent:s,anchorX:n,root:r}=e;const l=(0,a.useId)(),o=(0,a.useRef)(null),i=(0,a.useRef)({width:0,height:0,top:0,left:0,right:0}),{nonce:c}=(0,a.useContext)(Ad),d=Ld(o,null===t||void 0===t?void 0:t.ref);return(0,a.useInsertionEffect)(()=>{const{width:e,height:t,top:a,left:d,right:u}=i.current;if(s||!o.current||!e||!t)return;const m="left"===n?"left: ".concat(d):"right: ".concat(u);o.current.dataset.motionPopId=l;const h=document.createElement("style");c&&(h.nonce=c);const p=null!==r&&void 0!==r?r:document.head;return p.appendChild(h),h.sheet&&h.sheet.insertRule('\n          [data-motion-pop-id="'.concat(l,'"] {\n            position: absolute !important;\n            width: ').concat(e,"px !important;\n            height: ").concat(t,"px !important;\n            ").concat(m,"px !important;\n            top: ").concat(a,"px !important;\n          }\n        ")),()=>{p.contains(h)&&p.removeChild(h)}},[s]),(0,fn.jsx)(Md,{isPresent:s,childRef:o,sizeRef:i,children:a.cloneElement(t,{ref:d})})}const Fd=e=>{let{children:t,initial:s,isPresent:n,onExitComplete:r,custom:l,presenceAffectsLayout:o,mode:i,anchorX:c,root:d}=e;const u=Sd(Id),m=(0,a.useId)();let h=!0,p=(0,a.useMemo)(()=>(h=!1,{id:m,initial:s,isPresent:n,custom:l,onExitComplete:e=>{u.set(e,!0);for(const t of u.values())if(!t)return;r&&r()},register:e=>(u.set(e,!1),()=>u.delete(e))}),[n,u,r]);return o&&h&&(p=He({},p)),(0,a.useMemo)(()=>{u.forEach((e,t)=>u.set(t,!1))},[n]),a.useEffect(()=>{!n&&!u.size&&r&&r()},[n]),"popLayout"===i&&(t=(0,fn.jsx)(Rd,{isPresent:n,anchorX:c,root:d,children:t})),(0,fn.jsx)(Ed.Provider,{value:p,children:t})};function Id(){return new Map}function Od(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=(0,a.useContext)(Ed);if(null===t)return[!0,null];const{isPresent:s,onExitComplete:n,register:r}=t,l=(0,a.useId)();(0,a.useEffect)(()=>{if(e)return r(l)},[e]);const o=(0,a.useCallback)(()=>e&&n&&n(l),[l,n,e]);return!s&&n?[!1,o]:[!0]}const Bd=e=>e.key||"";function Ud(e){const t=[];return a.Children.forEach(e,e=>{(0,a.isValidElement)(e)&&t.push(e)}),t}const zd=e=>{let{children:t,custom:s,initial:n=!0,onExitComplete:r,presenceAffectsLayout:l=!0,mode:o="sync",propagate:i=!1,anchorX:c="left",root:d}=e;const[u,m]=Od(i),h=(0,a.useMemo)(()=>Ud(t),[t]),p=i&&!u?[]:h.map(Bd),x=(0,a.useRef)(!0),g=(0,a.useRef)(h),f=Sd(()=>new Map),[b,y]=(0,a.useState)(h),[v,j]=(0,a.useState)(h);_d(()=>{x.current=!1,g.current=h;for(let e=0;e<v.length;e++){const t=Bd(v[e]);p.includes(t)?f.delete(t):!0!==f.get(t)&&f.set(t,!1)}},[v,p.length,p.join("-")]);const w=[];if(h!==b){let e=[...h];for(let t=0;t<v.length;t++){const s=v[t],n=Bd(s);p.includes(n)||(e.splice(t,0,s),w.push(s))}return"wait"===o&&w.length&&(e=w),j(Ud(e)),y(h),null}const{forceRender:N}=(0,a.useContext)(kd);return(0,fn.jsx)(fn.Fragment,{children:v.map(e=>{const t=Bd(e),a=!(i&&!u)&&(h===v||p.includes(t));return(0,fn.jsx)(Fd,{isPresent:a,initial:!(x.current&&!n)&&void 0,custom:s,presenceAffectsLayout:l,mode:o,root:d,onExitComplete:a?void 0:()=>{if(!f.has(t))return;f.set(t,!0);let e=!0;f.forEach(t=>{t||(e=!1)}),e&&(null===N||void 0===N||N(),j(g.current),i&&(null===m||void 0===m||m()),r&&r())},anchorX:c,children:e},t)})})},Vd=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Wd=(()=>new Set(Vd))(),qd=e=>180*e/Math.PI,Hd=e=>{const t=qd(Math.atan2(e[1],e[0]));return Gd(t)},Yd={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate:Hd,rotateZ:Hd,skewX:e=>qd(Math.atan(e[1])),skewY:e=>qd(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},Gd=e=>((e%=360)<0&&(e+=360),e),$d=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),Qd=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),Kd={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:$d,scaleY:Qd,scale:e=>($d(e)+Qd(e))/2,rotateX:e=>Gd(qd(Math.atan2(e[6],e[5]))),rotateY:e=>Gd(qd(Math.atan2(-e[2],e[0]))),rotateZ:Hd,rotate:Hd,skewX:e=>qd(Math.atan(e[4])),skewY:e=>qd(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function Jd(e){return e.includes("scale")?1:0}function Xd(e,t){if(!e||"none"===e)return Jd(t);const s=e.match(/^matrix3d\(([\t-\r ,-\.0-9e\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+)\)$/);let n,a;if(s)n=Kd,a=s;else{const t=e.match(/^matrix\(([\t-\r ,-\.0-9e\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+)\)$/);n=Yd,a=t}if(!a)return Jd(t);const r=n[t],l=a[1].split(",").map(Zd);return"function"===typeof r?r(l):l[r]}function Zd(e){return parseFloat(e.trim())}const eu=e=>t=>"string"===typeof t&&t.startsWith(e),tu=eu("--"),su=eu("var(--"),nu=e=>!!su(e)&&au.test(e.split("/*")[0].trim()),au=/var\(--(?:[\x2D0-9A-Z_a-z\u017F\u212A]+[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*|[\x2D0-9A-Z_a-z\u017F\u212A]+[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*,(?:[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*(?:(?![\t-\r \(\)\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uD800-\uDFFF\uFEFF])[^]|[\uD800-\uDBFF][\uDC00-\uDFFF])|[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*\((?:(?:(?![\(\)\uD800-\uDFFF])[^]|[\uD800-\uDBFF][\uDC00-\uDFFF])|\((?:(?![\(\)\uD800-\uDFFF])[^]|[\uD800-\uDBFF][\uDC00-\uDFFF])*\))*\))+[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*)\)$/i;function ru(e){let{top:t,left:s,right:n,bottom:a}=e;return{x:{min:s,max:n},y:{min:t,max:a}}}const lu=(e,t,s)=>e+(t-e)*s;function ou(e){return void 0===e||1===e}function iu(e){let{scale:t,scaleX:s,scaleY:n}=e;return!ou(t)||!ou(s)||!ou(n)}function cu(e){return iu(e)||du(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function du(e){return uu(e.x)||uu(e.y)}function uu(e){return e&&"0%"!==e}function mu(e,t,s){return s+t*(e-s)}function hu(e,t,s,n,a){return void 0!==a&&(e=mu(e,a,n)),mu(e,s,n)+t}function pu(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;e.min=hu(e.min,t,s,n,a),e.max=hu(e.max,t,s,n,a)}function xu(e,t){let{x:s,y:n}=t;pu(e.x,s.translate,s.scale,s.originPoint),pu(e.y,n.translate,n.scale,n.originPoint)}const gu=.999999999999,fu=1.0000000000001;function bu(e,t){e.min=e.min+t,e.max=e.max+t}function yu(e,t,s,n){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5;pu(e,t,s,lu(e.min,e.max,a),n)}function vu(e,t){yu(e.x,t.x,t.scaleX,t.scale,t.originX),yu(e.y,t.y,t.scaleY,t.scale,t.originY)}function ju(e,t){return ru(function(e,t){if(!t)return e;const s=t({x:e.left,y:e.top}),n=t({x:e.right,y:e.bottom});return{top:s.y,left:s.x,bottom:n.y,right:n.x}}(e.getBoundingClientRect(),t))}const wu=new Set(["width","height","top","left","right","bottom",...Vd]),Nu=(e,t,s)=>s>t?t:s<e?e:s,ku={test:e=>"number"===typeof e,parse:parseFloat,transform:e=>e},Su=He(He({},ku),{},{transform:e=>Nu(0,1,e)}),Cu=He(He({},ku),{},{default:1}),_u=e=>({test:t=>"string"===typeof t&&t.endsWith(e)&&1===t.split(" ").length,parse:parseFloat,transform:t=>"".concat(t).concat(e)}),Eu=_u("deg"),Tu=_u("%"),Pu=_u("px"),Au=_u("vh"),Du=_u("vw"),Lu=(()=>He(He({},Tu),{},{parse:e=>Tu.parse(e)/100,transform:e=>Tu.transform(100*e)}))(),Mu=e=>t=>t.test(e),Ru=[ku,Pu,Tu,Eu,Du,Au,{test:e=>"auto"===e,parse:e=>e}],Fu=e=>Ru.find(Mu(e));const Iu=e=>/^-?(?:[0-9]+(?:\.[0-9]+)?|\.[0-9]+)$/.test(e),Ou=/^var\(--(?:([\x2D0-9A-Z_a-z]+)|([\x2D0-9A-Z_a-z]+), ?([ #%\(\),-\.0-9A-Za-z]+))\)/;function Bu(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;'Max CSS variable fallback depth detected in property "'.concat(e,'". This may indicate a circular fallback dependency.');const[n,a]=function(e){const t=Ou.exec(e);if(!t)return[,];const[,s,n,a]=t;return["--".concat(null!==s&&void 0!==s?s:n),a]}(e);if(!n)return;const r=window.getComputedStyle(t).getPropertyValue(n);if(r){const e=r.trim();return Iu(e)?parseFloat(e):e}return nu(a)?Bu(a,t,s+1):a}const Uu=e=>e===ku||e===Pu,zu=new Set(["x","y","z"]),Vu=Vd.filter(e=>!zu.has(e));const Wu={width:(e,t)=>{let{x:s}=e,{paddingLeft:n="0",paddingRight:a="0"}=t;return s.max-s.min-parseFloat(n)-parseFloat(a)},height:(e,t)=>{let{y:s}=e,{paddingTop:n="0",paddingBottom:a="0"}=t;return s.max-s.min-parseFloat(n)-parseFloat(a)},top:(e,t)=>{let{top:s}=t;return parseFloat(s)},left:(e,t)=>{let{left:s}=t;return parseFloat(s)},bottom:(e,t)=>{let{y:s}=e,{top:n}=t;return parseFloat(n)+(s.max-s.min)},right:(e,t)=>{let{x:s}=e,{left:n}=t;return parseFloat(n)+(s.max-s.min)},x:(e,t)=>{let{transform:s}=t;return Xd(s,"x")},y:(e,t)=>{let{transform:s}=t;return Xd(s,"y")}};Wu.translateX=Wu.x,Wu.translateY=Wu.y;const qu=e=>e,Hu={},Yu=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"],Gu={value:null,addProjectionMetrics:null};function $u(e,t){let s=!1,n=!0;const a={delta:0,timestamp:0,isProcessing:!1},r=()=>s=!0,l=Yu.reduce((e,s)=>(e[s]=function(e,t){let s=new Set,n=new Set,a=!1,r=!1;const l=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1},i=0;function c(t){l.has(t)&&(d.schedule(t),e()),i++,t(o)}const d={schedule:function(e){const t=arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&a?s:n;return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&l.add(e),t.has(e)||t.add(e),e},cancel:e=>{n.delete(e),l.delete(e)},process:e=>{o=e,a?r=!0:(a=!0,[s,n]=[n,s],s.forEach(c),t&&Gu.value&&Gu.value.frameloop[t].push(i),i=0,s.clear(),a=!1,r&&(r=!1,d.process(e)))}};return d}(r,t?s:void 0),e),{}),{setup:o,read:i,resolveKeyframes:c,preUpdate:d,update:u,preRender:m,render:h,postRender:p}=l,x=()=>{const r=Hu.useManualTiming?a.timestamp:performance.now();s=!1,Hu.useManualTiming||(a.delta=n?1e3/60:Math.max(Math.min(r-a.timestamp,40),1)),a.timestamp=r,a.isProcessing=!0,o.process(a),i.process(a),c.process(a),d.process(a),u.process(a),m.process(a),h.process(a),p.process(a),a.isProcessing=!1,s&&t&&(n=!1,e(x))},g=Yu.reduce((t,r)=>{const o=l[r];return t[r]=function(t){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return s||(s=!0,n=!0,a.isProcessing||e(x)),o.schedule(t,r,l)},t},{});return{schedule:g,cancel:e=>{for(let t=0;t<Yu.length;t++)l[Yu[t]].cancel(e)},state:a,steps:l}}const{schedule:Qu,cancel:Ku,state:Ju,steps:Xu}=$u("undefined"!==typeof requestAnimationFrame?requestAnimationFrame:qu,!0),Zu=new Set;let em=!1,tm=!1,sm=!1;function nm(){if(tm){const e=Array.from(Zu).filter(e=>e.needsMeasurement),t=new Set(e.map(e=>e.element)),s=new Map;t.forEach(e=>{const t=function(e){const t=[];return Vu.forEach(s=>{const n=e.getValue(s);void 0!==n&&(t.push([s,n.get()]),n.set(s.startsWith("scale")?1:0))}),t}(e);t.length&&(s.set(e,t),e.render())}),e.forEach(e=>e.measureInitialState()),t.forEach(e=>{e.render();const t=s.get(e);t&&t.forEach(t=>{var s;let[n,a]=t;null===(s=e.getValue(n))||void 0===s||s.set(a)})}),e.forEach(e=>e.measureEndState()),e.forEach(e=>{void 0!==e.suspendedScrollY&&window.scrollTo(0,e.suspendedScrollY)})}tm=!1,em=!1,Zu.forEach(e=>e.complete(sm)),Zu.clear()}function am(){Zu.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(tm=!0)})}class rm{constructor(e,t,s,n,a){let r=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=s,this.motionValue=n,this.element=a,this.isAsync=r}scheduleResolve(){this.state="scheduled",this.isAsync?(Zu.add(this),em||(em=!0,Qu.read(am),Qu.resolveKeyframes(nm))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:s,motionValue:n}=this;if(null===e[0]){const a=null===n||void 0===n?void 0:n.get(),r=e[e.length-1];if(void 0!==a)e[0]=a;else if(s&&t){const n=s.readValue(t,r);void 0!==n&&null!==n&&(e[0]=n)}void 0===e[0]&&(e[0]=r),n&&void 0===a&&n.set(e[0])}!function(e){for(let s=1;s<e.length;s++){var t;null!==(t=e[s])&&void 0!==t||(e[s]=e[s-1])}}(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),Zu.delete(this)}cancel(){"scheduled"===this.state&&(Zu.delete(this),this.state="pending")}resume(){"pending"===this.state&&this.scheduleResolve()}}const lm=e=>/^0(?:[\0-\x08\x0E-\x1F!-\x2D\/-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+$/.test(e);function om(e){return"number"===typeof e?0===e:null===e||("none"===e||"0"===e||lm(e))}const im=e=>Math.round(1e5*e)/1e5,cm=/-?(?:[0-9]+(?:\.[0-9]+)?|\.[0-9]+)/g;const dm=/^(?:#[0-9a-f]{3,8}|(?:rgb|h[s\u017F]l)a?\((?:-?[\.0-9]+%?[\t-\r ,\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+){2}-?[\.0-9]+%?[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*(?:[,\/][\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*)?(?:\b[0-9]+(?:\.[0-9]+)?|\.[0-9]+)?%?\))$/i,um=(e,t)=>s=>Boolean("string"===typeof s&&dm.test(s)&&s.startsWith(e)||t&&!function(e){return null==e}(s)&&Object.prototype.hasOwnProperty.call(s,t)),mm=(e,t,s)=>n=>{if("string"!==typeof n)return n;const[a,r,l,o]=n.match(cm);return{[e]:parseFloat(a),[t]:parseFloat(r),[s]:parseFloat(l),alpha:void 0!==o?parseFloat(o):1}},hm=He(He({},ku),{},{transform:e=>Math.round((e=>Nu(0,255,e))(e))}),pm={test:um("rgb","red"),parse:mm("red","green","blue"),transform:e=>{let{red:t,green:s,blue:n,alpha:a=1}=e;return"rgba("+hm.transform(t)+", "+hm.transform(s)+", "+hm.transform(n)+", "+im(Su.transform(a))+")"}};const xm={test:um("#"),parse:function(e){let t="",s="",n="",a="";return e.length>5?(t=e.substring(1,3),s=e.substring(3,5),n=e.substring(5,7),a=e.substring(7,9)):(t=e.substring(1,2),s=e.substring(2,3),n=e.substring(3,4),a=e.substring(4,5),t+=t,s+=s,n+=n,a+=a),{red:parseInt(t,16),green:parseInt(s,16),blue:parseInt(n,16),alpha:a?parseInt(a,16)/255:1}},transform:pm.transform},gm={test:um("hsl","hue"),parse:mm("hue","saturation","lightness"),transform:e=>{let{hue:t,saturation:s,lightness:n,alpha:a=1}=e;return"hsla("+Math.round(t)+", "+Tu.transform(im(s))+", "+Tu.transform(im(n))+", "+im(Su.transform(a))+")"}},fm={test:e=>pm.test(e)||xm.test(e)||gm.test(e),parse:e=>pm.test(e)?pm.parse(e):gm.test(e)?gm.parse(e):xm.parse(e),transform:e=>"string"===typeof e?e:e.hasOwnProperty("red")?pm.transform(e):gm.transform(e),getAnimatableNone:e=>{const t=fm.parse(e);return t.alpha=0,fm.transform(t)}},bm=/(?:#[0-9a-f]{3,8}|(?:rgb|h[s\u017F]l)a?\((?:-?[\.0-9]+%?[\t-\r ,\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+){2}-?[\.0-9]+%?[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*(?:[,\/][\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*)?(?:\b[0-9]+(?:\.[0-9]+)?|\.[0-9]+)?%?\))/gi;const ym="number",vm="color",jm=/var[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*\([\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*--(?:[\x2D0-9A-Z_a-z\u017F\u212A]+[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*|[\x2D0-9A-Z_a-z\u017F\u212A]+[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*,(?:[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*(?:(?![\t-\r \(\)\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uD800-\uDFFF\uFEFF])[^]|[\uD800-\uDBFF][\uDC00-\uDFFF])|[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*\((?:(?:(?![\(\)\uD800-\uDFFF])[^]|[\uD800-\uDBFF][\uDC00-\uDFFF])|\((?:(?![\(\)\uD800-\uDFFF])[^]|[\uD800-\uDBFF][\uDC00-\uDFFF])*\))*\))+[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*)\)|#[0-9a-f]{3,8}|(?:rgb|h[s\u017F]l)a?\((?:-?[\.0-9]+%?[\t-\r ,\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+){2}-?[\.0-9]+%?[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*(?:[,\/][\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*)?(?:\b[0-9]+(?:\.[0-9]+)?|\.[0-9]+)?%?\)|-?(?:[0-9]+(?:\.[0-9]+)?|\.[0-9]+)/gi;function wm(e){const t=e.toString(),s=[],n={color:[],number:[],var:[]},a=[];let r=0;const l=t.replace(jm,e=>(fm.test(e)?(n.color.push(r),a.push(vm),s.push(fm.parse(e))):e.startsWith("var(")?(n.var.push(r),a.push("var"),s.push(e)):(n.number.push(r),a.push(ym),s.push(parseFloat(e))),++r,"${}")).split("${}");return{values:s,split:l,indexes:n,types:a}}function Nm(e){return wm(e).values}function km(e){const{split:t,types:s}=wm(e),n=t.length;return e=>{let a="";for(let r=0;r<n;r++)if(a+=t[r],void 0!==e[r]){const t=s[r];a+=t===ym?im(e[r]):t===vm?fm.transform(e[r]):e[r]}return a}}const Sm=e=>"number"===typeof e?0:fm.test(e)?fm.getAnimatableNone(e):e;const Cm={test:function(e){var t,s;return isNaN(e)&&"string"===typeof e&&((null===(t=e.match(cm))||void 0===t?void 0:t.length)||0)+((null===(s=e.match(bm))||void 0===s?void 0:s.length)||0)>0},parse:Nm,createTransformer:km,getAnimatableNone:function(e){const t=Nm(e);return km(e)(t.map(Sm))}},_m=new Set(["brightness","contrast","saturate","opacity"]);function Em(e){const[t,s]=e.slice(0,-1).split("(");if("drop-shadow"===t)return e;const[n]=s.match(cm)||[];if(!n)return e;const a=s.replace(n,"");let r=_m.has(t)?1:0;return n!==s&&(r*=100),t+"("+r+a+")"}const Tm=/\b([\x2Da-z]*)\((?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*?\)/g,Pm=He(He({},Cm),{},{getAnimatableNone:e=>{const t=e.match(Tm);return t?t.map(Em).join(" "):e}}),Am=He(He({},ku),{},{transform:Math.round}),Dm=He(He({borderWidth:Pu,borderTopWidth:Pu,borderRightWidth:Pu,borderBottomWidth:Pu,borderLeftWidth:Pu,borderRadius:Pu,radius:Pu,borderTopLeftRadius:Pu,borderTopRightRadius:Pu,borderBottomRightRadius:Pu,borderBottomLeftRadius:Pu,width:Pu,maxWidth:Pu,height:Pu,maxHeight:Pu,top:Pu,right:Pu,bottom:Pu,left:Pu,padding:Pu,paddingTop:Pu,paddingRight:Pu,paddingBottom:Pu,paddingLeft:Pu,margin:Pu,marginTop:Pu,marginRight:Pu,marginBottom:Pu,marginLeft:Pu,backgroundPositionX:Pu,backgroundPositionY:Pu},{rotate:Eu,rotateX:Eu,rotateY:Eu,rotateZ:Eu,scale:Cu,scaleX:Cu,scaleY:Cu,scaleZ:Cu,skew:Eu,skewX:Eu,skewY:Eu,distance:Pu,translateX:Pu,translateY:Pu,translateZ:Pu,x:Pu,y:Pu,z:Pu,perspective:Pu,transformPerspective:Pu,opacity:Su,originX:Lu,originY:Lu,originZ:Pu}),{},{zIndex:Am,fillOpacity:Su,strokeOpacity:Su,numOctaves:Am}),Lm=He(He({},Dm),{},{color:fm,backgroundColor:fm,outlineColor:fm,fill:fm,stroke:fm,borderColor:fm,borderTopColor:fm,borderRightColor:fm,borderBottomColor:fm,borderLeftColor:fm,filter:Pm,WebkitFilter:Pm}),Mm=e=>Lm[e];function Rm(e,t){let s=Mm(e);return s!==Pm&&(s=Cm),s.getAnimatableNone?s.getAnimatableNone(t):void 0}const Fm=new Set(["auto","none","0"]);class Im extends rm{constructor(e,t,s,n,a){super(e,t,s,n,a,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:s}=this;if(!t||!t.current)return;super.readKeyframes();for(let o=0;o<e.length;o++){let s=e[o];if("string"===typeof s&&(s=s.trim(),nu(s))){const n=Bu(s,t.current);void 0!==n&&(e[o]=n),o===e.length-1&&(this.finalKeyframe=s)}}if(this.resolveNoneKeyframes(),!wu.has(s)||2!==e.length)return;const[n,a]=e,r=Fu(n),l=Fu(a);if(r!==l)if(Uu(r)&&Uu(l))for(let o=0;o<e.length;o++){const t=e[o];"string"===typeof t&&(e[o]=parseFloat(t))}else Wu[s]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,s=[];for(let n=0;n<e.length;n++)(null===e[n]||om(e[n]))&&s.push(n);s.length&&function(e,t,s){let n,a=0;for(;a<e.length&&!n;){const t=e[a];"string"===typeof t&&!Fm.has(t)&&wm(t).values.length&&(n=e[a]),a++}if(n&&s)for(const r of t)e[r]=Rm(s,n)}(e,s,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:s}=this;if(!e||!e.current)return;"height"===s&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Wu[s](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const n=t[t.length-1];void 0!==n&&e.getValue(s,n).jump(n,!1)}measureEndState(){var e;const{element:t,name:s,unresolvedKeyframes:n}=this;if(!t||!t.current)return;const a=t.getValue(s);a&&a.jump(this.measuredOrigin,!1);const r=n.length-1,l=n[r];n[r]=Wu[s](t.measureViewportBox(),window.getComputedStyle(t.current)),null!==l&&void 0===this.finalKeyframe&&(this.finalKeyframe=l),null!==(e=this.removedTransforms)&&void 0!==e&&e.length&&this.removedTransforms.forEach(e=>{let[s,n]=e;t.getValue(s).set(n)}),this.resolveNoneKeyframes()}}const Om=e=>Boolean(e&&e.getVelocity);let Bm;function Um(){Bm=void 0}const zm={now:()=>(void 0===Bm&&zm.set(Ju.isProcessing||Hu.useManualTiming?Ju.timestamp:performance.now()),Bm),set:e=>{Bm=e,queueMicrotask(Um)}};function Vm(e,t){-1===e.indexOf(t)&&e.push(t)}function Wm(e,t){const s=e.indexOf(t);s>-1&&e.splice(s,1)}class qm{constructor(){this.subscriptions=[]}add(e){return Vm(this.subscriptions,e),()=>Wm(this.subscriptions,e)}notify(e,t,s){const n=this.subscriptions.length;if(n)if(1===n)this.subscriptions[0](e,t,s);else for(let a=0;a<n;a++){const n=this.subscriptions[a];n&&n(e,t,s)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function Hm(e,t){return t?e*(1e3/t):0}const Ym={current:void 0};class Gm{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.canTrackVelocity=null,this.events={},this.updateAndNotify=e=>{const t=zm.now();var s;if((this.updatedAt!==t&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(e),this.current!==this.prev)&&(null===(s=this.events.change)||void 0===s||s.notify(this.current),this.dependents))for(const n of this.dependents)n.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){this.current=e,this.updatedAt=zm.now(),null===this.canTrackVelocity&&void 0!==e&&(this.canTrackVelocity=(e=>!isNaN(parseFloat(e)))(this.current))}setPrevFrameValue(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.current;this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new qm);const s=this.events[e].add(t);return"change"===e?()=>{s(),Qu.read(()=>{this.events.change.getSize()||this.stop()})}:s}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,t,s){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-s}jump(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var e;null===(e=this.events.change)||void 0===e||e.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return Ym.current&&Ym.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){const e=zm.now();if(!this.canTrackVelocity||void 0===this.prevFrameValue||e-this.updatedAt>30)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,30);return Hm(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var e,t;null===(e=this.dependents)||void 0===e||e.clear(),null===(t=this.events.destroy)||void 0===t||t.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function $m(e,t){return new Gm(e,t)}const Qm=[...Ru,fm,Cm],{schedule:Km,cancel:Jm}=$u(queueMicrotask,!1),Xm={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Zm={};for(const s in Xm)Zm[s]={isEnabled:e=>Xm[s].some(t=>!!e[t])};const eh=()=>({x:{min:0,max:0},y:{min:0,max:0}}),th={current:null},sh={current:!1};const nh=new WeakMap;function ah(e){return null!==e&&"object"===typeof e&&"function"===typeof e.start}function rh(e){return"string"===typeof e||Array.isArray(e)}const lh=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],oh=["initial",...lh];function ih(e){return ah(e.animate)||oh.some(t=>rh(e[t]))}function ch(e){return Boolean(ih(e)||e.variants)}function dh(e){const t=[{},{}];return null===e||void 0===e||e.values.forEach((e,s)=>{t[0][s]=e.get(),t[1][s]=e.getVelocity()}),t}function uh(e,t,s,n){if("function"===typeof t){const[a,r]=dh(n);t=t(void 0!==s?s:e.custom,a,r)}if("string"===typeof t&&(t=e.variants&&e.variants[t]),"function"===typeof t){const[a,r]=dh(n);t=t(void 0!==s?s:e.custom,a,r)}return t}const mh=["willChange"],hh=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class ph{scrapeMotionValuesFromProps(e,t,s){return{}}constructor(e){let{parent:t,props:s,presenceContext:n,reducedMotionConfig:a,blockInitialAnimation:r,visualState:l}=e,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=rm,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const e=zm.now();this.renderScheduledAt<e&&(this.renderScheduledAt=e,Qu.render(this.render,!1,!0))};const{latestValues:i,renderState:c}=l;this.latestValues=i,this.baseTarget=He({},i),this.initialValues=s.initial?He({},i):{},this.renderState=c,this.parent=t,this.props=s,this.presenceContext=n,this.depth=t?t.depth+1:0,this.reducedMotionConfig=a,this.options=o,this.blockInitialAnimation=Boolean(r),this.isControllingVariants=ih(s),this.isVariantNode=ch(s),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=Boolean(t&&t.current);const d=this.scrapeMotionValuesFromProps(s,{},this),{willChange:u}=d,m=Si(d,mh);for(const h in m){const e=m[h];void 0!==i[h]&&Om(e)&&e.set(i[h])}}mount(e){var t;this.current=e,nh.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((e,t)=>this.bindToMotionValue(t,e)),sh.current||function(){if(sh.current=!0,Cd)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>th.current=e.matches;e.addEventListener("change",t),t()}else th.current=!1}(),this.shouldReduceMotion="never"!==this.reducedMotionConfig&&("always"===this.reducedMotionConfig||th.current),null===(t=this.parent)||void 0===t||t.addChild(this),this.update(this.props,this.presenceContext)}unmount(){var e;this.projection&&this.projection.unmount(),Ku(this.notifyUpdate),Ku(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),null===(e=this.parent)||void 0===e||e.removeChild(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const e=this.features[t];e&&(e.unmount(),e.isMounted=!1)}this.current=null}addChild(e){var t;this.children.add(e),null!==(t=this.enteringChildren)&&void 0!==t||(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const s=Wd.has(e);s&&this.onBindTransform&&this.onBindTransform();const n=t.on("change",t=>{this.latestValues[e]=t,this.props.onUpdate&&Qu.preRender(this.notifyUpdate),s&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let a;window.MotionCheckAppearSync&&(a=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,()=>{n(),a&&a(),t.owner&&t.stop()})}sortNodePosition(e){return this.current&&this.sortInstanceNodePosition&&this.type===e.type?this.sortInstanceNodePosition(this.current,e.current):0}updateFeatures(){let e="animation";for(e in Zm){const t=Zm[e];if(!t)continue;const{isEnabled:s,Feature:n}=t;if(!this.features[e]&&n&&s(this.props)&&(this.features[e]=new n(this)),this.features[e]){const t=this.features[e];t.isMounted?t.update():(t.mount(),t.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):{x:{min:0,max:0},y:{min:0,max:0}}}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let s=0;s<hh.length;s++){const t=hh[s];this.propEventSubscriptions[t]&&(this.propEventSubscriptions[t](),delete this.propEventSubscriptions[t]);const n=e["on"+t];n&&(this.propEventSubscriptions[t]=this.on(t,n))}this.prevMotionValues=function(e,t,s){for(const n in t){const a=t[n],r=s[n];if(Om(a))e.addValue(n,a);else if(Om(r))e.addValue(n,$m(a,{owner:e}));else if(r!==a)if(e.hasValue(n)){const t=e.getValue(n);!0===t.liveStyle?t.jump(a):t.hasAnimated||t.set(a)}else{const t=e.getStaticValue(n);e.addValue(n,$m(void 0!==t?t:a,{owner:e}))}}for(const n in s)void 0===t[n]&&e.removeValue(n);return t}(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const s=this.values.get(e);t!==s&&(s&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let s=this.values.get(e);return void 0===s&&void 0!==t&&(s=$m(null===t?void 0:t,{owner:this}),this.addValue(e,s)),s}readValue(e,t){var s;let n=void 0===this.latestValues[e]&&this.current?null!==(s=this.getBaseTargetFromProps(this.props,e))&&void 0!==s?s:this.readValueFromInstance(this.current,e,this.options):this.latestValues[e];var a;return void 0!==n&&null!==n&&("string"===typeof n&&(Iu(n)||lm(n))?n=parseFloat(n):(a=n,!Qm.find(Mu(a))&&Cm.test(t)&&(n=Rm(e,t))),this.setBaseTarget(e,Om(n)?n.get():n)),Om(n)?n.get():n}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){const{initial:t}=this.props;let s;if("string"===typeof t||"object"===typeof t){var n;const a=uh(this.props,t,null===(n=this.presenceContext)||void 0===n?void 0:n.custom);a&&(s=a[e])}if(t&&void 0!==s)return s;const a=this.getBaseTargetFromProps(this.props,e);return void 0===a||Om(a)?void 0!==this.initialValues[e]&&void 0===s?void 0:this.baseTarget[e]:a}on(e,t){return this.events[e]||(this.events[e]=new qm),this.events[e].add(t)}notify(e){if(this.events[e]){for(var t=arguments.length,s=new Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];this.events[e].notify(...s)}}scheduleRenderMicrotask(){Km.render(this.render)}}class xh extends ph{constructor(){super(...arguments),this.KeyframeResolver=Im}sortInstanceNodePosition(e,t){return 2&e.compareDocumentPosition(t)?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,t){let{vars:s,style:n}=t;delete s[e],delete n[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Om(e)&&(this.childSubscription=e.on("change",e=>{this.current&&(this.current.textContent="".concat(e))}))}}const gh=(e,t)=>t&&"number"===typeof e?t.transform(e):e,fh={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},bh=Vd.length;function yh(e,t,s){const{style:n,vars:a,transformOrigin:r}=e;let l=!1,o=!1;for(const i in t){const e=t[i];if(Wd.has(i))l=!0;else if(tu(i))a[i]=e;else{const t=gh(e,Dm[i]);i.startsWith("origin")?(o=!0,r[i]=t):n[i]=t}}if(t.transform||(l||s?n.transform=function(e,t,s){let n="",a=!0;for(let r=0;r<bh;r++){const l=Vd[r],o=e[l];if(void 0===o)continue;let i=!0;if(i="number"===typeof o?o===(l.startsWith("scale")?1:0):0===parseFloat(o),!i||s){const e=gh(o,Dm[l]);i||(a=!1,n+="".concat(fh[l]||l,"(").concat(e,") ")),s&&(t[l]=e)}}return n=n.trim(),s?n=s(t,a?"":n):a&&(n="none"),n}(t,e.transform,s):n.transform&&(n.transform="none")),o){const{originX:e="50%",originY:t="50%",originZ:s=0}=r;n.transformOrigin="".concat(e," ").concat(t," ").concat(s)}}function vh(e,t,s,n){let{style:a,vars:r}=t;const l=e.style;let o;for(o in a)l[o]=a[o];for(o in null===n||void 0===n||n.applyProjectionStyles(l,s),r)l.setProperty(o,r[o])}const jh={};function wh(e,t){let{layout:s,layoutId:n}=t;return Wd.has(e)||e.startsWith("origin")||(s||void 0!==n)&&(!!jh[e]||"opacity"===e)}function Nh(e,t,s){const{style:n}=e,a={};for(const l in n){var r;(Om(n[l])||t.style&&Om(t.style[l])||wh(l,e)||void 0!==(null===s||void 0===s||null===(r=s.getValue(l))||void 0===r?void 0:r.liveStyle))&&(a[l]=n[l])}return a}class kh extends xh{constructor(){super(...arguments),this.type="html",this.renderInstance=vh}readValueFromInstance(e,t){var s,n;if(Wd.has(t))return null!==(s=this.projection)&&void 0!==s&&s.isProjecting?Jd(t):((e,t)=>{const{transform:s="none"}=getComputedStyle(e);return Xd(s,t)})(e,t);{const s=(n=e,window.getComputedStyle(n)),a=(tu(t)?s.getPropertyValue(t):s[t])||0;return"string"===typeof a?a.trim():a}}measureInstanceViewportBox(e,t){let{transformPagePoint:s}=t;return ju(e,s)}build(e,t,s){yh(e,t,s.transformTemplate)}scrapeMotionValuesFromProps(e,t,s){return Nh(e,t,s)}}const Sh=e=>e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),Ch={offset:"stroke-dashoffset",array:"stroke-dasharray"},_h={offset:"strokeDashoffset",array:"strokeDasharray"};const Eh=["attrX","attrY","attrScale","pathLength","pathSpacing","pathOffset"];function Th(e,t,s,n,a){let{attrX:r,attrY:l,attrScale:o,pathLength:i,pathSpacing:c=1,pathOffset:d=0}=t;if(yh(e,Si(t,Eh),n),s)return void(e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox));e.attrs=e.style,e.style={};const{attrs:u,style:m}=e;var h,p;(u.transform&&(m.transform=u.transform,delete u.transform),m.transform||u.transformOrigin)&&(m.transformOrigin=null!==(h=u.transformOrigin)&&void 0!==h?h:"50% 50%",delete u.transformOrigin);m.transform&&(m.transformBox=null!==(p=null===a||void 0===a?void 0:a.transformBox)&&void 0!==p?p:"fill-box",delete u.transformBox);void 0!==r&&(u.x=r),void 0!==l&&(u.y=l),void 0!==o&&(u.scale=o),void 0!==i&&function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];e.pathLength=1;const r=a?Ch:_h;e[r.offset]=Pu.transform(-n);const l=Pu.transform(t),o=Pu.transform(s);e[r.array]="".concat(l," ").concat(o)}(u,i,c,d,!1)}const Ph=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]),Ah=e=>"string"===typeof e&&"svg"===e.toLowerCase();function Dh(e,t,s){const n=Nh(e,t,s);for(const a in e)if(Om(e[a])||Om(t[a])){n[-1!==Vd.indexOf(a)?"attr"+a.charAt(0).toUpperCase()+a.substring(1):a]=e[a]}return n}class Lh extends xh{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=eh}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(Wd.has(t)){const e=Mm(t);return e&&e.default||0}return t=Ph.has(t)?t:Sh(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,s){return Dh(e,t,s)}build(e,t,s){Th(e,t,this.isSVGTag,s.transformTemplate,s.style)}renderInstance(e,t,s,n){!function(e,t,s,n){vh(e,t,void 0,n);for(const a in t.attrs)e.setAttribute(Ph.has(a)?a:Sh(a),t.attrs[a])}(e,t,0,n)}mount(e){this.isSVGTag=Ah(e.tagName),super.mount(e)}}const Mh=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Rh(e){return"string"===typeof e&&!e.includes("-")&&!!(Mh.indexOf(e)>-1||/[A-Z]/.test(e))}const Fh=(e,t)=>Rh(e)?new Lh(t):new kh(t,{allowProjection:e!==a.Fragment}),Ih=(0,a.createContext)({strict:!1}),Oh=(0,a.createContext)({});function Bh(e){const{initial:t,animate:s}=function(e,t){if(ih(e)){const{initial:t,animate:s}=e;return{initial:!1===t||rh(t)?t:void 0,animate:rh(s)?s:void 0}}return!1!==e.inherit?t:{}}(e,(0,a.useContext)(Oh));return(0,a.useMemo)(()=>({initial:t,animate:s}),[Uh(t),Uh(s)])}function Uh(e){return Array.isArray(e)?e.join(" "):e}const zh=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function Vh(e,t,s){for(const n in t)Om(t[n])||wh(n,s)||(e[n]=t[n])}function Wh(e,t){const s={};return Vh(s,e.style||{},e),Object.assign(s,function(e,t){let{transformTemplate:s}=e;return(0,a.useMemo)(()=>{const e={style:{},transform:{},transformOrigin:{},vars:{}};return yh(e,t,s),Object.assign({},e.vars,e.style)},[t])}(e,t)),s}function qh(e,t){const s={},n=Wh(e,t);return e.drag&&!1!==e.dragListener&&(s.draggable=!1,n.userSelect=n.WebkitUserSelect=n.WebkitTouchCallout="none",n.touchAction=!0===e.drag?"none":"pan-".concat("x"===e.drag?"y":"x")),void 0===e.tabIndex&&(e.onTap||e.onTapStart||e.whileTap)&&(s.tabIndex=0),s.style=n,s}const Hh=()=>He(He({},{style:{},transform:{},transformOrigin:{},vars:{}}),{},{attrs:{}});function Yh(e,t,s,n){const r=(0,a.useMemo)(()=>{const s=Hh();return Th(s,t,Ah(n),e.transformTemplate,e.style),He(He({},s.attrs),{},{style:He({},s.style)})},[t]);if(e.style){const t={};Vh(t,e.style,e),r.style=He(He({},t),r.style)}return r}const Gh=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function $h(e){return e.startsWith("while")||e.startsWith("drag")&&"draggable"!==e||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||Gh.has(e)}let Qh=e=>!$h(e);try{"function"===typeof(Kh=require("@emotion/is-prop-valid").default)&&(Qh=e=>e.startsWith("on")?!$h(e):Kh(e))}catch(sy){}var Kh;function Jh(e,t,s,n,r){let{latestValues:l}=n,o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const i=(Rh(e)?Yh:qh)(t,l,r,e),c=function(e,t,s){const n={};for(const a in e)"values"===a&&"object"===typeof e.values||(Qh(a)||!0===s&&$h(a)||!t&&!$h(a)||e.draggable&&a.startsWith("onDrag"))&&(n[a]=e[a]);return n}(t,"string"===typeof e,o),d=e!==a.Fragment?He(He(He({},c),i),{},{ref:s}):{},{children:u}=t,m=(0,a.useMemo)(()=>Om(u)?u.get():u,[u]);return(0,a.createElement)(e,He(He({},d),{},{children:m}))}function Xh(e){return Om(e)?e.get():e}const Zh=["transitionEnd","transition"];function ep(e,t,s,n){const a={},r=n(e,{});for(const m in r)a[m]=Xh(r[m]);let{initial:l,animate:o}=e;const i=ih(e),c=ch(e);t&&c&&!i&&!1!==e.inherit&&(void 0===l&&(l=t.initial),void 0===o&&(o=t.animate));let d=!!s&&!1===s.initial;d=d||!1===l;const u=d?o:l;if(u&&"boolean"!==typeof u&&!ah(u)){const t=Array.isArray(u)?u:[u];for(let s=0;s<t.length;s++){const n=uh(e,t[s]);if(n){const{transitionEnd:e,transition:t}=n,s=Si(n,Zh);for(const n in s){let e=s[n];if(Array.isArray(e)){e=e[d?e.length-1:0]}null!==e&&(a[n]=e)}for(const n in e)a[n]=e[n]}}}return a}const tp=e=>(t,s)=>{const n=(0,a.useContext)(Oh),r=(0,a.useContext)(Ed),l=()=>function(e,t,s,n){let{scrapeMotionValuesFromProps:a,createRenderState:r}=e;return{latestValues:ep(t,s,n,a),renderState:r()}}(e,t,n,r);return s?l():Sd(l)},sp=tp({scrapeMotionValuesFromProps:Nh,createRenderState:zh}),np=tp({scrapeMotionValuesFromProps:Dh,createRenderState:Hh});const ap=Symbol.for("motionComponentSymbol");function rp(e){return e&&"object"===typeof e&&Object.prototype.hasOwnProperty.call(e,"current")}function lp(e,t,s){return(0,a.useCallback)(n=>{n&&e.onMount&&e.onMount(n),t&&(n?t.mount(n):t.unmount()),s&&("function"===typeof s?s(n):rp(s)&&(s.current=n))},[t])}const op="data-"+Sh("framerAppearId"),ip=(0,a.createContext)({});function cp(e,t,s,n,r){var l,o,i,c;const{visualElement:d}=(0,a.useContext)(Oh),u=(0,a.useContext)(Ih),m=(0,a.useContext)(Ed),h=(0,a.useContext)(Ad).reducedMotion,p=(0,a.useRef)(null);n=n||u.renderer,!p.current&&n&&(p.current=n(e,{visualState:t,parent:d,props:s,presenceContext:m,blockInitialAnimation:!!m&&!1===m.initial,reducedMotionConfig:h}));const x=p.current,g=(0,a.useContext)(ip);!x||x.projection||!r||"html"!==x.type&&"svg"!==x.type||function(e,t,s,n){const{layoutId:a,layout:r,drag:l,dragConstraints:o,layoutScroll:i,layoutRoot:c,layoutCrossfade:d}=t;e.projection=new s(e.latestValues,t["data-framer-portal-id"]?void 0:dp(e.parent)),e.projection.setOptions({layoutId:a,layout:r,alwaysMeasureLayout:Boolean(l)||o&&rp(o),visualElement:e,animationType:"string"===typeof r?r:"both",initialPromotionConfig:n,crossfade:d,layoutScroll:i,layoutRoot:c})}(p.current,s,r,g);const f=(0,a.useRef)(!1);(0,a.useInsertionEffect)(()=>{x&&f.current&&x.update(s,m)});const b=s[op],y=(0,a.useRef)(Boolean(b)&&!(null!==(l=(o=window).MotionHandoffIsComplete)&&void 0!==l&&l.call(o,b))&&(null===(i=(c=window).MotionHasOptimisedAnimation)||void 0===i?void 0:i.call(c,b)));return _d(()=>{x&&(f.current=!0,window.MotionIsMounted=!0,x.updateFeatures(),x.scheduleRenderMicrotask(),y.current&&x.animationState&&x.animationState.animateChanges())}),(0,a.useEffect)(()=>{x&&(!y.current&&x.animationState&&x.animationState.animateChanges(),y.current&&(queueMicrotask(()=>{var e,t;null===(e=(t=window).MotionHandoffMarkAsComplete)||void 0===e||e.call(t,b)}),y.current=!1),x.enteringChildren=void 0)}),x}function dp(e){if(e)return!1!==e.options.allowProjection?e.projection:dp(e.parent)}function up(e){var t,s;let{forwardMotionProps:n=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,l=arguments.length>3?arguments[3]:void 0;r&&function(e){for(const t in e)Zm[t]=He(He({},Zm[t]),e[t])}(r);const o=Rh(e)?np:sp;function i(t,s){let r;const i=He(He(He({},(0,a.useContext)(Ad)),t),{},{layoutId:mp(t)}),{isStatic:c}=i,d=Bh(t),u=o(t,c);if(!c&&Cd){!function(){(0,a.useContext)(Ih).strict;0}();const t=function(e){const{drag:t,layout:s}=Zm;if(!t&&!s)return{};const n=He(He({},t),s);return{MeasureLayout:null!==t&&void 0!==t&&t.isEnabled(e)||null!==s&&void 0!==s&&s.isEnabled(e)?n.MeasureLayout:void 0,ProjectionNode:n.ProjectionNode}}(i);r=t.MeasureLayout,d.visualElement=cp(e,u,i,l,t.ProjectionNode)}return(0,fn.jsxs)(Oh.Provider,{value:d,children:[r&&d.visualElement?(0,fn.jsx)(r,He({visualElement:d.visualElement},i)):null,Jh(e,t,lp(u,d.visualElement,s),u,c,n)]})}i.displayName="motion.".concat("string"===typeof e?e:"create(".concat(null!==(t=null!==(s=e.displayName)&&void 0!==s?s:e.name)&&void 0!==t?t:"",")"));const c=(0,a.forwardRef)(i);return c[ap]=e,c}function mp(e){let{layoutId:t}=e;const s=(0,a.useContext)(kd).id;return s&&void 0!==t?s+"-"+t:t}function hp(e,t){if("undefined"===typeof Proxy)return up;const s=new Map,n=(s,n)=>up(s,n,e,t);return new Proxy((e,t)=>n(e,t),{get:(a,r)=>"create"===r?n:(s.has(r)||s.set(r,up(r,void 0,e,t)),s.get(r))})}function pp(e,t,s){const n=e.getProps();return uh(n,t,void 0!==s?s:n.custom,e)}function xp(e,t){var s,n;return null!==(s=null!==(n=null===e||void 0===e?void 0:e[t])&&void 0!==n?n:null===e||void 0===e?void 0:e.default)&&void 0!==s?s:e}const gp=e=>Array.isArray(e),fp=["transitionEnd","transition"];function bp(e,t,s){e.hasValue(t)?e.getValue(t).set(s):e.addValue(t,$m(s))}function yp(e){return gp(e)?e[e.length-1]||0:e}function vp(e,t){const s=e.getValue("willChange");if(function(e){return Boolean(Om(e)&&e.add)}(s))return s.add(t);if(!s&&Hu.WillChange){const s=new Hu.WillChange("auto");e.addValue("willChange",s),s.add(t)}}function jp(e){return e.props[op]}function wp(e){e.duration=0,e.type="keyframes"}const Np=(e,t)=>s=>t(e(s)),kp=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.reduce(Np)},Sp=e=>1e3*e,Cp=e=>e/1e3,_p={layout:0,mainThread:0,waapi:0};function Ep(e,t,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?e+6*(t-e)*s:s<.5?t:s<2/3?e+(t-e)*(2/3-s)*6:e}function Tp(e,t){return s=>s>0?t:e}const Pp=(e,t,s)=>{const n=e*e,a=s*(t*t-n)+n;return a<0?0:Math.sqrt(a)},Ap=[xm,pm,gm];function Dp(e){const t=(s=e,Ap.find(e=>e.test(s)));var s;if(Boolean(t),"'".concat(e,"' is not an animatable color. Use the equivalent color code instead."),!Boolean(t))return!1;let n=t.parse(e);return t===gm&&(n=function(e){let{hue:t,saturation:s,lightness:n,alpha:a}=e;t/=360,s/=100,n/=100;let r=0,l=0,o=0;if(s){const e=n<.5?n*(1+s):n+s-n*s,a=2*n-e;r=Ep(a,e,t+1/3),l=Ep(a,e,t),o=Ep(a,e,t-1/3)}else r=l=o=n;return{red:Math.round(255*r),green:Math.round(255*l),blue:Math.round(255*o),alpha:a}}(n)),n}const Lp=(e,t)=>{const s=Dp(e),n=Dp(t);if(!s||!n)return Tp(e,t);const a=He({},s);return e=>(a.red=Pp(s.red,n.red,e),a.green=Pp(s.green,n.green,e),a.blue=Pp(s.blue,n.blue,e),a.alpha=lu(s.alpha,n.alpha,e),pm.transform(a))},Mp=new Set(["none","hidden"]);function Rp(e,t){return s=>lu(e,t,s)}function Fp(e){return"number"===typeof e?Rp:"string"===typeof e?nu(e)?Tp:fm.test(e)?Lp:Bp:Array.isArray(e)?Ip:"object"===typeof e?fm.test(e)?Lp:Op:Tp}function Ip(e,t){const s=[...e],n=s.length,a=e.map((e,s)=>Fp(e)(e,t[s]));return e=>{for(let t=0;t<n;t++)s[t]=a[t](e);return s}}function Op(e,t){const s=He(He({},e),t),n={};for(const a in s)void 0!==e[a]&&void 0!==t[a]&&(n[a]=Fp(e[a])(e[a],t[a]));return e=>{for(const t in n)s[t]=n[t](e);return s}}const Bp=(e,t)=>{const s=Cm.createTransformer(t),n=wm(e),a=wm(t);return n.indexes.var.length===a.indexes.var.length&&n.indexes.color.length===a.indexes.color.length&&n.indexes.number.length>=a.indexes.number.length?Mp.has(e)&&!a.values.length||Mp.has(t)&&!n.values.length?function(e,t){return Mp.has(e)?s=>s<=0?e:t:s=>s>=1?t:e}(e,t):kp(Ip(function(e,t){const s=[],n={color:0,var:0,number:0};for(let r=0;r<t.values.length;r++){var a;const l=t.types[r],o=e.indexes[l][n[l]],i=null!==(a=e.values[o])&&void 0!==a?a:0;s[r]=i,n[l]++}return s}(n,a),a.values),s):("Complex values '".concat(e,"' and '").concat(t,"' too different to mix. Ensure all colors are of the same type, and that each contains the same quantity of number and color values. Falling back to instant transition."),Tp(e,t))};function Up(e,t,s){if("number"===typeof e&&"number"===typeof t&&"number"===typeof s)return lu(e,t,s);return Fp(e)(e,t)}const zp=e=>{const t=t=>{let{timestamp:s}=t;return e(s)};return{start:function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return Qu.update(t,e)},stop:()=>Ku(t),now:()=>Ju.isProcessing?Ju.timestamp:zm.now()}},Vp=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,n="";const a=Math.max(Math.round(t/s),2);for(let r=0;r<a;r++)n+=Math.round(1e4*e(r/(a-1)))/1e4+", ";return"linear(".concat(n.substring(0,n.length-2),")")},Wp=2e4;function qp(e){let t=0;let s=e.next(t);for(;!s.done&&t<Wp;)t+=50,s=e.next(t);return t>=Wp?1/0:t}function Hp(e,t,s){const n=Math.max(t-5,0);return Hm(s-e(n),t-n)}const Yp={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},Gp=.001;function $p(e){let t,s,{duration:n=Yp.duration,bounce:a=Yp.bounce,velocity:r=Yp.velocity,mass:l=Yp.mass}=e;Sp(Yp.maxDuration);let o=1-a;o=Nu(Yp.minDamping,Yp.maxDamping,o),n=Nu(Yp.minDuration,Yp.maxDuration,Cp(n)),o<1?(t=e=>{const t=e*o,s=t*n,a=t-r,l=Kp(e,o),i=Math.exp(-s);return Gp-a/l*i},s=e=>{const s=e*o*n,a=s*r+r,l=Math.pow(o,2)*Math.pow(e,2)*n,i=Math.exp(-s),c=Kp(Math.pow(e,2),o);return(-t(e)+Gp>0?-1:1)*((a-l)*i)/c}):(t=e=>Math.exp(-e*n)*((e-r)*n+1)-.001,s=e=>Math.exp(-e*n)*(n*n*(r-e)));const i=function(e,t,s){let n=s;for(let a=1;a<Qp;a++)n-=e(n)/t(n);return n}(t,s,5/n);if(n=Sp(n),isNaN(i))return{stiffness:Yp.stiffness,damping:Yp.damping,duration:n};{const e=Math.pow(i,2)*l;return{stiffness:e,damping:2*o*Math.sqrt(l*e),duration:n}}}const Qp=12;function Kp(e,t){return e*Math.sqrt(1-t*t)}const Jp=["duration","bounce"],Xp=["stiffness","damping","mass"];function Zp(e,t){return t.some(t=>void 0!==e[t])}function ex(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Yp.visualDuration,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Yp.bounce;const s="object"!==typeof e?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:n,restDelta:a}=s;const r=s.keyframes[0],l=s.keyframes[s.keyframes.length-1],o={done:!1,value:r},{stiffness:i,damping:c,mass:d,duration:u,velocity:m,isResolvedFromDuration:h}=function(e){let t=He({velocity:Yp.velocity,stiffness:Yp.stiffness,damping:Yp.damping,mass:Yp.mass,isResolvedFromDuration:!1},e);if(!Zp(e,Xp)&&Zp(e,Jp))if(e.visualDuration){const s=e.visualDuration,n=2*Math.PI/(1.2*s),a=n*n,r=2*Nu(.05,1,1-(e.bounce||0))*Math.sqrt(a);t=He(He({},t),{},{mass:Yp.mass,stiffness:a,damping:r})}else{const s=$p(e);t=He(He(He({},t),s),{},{mass:Yp.mass}),t.isResolvedFromDuration=!0}return t}(He(He({},s),{},{velocity:-Cp(s.velocity||0)})),p=m||0,x=c/(2*Math.sqrt(i*d)),g=l-r,f=Cp(Math.sqrt(i/d)),b=Math.abs(g)<5;let y;if(n||(n=b?Yp.restSpeed.granular:Yp.restSpeed.default),a||(a=b?Yp.restDelta.granular:Yp.restDelta.default),x<1){const e=Kp(f,x);y=t=>{const s=Math.exp(-x*f*t);return l-s*((p+x*f*g)/e*Math.sin(e*t)+g*Math.cos(e*t))}}else if(1===x)y=e=>l-Math.exp(-f*e)*(g+(p+f*g)*e);else{const e=f*Math.sqrt(x*x-1);y=t=>{const s=Math.exp(-x*f*t),n=Math.min(e*t,300);return l-s*((p+x*f*g)*Math.sinh(n)+e*g*Math.cosh(n))/e}}const v={calculatedDuration:h&&u||null,next:e=>{const t=y(e);if(h)o.done=e>=u;else{let s=0===e?p:0;x<1&&(s=0===e?Sp(p):Hp(y,e,t));const r=Math.abs(s)<=n,i=Math.abs(l-t)<=a;o.done=r&&i}return o.value=o.done?l:t,o},toString:()=>{const e=Math.min(qp(v),Wp),t=Vp(t=>v.next(e*t).value,e,30);return e+"ms "+t},toTransition:()=>{}};return v}function tx(e){let{keyframes:t,velocity:s=0,power:n=.8,timeConstant:a=325,bounceDamping:r=10,bounceStiffness:l=500,modifyTarget:o,min:i,max:c,restDelta:d=.5,restSpeed:u}=e;const m=t[0],h={done:!1,value:m},p=e=>void 0===i?c:void 0===c||Math.abs(i-e)<Math.abs(c-e)?i:c;let x=n*s;const g=m+x,f=void 0===o?g:o(g);f!==g&&(x=f-m);const b=e=>-x*Math.exp(-e/a),y=e=>f+b(e),v=e=>{const t=b(e),s=y(e);h.done=Math.abs(t)<=d,h.value=h.done?f:s};let j,w;const N=e=>{var t;(t=h.value,void 0!==i&&t<i||void 0!==c&&t>c)&&(j=e,w=ex({keyframes:[h.value,p(h.value)],velocity:Hp(y,e,h.value),damping:r,stiffness:l,restDelta:d,restSpeed:u}))};return N(0),{calculatedDuration:null,next:e=>{let t=!1;return w||void 0!==j||(t=!0,v(e),N(e)),void 0!==j&&e>=j?w.next(e-j):(!t&&v(e),h)}}}ex.applyToOptions=e=>{const t=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;const s=(arguments.length>2?arguments[2]:void 0)(He(He({},e),{},{keyframes:[0,t]})),n=Math.min(qp(s),Wp);return{type:"keyframes",ease:e=>s.next(n*e).value/t,duration:Cp(n)}}(e,100,ex);return e.ease=t.ease,e.duration=Sp(t.duration),e.type="keyframes",e};const sx=(e,t,s)=>(((1-3*s+3*t)*e+(3*s-6*t))*e+3*t)*e;function nx(e,t,s,n){if(e===t&&s===n)return qu;const a=t=>function(e,t,s,n,a){let r,l,o=0;do{l=t+(s-t)/2,r=sx(l,n,a)-e,r>0?s=l:t=l}while(Math.abs(r)>1e-7&&++o<12);return l}(t,0,1,e,s);return e=>0===e||1===e?e:sx(a(e),t,n)}const ax=nx(.42,0,1,1),rx=nx(0,0,.58,1),lx=nx(.42,0,.58,1),ox=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,ix=e=>t=>1-e(1-t),cx=nx(.33,1.53,.69,.99),dx=ix(cx),ux=ox(dx),mx=e=>(e*=2)<1?.5*dx(e):.5*(2-Math.pow(2,-10*(e-1))),hx=e=>1-Math.sin(Math.acos(e)),px=ix(hx),xx=ox(hx),gx=e=>Array.isArray(e)&&"number"===typeof e[0],fx={linear:qu,easeIn:ax,easeInOut:lx,easeOut:rx,circIn:hx,circInOut:xx,circOut:px,backIn:dx,backInOut:ux,backOut:cx,anticipate:mx},bx=e=>{if(gx(e)){e.length;const[t,s,n,a]=e;return nx(t,s,n,a)}return"string"===typeof e?("Invalid easing type '".concat(e,"'"),fx[e]):e},yx=(e,t,s)=>{const n=t-e;return 0===n?1:(s-e)/n};function vx(e,t){let{clamp:s=!0,ease:n,mixer:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=e.length;if(t.length,1===r)return()=>t[0];if(2===r&&t[0]===t[1])return()=>t[1];const l=e[0]===e[1];e[0]>e[r-1]&&(e=[...e].reverse(),t=[...t].reverse());const o=function(e,t,s){const n=[],a=s||Hu.mix||Up,r=e.length-1;for(let l=0;l<r;l++){let s=a(e[l],e[l+1]);if(t){const e=Array.isArray(t)?t[l]||qu:t;s=kp(e,s)}n.push(s)}return n}(t,n,a),i=o.length,c=s=>{if(l&&s<e[0])return t[0];let n=0;if(i>1)for(;n<e.length-2&&!(s<e[n+1]);n++);const a=yx(e[n],e[n+1],s);return o[n](a)};return s?t=>c(Nu(e[0],e[r-1],t)):c}function jx(e){const t=[0];return function(e,t){const s=e[e.length-1];for(let n=1;n<=t;n++){const a=yx(0,t,n);e.push(lu(s,1,a))}}(t,e.length-1),t}function wx(e){let{duration:t=300,keyframes:s,times:n,ease:a="easeInOut"}=e;const r=(e=>Array.isArray(e)&&"number"!==typeof e[0])(a)?a.map(bx):bx(a),l={done:!1,value:s[0]},o=function(e,t){return e.map(e=>e*t)}(n&&n.length===s.length?n:jx(s),t),i=vx(o,s,{ease:Array.isArray(r)?r:(c=s,d=r,c.map(()=>d||lx).splice(0,c.length-1))});var c,d;return{calculatedDuration:t,next:e=>(l.value=i(e),l.done=e>=t,l)}}const Nx=e=>null!==e;function kx(e,t,s){let{repeat:n,repeatType:a="loop"}=t,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;const l=e.filter(Nx),o=r<0||n&&"loop"!==a&&n%2===1?0:l.length-1;return o&&void 0!==s?s:l[o]}const Sx={decay:tx,inertia:tx,tween:wx,keyframes:wx,spring:ex};function Cx(e){"string"===typeof e.type&&(e.type=Sx[e.type])}class _x{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,t){return this.finished.then(e,t)}}const Ex=e=>e/100;class Tx extends _x{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var e,t;const{motionValue:s}=this.options;s&&s.updatedAt!==zm.now()&&this.tick(zm.now()),this.isStopped=!0,"idle"!==this.state&&(this.teardown(),null===(e=(t=this.options).onStop)||void 0===e||e.call(t))},_p.mainThread++,this.options=e,this.initAnimation(),this.play(),!1===e.autoplay&&this.pause()}initAnimation(){const{options:e}=this;Cx(e);const{type:t=wx,repeat:s=0,repeatDelay:n=0,repeatType:a,velocity:r=0}=e;let{keyframes:l}=e;const o=t||wx;o!==wx&&"number"!==typeof l[0]&&(this.mixKeyframes=kp(Ex,Up(l[0],l[1])),l=[0,100]);const i=o(He(He({},e),{},{keyframes:l}));"mirror"===a&&(this.mirroredGenerator=o(He(He({},e),{},{keyframes:[...l].reverse(),velocity:-r}))),null===i.calculatedDuration&&(i.calculatedDuration=qp(i));const{calculatedDuration:c}=i;this.calculatedDuration=c,this.resolvedDuration=c+n,this.totalDuration=this.resolvedDuration*(s+1)-n,this.generator=i}updateTime(e){const t=Math.round(e-this.startTime)*this.playbackSpeed;null!==this.holdTime?this.currentTime=this.holdTime:this.currentTime=t}tick(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{generator:s,totalDuration:n,mixKeyframes:a,mirroredGenerator:r,resolvedDuration:l,calculatedDuration:o}=this;if(null===this.startTime)return s.next(0);const{delay:i=0,keyframes:c,repeat:d,repeatType:u,repeatDelay:m,type:h,onUpdate:p,finalKeyframe:x}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-n/this.speed,this.startTime)),t?this.currentTime=e:this.updateTime(e);const g=this.currentTime-i*(this.playbackSpeed>=0?1:-1),f=this.playbackSpeed>=0?g<0:g>n;this.currentTime=Math.max(g,0),"finished"===this.state&&null===this.holdTime&&(this.currentTime=n);let b=this.currentTime,y=s;if(d){const e=Math.min(this.currentTime,n)/l;let t=Math.floor(e),s=e%1;!s&&e>=1&&(s=1),1===s&&t--,t=Math.min(t,d+1);Boolean(t%2)&&("reverse"===u?(s=1-s,m&&(s-=m/l)):"mirror"===u&&(y=r)),b=Nu(0,1,s)*l}const v=f?{done:!1,value:c[0]}:y.next(b);a&&(v.value=a(v.value));let{done:j}=v;f||null===o||(j=this.playbackSpeed>=0?this.currentTime>=n:this.currentTime<=0);const w=null===this.holdTime&&("finished"===this.state||"running"===this.state&&j);return w&&h!==tx&&(v.value=kx(c,this.options,x,this.speed)),p&&p(v.value),w&&this.finish(),v}then(e,t){return this.finished.then(e,t)}get duration(){return Cp(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+Cp(e)}get time(){return Cp(this.currentTime)}set time(e){var t;e=Sp(e),this.currentTime=e,null===this.startTime||null!==this.holdTime||0===this.playbackSpeed?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),null===(t=this.driver)||void 0===t||t.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(zm.now());const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=Cp(this.currentTime))}play(){var e,t;if(this.isStopped)return;const{driver:s=zp,startTime:n}=this.options;this.driver||(this.driver=s(e=>this.tick(e))),null===(e=(t=this.options).onPlay)||void 0===e||e.call(t);const a=this.driver.now();"finished"===this.state?(this.updateFinished(),this.startTime=a):null!==this.holdTime?this.startTime=a-this.holdTime:this.startTime||(this.startTime=null!==n&&void 0!==n?n:a),"finished"===this.state&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(zm.now()),this.holdTime=this.currentTime}complete(){"running"!==this.state&&this.play(),this.state="finished",this.holdTime=null}finish(){var e,t;this.notifyFinished(),this.teardown(),this.state="finished",null===(e=(t=this.options).onComplete)||void 0===e||e.call(t)}cancel(){var e,t;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),null===(e=(t=this.options).onCancel)||void 0===e||e.call(t)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null,_p.mainThread--}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){var t;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),null===(t=this.driver)||void 0===t||t.stop(),e.observe(this)}}function Px(e){let t;return()=>(void 0===t&&(t=e()),t)}const Ax=Px(()=>void 0!==window.ScrollTimeline),Dx={};function Lx(e,t){const s=Px(e);return()=>{var e;return null!==(e=Dx[t])&&void 0!==e?e:s()}}const Mx=Lx(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch(ey){return!1}return!0},"linearEasing"),Rx=e=>{let[t,s,n,a]=e;return"cubic-bezier(".concat(t,", ").concat(s,", ").concat(n,", ").concat(a,")")},Fx={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Rx([0,.65,.55,1]),circOut:Rx([.55,0,1,.45]),backIn:Rx([.31,.01,.66,-.59]),backOut:Rx([.33,1.53,.69,.99])};function Ix(e,t){return e?"function"===typeof e?Mx()?Vp(e,t):"ease-out":gx(e)?Rx(e):Array.isArray(e)?e.map(e=>Ix(e,t)||Fx.easeOut):Fx[e]:void 0}function Ox(e,t,s){let{delay:n=0,duration:a=300,repeat:r=0,repeatType:l="loop",ease:o="easeOut",times:i}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;const d={[t]:s};i&&(d.offset=i);const u=Ix(o,a);Array.isArray(u)&&(d.easing=u),Gu.value&&_p.waapi++;const m={delay:n,duration:a,easing:Array.isArray(u)?"linear":u,fill:"both",iterations:r+1,direction:"reverse"===l?"alternate":"normal"};c&&(m.pseudoElement=c);const h=e.animate(d,m);return Gu.value&&h.finished.finally(()=>{_p.waapi--}),h}function Bx(e){return"function"===typeof e&&"applyToOptions"in e}const Ux=["type"];class zx extends _x{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:t,name:s,keyframes:n,pseudoElement:a,allowFlatten:r=!1,finalKeyframe:l,onComplete:o}=e;this.isPseudoElement=Boolean(a),this.allowFlatten=r,this.options=e,e.type;const i=function(e){let{type:t}=e,s=Si(e,Ux);return Bx(t)&&Mx()?t.applyToOptions(s):(null!==(n=s.duration)&&void 0!==n||(s.duration=300),null!==(a=s.ease)&&void 0!==a||(s.ease="easeOut"),s);var n,a}(e);this.animation=Ox(t,s,n,i,a),!1===i.autoplay&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!a){const e=kx(n,this.options,l,this.speed);this.updateMotionValue?this.updateMotionValue(e):function(e,t,s){(e=>e.startsWith("--"))(t)?e.style.setProperty(t,s):e.style[t]=s}(t,s,e),this.animation.cancel()}null===o||void 0===o||o(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),"finished"===this.state&&this.updateFinished())}pause(){this.animation.pause()}complete(){var e,t;null===(e=(t=this.animation).finish)||void 0===e||e.call(t)}cancel(){try{this.animation.cancel()}catch(ey){}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;"idle"!==e&&"finished"!==e&&(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var e,t;this.isPseudoElement||(null===(e=(t=this.animation).commitStyles)||void 0===e||e.call(t))}get duration(){var e,t;const s=(null===(e=this.animation.effect)||void 0===e||null===(t=e.getComputedTiming)||void 0===t?void 0:t.call(e).duration)||0;return Cp(Number(s))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+Cp(e)}get time(){return Cp(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=Sp(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return null!==this.finishedTime?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline(e){let{timeline:t,observe:s}=e;var n;this.allowFlatten&&(null===(n=this.animation.effect)||void 0===n||n.updateTiming({easing:"linear"}));return this.animation.onfinish=null,t&&Ax()?(this.animation.timeline=t,qu):s(this)}}const Vx={anticipate:mx,backInOut:ux,circInOut:xx};function Wx(e){"string"===typeof e.ease&&e.ease in Vx&&(e.ease=Vx[e.ease])}const qx=["motionValue","onUpdate","onComplete","element"];class Hx extends zx{constructor(e){Wx(e),Cx(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){var t;const s=this.options,{motionValue:n,onUpdate:a,onComplete:r,element:l}=s,o=Si(s,qx);if(!n)return;if(void 0!==e)return void n.set(e);const i=new Tx(He(He({},o),{},{autoplay:!1})),c=Sp(null!==(t=this.finishedTime)&&void 0!==t?t:this.time);n.setWithVelocity(i.sample(c-10).value,i.sample(c).value,10),i.stop()}}const Yx=(e,t)=>"zIndex"!==t&&(!("number"!==typeof e&&!Array.isArray(e))||!("string"!==typeof e||!Cm.test(e)&&"0"!==e||e.startsWith("url(")));const Gx=new Set(["opacity","clipPath","filter","transform"]),$x=Px(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));const Qx=["autoplay","delay","type","repeat","repeatDelay","repeatType","keyframes","name","motionValue","element"];class Kx extends _x{constructor(e){var t;let{autoplay:s=!0,delay:n=0,type:a="keyframes",repeat:r=0,repeatDelay:l=0,repeatType:o="loop",keyframes:i,name:c,motionValue:d,element:u}=e,m=Si(e,Qx);super(),this.stop=()=>{var e,t;this._animation&&(this._animation.stop(),null===(t=this.stopTimeline)||void 0===t||t.call(this));null===(e=this.keyframeResolver)||void 0===e||e.cancel()},this.createdAt=zm.now();const h=He({autoplay:s,delay:n,type:a,repeat:r,repeatDelay:l,repeatType:o,name:c,motionValue:d,element:u},m),p=(null===u||void 0===u?void 0:u.KeyframeResolver)||rm;this.keyframeResolver=new p(i,(e,t,s)=>this.onKeyframesResolved(e,t,h,!s),c,d,u),null===(t=this.keyframeResolver)||void 0===t||t.scheduleResolve()}onKeyframesResolved(e,t,s,n){this.keyframeResolver=void 0;const{name:a,type:r,velocity:l,delay:o,isHandoff:i,onUpdate:c}=s;this.resolvedAt=zm.now(),function(e,t,s,n){const a=e[0];if(null===a)return!1;if("display"===t||"visibility"===t)return!0;const r=e[e.length-1],l=Yx(a,t),o=Yx(r,t);return"You are trying to animate ".concat(t,' from "').concat(a,'" to "').concat(r,'". "').concat(l?r:a,'" is not an animatable value.'),!(!l||!o)&&(function(e){const t=e[0];if(1===e.length)return!0;for(let s=0;s<e.length;s++)if(e[s]!==t)return!0}(e)||("spring"===s||Bx(s))&&n)}(e,a,r,l)||(!Hu.instantAnimations&&o||null===c||void 0===c||c(kx(e,s,t)),e[0]=e[e.length-1],wp(s),s.repeat=0);const d=He(He({startTime:n?this.resolvedAt&&this.resolvedAt-this.createdAt>40?this.resolvedAt:this.createdAt:void 0,finalKeyframe:t},s),{},{keyframes:e}),u=!i&&function(e){var t;const{motionValue:s,name:n,repeatDelay:a,repeatType:r,damping:l,type:o}=e;if(!((null===s||void 0===s||null===(t=s.owner)||void 0===t?void 0:t.current)instanceof HTMLElement))return!1;const{onUpdate:i,transformTemplate:c}=s.owner.getProps();return $x()&&n&&Gx.has(n)&&("transform"!==n||!c)&&!i&&!a&&"mirror"!==r&&0!==l&&"inertia"!==o}(d)?new Hx(He(He({},d),{},{element:d.motionValue.owner.current})):new Tx(d);u.finished.then(()=>this.notifyFinished()).catch(qu),this.pendingTimeline&&(this.stopTimeline=u.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=u}get finished(){return this._animation?this.animation.finished:this._finished}then(e,t){return this.finished.finally(e).then(()=>{})}get animation(){var e;this._animation||(null===(e=this.keyframeResolver)||void 0===e||e.resume(),sm=!0,am(),nm(),sm=!1);return this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var e;this._animation&&this.animation.cancel(),null===(e=this.keyframeResolver)||void 0===e||e.cancel()}}const Jx=e=>null!==e;const Xx={type:"spring",stiffness:500,damping:25,restSpeed:10},Zx={type:"keyframes",duration:.8},eg={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},tg=(e,t)=>{let{keyframes:s}=t;return s.length>2?Zx:Wd.has(e)?e.startsWith("scale")?{type:"spring",stiffness:550,damping:0===s[1]?2*Math.sqrt(550):30,restSpeed:10}:Xx:eg},sg=["when","delay","delayChildren","staggerChildren","staggerDirection","repeat","repeatType","repeatDelay","from","elapsed"];const ng=function(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4?arguments[4]:void 0,r=arguments.length>5?arguments[5]:void 0;return l=>{const o=xp(n,e)||{},i=o.delay||n.delay||0;let{elapsed:c=0}=n;c-=Sp(i);const d=He(He({keyframes:Array.isArray(s)?s:[null,s],ease:"easeOut",velocity:t.getVelocity()},o),{},{delay:-c,onUpdate:e=>{t.set(e),o.onUpdate&&o.onUpdate(e)},onComplete:()=>{l(),o.onComplete&&o.onComplete()},name:e,motionValue:t,element:r?void 0:a});(function(e){let{when:t,delay:s,delayChildren:n,staggerChildren:a,staggerDirection:r,repeat:l,repeatType:o,repeatDelay:i,from:c,elapsed:d}=e,u=Si(e,sg);return!!Object.keys(u).length})(o)||Object.assign(d,tg(e,d)),d.duration&&(d.duration=Sp(d.duration)),d.repeatDelay&&(d.repeatDelay=Sp(d.repeatDelay)),void 0!==d.from&&(d.keyframes[0]=d.from);let u=!1;if((!1===d.type||0===d.duration&&!d.repeatDelay)&&(wp(d),0===d.delay&&(u=!0)),(Hu.instantAnimations||Hu.skipAnimations)&&(u=!0,wp(d),d.delay=0),d.allowFlatten=!o.type&&!o.ease,u&&!r&&void 0!==t.get()){const e=function(e,t,s){let{repeat:n,repeatType:a="loop"}=t;const r=e.filter(Jx),l=n&&"loop"!==a&&n%2===1?0:r.length-1;return l&&void 0!==s?s:r[l]}(d.keyframes,o);if(void 0!==e)return void Qu.update(()=>{d.onUpdate(e),d.onComplete()})}return o.isSync?new Tx(d):new Kx(d)}},ag=["transition","transitionEnd"];function rg(e,t){let{protectedKeys:s,needsAnimating:n}=e;const a=s.hasOwnProperty(t)&&!0!==n[t];return n[t]=!1,a}function lg(e,t){let{delay:s=0,transitionOverride:n,type:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{transition:r=e.getDefaultTransition(),transitionEnd:l}=t,o=Si(t,ag);n&&(r=n);const i=[],c=a&&e.animationState&&e.animationState.getState()[a];for(const u in o){var d;const t=e.getValue(u,null!==(d=e.latestValues[u])&&void 0!==d?d:null),n=o[u];if(void 0===n||c&&rg(c,u))continue;const a=He({delay:s},xp(r||{},u)),l=t.get();if(void 0!==l&&!t.isAnimating&&!Array.isArray(n)&&n===l&&!a.velocity)continue;let m=!1;if(window.MotionHandoffAnimation){const t=jp(e);if(t){const e=window.MotionHandoffAnimation(t,u,Qu);null!==e&&(a.startTime=e,m=!0)}}vp(e,u),t.start(ng(u,t,n,e.shouldReduceMotion&&wu.has(u)?{type:!1}:a,e,m));const h=t.animation;h&&i.push(h)}return l&&Promise.all(i).then(()=>{Qu.update(()=>{l&&function(e,t){let s=pp(e,t)||{},{transitionEnd:n={},transition:a={}}=s,r=Si(s,fp);r=He(He({},r),n);for(const l in r)bp(e,l,yp(r[l]))}(e,l)})}),i}function og(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const r=Array.from(e).sort((e,t)=>e.sortNodePosition(t)).indexOf(t),l=e.size,o=(l-1)*n;return"function"===typeof s?s(r,l):1===a?r*n:o-r*n}function ig(e,t){var s;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=pp(e,t,"exit"===n.type?null===(s=e.presenceContext)||void 0===s?void 0:s.custom:void 0);let{transition:r=e.getDefaultTransition()||{}}=a||{};n.transitionOverride&&(r=n.transitionOverride);const l=a?()=>Promise.all(lg(e,a,n)):()=>Promise.resolve(),o=e.variantChildren&&e.variantChildren.size?function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const{delayChildren:a=0,staggerChildren:l,staggerDirection:o}=r;return function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,l=arguments.length>6?arguments[6]:void 0;const o=[];for(const i of e.variantChildren)i.notify("AnimationStart",t),o.push(ig(i,t,He(He({},l),{},{delay:s+("function"===typeof n?0:n)+og(e.variantChildren,i,n,a,r)})).then(()=>i.notify("AnimationComplete",t)));return Promise.all(o)}(e,t,s,a,l,o,n)}:()=>Promise.resolve(),{when:i}=r;if(i){const[e,t]="beforeChildren"===i?[l,o]:[o,l];return e().then(()=>t())}return Promise.all([l(),o(n.delay)])}function cg(e,t){if(!Array.isArray(t))return!1;const s=t.length;if(s!==e.length)return!1;for(let n=0;n<s;n++)if(t[n]!==e[n])return!1;return!0}const dg=oh.length;function ug(e){if(!e)return;if(!e.isControllingVariants){const t=e.parent&&ug(e.parent)||{};return void 0!==e.props.initial&&(t.initial=e.props.initial),t}const t={};for(let s=0;s<dg;s++){const n=oh[s],a=e.props[n];(rh(a)||!1===a)&&(t[n]=a)}return t}const mg=["transition","transitionEnd"],hg=[...lh].reverse(),pg=lh.length;function xg(e){return t=>Promise.all(t.map(t=>{let{animation:s,options:n}=t;return function(e,t){let s,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e.notify("AnimationStart",t),Array.isArray(t)){const a=t.map(t=>ig(e,t,n));s=Promise.all(a)}else if("string"===typeof t)s=ig(e,t,n);else{const a="function"===typeof t?pp(e,t,n.custom):t;s=Promise.all(lg(e,a,n))}return s.then(()=>{e.notify("AnimationComplete",t)})}(e,s,n)}))}function gg(e){let t=xg(e),s=yg(),n=!0;const a=t=>(s,n)=>{var a;const r=pp(e,n,"exit"===t?null===(a=e.presenceContext)||void 0===a?void 0:a.custom:void 0);if(r){const{transition:e,transitionEnd:t}=r,n=Si(r,mg);s=He(He(He({},s),n),t)}return s};function r(r){const{props:l}=e,o=ug(e.parent)||{},i=[],c=new Set;let d={},u=1/0;for(let t=0;t<pg;t++){const m=hg[t],h=s[m],p=void 0!==l[m]?l[m]:o[m],x=rh(p),g=m===r?h.isActive:null;!1===g&&(u=t);let f=p===o[m]&&p!==l[m]&&x;if(f&&n&&e.manuallyAnimateOnMount&&(f=!1),h.protectedKeys=He({},d),!h.isActive&&null===g||!p&&!h.prevProp||ah(p)||"boolean"===typeof p)continue;const b=fg(h.prevProp,p);let y=b||m===r&&h.isActive&&!f&&x||t>u&&x,v=!1;const j=Array.isArray(p)?p:[p];let w=j.reduce(a(m),{});!1===g&&(w={});const{prevResolvedValues:N={}}=h,k=He(He({},N),w),S=t=>{y=!0,c.has(t)&&(v=!0,c.delete(t)),h.needsAnimating[t]=!0;const s=e.getValue(t);s&&(s.liveStyle=!1)};for(const e in k){const t=w[e],s=N[e];if(d.hasOwnProperty(e))continue;let n=!1;n=gp(t)&&gp(s)?!cg(t,s):t!==s,n?void 0!==t&&null!==t?S(e):c.add(e):void 0!==t&&c.has(e)?S(e):h.protectedKeys[e]=!0}h.prevProp=p,h.prevResolvedValues=w,h.isActive&&(d=He(He({},d),w)),n&&e.blockInitialAnimation&&(y=!1);const C=f&&b;y&&(!C||v)&&i.push(...j.map(t=>{const s={type:m};if("string"===typeof t&&n&&!C&&e.manuallyAnimateOnMount&&e.parent){const{parent:n}=e,a=pp(n,t);if(n.enteringChildren&&a){const{delayChildren:t}=a.transition||{};s.delay=og(n.enteringChildren,e,t)}}return{animation:t,options:s}}))}if(c.size){const t={};if("boolean"!==typeof l.initial){const s=pp(e,Array.isArray(l.initial)?l.initial[0]:l.initial);s&&s.transition&&(t.transition=s.transition)}c.forEach(s=>{const n=e.getBaseTarget(s),a=e.getValue(s);a&&(a.liveStyle=!0),t[s]=null!==n&&void 0!==n?n:null}),i.push({animation:t})}let m=Boolean(i.length);return!n||!1!==l.initial&&l.initial!==l.animate||e.manuallyAnimateOnMount||(m=!1),n=!1,m?t(i):Promise.resolve()}return{animateChanges:r,setActive:function(t,n){var a;if(s[t].isActive===n)return Promise.resolve();null===(a=e.variantChildren)||void 0===a||a.forEach(e=>{var s;return null===(s=e.animationState)||void 0===s?void 0:s.setActive(t,n)}),s[t].isActive=n;const l=r(t);for(const e in s)s[e].protectedKeys={};return l},setAnimateFunction:function(s){t=s(e)},getState:()=>s,reset:()=>{s=yg()}}}function fg(e,t){return"string"===typeof t?t!==e:!!Array.isArray(t)&&!cg(t,e)}function bg(){return{isActive:arguments.length>0&&void 0!==arguments[0]&&arguments[0],protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function yg(){return{animate:bg(!0),whileInView:bg(),whileHover:bg(),whileTap:bg(),whileDrag:bg(),whileFocus:bg(),exit:bg()}}class vg{constructor(e){this.isMounted=!1,this.node=e}update(){}}let jg=0;const wg={animation:{Feature:class extends vg{constructor(e){super(e),e.animationState||(e.animationState=gg(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();ah(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),null===(e=this.unmountControls)||void 0===e||e.call(this)}}},exit:{Feature:class extends vg{constructor(){super(...arguments),this.id=jg++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:s}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===s)return;const n=this.node.animationState.setActive("exit",!e);t&&!e&&n.then(()=>{t(this.id)})}mount(){const{register:e,onExitComplete:t}=this.node.presenceContext||{};t&&t(this.id),e&&(this.unmount=e(this.id))}unmount(){}}}},Ng={x:!1,y:!1};function kg(){return Ng.x||Ng.y}function Sg(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{passive:!0};return e.addEventListener(t,s,n),()=>e.removeEventListener(t,s)}const Cg=e=>"mouse"===e.pointerType?"number"!==typeof e.button||e.button<=0:!1!==e.isPrimary;function _g(e){return{point:{x:e.pageX,y:e.pageY}}}function Eg(e,t,s,n){return Sg(e,t,(e=>t=>Cg(t)&&e(t,_g(t)))(s),n)}function Tg(e){return e.max-e.min}function Pg(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;e.origin=n,e.originPoint=lu(t.min,t.max,e.origin),e.scale=Tg(s)/Tg(t),e.translate=lu(s.min,s.max,e.origin)-e.originPoint,(e.scale>=.9999&&e.scale<=1.0001||isNaN(e.scale))&&(e.scale=1),(e.translate>=-.01&&e.translate<=.01||isNaN(e.translate))&&(e.translate=0)}function Ag(e,t,s,n){Pg(e.x,t.x,s.x,n?n.originX:void 0),Pg(e.y,t.y,s.y,n?n.originY:void 0)}function Dg(e,t,s){e.min=s.min+t.min,e.max=e.min+Tg(t)}function Lg(e,t,s){e.min=t.min-s.min,e.max=e.min+Tg(t)}function Mg(e,t,s){Lg(e.x,t.x,s.x),Lg(e.y,t.y,s.y)}function Rg(e){return[e("x"),e("y")]}const Fg=e=>{let{current:t}=e;return t?t.ownerDocument.defaultView:null},Ig=(e,t)=>Math.abs(e-t);class Og{constructor(e,t){let{transformPagePoint:s,contextWindow:n=window,dragSnapToOrigin:a=!1,distanceThreshold:r=3}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!this.lastMoveEvent||!this.lastMoveEventInfo)return;const e=zg(this.lastMoveEventInfo,this.history),t=null!==this.startEvent,s=function(e,t){const s=Ig(e.x,t.x),n=Ig(e.y,t.y);return Math.sqrt(s**2+n**2)}(e.offset,{x:0,y:0})>=this.distanceThreshold;if(!t&&!s)return;const{point:n}=e,{timestamp:a}=Ju;this.history.push(He(He({},n),{},{timestamp:a}));const{onStart:r,onMove:l}=this.handlers;t||(r&&r(this.lastMoveEvent,e),this.startEvent=this.lastMoveEvent),l&&l(this.lastMoveEvent,e)},this.handlePointerMove=(e,t)=>{this.lastMoveEvent=e,this.lastMoveEventInfo=Bg(t,this.transformPagePoint),Qu.update(this.updatePoint,!0)},this.handlePointerUp=(e,t)=>{this.end();const{onEnd:s,onSessionEnd:n,resumeAnimation:a}=this.handlers;if(this.dragSnapToOrigin&&a&&a(),!this.lastMoveEvent||!this.lastMoveEventInfo)return;const r=zg("pointercancel"===e.type?this.lastMoveEventInfo:Bg(t,this.transformPagePoint),this.history);this.startEvent&&s&&s(e,r),n&&n(e,r)},!Cg(e))return;this.dragSnapToOrigin=a,this.handlers=t,this.transformPagePoint=s,this.distanceThreshold=r,this.contextWindow=n||window;const l=Bg(_g(e),this.transformPagePoint),{point:o}=l,{timestamp:i}=Ju;this.history=[He(He({},o),{},{timestamp:i})];const{onSessionStart:c}=t;c&&c(e,zg(l,this.history)),this.removeListeners=kp(Eg(this.contextWindow,"pointermove",this.handlePointerMove),Eg(this.contextWindow,"pointerup",this.handlePointerUp),Eg(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Ku(this.updatePoint)}}function Bg(e,t){return t?{point:t(e.point)}:e}function Ug(e,t){return{x:e.x-t.x,y:e.y-t.y}}function zg(e,t){let{point:s}=e;return{point:s,delta:Ug(s,Wg(t)),offset:Ug(s,Vg(t)),velocity:qg(t,.1)}}function Vg(e){return e[0]}function Wg(e){return e[e.length-1]}function qg(e,t){if(e.length<2)return{x:0,y:0};let s=e.length-1,n=null;const a=Wg(e);for(;s>=0&&(n=e[s],!(a.timestamp-n.timestamp>Sp(t)));)s--;if(!n)return{x:0,y:0};const r=Cp(a.timestamp-n.timestamp);if(0===r)return{x:0,y:0};const l={x:(a.x-n.x)/r,y:(a.y-n.y)/r};return l.x===1/0&&(l.x=0),l.y===1/0&&(l.y=0),l}function Hg(e,t,s){return{min:void 0!==t?e.min+t:void 0,max:void 0!==s?e.max+s-(e.max-e.min):void 0}}function Yg(e,t){let s=t.min-e.min,n=t.max-e.max;return t.max-t.min<e.max-e.min&&([s,n]=[n,s]),{min:s,max:n}}const Gg=.35;function $g(e,t,s){return{min:Qg(e,t),max:Qg(e,s)}}function Qg(e,t){return"number"===typeof e?e:e[t]||0}const Kg=new WeakMap;class Jg{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic={x:{min:0,max:0},y:{min:0,max:0}},this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e){let{snapToCursor:t=!1,distanceThreshold:s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{presenceContext:n}=this.visualElement;if(n&&!1===n.isPresent)return;const{dragSnapToOrigin:a}=this.getProps();this.panSession=new Og(e,{onSessionStart:e=>{const{dragSnapToOrigin:s}=this.getProps();s?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(_g(e).point)},onStart:(e,t)=>{const{drag:s,dragPropagation:n,onDragStart:a}=this.getProps();if(s&&!n&&(this.openDragLock&&this.openDragLock(),this.openDragLock="x"===(r=s)||"y"===r?Ng[r]?null:(Ng[r]=!0,()=>{Ng[r]=!1}):Ng.x||Ng.y?null:(Ng.x=Ng.y=!0,()=>{Ng.x=Ng.y=!1}),!this.openDragLock))return;var r;this.latestPointerEvent=e,this.latestPanInfo=t,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Rg(e=>{let t=this.getAxisMotionValue(e).get()||0;if(Tu.test(t)){const{projection:s}=this.visualElement;if(s&&s.layout){const n=s.layout.layoutBox[e];if(n){t=Tg(n)*(parseFloat(t)/100)}}}this.originPoint[e]=t}),a&&Qu.postRender(()=>a(e,t)),vp(this.visualElement,"transform");const{animationState:l}=this.visualElement;l&&l.setActive("whileDrag",!0)},onMove:(e,t)=>{this.latestPointerEvent=e,this.latestPanInfo=t;const{dragPropagation:s,dragDirectionLock:n,onDirectionLock:a,onDrag:r}=this.getProps();if(!s&&!this.openDragLock)return;const{offset:l}=t;if(n&&null===this.currentDirection)return this.currentDirection=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,s=null;Math.abs(e.y)>t?s="y":Math.abs(e.x)>t&&(s="x");return s}(l),void(null!==this.currentDirection&&a&&a(this.currentDirection));this.updateAxis("x",t.point,l),this.updateAxis("y",t.point,l),this.visualElement.render(),r&&r(e,t)},onSessionEnd:(e,t)=>{this.latestPointerEvent=e,this.latestPanInfo=t,this.stop(e,t),this.latestPointerEvent=null,this.latestPanInfo=null},resumeAnimation:()=>Rg(e=>{var t;return"paused"===this.getAnimationState(e)&&(null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.play())})},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:a,distanceThreshold:s,contextWindow:Fg(this.visualElement)})}stop(e,t){const s=e||this.latestPointerEvent,n=t||this.latestPanInfo,a=this.isDragging;if(this.cancel(),!a||!n||!s)return;const{velocity:r}=n;this.startAnimation(r);const{onDragEnd:l}=this.getProps();l&&Qu.postRender(()=>l(s,n))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:s}=this.getProps();!s&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,s){const{drag:n}=this.getProps();if(!s||!Xg(e,n,this.currentDirection))return;const a=this.getAxisMotionValue(e);let r=this.originPoint[e]+s[e];this.constraints&&this.constraints[e]&&(r=function(e,t,s){let{min:n,max:a}=t;return void 0!==n&&e<n?e=s?lu(n,e,s.min):Math.max(e,n):void 0!==a&&e>a&&(e=s?lu(a,e,s.max):Math.min(e,a)),e}(r,this.constraints[e],this.elastic[e])),a.set(r)}resolveConstraints(){var e;const{dragConstraints:t,dragElastic:s}=this.getProps(),n=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):null===(e=this.visualElement.projection)||void 0===e?void 0:e.layout,a=this.constraints;t&&rp(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):this.constraints=!(!t||!n)&&function(e,t){let{top:s,left:n,bottom:a,right:r}=t;return{x:Hg(e.x,n,r),y:Hg(e.y,s,a)}}(n.layoutBox,t),this.elastic=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Gg;return!1===e?e=0:!0===e&&(e=Gg),{x:$g(e,"left","right"),y:$g(e,"top","bottom")}}(s),a!==this.constraints&&n&&this.constraints&&!this.hasMutatedConstraints&&Rg(e=>{!1!==this.constraints&&this.getAxisMotionValue(e)&&(this.constraints[e]=function(e,t){const s={};return void 0!==t.min&&(s.min=t.min-e.min),void 0!==t.max&&(s.max=t.max-e.min),s}(n.layoutBox[e],this.constraints[e]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!rp(e))return!1;const s=e.current,{projection:n}=this.visualElement;if(!n||!n.layout)return!1;const a=function(e,t,s){const n=ju(e,s),{scroll:a}=t;return a&&(bu(n.x,a.offset.x),bu(n.y,a.offset.y)),n}(s,n.root,this.visualElement.getTransformPagePoint());let r=function(e,t){return{x:Yg(e.x,t.x),y:Yg(e.y,t.y)}}(n.layout.layoutBox,a);if(t){const e=t(function(e){let{x:t,y:s}=e;return{top:s.min,right:t.max,bottom:s.max,left:t.min}}(r));this.hasMutatedConstraints=!!e,e&&(r=ru(e))}return r}startAnimation(e){const{drag:t,dragMomentum:s,dragElastic:n,dragTransition:a,dragSnapToOrigin:r,onDragTransitionEnd:l}=this.getProps(),o=this.constraints||{},i=Rg(l=>{if(!Xg(l,t,this.currentDirection))return;let i=o&&o[l]||{};r&&(i={min:0,max:0});const c=n?200:1e6,d=n?40:1e7,u=He(He({type:"inertia",velocity:s?e[l]:0,bounceStiffness:c,bounceDamping:d,timeConstant:750,restDelta:1,restSpeed:10},a),i);return this.startAxisValueAnimation(l,u)});return Promise.all(i).then(l)}startAxisValueAnimation(e,t){const s=this.getAxisMotionValue(e);return vp(this.visualElement,e),s.start(ng(e,s,0,t,this.visualElement,!1))}stopAnimation(){Rg(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Rg(e=>{var t;return null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.pause()})}getAnimationState(e){var t;return null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.state}getAxisMotionValue(e){const t="_drag".concat(e.toUpperCase()),s=this.visualElement.getProps(),n=s[t];return n||this.visualElement.getValue(e,(s.initial?s.initial[e]:void 0)||0)}snapToCursor(e){Rg(t=>{const{drag:s}=this.getProps();if(!Xg(t,s,this.currentDirection))return;const{projection:n}=this.visualElement,a=this.getAxisMotionValue(t);if(n&&n.layout){const{min:s,max:r}=n.layout.layoutBox[t];a.set(e[t]-lu(s,r,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:s}=this.visualElement;if(!rp(t)||!s||!this.constraints)return;this.stopAnimation();const n={x:0,y:0};Rg(e=>{const t=this.getAxisMotionValue(e);if(t&&!1!==this.constraints){const s=t.get();n[e]=function(e,t){let s=.5;const n=Tg(e),a=Tg(t);return a>n?s=yx(t.min,t.max-n,e.min):n>a&&(s=yx(e.min,e.max-a,t.min)),Nu(0,1,s)}({min:s,max:s},this.constraints[e])}});const{transformTemplate:a}=this.visualElement.getProps();this.visualElement.current.style.transform=a?a({},""):"none",s.root&&s.root.updateScroll(),s.updateLayout(),this.resolveConstraints(),Rg(t=>{if(!Xg(t,e,null))return;const s=this.getAxisMotionValue(t),{min:a,max:r}=this.constraints[t];s.set(lu(a,r,n[t]))})}addListeners(){if(!this.visualElement.current)return;Kg.set(this.visualElement,this);const e=Eg(this.visualElement.current,"pointerdown",e=>{const{drag:t,dragListener:s=!0}=this.getProps();t&&s&&this.start(e)}),t=()=>{const{dragConstraints:e}=this.getProps();rp(e)&&e.current&&(this.constraints=this.resolveRefConstraints())},{projection:s}=this.visualElement,n=s.addEventListener("measure",t);s&&!s.layout&&(s.root&&s.root.updateScroll(),s.updateLayout()),Qu.read(t);const a=Sg(window,"resize",()=>this.scalePositionWithinConstraints()),r=s.addEventListener("didUpdate",e=>{let{delta:t,hasLayoutChanged:s}=e;this.isDragging&&s&&(Rg(e=>{const s=this.getAxisMotionValue(e);s&&(this.originPoint[e]+=t[e].translate,s.set(s.get()+t[e].translate))}),this.visualElement.render())});return()=>{a(),e(),n(),r&&r()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:s=!1,dragPropagation:n=!1,dragConstraints:a=!1,dragElastic:r=Gg,dragMomentum:l=!0}=e;return He(He({},e),{},{drag:t,dragDirectionLock:s,dragPropagation:n,dragConstraints:a,dragElastic:r,dragMomentum:l})}}function Xg(e,t,s){return(!0===t||t===e)&&(null===s||s===e)}const Zg=e=>(t,s)=>{e&&Qu.postRender(()=>e(t,s))};const ef={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function tf(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const sf={correct:(e,t)=>{if(!t.target)return e;if("string"===typeof e){if(!Pu.test(e))return e;e=parseFloat(e)}const s=tf(e,t.target.x),n=tf(e,t.target.y);return"".concat(s,"% ").concat(n,"%")}},nf={correct:(e,t)=>{let{treeScale:s,projectionDelta:n}=t;const a=e,r=Cm.parse(e);if(r.length>5)return a;const l=Cm.createTransformer(e),o="number"!==typeof r[0]?1:0,i=n.x.scale*s.x,c=n.y.scale*s.y;r[0+o]/=i,r[1+o]/=c;const d=lu(i,c,.5);return"number"===typeof r[2+o]&&(r[2+o]/=d),"number"===typeof r[3+o]&&(r[3+o]/=d),l(r)}};let af=!1;class rf extends a.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:s,layoutId:n}=this.props,{projection:a}=e;!function(e){for(const t in e)jh[t]=e[t],tu(t)&&(jh[t].isCSSVariable=!0)}(of),a&&(t.group&&t.group.add(a),s&&s.register&&n&&s.register(a),af&&a.root.didUpdate(),a.addEventListener("animationComplete",()=>{this.safeToRemove()}),a.setOptions(He(He({},a.options),{},{onExitComplete:()=>this.safeToRemove()}))),ef.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:s,drag:n,isPresent:a}=this.props,{projection:r}=s;return r?(r.isPresent=a,af=!0,n||e.layoutDependency!==t||void 0===t||e.isPresent!==a?r.willUpdate():this.safeToRemove(),e.isPresent!==a&&(a?r.promote():r.relegate()||Qu.postRender(()=>{const e=r.getStack();e&&e.members.length||this.safeToRemove()})),null):null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),Km.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:s}=this.props,{projection:n}=e;af=!0,n&&(n.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(n),s&&s.deregister&&s.deregister(n))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function lf(e){const[t,s]=Od(),n=(0,a.useContext)(kd);return(0,fn.jsx)(rf,He(He({},e),{},{layoutGroup:n,switchLayoutGroup:(0,a.useContext)(ip),isPresent:t,safeToRemove:s}))}const of={borderRadius:He(He({},sf),{},{applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]}),borderTopLeftRadius:sf,borderTopRightRadius:sf,borderBottomLeftRadius:sf,borderBottomRightRadius:sf,boxShadow:nf};function cf(e){return Td(e)&&"ownerSVGElement"in e}const df=(e,t)=>e.depth-t.depth;class uf{constructor(){this.children=[],this.isDirty=!1}add(e){Vm(this.children,e),this.isDirty=!0}remove(e){Wm(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(df),this.isDirty=!1,this.children.forEach(e)}}function mf(e,t){const s=zm.now(),n=a=>{let{timestamp:r}=a;const l=r-s;l>=t&&(Ku(n),e(l-t))};return Qu.setup(n,!0),()=>Ku(n)}const hf=["TopLeft","TopRight","BottomLeft","BottomRight"],pf=hf.length,xf=e=>"string"===typeof e?parseFloat(e):e,gf=e=>"number"===typeof e||Pu.test(e);function ff(e,t){return void 0!==e[t]?e[t]:e.borderRadius}const bf=vf(0,.5,px),yf=vf(.5,.95,qu);function vf(e,t,s){return n=>n<e?0:n>t?1:s(yx(e,t,n))}function jf(e,t){e.min=t.min,e.max=t.max}function wf(e,t){jf(e.x,t.x),jf(e.y,t.y)}function Nf(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function kf(e,t,s,n,a){return e=mu(e-=t,1/s,n),void 0!==a&&(e=mu(e,1/a,n)),e}function Sf(e,t,s,n,a){let[r,l,o]=s;!function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4?arguments[4]:void 0,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:e,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:e;Tu.test(t)&&(t=parseFloat(t),t=lu(l.min,l.max,t/100)-l.min);if("number"!==typeof t)return;let o=lu(r.min,r.max,n);e===r&&(o-=t),e.min=kf(e.min,t,s,o,a),e.max=kf(e.max,t,s,o,a)}(e,t[r],t[l],t[o],t.scale,n,a)}const Cf=["x","scaleX","originX"],_f=["y","scaleY","originY"];function Ef(e,t,s,n){Sf(e.x,t,Cf,s?s.x:void 0,n?n.x:void 0),Sf(e.y,t,_f,s?s.y:void 0,n?n.y:void 0)}function Tf(e){return 0===e.translate&&1===e.scale}function Pf(e){return Tf(e.x)&&Tf(e.y)}function Af(e,t){return e.min===t.min&&e.max===t.max}function Df(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function Lf(e,t){return Df(e.x,t.x)&&Df(e.y,t.y)}function Mf(e){return Tg(e.x)/Tg(e.y)}function Rf(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class Ff{constructor(){this.members=[]}add(e){Vm(this.members,e),e.scheduleRender()}remove(e){if(Wm(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const e=this.members[this.members.length-1];e&&this.promote(e)}}relegate(e){const t=this.members.findIndex(t=>e===t);if(0===t)return!1;let s;for(let n=t;n>=0;n--){const e=this.members[n];if(!1!==e.isPresent){s=e;break}}return!!s&&(this.promote(s),!0)}promote(e,t){const s=this.lead;if(e!==s&&(this.prevLead=s,this.lead=e,e.show(),s)){s.instance&&s.scheduleRender(),e.scheduleRender(),e.resumeFrom=s,t&&(e.resumeFrom.preserveOpacity=!0),s.snapshot&&(e.snapshot=s.snapshot,e.snapshot.latestValues=s.animationValues||s.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:n}=e.options;!1===n&&s.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:s}=e;t.onExitComplete&&t.onExitComplete(),s&&s.options.onExitComplete&&s.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const If={nodes:0,calculatedTargetDeltas:0,calculatedProjections:0},Of=["","X","Y","Z"];let Bf=0;function Uf(e,t,s,n){const{latestValues:a}=t;a[e]&&(s[e]=a[e],t.setStaticValue(e,0),n&&(n[e]=0))}function zf(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const s=jp(t);if(window.MotionHasOptimisedAnimation(s,"transform")){const{layout:t,layoutId:n}=e.options;window.MotionCancelOptimisedAnimation(s,"transform",Qu,!(t||n))}const{parent:n}=e;n&&!n.hasCheckedOptimisedAppear&&zf(n)}function Vf(e){let{attachResizeListener:t,defaultParent:s,measureScroll:n,checkIsScrollRoot:a,resetTransform:r}=e;return class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null===s||void 0===s?void 0:s();this.id=Bf++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Gu.value&&(If.nodes=If.calculatedTargetDeltas=If.calculatedProjections=0),this.nodes.forEach(Hf),this.nodes.forEach(Xf),this.nodes.forEach(Zf),this.nodes.forEach(Yf),Gu.addProjectionMetrics&&Gu.addProjectionMetrics(If)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=e,this.root=t?t.root||t:this,this.path=t?[...t.path,t]:[],this.parent=t,this.depth=t?t.depth+1:0;for(let s=0;s<this.path.length;s++)this.path[s].shouldResetTransform=!0;this.root===this&&(this.nodes=new uf)}addEventListener(e,t){return this.eventHandlers.has(e)||this.eventHandlers.set(e,new qm),this.eventHandlers.get(e).add(t)}notifyListeners(e){const t=this.eventHandlers.get(e);for(var s=arguments.length,n=new Array(s>1?s-1:0),a=1;a<s;a++)n[a-1]=arguments[a];t&&t.notify(...n)}hasListeners(e){return this.eventHandlers.has(e)}mount(e){if(this.instance)return;var s;this.isSVG=cf(e)&&!(cf(s=e)&&"svg"===s.tagName),this.instance=e;const{layoutId:n,layout:a,visualElement:r}=this.options;if(r&&!r.current&&r.mount(e),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(a||n)&&(this.isLayoutDirty=!0),t){let s,n=0;const a=()=>this.root.updateBlockedByResize=!1;Qu.read(()=>{n=window.innerWidth}),t(e,()=>{const e=window.innerWidth;e!==n&&(n=e,this.root.updateBlockedByResize=!0,s&&s(),s=mf(a,250),ef.hasAnimatedSinceResize&&(ef.hasAnimatedSinceResize=!1,this.nodes.forEach(Jf)))})}n&&this.root.registerSharedNode(n,this),!1!==this.options.animate&&r&&(n||a)&&this.addEventListener("didUpdate",e=>{let{delta:t,hasLayoutChanged:s,hasRelativeLayoutChanged:n,layout:a}=e;if(this.isTreeAnimationBlocked())return this.target=void 0,void(this.relativeTarget=void 0);const l=this.options.transition||r.getDefaultTransition()||rb,{onLayoutAnimationStart:o,onLayoutAnimationComplete:i}=r.getProps(),c=!this.targetLayout||!Lf(this.targetLayout,a),d=!s&&n;if(this.options.layoutRoot||this.resumeFrom||d||s&&(c||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const e=He(He({},xp(l,"layout")),{},{onPlay:o,onComplete:i});(r.shouldReduceMotion||this.options.layoutRoot)&&(e.delay=0,e.type=!1),this.startAnimation(e),this.setAnimationOrigin(t,d)}else s||Jf(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=a})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const e=this.getStack();e&&e.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Ku(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(eb),this.animationId++)}getTransformTemplate(){const{visualElement:e}=this.options;return e&&e.getProps().transformTemplate}willUpdate(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked())return void(this.options.onExitComplete&&this.options.onExitComplete());if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&zf(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let a=0;a<this.path.length;a++){const e=this.path[a];e.shouldResetTransform=!0,e.updateScroll("snapshot"),e.options.layoutRoot&&e.willUpdate(!1)}const{layoutId:t,layout:s}=this.options;if(void 0===t&&!s)return;const n=this.getTransformTemplate();this.prevTransformTemplateValue=n?n(this.latestValues,""):void 0,this.updateSnapshot(),e&&this.notifyListeners("willUpdate")}update(){this.updateScheduled=!1;if(this.isUpdateBlocked())return this.unblockUpdate(),this.clearAllSnapshots(),void this.nodes.forEach($f);if(this.animationId<=this.animationCommitId)return void this.nodes.forEach(Qf);this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(Kf),this.nodes.forEach(Wf),this.nodes.forEach(qf)):this.nodes.forEach(Qf),this.clearAllSnapshots();const e=zm.now();Ju.delta=Nu(0,1e3/60,e-Ju.timestamp),Ju.timestamp=e,Ju.isProcessing=!0,Xu.update.process(Ju),Xu.preRender.process(Ju),Xu.render.process(Ju),Ju.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Km.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(Gf),this.sharedNodes.forEach(tb)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Qu.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Qu.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){!this.snapshot&&this.instance&&(this.snapshot=this.measure(),!this.snapshot||Tg(this.snapshot.measuredBox.x)||Tg(this.snapshot.measuredBox.y)||(this.snapshot=void 0))}updateLayout(){if(!this.instance)return;if(this.updateScroll(),(!this.options.alwaysMeasureLayout||!this.isLead())&&!this.isLayoutDirty)return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let s=0;s<this.path.length;s++){this.path[s].updateScroll()}const e=this.layout;this.layout=this.measure(!1),this.layoutCorrected={x:{min:0,max:0},y:{min:0,max:0}},this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:t}=this.options;t&&t.notify("LayoutMeasure",this.layout.layoutBox,e?e.layoutBox:void 0)}updateScroll(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"measure",t=Boolean(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===e&&(t=!1),t&&this.instance){const t=a(this.instance);this.scroll={animationId:this.root.animationId,phase:e,isRoot:t,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:t}}}resetTransform(){if(!r)return;const e=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,t=this.projectionDelta&&!Pf(this.projectionDelta),s=this.getTransformTemplate(),n=s?s(this.latestValues,""):void 0,a=n!==this.prevTransformTemplateValue;e&&this.instance&&(t||cu(this.latestValues)||a)&&(r(this.instance,n),this.shouldResetTransform=!1,this.scheduleRender())}measure(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=this.measurePageBox();let s=this.removeElementScroll(t);var n;return e&&(s=this.removeTransform(s)),ib((n=s).x),ib(n.y),{animationId:this.root.animationId,measuredBox:t,layoutBox:s,latestValues:{},source:this.id}}measurePageBox(){var e;const{visualElement:t}=this.options;if(!t)return{x:{min:0,max:0},y:{min:0,max:0}};const s=t.measureViewportBox();if(!((null===(e=this.scroll)||void 0===e?void 0:e.wasRoot)||this.path.some(db))){const{scroll:e}=this.root;e&&(bu(s.x,e.offset.x),bu(s.y,e.offset.y))}return s}removeElementScroll(e){var t;const s={x:{min:0,max:0},y:{min:0,max:0}};if(wf(s,e),null!==(t=this.scroll)&&void 0!==t&&t.wasRoot)return s;for(let n=0;n<this.path.length;n++){const t=this.path[n],{scroll:a,options:r}=t;t!==this.root&&a&&r.layoutScroll&&(a.wasRoot&&wf(s,e),bu(s.x,a.offset.x),bu(s.y,a.offset.y))}return s}applyTransform(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const s={x:{min:0,max:0},y:{min:0,max:0}};wf(s,e);for(let n=0;n<this.path.length;n++){const e=this.path[n];!t&&e.options.layoutScroll&&e.scroll&&e!==e.root&&vu(s,{x:-e.scroll.offset.x,y:-e.scroll.offset.y}),cu(e.latestValues)&&vu(s,e.latestValues)}return cu(this.latestValues)&&vu(s,this.latestValues),s}removeTransform(e){const t={x:{min:0,max:0},y:{min:0,max:0}};wf(t,e);for(let s=0;s<this.path.length;s++){const e=this.path[s];if(!e.instance)continue;if(!cu(e.latestValues))continue;iu(e.latestValues)&&e.updateSnapshot();const n=eh();wf(n,e.measurePageBox()),Ef(t,e.latestValues,e.snapshot?e.snapshot.layoutBox:void 0,n)}return cu(this.latestValues)&&Ef(t,this.latestValues),t}setTargetDelta(e){this.targetDelta=e,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(e){this.options=He(He(He({},this.options),e),{},{crossfade:void 0===e.crossfade||e.crossfade})}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Ju.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(){var e;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const s=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=s.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=s.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=s.isSharedProjectionDirty);const n=Boolean(this.resumingFrom)||this!==s;if(!(t||n&&this.isSharedProjectionDirty||this.isProjectionDirty||null!==(e=this.parent)&&void 0!==e&&e.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:a,layoutId:r}=this.options;if(this.layout&&(a||r)){if(this.resolvedRelativeTargetAt=Ju.timestamp,!this.targetDelta&&!this.relativeTarget){const e=this.getClosestProjectingParent();e&&e.layout&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},Mg(this.relativeTargetOrigin,this.layout.layoutBox,e.layout.layoutBox),wf(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(this.relativeTarget||this.targetDelta){var l,o,i;if(this.target||(this.target={x:{min:0,max:0},y:{min:0,max:0}},this.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}}),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),l=this.target,o=this.relativeTarget,i=this.relativeParent.target,Dg(l.x,o.x,i.x),Dg(l.y,o.y,i.y)):this.targetDelta?(Boolean(this.resumingFrom)?this.target=this.applyTransform(this.layout.layoutBox):wf(this.target,this.layout.layoutBox),xu(this.target,this.targetDelta)):wf(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const e=this.getClosestProjectingParent();e&&Boolean(e.resumingFrom)===Boolean(this.resumingFrom)&&!e.options.layoutScroll&&e.target&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},Mg(this.relativeTargetOrigin,this.target,e.target),wf(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Gu.value&&If.calculatedTargetDeltas++}}}getClosestProjectingParent(){if(this.parent&&!iu(this.parent.latestValues)&&!du(this.parent.latestValues))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return Boolean((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var e;const t=this.getLead(),s=Boolean(this.resumingFrom)||this!==t;let n=!0;if((this.isProjectionDirty||null!==(e=this.parent)&&void 0!==e&&e.isProjectionDirty)&&(n=!1),s&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(n=!1),this.resolvedRelativeTargetAt===Ju.timestamp&&(n=!1),n)return;const{layout:a,layoutId:r}=this.options;if(this.isTreeAnimating=Boolean(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!a&&!r)return;wf(this.layoutCorrected,this.layout.layoutBox);const l=this.treeScale.x,o=this.treeScale.y;!function(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=s.length;if(!a)return;let r,l;t.x=t.y=1;for(let o=0;o<a;o++){r=s[o],l=r.projectionDelta;const{visualElement:a}=r.options;a&&a.props.style&&"contents"===a.props.style.display||(n&&r.options.layoutScroll&&r.scroll&&r!==r.root&&vu(e,{x:-r.scroll.offset.x,y:-r.scroll.offset.y}),l&&(t.x*=l.x.scale,t.y*=l.y.scale,xu(e,l)),n&&cu(r.latestValues)&&vu(e,r.latestValues))}t.x<fu&&t.x>gu&&(t.x=1),t.y<fu&&t.y>gu&&(t.y=1)}(this.layoutCorrected,this.treeScale,this.path,s),!t.layout||t.target||1===this.treeScale.x&&1===this.treeScale.y||(t.target=t.layout.layoutBox,t.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}});const{target:i}=t;i?(this.projectionDelta&&this.prevProjectionDelta?(Nf(this.prevProjectionDelta.x,this.projectionDelta.x),Nf(this.prevProjectionDelta.y,this.projectionDelta.y)):this.createProjectionDeltas(),Ag(this.projectionDelta,this.layoutCorrected,i,this.latestValues),this.treeScale.x===l&&this.treeScale.y===o&&Rf(this.projectionDelta.x,this.prevProjectionDelta.x)&&Rf(this.projectionDelta.y,this.prevProjectionDelta.y)||(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",i)),Gu.value&&If.calculatedProjections++):this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender())}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(){var e;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(null===(e=this.options.visualElement)||void 0===e||e.scheduleRender(),t){const e=this.getStack();e&&e.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDeltaWithTransform={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}}}setAnimationOrigin(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const s=this.snapshot,n=s?s.latestValues:{},a=He({},this.latestValues),r={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};this.relativeParent&&this.relativeParent.options.layoutRoot||(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!t;const l={x:{min:0,max:0},y:{min:0,max:0}},o=(s?s.source:void 0)!==(this.layout?this.layout.source:void 0),i=this.getStack(),c=!i||i.members.length<=1,d=Boolean(o&&!c&&!0===this.options.crossfade&&!this.path.some(ab));let u;this.animationProgress=0,this.mixTargetDelta=t=>{const s=t/1e3;var i,m,h,p,x,g;sb(r.x,e.x,s),sb(r.y,e.y,s),this.setTargetDelta(r),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Mg(l,this.layout.layoutBox,this.relativeParent.layout.layoutBox),h=this.relativeTarget,p=this.relativeTargetOrigin,x=l,g=s,nb(h.x,p.x,x.x,g),nb(h.y,p.y,x.y,g),u&&(i=this.relativeTarget,m=u,Af(i.x,m.x)&&Af(i.y,m.y))&&(this.isProjectionDirty=!1),u||(u={x:{min:0,max:0},y:{min:0,max:0}}),wf(u,this.relativeTarget)),o&&(this.animationValues=a,function(e,t,s,n,a,r){var l,o;if(a)e.opacity=lu(0,null!==(l=s.opacity)&&void 0!==l?l:1,bf(n)),e.opacityExit=lu(null!==(o=t.opacity)&&void 0!==o?o:1,0,yf(n));else if(r){var i,c;e.opacity=lu(null!==(i=t.opacity)&&void 0!==i?i:1,null!==(c=s.opacity)&&void 0!==c?c:1,n)}for(let d=0;d<pf;d++){const a="border".concat(hf[d],"Radius");let r=ff(t,a),l=ff(s,a);void 0===r&&void 0===l||(r||(r=0),l||(l=0),0===r||0===l||gf(r)===gf(l)?(e[a]=Math.max(lu(xf(r),xf(l),n),0),(Tu.test(l)||Tu.test(r))&&(e[a]+="%")):e[a]=l)}(t.rotate||s.rotate)&&(e.rotate=lu(t.rotate||0,s.rotate||0,n))}(a,n,this.latestValues,s,d,c)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=s},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(e){var t,s;this.notifyListeners("animationStart"),null===(t=this.currentAnimation)||void 0===t||t.stop(),null===(s=this.resumingFrom)||void 0===s||null===(s=s.currentAnimation)||void 0===s||s.stop(),this.pendingAnimation&&(Ku(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Qu.update(()=>{ef.hasAnimatedSinceResize=!0,_p.layout++,this.motionValue||(this.motionValue=$m(0)),this.currentAnimation=function(e,t,s){const n=Om(e)?e:$m(e);return n.start(ng("",n,t,s)),n.animation}(this.motionValue,[0,1e3],He(He({},e),{},{velocity:0,isSync:!0,onUpdate:t=>{this.mixTargetDelta(t),e.onUpdate&&e.onUpdate(t)},onStop:()=>{_p.layout--},onComplete:()=>{_p.layout--,e.onComplete&&e.onComplete(),this.completeAnimation()}})),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const e=this.getStack();e&&e.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(1e3),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const e=this.getLead();let{targetWithTransforms:t,target:s,layout:n,latestValues:a}=e;if(t&&s&&n){if(this!==e&&this.layout&&n&&cb(this.options.animationType,this.layout.layoutBox,n.layoutBox)){s=this.target||{x:{min:0,max:0},y:{min:0,max:0}};const t=Tg(this.layout.layoutBox.x);s.x.min=e.target.x.min,s.x.max=s.x.min+t;const n=Tg(this.layout.layoutBox.y);s.y.min=e.target.y.min,s.y.max=s.y.min+n}wf(t,s),vu(t,a),Ag(this.projectionDeltaWithTransform,this.layoutCorrected,t,a)}}registerSharedNode(e,t){this.sharedNodes.has(e)||this.sharedNodes.set(e,new Ff);this.sharedNodes.get(e).add(t);const s=t.options.initialPromotionConfig;t.promote({transition:s?s.transition:void 0,preserveFollowOpacity:s&&s.shouldPreserveFollowOpacity?s.shouldPreserveFollowOpacity(t):void 0})}isLead(){const e=this.getStack();return!e||e.lead===this}getLead(){var e;const{layoutId:t}=this.options;return t&&(null===(e=this.getStack())||void 0===e?void 0:e.lead)||this}getPrevLead(){var e;const{layoutId:t}=this.options;return t?null===(e=this.getStack())||void 0===e?void 0:e.prevLead:void 0}getStack(){const{layoutId:e}=this.options;if(e)return this.root.sharedNodes.get(e)}promote(){let{needsReset:e,transition:t,preserveFollowOpacity:s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=this.getStack();n&&n.promote(this,s),e&&(this.projectionDelta=void 0,this.needsReset=!0),t&&this.setOptions({transition:t})}relegate(){const e=this.getStack();return!!e&&e.relegate(this)}resetSkewAndRotation(){const{visualElement:e}=this.options;if(!e)return;let t=!1;const{latestValues:s}=e;if((s.z||s.rotate||s.rotateX||s.rotateY||s.rotateZ||s.skewX||s.skewY)&&(t=!0),!t)return;const n={};s.z&&Uf("z",e,n,this.animationValues);for(let a=0;a<Of.length;a++)Uf("rotate".concat(Of[a]),e,n,this.animationValues),Uf("skew".concat(Of[a]),e,n,this.animationValues);e.render();for(const a in n)e.setStaticValue(a,n[a]),this.animationValues&&(this.animationValues[a]=n[a]);e.scheduleRender()}applyProjectionStyles(e,t){if(!this.instance||this.isSVG)return;if(!this.isVisible)return void(e.visibility="hidden");const s=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,e.visibility="",e.opacity="",e.pointerEvents=Xh(null===t||void 0===t?void 0:t.pointerEvents)||"",void(e.transform=s?s(this.latestValues,""):"none");const n=this.getLead();if(!this.projectionDelta||!this.layout||!n.target)return this.options.layoutId&&(e.opacity=void 0!==this.latestValues.opacity?this.latestValues.opacity:1,e.pointerEvents=Xh(null===t||void 0===t?void 0:t.pointerEvents)||""),void(this.hasProjected&&!cu(this.latestValues)&&(e.transform=s?s({},""):"none",this.hasProjected=!1));e.visibility="";const a=n.animationValues||n.latestValues;this.applyTransformsToTarget();let r=function(e,t,s){let n="";const a=e.x.translate/t.x,r=e.y.translate/t.y,l=(null===s||void 0===s?void 0:s.z)||0;if((a||r||l)&&(n="translate3d(".concat(a,"px, ").concat(r,"px, ").concat(l,"px) ")),1===t.x&&1===t.y||(n+="scale(".concat(1/t.x,", ").concat(1/t.y,") ")),s){const{transformPerspective:e,rotate:t,rotateX:a,rotateY:r,skewX:l,skewY:o}=s;e&&(n="perspective(".concat(e,"px) ").concat(n)),t&&(n+="rotate(".concat(t,"deg) ")),a&&(n+="rotateX(".concat(a,"deg) ")),r&&(n+="rotateY(".concat(r,"deg) ")),l&&(n+="skewX(".concat(l,"deg) ")),o&&(n+="skewY(".concat(o,"deg) "))}const o=e.x.scale*t.x,i=e.y.scale*t.y;return 1===o&&1===i||(n+="scale(".concat(o,", ").concat(i,")")),n||"none"}(this.projectionDeltaWithTransform,this.treeScale,a);s&&(r=s(a,r)),e.transform=r;const{x:l,y:o}=this.projectionDelta;var i,c;(e.transformOrigin="".concat(100*l.origin,"% ").concat(100*o.origin,"% 0"),n.animationValues)?e.opacity=n===this?null!==(i=null!==(c=a.opacity)&&void 0!==c?c:this.latestValues.opacity)&&void 0!==i?i:1:this.preserveOpacity?this.latestValues.opacity:a.opacityExit:e.opacity=n===this?void 0!==a.opacity?a.opacity:"":void 0!==a.opacityExit?a.opacityExit:0;for(const d in jh){if(void 0===a[d])continue;const{correct:t,applyTo:s,isCSSVariable:l}=jh[d],o="none"===r?a[d]:t(a[d],n);if(s){const t=s.length;for(let n=0;n<t;n++)e[s[n]]=o}else l?this.options.visualElement.renderState.vars[d]=o:e[d]=o}this.options.layoutId&&(e.pointerEvents=n===this?Xh(null===t||void 0===t?void 0:t.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(e=>{var t;return null===(t=e.currentAnimation)||void 0===t?void 0:t.stop()}),this.root.nodes.forEach($f),this.root.sharedNodes.clear()}}}function Wf(e){e.updateLayout()}function qf(e){var t;const s=(null===(t=e.resumeFrom)||void 0===t?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&s&&e.hasListeners("didUpdate")){const{layoutBox:t,measuredBox:n}=e.layout,{animationType:a}=e.options,r=s.source!==e.layout.source;"size"===a?Rg(e=>{const n=r?s.measuredBox[e]:s.layoutBox[e],a=Tg(n);n.min=t[e].min,n.max=n.min+a}):cb(a,s.layoutBox,t)&&Rg(n=>{const a=r?s.measuredBox[n]:s.layoutBox[n],l=Tg(t[n]);a.max=a.min+l,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[n].max=e.relativeTarget[n].min+l)});const l={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};Ag(l,t,s.layoutBox);const o={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};r?Ag(o,e.applyTransform(n,!0),s.measuredBox):Ag(o,t,s.layoutBox);const i=!Pf(l);let c=!1;if(!e.resumeFrom){const n=e.getClosestProjectingParent();if(n&&!n.resumeFrom){const{snapshot:a,layout:r}=n;if(a&&r){const l={x:{min:0,max:0},y:{min:0,max:0}};Mg(l,s.layoutBox,a.layoutBox);const o={x:{min:0,max:0},y:{min:0,max:0}};Mg(o,t,r.layoutBox),Lf(l,o)||(c=!0),n.options.layoutRoot&&(e.relativeTarget=o,e.relativeTargetOrigin=l,e.relativeParent=n)}}}e.notifyListeners("didUpdate",{layout:t,snapshot:s,delta:o,layoutDelta:l,hasLayoutChanged:i,hasRelativeLayoutChanged:c})}else if(e.isLead()){const{onExitComplete:t}=e.options;t&&t()}e.options.transition=void 0}function Hf(e){Gu.value&&If.nodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=Boolean(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function Yf(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function Gf(e){e.clearSnapshot()}function $f(e){e.clearMeasurements()}function Qf(e){e.isLayoutDirty=!1}function Kf(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function Jf(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function Xf(e){e.resolveTargetDelta()}function Zf(e){e.calcProjection()}function eb(e){e.resetSkewAndRotation()}function tb(e){e.removeLeadSnapshot()}function sb(e,t,s){e.translate=lu(t.translate,0,s),e.scale=lu(t.scale,1,s),e.origin=t.origin,e.originPoint=t.originPoint}function nb(e,t,s,n){e.min=lu(t.min,s.min,n),e.max=lu(t.max,s.max,n)}function ab(e){return e.animationValues&&void 0!==e.animationValues.opacityExit}const rb={duration:.45,ease:[.4,0,.1,1]},lb=e=>"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),ob=lb("applewebkit/")&&!lb("chrome/")?Math.round:qu;function ib(e){e.min=ob(e.min),e.max=ob(e.max)}function cb(e,t,s){return"position"===e||"preserve-aspect"===e&&!function(e,t,s){return Math.abs(e-t)<=s}(Mf(t),Mf(s),.2)}function db(e){var t;return e!==e.root&&(null===(t=e.scroll)||void 0===t?void 0:t.wasRoot)}const ub=Vf({attachResizeListener:(e,t)=>Sg(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),mb={current:void 0},hb=Vf({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!mb.current){const e=new ub({});e.mount(window),e.setOptions({layoutScroll:!0}),mb.current=e}return mb.current},resetTransform:(e,t)=>{e.style.transform=void 0!==t?t:"none"},checkIsScrollRoot:e=>Boolean("fixed"===window.getComputedStyle(e).position)}),pb={pan:{Feature:class extends vg{constructor(){super(...arguments),this.removePointerDownListener=qu}onPointerDown(e){this.session=new Og(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Fg(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:s,onPanEnd:n}=this.node.getProps();return{onSessionStart:Zg(e),onStart:Zg(t),onMove:s,onEnd:(e,t)=>{delete this.session,n&&Qu.postRender(()=>n(e,t))}}}mount(){this.removePointerDownListener=Eg(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}},drag:{Feature:class extends vg{constructor(e){super(e),this.removeGroupControls=qu,this.removeListeners=qu,this.controls=new Jg(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||qu}unmount(){this.removeGroupControls(),this.removeListeners()}},ProjectionNode:hb,MeasureLayout:lf}};function xb(e,t){const s=function(e,t,s){if(e instanceof EventTarget)return[e];if("string"===typeof e){var n;let a=document;t&&(a=t.current);const r=null!==(n=null===s||void 0===s?void 0:s[e])&&void 0!==n?n:a.querySelectorAll(e);return r?Array.from(r):[]}return Array.from(e)}(e),n=new AbortController;return[s,He(He({passive:!0},t),{},{signal:n.signal}),()=>n.abort()]}function gb(e){return!("touch"===e.pointerType||kg())}function fb(e,t,s){const{props:n}=e;e.animationState&&n.whileHover&&e.animationState.setActive("whileHover","Start"===s);const a=n["onHover"+s];a&&Qu.postRender(()=>a(t,_g(t)))}const bb=(e,t)=>!!t&&(e===t||bb(e,t.parentElement)),yb=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);const vb=new WeakSet;function jb(e){return t=>{"Enter"===t.key&&e(t)}}function wb(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}function Nb(e){return Cg(e)&&!kg()}function kb(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const[n,a,r]=xb(e,s),l=e=>{const n=e.currentTarget;if(!Nb(e))return;vb.add(n);const r=t(n,e),l=(e,t)=>{window.removeEventListener("pointerup",o),window.removeEventListener("pointercancel",i),vb.has(n)&&vb.delete(n),Nb(e)&&"function"===typeof r&&r(e,{success:t})},o=e=>{l(e,n===window||n===document||s.useGlobalTarget||bb(n,e.target))},i=e=>{l(e,!1)};window.addEventListener("pointerup",o,a),window.addEventListener("pointercancel",i,a)};return n.forEach(e=>{var t;(s.useGlobalTarget?window:e).addEventListener("pointerdown",l,a),Pd(e)&&(e.addEventListener("focus",e=>((e,t)=>{const s=e.currentTarget;if(!s)return;const n=jb(()=>{if(vb.has(s))return;wb(s,"down");const e=jb(()=>{wb(s,"up")});s.addEventListener("keyup",e,t),s.addEventListener("blur",()=>wb(s,"cancel"),t)});s.addEventListener("keydown",n,t),s.addEventListener("blur",()=>s.removeEventListener("keydown",n),t)})(e,a)),t=e,yb.has(t.tagName)||-1!==t.tabIndex||e.hasAttribute("tabindex")||(e.tabIndex=0))}),r}function Sb(e,t,s){const{props:n}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&n.whileTap&&e.animationState.setActive("whileTap","Start"===s);const a=n["onTap"+("End"===s?"":s)];a&&Qu.postRender(()=>a(t,_g(t)))}const Cb=["root"],_b=new WeakMap,Eb=new WeakMap,Tb=e=>{const t=_b.get(e.target);t&&t(e)},Pb=e=>{e.forEach(Tb)};function Ab(e,t,s){const n=function(e){let{root:t}=e,s=Si(e,Cb);const n=t||document;Eb.has(n)||Eb.set(n,{});const a=Eb.get(n),r=JSON.stringify(s);return a[r]||(a[r]=new IntersectionObserver(Pb,He({root:t},s))),a[r]}(t);return _b.set(e,s),n.observe(e),()=>{_b.delete(e),n.unobserve(e)}}const Db={some:0,all:1};const Lb={inView:{Feature:class extends vg{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:s,amount:n="some",once:a}=e,r={root:t?t.current:void 0,rootMargin:s,threshold:"number"===typeof n?n:Db[n]};return Ab(this.node.current,r,e=>{const{isIntersecting:t}=e;if(this.isInView===t)return;if(this.isInView=t,a&&!t&&this.hasEnteredView)return;t&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",t);const{onViewportEnter:s,onViewportLeave:n}=this.node.getProps(),r=t?s:n;r&&r(e)})}mount(){this.startObserver()}update(){if("undefined"===typeof IntersectionObserver)return;const{props:e,prevProps:t}=this.node,s=["amount","margin","root"].some(function(e){let{viewport:t={}}=e,{viewport:s={}}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e=>t[e]!==s[e]}(e,t));s&&this.startObserver()}unmount(){}}},tap:{Feature:class extends vg{mount(){const{current:e}=this.node;e&&(this.unmount=kb(e,(e,t)=>(Sb(this.node,t,"Start"),(e,t)=>{let{success:s}=t;return Sb(this.node,e,s?"End":"Cancel")}),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}},focus:{Feature:class extends vg{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch(ey){e=!0}e&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){this.isActive&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=kp(Sg(this.node.current,"focus",()=>this.onFocus()),Sg(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}},hover:{Feature:class extends vg{mount(){const{current:e}=this.node;e&&(this.unmount=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const[n,a,r]=xb(e,s),l=e=>{if(!gb(e))return;const{target:s}=e,n=t(s,e);if("function"!==typeof n||!s)return;const r=e=>{gb(e)&&(n(e),s.removeEventListener("pointerleave",r))};s.addEventListener("pointerleave",r,a)};return n.forEach(e=>{e.addEventListener("pointerenter",l,a)}),r}(e,(e,t)=>(fb(this.node,t,"Start"),e=>fb(this.node,e,"End"))))}unmount(){}}}},Mb={layout:{ProjectionNode:hb,MeasureLayout:lf}},Rb=hp(He(He(He(He({},wg),Lb),pb),Mb),Fh),Fb=e=>{let{data:t,onPause:s,onResume:n}=e;if(!t)return(0,fn.jsx)("div",{className:"bg-white rounded-lg shadow-md p-6",children:(0,fn.jsxs)("div",{className:"animate-pulse",children:[(0,fn.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/4 mb-4"}),(0,fn.jsx)("div",{className:"h-8 bg-gray-200 rounded w-3/4"})]})});const{isActive:a,isPaused:r,currentLead:l,lastActivity:o,todayStats:i}=t;return(0,fn.jsxs)(Rb.div,{className:"bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg shadow-lg p-6 text-white",whileHover:{scale:1.01},transition:{duration:.2},children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,fn.jsxs)("div",{className:"flex items-center gap-3",children:[(0,fn.jsx)("div",{className:"w-4 h-4 rounded-full ".concat(r?"bg-yellow-500":a?"bg-green-500":"bg-gray-400"," animate-pulse")}),(0,fn.jsx)("h2",{className:"text-2xl font-bold",children:"\ud83e\udd16 SalesApe Live Activity"})]}),(0,fn.jsx)("div",{className:"flex gap-2",children:r?(0,fn.jsxs)("button",{onClick:n,className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-medium transition-colors flex items-center gap-2",children:[(0,fn.jsx)("span",{children:"\u25b6\ufe0f"})," Resume"]}):(0,fn.jsxs)("button",{onClick:s,className:"bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg font-medium transition-colors flex items-center gap-2",children:[(0,fn.jsx)("span",{children:"\u23f8\ufe0f"})," Pause"]})})]}),(0,fn.jsx)("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-4 mb-4",children:(0,fn.jsx)("div",{className:"flex items-center justify-between",children:(0,fn.jsxs)("div",{className:"flex-1",children:[(0,fn.jsxs)("p",{className:"text-sm opacity-90 mb-1",children:["Status: ",r?"Paused":a?"Active":"Idle"]}),l?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsxs)("p",{className:"text-xl font-semibold mb-1",children:["Currently engaging with: ",l.name]}),(0,fn.jsxs)("p",{className:"text-sm opacity-90",children:[l.status," \u2022 Last activity: ",(e=>{if(!e)return"N/A";const t=Math.floor((Date.now()-new Date(e))/1e3);if(t<60)return"".concat(t,"s ago");const s=Math.floor(t/60);if(s<60)return"".concat(s,"m ago");const n=Math.floor(s/60);return"".concat(n,"h ago")})(o)]}),l.lastMessage&&(0,fn.jsxs)("p",{className:"text-sm mt-2 italic opacity-80",children:['"',l.lastMessage,'"']})]}):(0,fn.jsx)("p",{className:"text-xl font-semibold",children:r?"Queue is paused":"No active engagement"})]})})}),(0,fn.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,fn.jsxs)("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-4",children:[(0,fn.jsx)("p",{className:"text-sm opacity-90 mb-1",children:"Messages Sent"}),(0,fn.jsx)("p",{className:"text-3xl font-bold",children:(null===i||void 0===i?void 0:i.messagesSent)||0})]}),(0,fn.jsxs)("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-4",children:[(0,fn.jsx)("p",{className:"text-sm opacity-90 mb-1",children:"Leads Engaged"}),(0,fn.jsx)("p",{className:"text-3xl font-bold",children:(null===i||void 0===i?void 0:i.leadsEngaged)||0}),(0,fn.jsxs)("p",{className:"text-xs opacity-75",children:[(null===i||void 0===i?void 0:i.engagementRate)||0,"% rate"]})]}),(0,fn.jsxs)("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-4",children:[(0,fn.jsx)("p",{className:"text-sm opacity-90 mb-1",children:"Bookings Made"}),(0,fn.jsx)("p",{className:"text-3xl font-bold",children:(null===i||void 0===i?void 0:i.bookingsMade)||0}),(0,fn.jsxs)("p",{className:"text-xs opacity-75",children:[(null===i||void 0===i?void 0:i.conversionRate)||0,"% conversion"]})]}),(0,fn.jsxs)("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-4",children:[(0,fn.jsx)("p",{className:"text-sm opacity-90 mb-1",children:"Response Rate"}),(0,fn.jsxs)("p",{className:"text-3xl font-bold",children:[(null===i||void 0===i?void 0:i.responseRate)||0,"%"]}),(0,fn.jsxs)("p",{className:"text-xs opacity-75",children:["Avg: ",(null===i||void 0===i?void 0:i.avgResponseTime)||"N/A"]})]})]})]})},Ib=e=>{let{queue:t,onLeadSelect:s,selectedLead:n,onAddToQueue:r,onRemoveFromQueue:l,onRemoveAll:o,onRefresh:i}=e;const[c,d]=(0,a.useState)(!1),[u,m]=(0,a.useState)(""),[h,p]=(0,a.useState)([]),[x,g]=(0,a.useState)(!1),[f,b]=(0,a.useState)(null);if(!t)return(0,fn.jsx)("div",{className:"bg-white rounded-lg shadow-md p-6",children:(0,fn.jsxs)("div",{className:"animate-pulse",children:[(0,fn.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/2 mb-4"}),(0,fn.jsxs)("div",{className:"space-y-3",children:[(0,fn.jsx)("div",{className:"h-12 bg-gray-200 rounded"}),(0,fn.jsx)("div",{className:"h-12 bg-gray-200 rounded"}),(0,fn.jsx)("div",{className:"h-12 bg-gray-200 rounded"})]})]})});const y=[...t].sort((e,t)=>{const s=new Date(e.salesape_sent_at||e.created_at||0).getTime();return new Date(t.salesape_sent_at||t.created_at||0).getTime()-s}),v=y.filter(e=>"in_progress"===e.queue_status),j=y.filter(e=>"queued"===e.queue_status),w=y.filter(e=>"failed"===e.queue_status),N=y.filter(e=>"completed"===e.queue_status),k=e=>{switch(e){case"in_progress":return"\ud83d\udd35";case"queued":return"\u23f3";case"completed":return"\u2705";case"failed":return"\u274c";default:return"\u26aa"}},S=e=>{switch(e){case"in_progress":return"bg-blue-100 border-blue-300";case"queued":default:return"bg-gray-100 border-gray-300";case"completed":return"bg-green-100 border-green-300";case"failed":return"bg-red-100 border-red-300"}},C=e=>{if(!e)return"Just now";const t=Math.floor((Date.now()-new Date(e))/1e3);if(t<60)return"".concat(t,"s ago");const s=Math.floor(t/60);if(s<60)return"".concat(s,"m ago");const n=Math.floor(s/60);if(n<24)return"".concat(n,"h ago");const a=Math.floor(n/24);return"".concat(a,"d ago")},_=e=>{let{lead:t}=e;return(0,fn.jsxs)(Rb.div,{layout:!0,initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,x:-10},whileHover:{scale:1.02},onClick:()=>s(t),className:"p-3 rounded-lg border-2 cursor-pointer transition-all ".concat(S(t.queue_status)," ").concat((null===n||void 0===n?void 0:n.id)===t.id?"ring-2 ring-blue-500":""),children:[(0,fn.jsxs)("div",{className:"flex items-start justify-between",children:[(0,fn.jsxs)("div",{className:"flex-1",children:[(0,fn.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,fn.jsx)("span",{className:"text-lg",children:k(t.queue_status)}),(0,fn.jsx)("p",{className:"font-semibold text-gray-900 truncate",children:t.name})]}),(0,fn.jsx)("p",{className:"text-sm text-gray-600",children:t.salesape_status||"Queued"}),"failed"===t.queue_status&&t.salesape_error&&(0,fn.jsxs)("p",{className:"text-xs text-red-600 mt-1 font-medium",children:["\u26a0\ufe0f ",t.salesape_error]}),(0,fn.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:C(t.salesape_last_updated||t.created_at)})]}),(0,fn.jsx)("button",{onClick:e=>{e.stopPropagation(),window.confirm("Remove ".concat(t.name," from queue?"))&&l(t.id)},className:"text-gray-400 hover:text-red-500 transition-colors",children:"\u2715"})]}),("in_progress"===t.queue_status||"queued"===t.queue_status)&&(0,fn.jsxs)("div",{className:"mt-2",children:[(0,fn.jsxs)("div",{className:"flex gap-1",children:[(0,fn.jsx)("div",{className:"h-1.5 flex-1 rounded transition-all ".concat(t.salesape_initial_message_sent?"bg-blue-500":"bg-gray-300"),title:"Initial message sent"}),(0,fn.jsx)("div",{className:"h-1.5 flex-1 rounded transition-all ".concat(t.salesape_user_engaged?"bg-blue-500":"bg-gray-300"),title:"User engaged"}),(0,fn.jsx)("div",{className:"h-1.5 flex-1 rounded transition-all ".concat(t.salesape_goal_presented?"bg-blue-500":"bg-gray-300"),title:"Goal presented"}),(0,fn.jsx)("div",{className:"h-1.5 flex-1 rounded transition-all ".concat(t.salesape_goal_hit?"bg-green-500":"bg-gray-300"),title:"Goal achieved"})]}),(0,fn.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,fn.jsx)("p",{className:"text-xs text-gray-600 font-medium",children:t.salesape_goal_hit?"\u2705 Booked!":t.salesape_goal_presented?"\ud83c\udfaf Goal presented":t.salesape_user_engaged?"\ud83d\udcac User engaged":t.salesape_initial_message_sent?"\ud83d\udce4 Message sent":"queued"===t.queue_status?"\u23f3 Waiting to start...":"\ud83d\udd04 Starting..."}),t.salesape_status&&(0,fn.jsx)("span",{className:"text-xs text-gray-500",children:t.salesape_status})]})]})]})};return(0,fn.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 h-full",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,fn.jsxs)("h2",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:["\ud83d\udccb Queue",(0,fn.jsxs)("span",{className:"text-sm font-normal text-gray-500",children:["(",t.length," leads)"]})]}),(0,fn.jsxs)("div",{className:"flex items-center gap-2",children:[t.length>0&&(0,fn.jsx)("button",{onClick:o,className:"px-3 py-1 bg-red-500 hover:bg-red-600 text-white text-sm rounded-lg transition-colors font-medium",title:"Remove all leads from queue",children:"\ud83d\uddd1\ufe0f Remove All"}),(0,fn.jsx)("button",{onClick:i,className:"text-gray-400 hover:text-gray-600 transition-colors",title:"Refresh",children:"\ud83d\udd04"})]})]}),(0,fn.jsxs)("div",{className:"space-y-4 max-h-[600px] overflow-y-auto",children:[v.length>0&&(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("h3",{className:"text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2",children:[(0,fn.jsx)("span",{className:"text-blue-500",children:"\u25cf"}),"IN PROGRESS (",v.length,")"]}),(0,fn.jsx)(zd,{children:(0,fn.jsx)("div",{className:"space-y-2",children:v.map(e=>(0,fn.jsx)(_,{lead:e},e.id))})})]}),j.length>0&&(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("h3",{className:"text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2",children:[(0,fn.jsx)("span",{className:"text-gray-500",children:"\u25cf"}),"QUEUED (",j.length,")"]}),(0,fn.jsx)(zd,{children:(0,fn.jsx)("div",{className:"space-y-2",children:j.map(e=>(0,fn.jsx)(_,{lead:e},e.id))})})]}),w.length>0&&(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("h3",{className:"text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2",children:[(0,fn.jsx)("span",{className:"text-red-500",children:"\u25cf"}),"FAILED (",w.length,")"]}),(0,fn.jsx)(zd,{children:(0,fn.jsx)("div",{className:"space-y-2",children:w.map(e=>(0,fn.jsx)(_,{lead:e},e.id))})})]}),N.length>0&&(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("h3",{className:"text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2",children:[(0,fn.jsx)("span",{className:"text-green-500",children:"\u25cf"}),"COMPLETED (",N.length,")"]}),(0,fn.jsx)(zd,{children:(0,fn.jsx)("div",{className:"space-y-2",children:N.slice(0,5).map(e=>(0,fn.jsx)(_,{lead:e},e.id))})}),N.length>5&&(0,fn.jsxs)("p",{className:"text-xs text-gray-500 mt-2 text-center",children:["... and ",N.length-5," more"]})]}),0===t.length&&(0,fn.jsxs)("div",{className:"text-center py-12",children:[(0,fn.jsx)("p",{className:"text-4xl mb-4",children:"\ud83d\udced"}),(0,fn.jsx)("p",{className:"text-gray-500",children:"No leads in queue"}),(0,fn.jsx)("p",{className:"text-sm text-gray-400 mt-2",children:"Add leads from the Leads page"})]})]}),(0,fn.jsx)("div",{className:"mt-4 pt-4 border-t",children:(0,fn.jsxs)("button",{onClick:()=>d(!0),className:"w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg font-medium transition-colors flex items-center justify-center gap-2",children:[(0,fn.jsx)("span",{children:"+"})," Add Lead to Queue"]})}),(0,fn.jsx)(zd,{children:c&&(0,fn.jsx)(Rb.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:()=>d(!1),children:(0,fn.jsxs)(Rb.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:e=>e.stopPropagation(),className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] flex flex-col",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between p-6 border-b",children:[(0,fn.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"Add Lead to SalesApe Queue"}),(0,fn.jsx)("button",{onClick:()=>{d(!1),m(""),p([])},className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,fn.jsx)(jl,{className:"h-6 w-6"})})]}),(0,fn.jsx)("div",{className:"p-6 border-b",children:(0,fn.jsxs)("div",{className:"relative",children:[(0,fn.jsx)(sl,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),(0,fn.jsx)("input",{type:"text",placeholder:"Search by name, phone, email, or postcode...",value:u,onChange:e=>{m(e.target.value),e.target.value.length>=2?(async e=>{g(!0);try{const t=localStorage.getItem("token"),s=await gn.get("/api/leads",{params:{search:e,limit:20,page:1},headers:{"x-auth-token":t}}),n=s.data.leads||s.data||[];p(n)}catch(t){console.error("Error searching leads:",t),p([])}finally{g(!1)}})(e.target.value):p([])},className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoFocus:!0})]})}),(0,fn.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:x?(0,fn.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,fn.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):0===h.length&&u.length>=2?(0,fn.jsx)("div",{className:"text-center py-12",children:(0,fn.jsx)("p",{className:"text-gray-500",children:"No leads found"})}):0===h.length?(0,fn.jsx)("div",{className:"text-center py-12",children:(0,fn.jsx)("p",{className:"text-gray-500",children:"Start typing to search for leads..."})}):(0,fn.jsx)("div",{className:"space-y-2",children:h.map(e=>{const s=t.some(t=>t.id===e.id),n=e.phone&&""!==e.phone.trim();return(0,fn.jsx)(Rb.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"p-4 border rounded-lg ".concat(s?"bg-gray-50 border-gray-200":"bg-white border-gray-200 hover:border-blue-300"),children:(0,fn.jsxs)("div",{className:"flex items-start justify-between",children:[(0,fn.jsxs)("div",{className:"flex-1",children:[(0,fn.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,fn.jsx)(gl,{className:"text-gray-400"}),(0,fn.jsx)("h4",{className:"font-semibold text-gray-900",children:e.name||"Unnamed Lead"}),s&&(0,fn.jsx)("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded-full",children:"In Queue"}),!n&&(0,fn.jsx)("span",{className:"px-2 py-0.5 bg-red-100 text-red-700 text-xs rounded-full",children:"No Phone"})]}),(0,fn.jsxs)("div",{className:"space-y-1 text-sm text-gray-600",children:[e.phone&&(0,fn.jsxs)("div",{className:"flex items-center gap-2",children:[(0,fn.jsx)(Jr,{className:"h-4 w-4"}),(0,fn.jsx)("span",{children:e.phone})]}),e.email&&(0,fn.jsxs)("div",{className:"flex items-center gap-2",children:[(0,fn.jsx)(Wr,{className:"h-4 w-4"}),(0,fn.jsx)("span",{children:e.email})]}),e.postcode&&(0,fn.jsxs)("div",{className:"text-gray-500",children:["\ud83d\udccd ",e.postcode]})]})]}),(0,fn.jsx)("button",{onClick:async()=>{if(s)alert("This lead is already in the queue");else if(n){b(e.id);try{await r(e.id),d(!1),m(""),p([])}catch(t){console.error("Error adding to queue:",t)}finally{b(null)}}else alert("This lead has no phone number. Please add a phone number first.")},disabled:s||!n||f===e.id,className:"ml-4 px-4 py-2 rounded-lg font-medium transition-colors ".concat(s||!n?"bg-gray-200 text-gray-400 cursor-not-allowed":f===e.id?"bg-blue-400 text-white cursor-wait":"bg-blue-600 hover:bg-blue-700 text-white"),children:f===e.id?"Adding...":s?"In Queue":"Add to Queue"})]})},e.id)})})})]})})})]})},Ob=e=>{let{lead:t,conversation:s,onRefresh:n,onCalendarLinkSent:r}=e;const l=(0,a.useRef)(null),[o,i]=(0,a.useState)(!1),[c,d]=(0,a.useState)(""),[u,m]=(0,a.useState)(""),[h,p]=(0,a.useState)(!1),[x,g]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(()=>{var e;null===(e=l.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})})()},[s]);if(!t)return(0,fn.jsx)("div",{className:"bg-white rounded-lg shadow-md p-6 h-full flex items-center justify-center",children:(0,fn.jsxs)("div",{className:"text-center",children:[(0,fn.jsx)("p",{className:"text-4xl mb-4",children:"\ud83d\udcac"}),(0,fn.jsx)("p",{className:"text-gray-500",children:"Select a lead from the queue"}),(0,fn.jsx)("p",{className:"text-sm text-gray-400 mt-2",children:"to view their conversation with SalesApe"})]})});const f=(null===s||void 0===s?void 0:s.messages)||[],b=(null===s||void 0===s?void 0:s.stats)||{},y=(()=>{if(!t)return"";const e=window.location.origin;return"".concat(e,"/book/").concat(t.id)})();return(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsxs)("div",{className:"bg-white rounded-lg shadow-md h-full flex flex-col",children:[(0,fn.jsxs)("div",{className:"p-4 border-b",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("h2",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:["\ud83d\udcac Conversation: ",t.name]}),(0,fn.jsx)("p",{className:"text-sm text-gray-600",children:t.phone||t.email})]}),(0,fn.jsxs)("div",{className:"flex items-center gap-2",children:[(0,fn.jsxs)("button",{onClick:()=>{d(y),i(!0)},className:"px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors flex items-center gap-2",title:"Send Calendar Link",children:[(0,fn.jsx)(hr,{className:"w-4 h-4"}),"Send Calendar Link"]}),(0,fn.jsx)("button",{onClick:n,className:"text-gray-400 hover:text-gray-600 transition-colors",title:"Refresh",children:"\ud83d\udd04"})]})]}),(0,fn.jsxs)("div",{className:"flex items-center gap-3",children:[t.salesape_goal_hit?(0,fn.jsx)("span",{className:"px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium",children:"\u2705 Booked"}):t.salesape_goal_presented?(0,fn.jsx)("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:"\ud83c\udfaf Goal Presented"}):t.salesape_user_engaged?(0,fn.jsx)("span",{className:"px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm font-medium",children:"\ud83d\udcac Engaged"}):t.salesape_initial_message_sent?(0,fn.jsx)("span",{className:"px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-sm font-medium",children:"\ud83d\udce4 Message Sent"}):(0,fn.jsx)("span",{className:"px-3 py-1 bg-gray-100 text-gray-800 rounded-full text-sm font-medium",children:"\u23f3 Queued"}),t.salesape_portal_link&&(0,fn.jsx)("a",{href:t.salesape_portal_link,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:text-blue-800 flex items-center gap-1",children:"\ud83d\udd17 View in SalesApe Portal \u2192"})]})]}),(0,fn.jsx)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50",children:0===f.length?(0,fn.jsxs)("div",{className:"text-center py-12",children:[(0,fn.jsx)("p",{className:"text-4xl mb-4",children:"\ud83e\udd16"}),(0,fn.jsx)("p",{className:"text-gray-500",children:"No messages yet"}),(0,fn.jsx)("p",{className:"text-sm text-gray-400 mt-2",children:"Conversation will appear here once SalesApe engages"})]}):(0,fn.jsxs)(fn.Fragment,{children:[f.map((e,s)=>(0,fn.jsx)(Rb.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3,delay:.05*s},className:"flex ".concat("salesape"===e.sender?"justify-start":"justify-end"),children:(0,fn.jsxs)("div",{className:"max-w-[70%] ".concat("salesape"===e.sender?"order-1":"order-2"),children:[(0,fn.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,fn.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"salesape"===e.sender?"\ud83e\udd16 SalesApe":"\ud83d\udc64 "+t.name}),(0,fn.jsx)("span",{className:"text-xs text-gray-500",children:new Date(e.sent_at).toLocaleTimeString()})]}),(0,fn.jsxs)("div",{className:"rounded-lg p-3 ".concat("salesape"===e.sender?"bg-blue-100 text-blue-900":"bg-green-100 text-green-900"),children:[(0,fn.jsx)("p",{className:"whitespace-pre-wrap",children:e.message}),e.calendarLink&&(0,fn.jsx)("div",{className:"mt-2 pt-2 border-t border-blue-300",children:(0,fn.jsxs)("a",{href:e.calendarLink,target:"_blank",rel:"noopener noreferrer",className:"text-blue-700 hover:text-blue-900 flex items-center gap-2 text-sm",children:[(0,fn.jsx)(hr,{className:"w-4 h-4"}),"Calendar Link"]})})]})]})},s)),(0,fn.jsx)("div",{ref:l})]})}),(0,fn.jsxs)("div",{className:"p-4 border-t bg-gray-50",children:[(0,fn.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-3",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("p",{className:"text-xs text-gray-600",children:"Messages"}),(0,fn.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:b.messageCount||f.length})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("p",{className:"text-xs text-gray-600",children:"Duration"}),(0,fn.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:b.duration||"N/A"})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("p",{className:"text-xs text-gray-600",children:"Engagement"}),(0,fn.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:t.salesape_user_engaged?"High":"Low"})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("p",{className:"text-xs text-gray-600",children:"Goal Status"}),(0,fn.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:t.salesape_goal_hit?"\u2705 Hit":"\u23f3 Pending"})]})]}),(0,fn.jsxs)("div",{className:"flex gap-2",children:[t.salesape_conversation_summary&&(0,fn.jsx)("button",{onClick:()=>alert(t.salesape_conversation_summary),className:"flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-4 rounded-lg font-medium transition-colors text-sm",children:"\ud83d\udcdd View Summary"}),f.length>0&&(0,fn.jsx)("button",{onClick:()=>{const e=f.map(e=>"[".concat(new Date(e.sent_at).toLocaleString(),"] ").concat("salesape"===e.sender?"\ud83e\udd16 SalesApe":"\ud83d\udc64 "+t.name,": ").concat(e.message)).join("\n\n"),s=new Blob([e],{type:"text/plain"}),n=URL.createObjectURL(s),a=document.createElement("a");a.href=n,a.download="conversation-".concat(t.name,"-").concat(Date.now(),".txt"),a.click()},className:"flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-4 rounded-lg font-medium transition-colors text-sm",children:"\ud83d\udce5 Export Transcript"}),t.salesape_portal_link&&(0,fn.jsx)("a",{href:t.salesape_portal_link,target:"_blank",rel:"noopener noreferrer",className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg font-medium transition-colors text-sm text-center",children:"\ud83d\udd17 SalesApe Portal"})]})]})]}),o&&(0,fn.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,fn.jsxs)(Rb.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"bg-white rounded-lg shadow-xl p-6 max-w-md w-full mx-4",children:[(0,fn.jsxs)("h3",{className:"text-xl font-bold text-gray-900 mb-4 flex items-center gap-2",children:[(0,fn.jsx)(hr,{className:"w-5 h-5"}),"Send Calendar Link to SalesApe"]}),(0,fn.jsxs)("div",{className:"space-y-4",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Generated Link (Default)"}),(0,fn.jsxs)("div",{className:"flex items-center gap-2",children:[(0,fn.jsx)("input",{type:"text",value:c,readOnly:!0,className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm"}),(0,fn.jsx)("button",{onClick:()=>{return e=c,void navigator.clipboard.writeText(e).then(()=>{g(!0),setTimeout(()=>g(!1),2e3)});var e},className:"px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",title:"Copy link",children:x?(0,fn.jsx)(gr,{className:"w-4 h-4 text-green-600"}):(0,fn.jsx)(Nr,{className:"w-4 h-4"})})]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Or Enter Custom Link"}),(0,fn.jsx)("input",{type:"text",value:u,onChange:e=>m(e.target.value),placeholder:"https://example.com/book",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,fn.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,fn.jsx)("button",{onClick:()=>{i(!1),m("")},className:"flex-1 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium transition-colors",children:"Cancel"}),(0,fn.jsx)("button",{onClick:async()=>{if(!t||!t.salesape_record_id)return void alert("This lead has not been sent to SalesApe yet");const e=u.trim()||c;if(e){p(!0);try{const s=localStorage.getItem("token");(await gn.post("/api/salesape-webhook/send-calendar-link/".concat(t.id),{calendarLink:e,eventType:"Meeting Booked"},{headers:{"x-auth-token":s}})).data.success&&(alert("\u2705 Calendar link sent to SalesApe successfully!"),i(!1),m(""),r&&r(),n&&n())}catch(l){var s,a;console.error("Error sending calendar link:",l),alert("Failed to send calendar link: ".concat((null===(s=l.response)||void 0===s||null===(a=s.data)||void 0===a?void 0:a.message)||l.message))}finally{p(!1)}}else alert("Please enter or generate a calendar link")},disabled:h,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:h?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Sending..."]}):(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(Br,{className:"w-4 h-4"}),"Send to SalesApe"]})})]})]})]})})]})},Bb=e=>{let{data:t}=e;const[s,n]=(0,a.useState)("today");if(!t)return(0,fn.jsx)("div",{className:"bg-white rounded-lg shadow-md p-6",children:(0,fn.jsxs)("div",{className:"animate-pulse",children:[(0,fn.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/4 mb-4"}),(0,fn.jsxs)("div",{className:"grid grid-cols-4 gap-4",children:[(0,fn.jsx)("div",{className:"h-20 bg-gray-200 rounded"}),(0,fn.jsx)("div",{className:"h-20 bg-gray-200 rounded"}),(0,fn.jsx)("div",{className:"h-20 bg-gray-200 rounded"}),(0,fn.jsx)("div",{className:"h-20 bg-gray-200 rounded"})]})]})});const r=t[s]||{},{leadsSent:l=0,leadsEngaged:o=0,bookingsMade:i=0,engagementRate:c=0,conversionRate:d=0,avgResponseTime:u="N/A",avgMessagesPerLead:m=0,goalHitRate:h=0}=r;return(0,fn.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,fn.jsx)("h2",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:"\ud83d\udcca Performance Analytics"}),(0,fn.jsx)("div",{className:"flex gap-2",children:[{key:"today",label:"Today"},{key:"week",label:"This Week"},{key:"month",label:"This Month"},{key:"all",label:"All Time"}].map(e=>(0,fn.jsx)("button",{onClick:()=>n(e.key),className:"px-4 py-2 rounded-lg font-medium transition-colors text-sm ".concat(s===e.key?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:e.label},e.key))})]}),(0,fn.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[(0,fn.jsxs)(Rb.div,{whileHover:{scale:1.05},className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-4 border border-blue-200",children:[(0,fn.jsx)("p",{className:"text-sm text-blue-700 mb-1",children:"Leads Sent"}),(0,fn.jsx)("p",{className:"text-3xl font-bold text-blue-900",children:l}),(0,fn.jsx)("p",{className:"text-xs text-blue-600 mt-1",children:"Total initiated"})]}),(0,fn.jsxs)(Rb.div,{whileHover:{scale:1.05},className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg p-4 border border-purple-200",children:[(0,fn.jsx)("p",{className:"text-sm text-purple-700 mb-1",children:"Engaged"}),(0,fn.jsx)("p",{className:"text-3xl font-bold text-purple-900",children:o}),(0,fn.jsxs)("p",{className:"text-xs text-purple-600 mt-1",children:[c,"% of sent"]})]}),(0,fn.jsxs)(Rb.div,{whileHover:{scale:1.05},className:"bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-4 border border-green-200",children:[(0,fn.jsx)("p",{className:"text-sm text-green-700 mb-1",children:"Bookings"}),(0,fn.jsx)("p",{className:"text-3xl font-bold text-green-900",children:i}),(0,fn.jsxs)("p",{className:"text-xs text-green-600 mt-1",children:[d,"% of sent"]})]}),(0,fn.jsxs)(Rb.div,{whileHover:{scale:1.05},className:"bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-lg p-4 border border-yellow-200",children:[(0,fn.jsx)("p",{className:"text-sm text-yellow-700 mb-1",children:"Conversion"}),(0,fn.jsxs)("p",{className:"text-3xl font-bold text-yellow-900",children:[h,"%"]}),(0,fn.jsxs)("p",{className:"text-xs text-yellow-600 mt-1",children:[o>0?Math.round(i/o*100):0,"% of engaged"]})]})]}),(0,fn.jsxs)("div",{className:"mb-6",children:[(0,fn.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"\ud83d\udcc8 Engagement Funnel"}),(0,fn.jsxs)("div",{className:"space-y-3",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,fn.jsx)("span",{className:"text-sm text-gray-700",children:"Initial Messages Sent"}),(0,fn.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:l})]}),(0,fn.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-8 overflow-hidden",children:(0,fn.jsx)(Rb.div,{initial:{width:0},animate:{width:"100%"},transition:{duration:.5},className:"bg-gradient-to-r from-blue-500 to-blue-600 h-full flex items-center justify-center text-white text-sm font-medium",children:"100%"})})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,fn.jsx)("span",{className:"text-sm text-gray-700",children:"Users Engaged"}),(0,fn.jsxs)("span",{className:"text-sm font-semibold text-gray-900",children:[o," (",c,"%)"]})]}),(0,fn.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-8 overflow-hidden",children:(0,fn.jsxs)(Rb.div,{initial:{width:0},animate:{width:"".concat(c,"%")},transition:{duration:.5,delay:.1},className:"bg-gradient-to-r from-purple-500 to-purple-600 h-full flex items-center justify-center text-white text-sm font-medium",children:[c,"%"]})})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,fn.jsx)("span",{className:"text-sm text-gray-700",children:"Bookings Made"}),(0,fn.jsxs)("span",{className:"text-sm font-semibold text-gray-900",children:[i," (",d,"% of total, ",o>0?Math.round(i/o*100):0,"% of engaged)"]})]}),(0,fn.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-8 overflow-hidden",children:(0,fn.jsxs)(Rb.div,{initial:{width:0},animate:{width:"".concat(d,"%")},transition:{duration:.5,delay:.2},className:"bg-gradient-to-r from-green-500 to-green-600 h-full flex items-center justify-center text-white text-sm font-medium",children:[d,"%"]})})]})]})]}),(0,fn.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-gray-50 rounded-lg",children:[(0,fn.jsxs)("div",{className:"text-center",children:[(0,fn.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"\u23f1\ufe0f Avg Response Time"}),(0,fn.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:u})]}),(0,fn.jsxs)("div",{className:"text-center",children:[(0,fn.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"\ud83d\udcac Avg Messages per Lead"}),(0,fn.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:m.toFixed(1)})]}),(0,fn.jsxs)("div",{className:"text-center",children:[(0,fn.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"\u2b50 Goal Hit Rate"}),(0,fn.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:[h,"%"]})]})]}),(0,fn.jsx)("div",{className:"mt-4 pt-4 border-t",children:(0,fn.jsxs)("button",{onClick:()=>{const e="Period,Leads Sent,Leads Engaged,Bookings Made,Engagement Rate,Conversion Rate\n".concat(s,",").concat(l,",").concat(o,",").concat(i,",").concat(c,"%,").concat(d,"%"),t=new Blob([e],{type:"text/csv"}),n=URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download="salesape-analytics-".concat(s,"-").concat(Date.now(),".csv"),a.click()},className:"w-full bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-4 rounded-lg font-medium transition-colors flex items-center justify-center gap-2",children:[(0,fn.jsx)("span",{children:"\ud83d\udce5"})," Export Report as CSV"]})})]})},Ub=e=>{let{leads:t,onLeadSelect:s,onRemoveFromQueue:n,onRemoveAll:a}=e;if(!t||0===t.length)return(0,fn.jsxs)("div",{className:"text-center py-20",children:[(0,fn.jsx)("p",{className:"text-6xl mb-4",children:"\ud83d\udced"}),(0,fn.jsx)("p",{className:"text-xl text-gray-500",children:"No leads in SalesApe queue"}),(0,fn.jsx)("p",{className:"text-gray-400 mt-2",children:"Add leads from the Leads page to get started"})]});const r=e=>e.salesape_goal_hit?"from-green-400 to-green-600":e.salesape_goal_presented?"from-blue-400 to-blue-600":e.salesape_user_engaged?"from-purple-400 to-purple-600":e.salesape_initial_message_sent?"from-yellow-400 to-yellow-600":"from-gray-400 to-gray-600",l=e=>e.salesape_goal_hit?"\u2705":e.salesape_goal_presented?"\ud83c\udfaf":e.salesape_user_engaged?"\ud83d\udcac":e.salesape_initial_message_sent?"\ud83d\udce4":"\u23f3",o=e=>e.salesape_goal_hit?"Booked":e.salesape_goal_presented?"Goal Presented":e.salesape_user_engaged?"Engaged":e.salesape_initial_message_sent?"Message Sent":"Queued",i=e=>{if(!e)return"Just now";const t=Math.floor((Date.now()-new Date(e))/1e3);if(t<60)return"".concat(t,"s ago");const s=Math.floor(t/60);if(s<60)return"".concat(s,"m ago");const n=Math.floor(s/60);if(n<24)return"".concat(n,"h ago");const a=Math.floor(n/24);return"".concat(a,"d ago")};return(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"\ud83d\udccb SalesApe Queue"}),(0,fn.jsxs)("p",{className:"text-gray-600 mt-1",children:[t.length," leads in queue"]})]}),t.length>0&&a&&(0,fn.jsxs)("button",{onClick:a,className:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors font-medium flex items-center gap-2",children:["\ud83d\uddd1\ufe0f Remove All (",t.length,")"]})]}),(0,fn.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:t.map((e,t)=>(0,fn.jsx)(Rb.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3,delay:.05*t},whileHover:{scale:1.05,y:-5},onClick:()=>s(e),className:"cursor-pointer",children:(0,fn.jsxs)("div",{className:"bg-gradient-to-br ".concat(r(e)," rounded-lg shadow-lg p-6 text-white relative overflow-hidden"),children:[(0,fn.jsxs)("div",{className:"absolute inset-0 opacity-10",children:[(0,fn.jsx)("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white rounded-full -mr-16 -mt-16"}),(0,fn.jsx)("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-white rounded-full -ml-12 -mb-12"})]}),(0,fn.jsxs)("div",{className:"relative z-10",children:[(0,fn.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,fn.jsxs)("div",{className:"flex-1",children:[(0,fn.jsx)("p",{className:"text-3xl mb-2",children:l(e)}),(0,fn.jsx)("h3",{className:"font-bold text-lg truncate",children:e.name}),(0,fn.jsx)("p",{className:"text-sm opacity-90 truncate",children:e.phone||e.email})]}),(0,fn.jsx)("button",{onClick:t=>{t.stopPropagation(),window.confirm("Remove ".concat(e.name," from queue?"))&&n(e.id)},className:"text-white hover:bg-white/20 rounded-full p-2 transition-colors",children:"\u2715"})]}),(0,fn.jsx)("div",{className:"mb-4",children:(0,fn.jsxs)("div",{className:"bg-white/20 backdrop-blur-sm rounded-lg px-3 py-2",children:[(0,fn.jsx)("p",{className:"text-sm font-semibold",children:o(e)}),(0,fn.jsx)("p",{className:"text-xs opacity-90",children:i(e.salesape_last_updated||e.created_at)})]})}),(0,fn.jsx)("div",{className:"mb-3",children:(0,fn.jsxs)("div",{className:"flex gap-1",children:[(0,fn.jsx)("div",{className:"h-1 flex-1 rounded ".concat(e.salesape_initial_message_sent?"bg-white":"bg-white/30")}),(0,fn.jsx)("div",{className:"h-1 flex-1 rounded ".concat(e.salesape_user_engaged?"bg-white":"bg-white/30")}),(0,fn.jsx)("div",{className:"h-1 flex-1 rounded ".concat(e.salesape_goal_presented?"bg-white":"bg-white/30")}),(0,fn.jsx)("div",{className:"h-1 flex-1 rounded ".concat(e.salesape_goal_hit?"bg-white":"bg-white/30")})]})}),(0,fn.jsx)("button",{onClick:t=>{t.stopPropagation(),s(e)},className:"w-full bg-white/20 hover:bg-white/30 backdrop-blur-sm text-white py-2 px-4 rounded-lg font-medium transition-colors text-sm",children:"View Conversation"})]})]})},e.id))})]})},zb=()=>{const{socket:e,isConnected:t}=Ga(),[s,n]=(0,a.useState)("dashboard"),[r,l]=(0,a.useState)(null),[o,i]=(0,a.useState)([]),[c,d]=(0,a.useState)(null),[u,m]=(0,a.useState)(null),[h,p]=(0,a.useState)(null),[x,g]=(0,a.useState)(!0),[f,b]=(0,a.useState)(null),[y,v]=(0,a.useState)("connected"),j=(0,a.useMemo)(()=>{const e=new Map;return o.forEach(t=>e.set(t.id,t)),e},[o]);(0,a.useEffect)(()=>{if(!e||!t)return void v("disconnected");v("connected");const s=e=>{console.log("\ud83d\udce1 Real-time: SalesApe status update",e),b({type:"status_update",timestamp:new Date,data:e}),j.has(e.leadId)&&i(t=>t.map(t=>t.id===e.leadId?He(He({},t),e):t)),N(),(null===r||void 0===r?void 0:r.id)===e.leadId&&C(e.leadId)},n=e=>{console.log("\ud83d\udce1 Real-time: SalesApe message",e),b({type:"message",timestamp:new Date,data:e}),k(),N(),(null===r||void 0===r?void 0:r.id)===e.leadId&&C(e.leadId)},a=e=>{console.log("\ud83d\udce1 Real-time: SalesApe queue update",e),b({type:"queue_update",timestamp:new Date,data:e}),k(),N(),(null===r||void 0===r?void 0:r.id)===e.leadId&&"updated"===e.action&&C(e.leadId)},l=e=>{console.log("\ud83d\udce1 Real-time: Calendar link sent",e),b({type:"calendar_link_sent",timestamp:new Date,data:e}),(null===r||void 0===r?void 0:r.id)===e.leadId&&C(e.leadId)};return e.on("salesape_status_update",s),e.on("salesape_message",n),e.on("salesape_queue_update",a),e.on("salesape_calendar_link_sent",l),()=>{e.off("salesape_status_update",s),e.off("salesape_message",n),e.off("salesape_queue_update",a),e.off("salesape_calendar_link_sent",l)}},[e,t,r,j]),(0,a.useEffect)(()=>{w();const e=setInterval(()=>{k(),N()},3e4);return()=>clearInterval(e)},[]);const w=async()=>{try{await Promise.all([N(),k(),S()]),g(!1)}catch(e){console.error("Error fetching SalesApe data:",e),g(!1)}},N=async()=>{try{const e=localStorage.getItem("token"),t=await gn.get("/api/salesape-dashboard/status",{headers:{"x-auth-token":e}});d(t.data)}catch(e){console.error("Error fetching activity data:",e)}},k=async()=>{try{const e=localStorage.getItem("token"),t=await gn.get("/api/salesape-dashboard/queue",{headers:{"x-auth-token":e}});i(t.data||[])}catch(e){console.error("Error fetching queue data:",e),i([])}},S=async()=>{try{const e=localStorage.getItem("token"),t=await gn.get("/api/salesape-dashboard/analytics",{headers:{"x-auth-token":e}});m(t.data)}catch(e){console.error("Error fetching analytics data:",e)}},C=async e=>{try{const t=localStorage.getItem("token"),s=await gn.get("/api/salesape-dashboard/conversation/".concat(e),{headers:{"x-auth-token":t}});p(s.data)}catch(t){console.error("Error fetching conversation:",t)}},_=(0,a.useCallback)(e=>{l(e),C(e.id)},[]),E=async e=>{try{const t=localStorage.getItem("token");await gn.post("/api/salesape-dashboard/queue/remove",{leadId:e},{headers:{"x-auth-token":t}});await k(),alert("\u2705 Lead removed from queue successfully"),(null===r||void 0===r?void 0:r.id)===e&&(l(null),p(null))}catch(n){var t,s;console.error("\u274c Error removing from queue:",n),alert("Failed to remove lead: ".concat((null===(t=n.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||n.message))}},T=async()=>{if(window.confirm("Remove ALL ".concat(o.length," leads from queue? This will stop all SalesApe conversations.")))try{const t=localStorage.getItem("token");let s=0,n=0;for(const a of o)try{await gn.post("/api/salesape-dashboard/queue/remove",{leadId:a.id},{headers:{"x-auth-token":t}}),s++}catch(e){console.error("Failed to remove lead ".concat(a.id,":"),e),n++}await k(),l(null),p(null),alert("\u2705 Removed ".concat(s," leads from queue").concat(n>0?"\n\u26a0\ufe0f ".concat(n," failed to remove"):""))}catch(e){console.error("Error bulk removing from queue:",e),alert("Failed to remove all leads from queue")}};return x?(0,fn.jsx)("div",{className:"flex items-center justify-center h-screen",children:(0,fn.jsxs)("div",{className:"text-center",children:[(0,fn.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-500 mx-auto mb-4"}),(0,fn.jsx)("p",{className:"text-gray-600",children:"Loading SalesApe Dashboard..."})]})}):(0,fn.jsxs)("div",{className:"min-h-screen bg-gray-50 p-6",children:[(0,fn.jsx)("div",{className:"mb-6",children:(0,fn.jsxs)("div",{className:"flex items-center justify-between",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("div",{className:"flex items-center gap-3",children:[(0,fn.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[(0,fn.jsx)("span",{className:"text-4xl mr-3",children:"\ud83e\udd16"}),"SalesApe AI Dashboard"]}),(0,fn.jsxs)("div",{className:"flex items-center gap-2",children:[(0,fn.jsx)("div",{className:"w-3 h-3 rounded-full ".concat("connected"===y?"bg-green-500 animate-pulse":"bg-red-500"),title:"connected"===y?"Real-time connected":"Real-time disconnected"}),f&&(0,fn.jsxs)("span",{className:"text-xs text-gray-500",children:["Updated ",new Date(f.timestamp).toLocaleTimeString()]})]})]}),(0,fn.jsx)("p",{className:"text-gray-600 mt-1",children:"Monitor AI engagement, conversations, and performance in real-time"})]}),(0,fn.jsxs)("div",{className:"flex gap-2",children:[(0,fn.jsx)("button",{onClick:()=>n("dashboard"),className:"px-4 py-2 rounded-lg font-medium transition-colors ".concat("dashboard"===s?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"),children:"\ud83d\udcca Dashboard View"}),(0,fn.jsx)("button",{onClick:()=>n("cards"),className:"px-4 py-2 rounded-lg font-medium transition-colors ".concat("cards"===s?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"),children:"\ud83c\udfb4 Card View"})]})]})}),(0,fn.jsx)(zd,{mode:"wait",children:"dashboard"===s?(0,fn.jsxs)(Rb.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"space-y-6",children:[(0,fn.jsx)(Rb.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:(0,fn.jsx)(Fb,{data:c,onPause:async()=>{try{const e=localStorage.getItem("token");await gn.post("/api/salesape-dashboard/queue/pause",{},{headers:{"x-auth-token":e}}),N()}catch(e){console.error("Error pausing queue:",e),alert("Failed to pause queue")}},onResume:async()=>{try{const e=localStorage.getItem("token");await gn.post("/api/salesape-dashboard/queue/resume",{},{headers:{"x-auth-token":e}}),N()}catch(e){console.error("Error resuming queue:",e),alert("Failed to resume queue")}}})}),(0,fn.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,fn.jsx)(Rb.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:.1},className:"lg:col-span-1",children:(0,fn.jsx)(Ib,{queue:o,onLeadSelect:_,selectedLead:r,onAddToQueue:async e=>{try{const t=localStorage.getItem("token");await gn.post("/api/salesape-dashboard/queue/add",{leadId:e},{headers:{"x-auth-token":t}}),k()}catch(t){console.error("Error adding to queue:",t),alert("Failed to add lead to queue")}},onRemoveFromQueue:E,onRemoveAll:T,onRefresh:k})}),(0,fn.jsx)(Rb.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.3,delay:.2},className:"lg:col-span-2",children:(0,fn.jsx)(Ob,{lead:r,conversation:h,onRefresh:()=>r&&C(r.id),onCalendarLinkSent:()=>r&&C(r.id)})})]}),(0,fn.jsx)(Rb.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.3},children:(0,fn.jsx)(Bb,{data:u})})]},"dashboard"):(0,fn.jsx)(Rb.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,fn.jsx)(Ub,{leads:o,onLeadSelect:_,onRemoveFromQueue:E,onRemoveAll:T})},"cards")})]})},Vb=()=>{const{user:e}=wn(),[t,s]=(0,a.useState)((new Date).toISOString().split("T")[0]),[n,r]=(0,a.useState)([]),[l,o]=(0,a.useState)(!1),[i,c]=(0,a.useState)(""),[d,u]=(0,a.useState)(!1),[m,h]=(0,a.useState)("full-day"),[p,x]=(0,a.useState)(""),[g,f]=(0,a.useState)(null),b=["10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30"];(0,a.useEffect)(()=>{"admin"===(null===e||void 0===e?void 0:e.role)&&y()},[e,t]);const y=async()=>{try{o(!0);const e=await gn.get("/api/blocked-slots",{params:{start_date:t,end_date:t}});r(e.data)}catch(e){console.error("Error fetching blocked slots:",e),alert("Error loading blocked slots")}finally{o(!1)}},v=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return n.some(s=>{if(!s.time_slot){if(t&&s.slot_number)return parseInt(s.slot_number)===parseInt(t);if(!s.slot_number)return!0}if(e&&s.time_slot===e){if(t&&s.slot_number)return parseInt(s.slot_number)===parseInt(t);if(!s.slot_number)return!0}return!1})},j=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const s=n.find(s=>{if(e){if(s.time_slot===e)return t&&s.slot_number?parseInt(s.slot_number)===parseInt(t):!s.slot_number}else if(!s.time_slot)return t&&s.slot_number?parseInt(s.slot_number)===parseInt(t):!s.slot_number;return!1});return(null===s||void 0===s?void 0:s.reason)||""};return"admin"!==(null===e||void 0===e?void 0:e.role)?(0,fn.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,fn.jsxs)("div",{className:"text-center",children:[(0,fn.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Access Denied"}),(0,fn.jsx)("p",{className:"text-gray-600",children:"Only administrators can manage blocked slots."})]})}):(0,fn.jsxs)("div",{className:"min-h-screen bg-gray-50 p-6",children:[(0,fn.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,fn.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,fn.jsxs)("div",{className:"flex items-center gap-3",children:[(0,fn.jsx)(hr,{className:"text-2xl text-blue-600"}),(0,fn.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Manage Blocked Slots"})]}),(0,fn.jsxs)("button",{onClick:()=>u(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[(0,fn.jsx)(zr,{}),"Block Slot"]})]}),(0,fn.jsxs)("div",{className:"flex items-center gap-4",children:[(0,fn.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Select Date:"}),(0,fn.jsx)("input",{type:"date",value:t,onChange:e=>s(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),(0,fn.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[(0,fn.jsxs)("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:["Blocked Slots for ",new Date(t).toLocaleDateString("en-GB",{weekday:"long",year:"numeric",month:"long",day:"numeric"})]}),l?(0,fn.jsx)("p",{className:"text-gray-600",children:"Loading..."}):0===n.length?(0,fn.jsx)("p",{className:"text-gray-600",children:"No blocked slots for this date."}):(0,fn.jsx)("div",{className:"space-y-3",children:n.map(e=>(0,fn.jsxs)("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50",children:[(0,fn.jsxs)("div",{className:"flex items-center gap-3",children:[(0,fn.jsx)(zr,{className:"text-red-500"}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("p",{className:"font-medium text-gray-800",children:e.time_slot?(0,fn.jsxs)(fn.Fragment,{children:[e.time_slot,e.slot_number?" - Slot ".concat(e.slot_number):" - Both Slots"]}):(0,fn.jsxs)(fn.Fragment,{children:["Full Day Blocked",e.slot_number&&" - Slot ".concat(e.slot_number," only")]})}),(0,fn.jsx)("p",{className:"text-sm text-gray-600",children:e.reason})]})]}),(0,fn.jsxs)("button",{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to unblock this slot?"))try{o(!0),await gn.delete("/api/blocked-slots/".concat(e)),y(),alert("Slot unblocked successfully")}catch(t){console.error("Error unblocking slot:",t),alert("Error unblocking slot")}finally{o(!1)}})(e.id),className:"px-3 py-1 text-sm bg-green-600 text-white rounded hover:bg-green-700 flex items-center gap-2",children:[(0,fn.jsx)(hl,{}),"Unblock"]})]},e.id))})]}),(0,fn.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,fn.jsx)("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Time Slots Overview"}),(0,fn.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("h3",{className:"text-md font-semibold text-gray-700 mb-3 text-center",children:"Slot 1"}),(0,fn.jsx)("div",{className:"space-y-2",children:b.map(e=>(0,fn.jsxs)("div",{className:"p-3 rounded-lg border ".concat(v(e,1)?"bg-red-100 border-red-300":"bg-green-100 border-green-300"),children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between",children:[(0,fn.jsx)("span",{className:"font-medium",children:e}),v(e,1)?(0,fn.jsxs)("span",{className:"text-sm text-red-600 flex items-center gap-1",children:[(0,fn.jsx)(zr,{})," Blocked"]}):(0,fn.jsx)("span",{className:"text-sm text-green-600",children:"Available"})]}),v(e,1)&&(0,fn.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:j(e,1)})]},"slot1-".concat(e)))})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("h3",{className:"text-md font-semibold text-gray-700 mb-3 text-center",children:"Slot 2"}),(0,fn.jsx)("div",{className:"space-y-2",children:b.map(e=>(0,fn.jsxs)("div",{className:"p-3 rounded-lg border ".concat(v(e,2)?"bg-red-100 border-red-300":"bg-green-100 border-green-300"),children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between",children:[(0,fn.jsx)("span",{className:"font-medium",children:e}),v(e,2)?(0,fn.jsxs)("span",{className:"text-sm text-red-600 flex items-center gap-1",children:[(0,fn.jsx)(zr,{})," Blocked"]}):(0,fn.jsx)("span",{className:"text-sm text-green-600",children:"Available"})]}),v(e,2)&&(0,fn.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:j(e,2)})]},"slot2-".concat(e)))})]})]})]})]}),d&&(0,fn.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,fn.jsxs)("div",{className:"bg-white rounded-lg shadow-xl p-6 max-w-md w-full mx-4",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,fn.jsx)("h2",{className:"text-xl font-bold text-gray-800",children:"Block Slot"}),(0,fn.jsx)("button",{onClick:()=>u(!1),className:"text-gray-400 hover:text-gray-600",children:(0,fn.jsx)(jl,{className:"text-xl"})})]}),(0,fn.jsxs)("div",{className:"space-y-4",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Block Type"}),(0,fn.jsxs)("select",{value:m,onChange:e=>h(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[(0,fn.jsx)("option",{value:"full-day",children:"Full Day (Both Slots)"}),(0,fn.jsx)("option",{value:"time-slot",children:"Specific Time (Both Slots)"}),(0,fn.jsx)("option",{value:"slot-column",children:"Specific Time & Slot Number"})]})]}),("time-slot"===m||"slot-column"===m)&&(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Time Slot"}),(0,fn.jsxs)("select",{value:p,onChange:e=>x(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,fn.jsx)("option",{value:"",children:"Select time..."}),b.map(e=>(0,fn.jsx)("option",{value:e,children:e},e))]})]}),"slot-column"===m&&(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Slot Number"}),(0,fn.jsxs)("select",{value:g||"",onChange:e=>f(e.target.value?parseInt(e.target.value):null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,fn.jsx)("option",{value:"",children:"Select slot..."}),(0,fn.jsx)("option",{value:"1",children:"Slot 1"}),(0,fn.jsx)("option",{value:"2",children:"Slot 2"})]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason (optional)"}),(0,fn.jsx)("input",{type:"text",value:i,onChange:e=>c(e.target.value),placeholder:"e.g., Holiday, Staff unavailable",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),(0,fn.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,fn.jsx)("button",{onClick:()=>u(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancel"}),(0,fn.jsx)("button",{onClick:async()=>{try{o(!0);const e={date:t,reason:i||"Unavailable"};"time-slot"===m&&(e.time_slot=p),"slot-column"===m&&(e.time_slot=p,e.slot_number=g),"full-day"===m&&g&&(e.slot_number=g),await gn.post("/api/blocked-slots",e),u(!1),c(""),x(""),f(null),y(),alert("Slot blocked successfully")}catch(a){var e,s,n;if(console.error("Error blocking slot:",a),409===(null===(e=a.response)||void 0===e?void 0:e.status))alert("This slot is already blocked");else alert("Error blocking slot: "+((null===(s=a.response)||void 0===s||null===(n=s.data)||void 0===n?void 0:n.message)||a.message))}finally{o(!1)}},disabled:l||"full-day"!==m&&!p||"slot-column"===m&&!g,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:bg-gray-300 disabled:cursor-not-allowed",children:l?"Blocking...":"Block Slot"})]})]})]})})]})},Wb=()=>{const{leadId:e}=J(),[t,s]=(0,a.useState)(!0),[n,r]=(0,a.useState)(!1),[l,o]=(0,a.useState)(null),[i,c]=(0,a.useState)([]),[d,u]=(0,a.useState)([]),[m,h]=(0,a.useState)(null),[p,x]=(0,a.useState)(null),[g,f]=(0,a.useState)(null),[b,y]=(0,a.useState)(!1),[v,j]=(0,a.useState)(()=>{const e=new Date;return new Date(e.getFullYear(),e.getMonth(),1)}),[w,N]=(0,a.useState)(1),[k,S]=(0,a.useState)(!1),[C,_]=(0,a.useState)(!1),[E,T]=(0,a.useState)(""),[P,A]=(0,a.useState)(""),D=new Date;D.setHours(0,0,0,0);const L=new Date(D);L.setDate(D.getDate()+21);const M=new Date(D.getFullYear(),D.getMonth(),1),R=new Date(L.getFullYear(),L.getMonth(),1),F=v.getFullYear()===M.getFullYear()&&v.getMonth()===M.getMonth(),I=v.getFullYear()===R.getFullYear()&&v.getMonth()===R.getMonth(),O=["10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30"],B=(0,a.useCallback)(async()=>{try{s(!0);const t=new Date(v.getFullYear(),v.getMonth(),1),n=new Date(v.getFullYear(),v.getMonth()+1,0),a=t.toISOString().split("T")[0],r=n.toISOString().split("T")[0],[l,i,d]=await Promise.all([gn.get("/api/public/booking/lead/".concat(e)),gn.get("/api/stats/calendar-public?start=".concat(a,"&end=").concat(r)),gn.get("/api/blocked-slots?start_date=".concat(a,"&end_date=").concat(r))]);o(l.data),T(l.data.name||""),A(l.data.email||""),c(i.data||[]),u(d.data||[]),s(!1)}catch(ty){console.error("Error fetching data:",ty),f("Unable to load booking page. Please try again later."),s(!1)}},[e,v]);(0,a.useEffect)(()=>{B()},[B]);const U=e=>{if(!e)return!0;const t=e.toISOString().split("T")[0];return d.some(e=>{var s;return(null===(s=e.date)||void 0===s?void 0:s.split("T")[0])===t&&!e.time_slot})},z=e=>{if(!e)return!0;const t=new Date;return t.setHours(0,0,0,0),e<t},V=e=>{if(!e)return[];const t=e.toISOString().split("T")[0],s=i.filter(e=>{var s;return(null===(s=e.booking_date)||void 0===s?void 0:s.split("T")[0])===t&&"Cancelled"!==e.lead_status}).map(e=>e.booking_time),n=d.filter(e=>{var s;return(null===(s=e.date)||void 0===s?void 0:s.split("T")[0])===t&&e.time_slot}).map(e=>e.time_slot);return[...new Set([...s,...n])]},W=e=>!e||U(e)||z(e)||(e=>!e||e>L)(e)?0:O.filter(t=>!V(e).includes(t)).length,q=(()=>{const e=v.getFullYear(),t=v.getMonth(),s=new Date(e,t,1),n=new Date(e,t+1,0).getDate(),a=s.getDay(),r=0===a?6:a-1,l=[];for(let o=0;o<r;o++)l.push(null);for(let o=1;o<=n;o++)l.push(new Date(e,t,o));return l})(),H=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],Y={hidden:{opacity:0,x:50,scale:.95},visible:{opacity:1,x:0,scale:1,transition:{duration:.5,ease:[.22,1,.36,1]}},exit:{opacity:0,x:-50,scale:.95,transition:{duration:.3}}},G={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.05}}},$={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4,ease:[.22,1,.36,1]}}};return t?(0,fn.jsx)("div",{className:"min-h-screen bg-[#fafafa] flex items-center justify-center p-4",children:(0,fn.jsxs)(Rb.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center",children:[(0,fn.jsx)(Rb.div,{animate:{rotate:360},transition:{duration:1.5,repeat:1/0,ease:"linear"},className:"w-12 h-12 sm:w-16 sm:h-16 border-4 border-[#1a1a1a]/10 border-t-[#1e3a5f] rounded-full mx-auto mb-4 sm:mb-6"}),(0,fn.jsx)("p",{className:"text-[#1a1a1a]/60 text-base sm:text-lg tracking-wide",children:"Loading your booking..."})]})}):g&&!l?(0,fn.jsx)("div",{className:"min-h-screen bg-[#fafafa] flex items-center justify-center p-4",children:(0,fn.jsxs)(Rb.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"max-w-md w-full text-center px-4",children:[(0,fn.jsx)("div",{className:"w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,fn.jsx)("span",{className:"text-4xl",children:"!"})}),(0,fn.jsx)("h1",{className:"text-2xl sm:text-3xl font-light text-[#1a1a1a] mb-4",children:"Booking Not Found"}),(0,fn.jsx)("p",{className:"text-[#1a1a1a]/60 mb-6",children:g}),(0,fn.jsx)("p",{className:"text-[#1a1a1a]/40 text-sm",children:"Please check your booking link and try again, or contact support if the problem persists."})]})}):b?(0,fn.jsx)("div",{className:"min-h-screen bg-[#fafafa] flex items-center justify-center p-4",children:(0,fn.jsxs)(Rb.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.6,ease:[.22,1,.36,1]},className:"max-w-lg w-full text-center px-4",children:[(0,fn.jsx)(Rb.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring",stiffness:200},className:"w-20 h-20 sm:w-24 sm:h-24 bg-gradient-to-br from-emerald-400 to-emerald-600 rounded-full flex items-center justify-center mx-auto mb-6 sm:mb-8 shadow-2xl shadow-emerald-500/30",children:(0,fn.jsx)(gr,{className:"w-10 h-10 sm:w-12 sm:h-12 text-white",strokeWidth:3})}),(0,fn.jsx)(Rb.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"text-2xl sm:text-4xl font-light text-[#1a1a1a] mb-4 tracking-tight",children:"Booking Confirmed"}),(0,fn.jsxs)(Rb.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-white rounded-2xl p-6 sm:p-8 shadow-xl shadow-black/5 border border-black/5",children:[(0,fn.jsx)("p",{className:"text-[#1a1a1a]/60 mb-3 sm:mb-4 text-sm sm:text-base",children:"Your appointment is scheduled for"}),(0,fn.jsx)("p",{className:"text-lg sm:text-2xl font-medium text-[#1a1a1a] mb-2",children:null===m||void 0===m?void 0:m.toLocaleDateString("en-GB",{weekday:"long",day:"numeric",month:"long"})}),(0,fn.jsx)("p",{className:"text-2xl sm:text-3xl font-light text-[#1a1a1a]",children:p})]}),(0,fn.jsxs)(Rb.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.6},className:"mt-6 sm:mt-8 text-[#1a1a1a]/40 text-xs sm:text-sm px-4",children:["A confirmation has been sent to ",P]})]})}):(0,fn.jsxs)("div",{className:"min-h-screen bg-[#fafafa]",children:[(0,fn.jsx)("div",{className:"fixed inset-0 bg-gradient-to-br from-white via-transparent to-[#f0f0f0] pointer-events-none"}),(0,fn.jsxs)("div",{className:"relative max-w-5xl mx-auto px-4 sm:px-6 py-4 sm:py-8",children:[(0,fn.jsx)(Rb.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"flex justify-center sm:justify-start mb-4 sm:mb-0 sm:absolute sm:top-8 sm:left-6",children:(0,fn.jsx)("img",{src:"/images/edge-talent-logo.png",alt:"Edge Talent",className:"h-12 sm:h-16 w-auto"})}),(0,fn.jsxs)(Rb.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"text-center mb-6 sm:mb-12 pt-2 sm:pt-8",children:[(0,fn.jsx)("h1",{className:"text-2xl sm:text-4xl lg:text-5xl font-extralight text-[#1a1a1a] tracking-tight mb-2 sm:mb-3",children:"Book Your Session"}),(0,fn.jsx)("p",{className:"text-[#1a1a1a]/50 text-sm sm:text-lg",children:"Select your preferred date and time"})]}),(0,fn.jsx)(Rb.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"flex justify-center mb-8 sm:mb-16 px-2",children:(0,fn.jsx)("div",{className:"flex items-center gap-1 sm:gap-3",children:[{num:1,label:"Details",color:"from-[#1e3a5f] to-[#152a45]",shadow:"shadow-blue-900/40"},{num:2,label:"Date",color:"from-[#D4145A] to-[#B8124E]",shadow:"shadow-pink-500/40"},{num:3,label:"Time",color:"from-[#9B2335] to-[#7A1C2A]",shadow:"shadow-rose-600/40"},{num:4,label:"Confirm",color:"from-[#C9A227] to-[#A88B1F]",shadow:"shadow-amber-500/40"}].map((e,t)=>(0,fn.jsxs)(a.Fragment,{children:[(0,fn.jsxs)(Rb.button,{onClick:()=>e.num<w&&N(e.num),whileHover:e.num<w?{scale:1.1}:{},whileTap:e.num<w?{scale:.95}:{},className:"flex flex-col items-center transition-all duration-500 ".concat(e.num<w?"cursor-pointer":"cursor-default"),children:[(0,fn.jsx)(Rb.div,{animate:w===e.num?{scale:[1,1.1,1]}:{},transition:{duration:.5,repeat:w===e.num?1/0:0,repeatDelay:2},className:"w-9 h-9 sm:w-12 sm:h-12 rounded-full flex items-center justify-center text-xs sm:text-sm font-semibold transition-all duration-500 ".concat(w>e.num?"bg-gradient-to-br ".concat(e.color," text-white shadow-lg ").concat(e.shadow):w===e.num?"bg-gradient-to-br ".concat(e.color," text-white shadow-xl ").concat(e.shadow," scale-105 sm:scale-110 ring-2 sm:ring-4 ring-white ring-offset-1 sm:ring-offset-2"):"bg-white text-[#1a1a1a]/30 border-2 border-[#1a1a1a]/10"),children:w>e.num?(0,fn.jsx)(gr,{className:"w-4 h-4 sm:w-5 sm:h-5",strokeWidth:3}):e.num}),(0,fn.jsx)("span",{className:"text-[10px] sm:text-xs mt-1 sm:mt-2 font-semibold tracking-wide transition-all duration-300 hidden sm:block ".concat(w>e.num?1===e.num?"text-[#1e3a5f]":"text-[#C41230]":w===e.num?"text-[#1a1a1a]":"text-[#1a1a1a]/30"),children:e.label})]}),t<3&&(0,fn.jsx)(Rb.div,{initial:{scaleX:0},animate:{scaleX:w>e.num?1:0},transition:{duration:.5,ease:"easeOut"},className:"w-6 sm:w-16 h-0.5 sm:h-1 rounded-full origin-left transition-all duration-500 ".concat(w>e.num?"bg-gradient-to-r ".concat(e.color):"bg-[#1a1a1a]/10")})]},e.num))})}),(0,fn.jsxs)(zd,{mode:"wait",children:[1===w&&(0,fn.jsx)(Rb.div,{variants:Y,initial:"hidden",animate:"visible",exit:"exit",className:"max-w-xl mx-auto px-2 sm:px-0",children:(0,fn.jsxs)(Rb.div,{variants:G,initial:"hidden",animate:"visible",className:"bg-white rounded-2xl sm:rounded-3xl p-6 sm:p-10 shadow-2xl shadow-black/5 border border-black/5",children:[(0,fn.jsx)(Rb.h2,{variants:$,className:"text-xl sm:text-2xl font-light text-[#1a1a1a] mb-6 sm:mb-8 text-center",children:"Confirm Your Details"}),(0,fn.jsxs)(Rb.div,{variants:$,className:"mb-4 sm:mb-6",children:[(0,fn.jsx)("label",{className:"text-[10px] sm:text-xs font-medium text-[#1a1a1a]/40 uppercase tracking-wider mb-2 sm:mb-3 block",children:"Your Name"}),(0,fn.jsxs)("div",{className:"relative group",children:[(0,fn.jsx)("div",{className:"absolute left-3 sm:left-4 top-1/2 -translate-y-1/2 text-[#1a1a1a]/30",children:(0,fn.jsx)(gl,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),k?(0,fn.jsx)("input",{type:"text",value:E,onChange:e=>T(e.target.value),onBlur:()=>S(!1),autoFocus:!0,className:"w-full pl-10 sm:pl-12 pr-4 py-3 sm:py-4 text-base sm:text-xl text-[#1a1a1a] bg-[#fafafa] rounded-xl border-2 border-[#1a1a1a] outline-none transition-all"}):(0,fn.jsxs)("div",{onClick:()=>S(!0),className:"w-full pl-10 sm:pl-12 pr-10 sm:pr-12 py-3 sm:py-4 text-base sm:text-xl text-[#1a1a1a] bg-[#fafafa] rounded-xl border-2 border-transparent hover:border-[#1a1a1a]/20 cursor-pointer transition-all group",children:[E||"Enter your name",(0,fn.jsx)(_r,{className:"absolute right-3 sm:right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-[#1a1a1a]/30 group-hover:text-[#1a1a1a]/60 transition-colors"})]})]})]}),(0,fn.jsxs)(Rb.div,{variants:$,className:"mb-6 sm:mb-10",children:[(0,fn.jsx)("label",{className:"text-[10px] sm:text-xs font-medium text-[#1a1a1a]/40 uppercase tracking-wider mb-2 sm:mb-3 block",children:"Email Address"}),(0,fn.jsxs)("div",{className:"relative group",children:[(0,fn.jsx)("div",{className:"absolute left-3 sm:left-4 top-1/2 -translate-y-1/2 text-[#1a1a1a]/30",children:(0,fn.jsx)(Wr,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),C?(0,fn.jsx)("input",{type:"email",value:P,onChange:e=>A(e.target.value),onBlur:()=>_(!1),autoFocus:!0,className:"w-full pl-10 sm:pl-12 pr-4 py-3 sm:py-4 text-base sm:text-xl text-[#1a1a1a] bg-[#fafafa] rounded-xl border-2 border-[#1a1a1a] outline-none transition-all"}):(0,fn.jsxs)("div",{onClick:()=>_(!0),className:"w-full pl-10 sm:pl-12 pr-10 sm:pr-12 py-3 sm:py-4 text-base sm:text-xl text-[#1a1a1a] bg-[#fafafa] rounded-xl border-2 border-transparent hover:border-[#1a1a1a]/20 cursor-pointer transition-all group truncate",children:[P||"Enter your email",(0,fn.jsx)(_r,{className:"absolute right-3 sm:right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-[#1a1a1a]/30 group-hover:text-[#1a1a1a]/60 transition-colors"})]})]})]}),(0,fn.jsx)(Rb.button,{variants:$,onClick:()=>N(2),whileHover:{scale:1.02,y:-2},whileTap:{scale:.98},className:"w-full py-4 sm:py-5 bg-[#1a1a1a] text-white rounded-xl font-medium text-base sm:text-lg shadow-xl shadow-black/20 hover:shadow-2xl hover:shadow-black/30 transition-all",children:"Continue to Calendar"})]})},"step1"),2===w&&(0,fn.jsx)(Rb.div,{variants:Y,initial:"hidden",animate:"visible",exit:"exit",className:"px-2 sm:px-0",children:(0,fn.jsxs)(Rb.div,{className:"bg-white rounded-2xl sm:rounded-3xl p-4 sm:p-8 lg:p-12 shadow-2xl shadow-black/5 border border-black/5",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-6 sm:mb-10",children:[(0,fn.jsx)(Rb.button,{onClick:()=>!F&&j(new Date(v.getFullYear(),v.getMonth()-1)),whileHover:F?{}:{scale:1.1,x:-3},whileTap:F?{}:{scale:.9},disabled:F,className:"w-10 h-10 sm:w-14 sm:h-14 rounded-full flex items-center justify-center transition-colors ".concat(F?"bg-[#fafafa]/50 cursor-not-allowed":"bg-[#fafafa] hover:bg-[#f0f0f0]"),children:(0,fn.jsx)(br,{className:"w-5 h-5 sm:w-6 sm:h-6 ".concat(F?"text-[#1a1a1a]/20":"text-[#1a1a1a]")})}),(0,fn.jsxs)(Rb.h2,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"text-lg sm:text-2xl lg:text-3xl font-light text-[#1a1a1a] tracking-tight",children:[["January","February","March","April","May","June","July","August","September","October","November","December"][v.getMonth()]," ",v.getFullYear()]},v.toString()),(0,fn.jsx)(Rb.button,{onClick:()=>!I&&j(new Date(v.getFullYear(),v.getMonth()+1)),whileHover:I?{}:{scale:1.1,x:3},whileTap:I?{}:{scale:.9},disabled:I,className:"w-10 h-10 sm:w-14 sm:h-14 rounded-full flex items-center justify-center transition-colors ".concat(I?"bg-[#fafafa]/50 cursor-not-allowed":"bg-[#fafafa] hover:bg-[#f0f0f0]"),children:(0,fn.jsx)(yr,{className:"w-5 h-5 sm:w-6 sm:h-6 ".concat(I?"text-[#1a1a1a]/20":"text-[#1a1a1a]")})})]}),(0,fn.jsx)("div",{className:"grid grid-cols-7 gap-1 sm:gap-2 mb-2 sm:mb-4",children:["M","T","W","T","F","S","S"].map((e,t)=>(0,fn.jsxs)("div",{className:"text-center py-2 sm:py-3 text-xs sm:text-sm font-medium text-[#1a1a1a]/40 uppercase tracking-wider",children:[(0,fn.jsx)("span",{className:"sm:hidden",children:e}),(0,fn.jsx)("span",{className:"hidden sm:inline",children:H[t]})]},e+t))}),(0,fn.jsx)(Rb.div,{variants:G,initial:"hidden",animate:"visible",className:"grid grid-cols-7 gap-1 sm:gap-2",children:q.map((e,t)=>{const s=e&&U(e),n=e&&z(e),a=e?W(e):0,r=!e||s||n||0===a;return(0,fn.jsx)(Rb.button,{variants:$,onClick:()=>(e=>{!e||U(e)||z(e)||0===W(e)||(h(e),x(null),N(3))})(e),disabled:r,whileHover:r?{}:{scale:1.05,y:-2},whileTap:r?{}:{scale:.95},className:"aspect-square rounded-lg sm:rounded-2xl flex flex-col items-center justify-center transition-all duration-300 min-h-[40px] sm:min-h-[60px] ".concat(e?r?"text-[#1a1a1a]/20 cursor-not-allowed":"bg-[#fafafa] hover:bg-[#1a1a1a] hover:text-white cursor-pointer shadow-sm hover:shadow-xl hover:shadow-black/20 group":""),children:e&&(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)("span",{className:"text-sm sm:text-xl font-medium",children:e.getDate()}),!r&&a>0&&(0,fn.jsxs)("span",{className:"text-[8px] sm:text-[10px] text-[#1a1a1a]/40 group-hover:text-white/60 font-medium hidden sm:block",children:[a," slots"]})]})},t)})}),(0,fn.jsx)(Rb.button,{onClick:()=>N(1),whileHover:{scale:1.02},whileTap:{scale:.98},className:"mt-6 sm:mt-8 w-full py-3 sm:py-4 border-2 border-[#1a1a1a]/20 text-[#1a1a1a]/60 rounded-xl font-medium hover:border-[#1a1a1a]/40 hover:text-[#1a1a1a] transition-colors",children:"Back to Details"})]})},"step2"),3===w&&m&&(0,fn.jsx)(Rb.div,{variants:Y,initial:"hidden",animate:"visible",exit:"exit",className:"max-w-3xl mx-auto px-2 sm:px-0",children:(0,fn.jsxs)(Rb.div,{className:"bg-white rounded-2xl sm:rounded-3xl p-4 sm:p-8 lg:p-12 shadow-2xl shadow-black/5 border border-black/5",children:[(0,fn.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 sm:mb-10 gap-4",children:[(0,fn.jsxs)("div",{className:"flex items-center gap-3 sm:gap-4",children:[(0,fn.jsx)("div",{className:"w-10 h-10 sm:w-14 sm:h-14 rounded-full bg-[#1a1a1a] flex items-center justify-center flex-shrink-0",children:(0,fn.jsx)(wr,{className:"w-5 h-5 sm:w-6 sm:h-6 text-white"})}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("p",{className:"text-[10px] sm:text-sm text-[#1a1a1a]/40 font-medium uppercase tracking-wider",children:"Selected Date"}),(0,fn.jsx)("p",{className:"text-base sm:text-2xl font-light text-[#1a1a1a]",children:m.toLocaleDateString("en-GB",{weekday:"long",day:"numeric",month:"long"})})]})]}),(0,fn.jsx)(Rb.button,{onClick:()=>N(2),whileHover:{scale:1.05},whileTap:{scale:.95},className:"text-[#1a1a1a]/50 hover:text-[#1a1a1a] font-medium transition-colors text-sm sm:text-base self-end sm:self-auto",children:"Change"})]}),(0,fn.jsx)("h3",{className:"text-base sm:text-lg font-medium text-[#1a1a1a]/60 mb-4 sm:mb-6",children:"Available Times"}),(0,fn.jsx)(Rb.div,{variants:G,initial:"hidden",animate:"visible",className:"grid grid-cols-3 sm:grid-cols-5 gap-2 sm:gap-3",children:O.map((e,t)=>{const s=V(m).includes(e);return(0,fn.jsx)(Rb.button,{variants:$,custom:t,onClick:()=>!s&&(e=>{x(e),N(4)})(e),disabled:s,whileHover:s?{}:{scale:1.05,y:-3},whileTap:s?{}:{scale:.95},className:"py-3 sm:py-5 rounded-lg sm:rounded-xl font-medium text-sm sm:text-lg transition-all duration-300 ".concat(s?"bg-[#fafafa] text-[#1a1a1a]/20 cursor-not-allowed":"bg-[#fafafa] hover:bg-[#1a1a1a] hover:text-white hover:shadow-xl hover:shadow-black/20"),children:e},e)})})]})},"step3"),4===w&&m&&p&&(0,fn.jsx)(Rb.div,{variants:Y,initial:"hidden",animate:"visible",exit:"exit",className:"max-w-xl mx-auto px-2 sm:px-0",children:(0,fn.jsxs)(Rb.div,{className:"bg-white rounded-2xl sm:rounded-3xl p-6 sm:p-10 shadow-2xl shadow-black/5 border border-black/5",children:[(0,fn.jsx)(Rb.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:200},className:"w-16 h-16 sm:w-20 sm:h-20 rounded-full bg-[#1a1a1a] flex items-center justify-center mx-auto mb-6 sm:mb-8",children:(0,fn.jsx)(hr,{className:"w-7 h-7 sm:w-8 sm:h-8 text-white"})}),(0,fn.jsx)("h2",{className:"text-2xl sm:text-3xl font-light text-[#1a1a1a] text-center mb-6 sm:mb-10",children:"Confirm Your Booking"}),(0,fn.jsxs)("div",{className:"space-y-3 sm:space-y-4 mb-6 sm:mb-10",children:[(0,fn.jsxs)(Rb.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.2},className:"flex items-center justify-between py-3 sm:py-4 border-b border-[#1a1a1a]/10",children:[(0,fn.jsx)("span",{className:"text-[#1a1a1a]/50 text-sm sm:text-base",children:"Name"}),(0,fn.jsx)("span",{className:"font-medium text-[#1a1a1a] text-sm sm:text-base text-right",children:E})]}),(0,fn.jsxs)(Rb.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.3},className:"flex items-center justify-between py-3 sm:py-4 border-b border-[#1a1a1a]/10",children:[(0,fn.jsx)("span",{className:"text-[#1a1a1a]/50 text-sm sm:text-base",children:"Email"}),(0,fn.jsx)("span",{className:"font-medium text-[#1a1a1a] text-sm sm:text-base text-right truncate max-w-[180px] sm:max-w-none",children:P})]}),(0,fn.jsxs)(Rb.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4},className:"flex items-center justify-between py-3 sm:py-4 border-b border-[#1a1a1a]/10",children:[(0,fn.jsx)("span",{className:"text-[#1a1a1a]/50 text-sm sm:text-base",children:"Date"}),(0,fn.jsx)("span",{className:"font-medium text-[#1a1a1a] text-sm sm:text-base text-right",children:m.toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short"})})]}),(0,fn.jsxs)(Rb.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.5},className:"flex items-center justify-between py-3 sm:py-4",children:[(0,fn.jsx)("span",{className:"text-[#1a1a1a]/50 text-sm sm:text-base",children:"Time"}),(0,fn.jsx)("span",{className:"text-xl sm:text-2xl font-light text-[#1a1a1a]",children:p})]})]}),g&&(0,fn.jsx)(Rb.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mb-4 sm:mb-6 p-3 sm:p-4 bg-red-50 border border-red-200 rounded-xl text-red-600 text-xs sm:text-sm text-center",children:g}),(0,fn.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4",children:[(0,fn.jsx)(Rb.button,{onClick:()=>N(3),whileHover:{scale:1.02},whileTap:{scale:.98},className:"w-full sm:flex-1 py-4 sm:py-5 border-2 border-[#1a1a1a]/20 text-[#1a1a1a] rounded-xl font-medium hover:border-[#1a1a1a]/40 transition-colors order-2 sm:order-1",children:"Back"}),(0,fn.jsx)(Rb.button,{onClick:async()=>{if(!m||!p)return;if(!E||!E.trim())return void f("Please enter your name");if(!P||!P.trim())return void f("Please enter your email address");if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(P.trim()))try{r(!0),f(null);const t=await gn.post("/api/public/booking/book/".concat(e),{date:m.toISOString().split("T")[0],time:p,name:E,email:P});t.data.success?y(!0):f(t.data.message||"Failed to book appointment")}catch(ty){var t,s;f((null===(t=ty.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||"Failed to book. Please try again.")}finally{r(!1)}else f("Please enter a valid email address")},disabled:n,whileHover:n?{}:{scale:1.02,y:-2},whileTap:n?{}:{scale:.98},className:"w-full sm:flex-1 py-4 sm:py-5 bg-[#1a1a1a] text-white rounded-xl font-medium shadow-xl shadow-black/20 hover:shadow-2xl hover:shadow-black/30 transition-all disabled:opacity-50 order-1 sm:order-2",children:n?(0,fn.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,fn.jsx)(Rb.span,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full"}),"Booking..."]}):"Confirm Booking"})]})]})},"step4")]})]})]})},qb=()=>{const{user:e}=wn(),[t,s]=(K(),(0,a.useState)([])),[n,r]=(0,a.useState)([]),[l,o]=(0,a.useState)(""),[i,c]=(0,a.useState)(!1),[d,u]=(0,a.useState)(0),[m,h]=(0,a.useState)({current:0,total:0,currentFileName:""}),[p,x]=(0,a.useState)(!1),[g,f]=(0,a.useState)(null),[b,y]=(0,a.useState)(!1),[v,j]=(0,a.useState)([]),[w,N]=(0,a.useState)([]),[k,S]=(0,a.useState)([]),[C,_]=(0,a.useState)(!1),[E,T]=(0,a.useState)(!0),[P,A]=(0,a.useState)(""),[D,L]=(0,a.useState)(!1),M=(0,a.useRef)(null),[R,F]=(0,a.useState)(!0),[I,O]=(0,a.useState)(null),[B,U]=(0,a.useState)(!1),z=(0,a.useRef)(null),[V,W]=(0,a.useState)({start:0,end:20}),[q,H]=(0,a.useState)(6),Y=(0,a.useRef)(null),G=(0,a.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;z.current&&z.current.abort(),z.current=new AbortController;try{e?(T(!0),s([]),O(null),F(!0)):U(!0),console.log("\ud83d\udcf8 Fetching photographer photos...",{cursor:t,limit:30});const n=await gn.get("/api/photos",{params:{limit:30,cursor:t||void 0,fields:"minimal"},signal:z.current.signal});if(console.log("\ud83d\udcf8 Photos response:",n.data),n.data.success){const t=n.data.photos||[];if(e){s(t);const e=[...new Set(t.map(e=>e.folder_path).filter(Boolean))];r(e)}else s(e=>{const s=new Set(e.map(e=>e.id)),n=t.filter(e=>!s.has(e.id)),a=[...e,...n],l=[...new Set(a.map(e=>e.folder_path).filter(Boolean))];return r(l),a});F(n.data.hasMore||!1),O(n.data.nextCursor||null)}}catch(n){if("CanceledError"===n.name||"canceled"===n.message)return void console.log("\ud83d\udcf8 Photo fetch cancelled");console.error("Error fetching photos:",n)}finally{T(!1),U(!1)}},[30]),$=(0,a.useCallback)(()=>{!B&&R&&I&&G(!1,I)},[B,R,I,G]);(0,a.useEffect)(()=>(G(!0),()=>{z.current&&z.current.abort()}),[]);const Q=(0,a.useRef)(null);(0,a.useEffect)(()=>{if(!Q.current||!R||B)return;const e=new IntersectionObserver(e=>{e[0].isIntersecting&&R&&!B&&$()},{threshold:.1});return e.observe(Q.current),()=>{Q.current&&e.unobserve(Q.current)}},[R,B,$]),(0,a.useEffect)(()=>{const e=()=>{const e=window.innerWidth;return e>=1280?6:e>=1024?5:e>=768?4:e>=640?3:2};H(e());const t=()=>{H(e())};return window.addEventListener("resize",t,{passive:!0}),()=>window.removeEventListener("resize",t)},[]);const J=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!e||0===e.length)return;const s=Array.from(e),n=s.length;c(!0),u(0),h({current:0,total:n,currentFileName:""});let a=0,r=0;for(let i=0;i<s.length;i++){const e=s[i];h({current:i+1,total:n,currentFileName:e.name.length>25?e.name.substring(0,22)+"...":e.name});const c=new FormData;c.append("photo",e),t?c.append("folderPath",t):l&&c.append("folderPath",l);try{await gn.post("/api/photos/upload",c),a++}catch(o){console.error("Upload error:",o),r++}u(Math.round((i+1)/n*100))}c(!1),u(0),h({current:0,total:0,currentFileName:""}),G(!0),r>0?alert("Uploaded ".concat(a," of ").concat(n," photos. ").concat(r," failed.")):a>0&&alert("Successfully uploaded ".concat(a," photo").concat(a>1?"s":"","!"))},X=e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?x(!0):"dragleave"===e.type&&x(!1)},Z=(0,a.useCallback)(async()=>{_(!0);try{console.log("\ud83d\udccb Fetching leads...");const e=await gn.get("/api/leads",{params:{limit:100}});console.log("\ud83d\udccb Leads response:",e.data);const t=e.data.leads||e.data||[];if(console.log("\ud83d\udccb Total leads:",t.length),0===t.length)return console.log("\u26a0\ufe0f No leads returned from API"),N([]),void j([]);const s=t.sort((e,t)=>new Date(t.updated_at||t.created_at)-new Date(e.updated_at||e.created_at));console.log("\ud83d\udccb Available leads:",s.length),N(s),j([])}catch(t){var e;console.error("\u274c Error fetching leads:",(null===(e=t.response)||void 0===e?void 0:e.data)||t.message)}finally{_(!1)}},[]),ee=(0,a.useMemo)(()=>{const e=l?t.filter(e=>e.folder_path===l):t,s=new Set;return e.filter(e=>!s.has(e.id)&&(s.add(e.id),!0))},[t,l]);(0,a.useEffect)(()=>{W({start:0,end:Math.min(30,ee.length)})},[l,ee.length]),(0,a.useEffect)(()=>{if(0===ee.length)return;const e=()=>{const e=window.scrollY||document.documentElement.scrollTop,t=window.innerHeight,s=Math.floor(e/200),n=Math.max(0,(s-5)*q),a=Math.ceil(t/200),r=Math.min(ee.length,n+Math.max(20,(a+10)*q));W({start:n,end:r})};let t;e();const s=()=>{t&&clearTimeout(t),t=setTimeout(e,50)};return window.addEventListener("scroll",s,{passive:!0}),window.addEventListener("resize",s,{passive:!0}),()=>{window.removeEventListener("scroll",s),window.removeEventListener("resize",s),t&&clearTimeout(t)}},[ee.length,q,5,20]);const te=(0,a.useCallback)(e=>{if(e){const e=ee.map(e=>e.id);S(e)}else S([])},[ee]),se=(0,a.useMemo)(()=>ee.length>0&&ee.every(e=>k.includes(e.id)),[ee,k]),ne=(0,a.useMemo)(()=>ee.some(e=>k.includes(e.id)),[ee,k]);return(0,a.useEffect)(()=>{M.current&&(M.current.indeterminate=ne&&!se)},[ne,se]),(0,fn.jsx)("div",{className:"min-h-screen bg-gray-50 p-6",children:(0,fn.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,fn.jsxs)("div",{className:"mb-6",children:[(0,fn.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Photographer Dashboard"}),(0,fn.jsx)("p",{className:"text-gray-600 mt-2",children:"Upload and manage your photos"})]}),(0,fn.jsxs)("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,fn.jsx)("h2",{className:"text-lg font-semibold",children:"Folders"}),(0,fn.jsxs)("button",{onClick:()=>{const e=prompt("Enter folder name:");if(e&&e.trim()){const t=e.trim();n.includes(t)?alert("Folder already exists"):(r([...n,t]),o(t))}},className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[(0,fn.jsx)(Mr,{className:"h-4 w-4"}),(0,fn.jsx)("span",{children:"New Folder"})]})]}),(0,fn.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,fn.jsxs)("button",{onClick:()=>o(""),className:"px-4 py-2 rounded-lg transition-colors ".concat(""===l?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:["All Photos (",t.length,")"]}),n.map(e=>{const s=t.filter(t=>t.folder_path===e).length;return(0,fn.jsxs)("button",{onClick:()=>o(e),className:"px-4 py-2 rounded-lg transition-colors ".concat(l===e?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:[e," (",s,")"]},e)})]})]}),(0,fn.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[(0,fn.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Upload Photos"}),l&&(0,fn.jsxs)("p",{className:"text-sm text-blue-600 mb-2",children:["Photos will be uploaded to: ",(0,fn.jsx)("strong",{children:l})]}),(0,fn.jsx)("div",{onDragEnter:X,onDragLeave:X,onDragOver:X,onDrop:e=>{e.preventDefault(),e.stopPropagation(),x(!1),e.dataTransfer.files&&e.dataTransfer.files.length>0&&J(e.dataTransfer.files)},className:"border-2 border-dashed rounded-lg p-8 text-center transition-colors ".concat(p?"border-blue-500 bg-blue-50":i?"border-blue-400 bg-blue-50":"border-gray-300 bg-gray-50 hover:border-blue-400"),children:i?(0,fn.jsxs)("div",{className:"space-y-4 py-4",children:[(0,fn.jsxs)("div",{className:"relative mx-auto w-16 h-16",children:[(0,fn.jsx)(Fr,{className:"h-16 w-16 text-blue-600"}),(0,fn.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,fn.jsx)("div",{className:"w-20 h-20 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin"})})]}),(0,fn.jsxs)("div",{className:"text-center",children:[(0,fn.jsxs)("p",{className:"text-xl font-semibold text-blue-700",children:["Uploading ",m.current," of ",m.total]}),m.currentFileName&&(0,fn.jsx)("p",{className:"text-sm text-gray-500 mt-1 font-mono",children:m.currentFileName})]}),(0,fn.jsxs)("div",{className:"w-full max-w-md mx-auto",children:[(0,fn.jsxs)("div",{className:"flex justify-between text-sm text-gray-500 mb-2",children:[(0,fn.jsxs)("span",{children:[d,"% complete"]}),(0,fn.jsxs)("span",{children:[m.total-m.current," remaining"]})]}),(0,fn.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-4 overflow-hidden",children:(0,fn.jsx)("div",{className:"h-full rounded-full transition-all duration-300 ease-out relative overflow-hidden",style:{width:"".concat(d,"%"),background:"linear-gradient(90deg, #2563EB, #7C3AED)"},children:(0,fn.jsx)("div",{className:"absolute inset-0 opacity-30",style:{backgroundImage:"linear-gradient(45deg, rgba(255,255,255,.15) 25%, transparent 25%, transparent 50%, rgba(255,255,255,.15) 50%, rgba(255,255,255,.15) 75%, transparent 75%, transparent)",backgroundSize:"1rem 1rem",animation:"progress-stripes 1s linear infinite"}})})})]}),(0,fn.jsx)("p",{className:"text-sm text-gray-400",children:"Please don't close this page while uploading"})]}):(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(pl,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),(0,fn.jsx)("p",{className:"text-gray-600 mb-2",children:"Drag and drop photos here, or click to select"}),(0,fn.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"Supports: JPEG, PNG, GIF, WebP, HEIC"}),(0,fn.jsx)("input",{type:"file",multiple:!0,accept:"image/*",onChange:e=>J(e.target.files),className:"hidden",id:"file-upload"}),(0,fn.jsx)("label",{htmlFor:"file-upload",className:"inline-block px-6 py-3 rounded-lg cursor-pointer transition-colors bg-blue-600 text-white hover:bg-blue-700",children:"Select Photos"})]})})]}),k.length>0&&(0,fn.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6 flex items-center justify-between",children:[(0,fn.jsxs)("span",{className:"text-blue-800 font-medium",children:[k.length," photo(s) selected"]}),(0,fn.jsxs)("div",{className:"flex space-x-2",children:[(0,fn.jsxs)("button",{onClick:()=>{y(!0),Z()},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[(0,fn.jsx)(hr,{className:"inline h-4 w-4 mr-2"}),"Assign to Client"]}),(0,fn.jsxs)("button",{onClick:async()=>{if(0===k.length)return;const e="Are you sure you want to delete ".concat(k.length," photo(s)? This action cannot be undone.");if(window.confirm(e))try{let e=0,t=0;const s=k.map(async s=>{try{await gn.delete("/api/photos/".concat(s)),e++}catch(n){console.error("Error deleting photo ".concat(s,":"),n),t++}});await Promise.all(s),S([]),G(!0),t>0?alert("Deleted ".concat(e," of ").concat(k.length," photos. ").concat(t," failed.")):alert("Successfully deleted ".concat(e," photo(s)!"))}catch(t){console.error("Error during bulk delete:",t),alert("Error deleting photos. Please try again.")}},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[(0,fn.jsx)(cl,{className:"inline h-4 w-4 mr-2"}),"Delete Selected"]}),(0,fn.jsx)("button",{onClick:()=>S([]),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors",children:"Clear Selection"})]})]}),b&&(0,fn.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,fn.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-lg max-h-[85vh] flex flex-col",children:[(0,fn.jsxs)("div",{className:"flex justify-between items-center p-5 border-b bg-gradient-to-r from-blue-600 to-indigo-600 rounded-t-xl",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("h3",{className:"text-xl font-bold text-white",children:"Assign to Client"}),(0,fn.jsxs)("p",{className:"text-blue-100 text-sm",children:[k.length," photo(s) selected"]})]}),(0,fn.jsx)("button",{onClick:()=>{y(!1),f(null),A("")},className:"text-white/80 hover:text-white p-1",children:(0,fn.jsx)(jl,{className:"h-6 w-6"})})]}),(0,fn.jsx)("div",{className:"p-4 border-b",children:(0,fn.jsx)("input",{type:"text",placeholder:"Search by name or phone...",value:P,onChange:e=>A(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})}),(0,fn.jsx)("div",{className:"flex-1 overflow-y-auto p-4",children:C?(0,fn.jsxs)("div",{className:"text-center py-8",children:[(0,fn.jsx)("div",{className:"animate-spin h-8 w-8 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-3"}),(0,fn.jsx)("p",{className:"text-gray-500",children:"Loading clients..."})]}):(0,fn.jsxs)(fn.Fragment,{children:[w.length>0&&(0,fn.jsxs)("div",{className:"mb-4",children:[(0,fn.jsxs)("h4",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2 flex items-center",children:[(0,fn.jsx)(hr,{className:"h-3 w-3 mr-1"}),"Select a Client (",w.length," available)"]}),(0,fn.jsx)("div",{className:"space-y-1",children:w.filter(e=>{var t,s;return!P||(null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(P.toLowerCase()))||(null===(s=e.phone)||void 0===s?void 0:s.includes(P))}).map(e=>(0,fn.jsx)("button",{onClick:()=>f(e),className:"w-full text-left p-3 rounded-lg transition-all ".concat((null===g||void 0===g?void 0:g.id)===e.id?"bg-blue-100 border-2 border-blue-500":"bg-gray-50 hover:bg-gray-100 border-2 border-transparent"),children:(0,fn.jsxs)("div",{className:"flex items-center justify-between",children:[(0,fn.jsxs)("div",{className:"flex-1",children:[(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("span",{className:"font-medium text-gray-900",children:e.name||"Unnamed"}),(0,fn.jsx)("span",{className:"ml-2 px-2 py-0.5 text-xs rounded-full font-medium ".concat("Attended"===e.status?"bg-green-100 text-green-700":"Sale"===e.status?"bg-purple-100 text-purple-700":"bg-blue-100 text-blue-700"),children:e.status})]}),e.phone&&(0,fn.jsx)("span",{className:"text-sm text-gray-500",children:e.phone})]}),(null===g||void 0===g?void 0:g.id)===e.id&&(0,fn.jsx)(gr,{className:"h-5 w-5 text-blue-600"})]})},e.id))})]}),0===w.length&&(0,fn.jsxs)("div",{className:"text-center py-8",children:[(0,fn.jsx)(Fr,{className:"h-12 w-12 mx-auto text-gray-300 mb-3"}),(0,fn.jsx)("p",{className:"text-gray-500 font-medium",children:"No clients found"}),(0,fn.jsx)("p",{className:"text-gray-400 text-sm mt-1",children:"Only Booked, Attended, or Sale clients are available"})]})]})}),(0,fn.jsxs)("div",{className:"p-4 border-t bg-gray-50 rounded-b-xl",children:[g&&(0,fn.jsx)("div",{className:"mb-3 p-3 bg-blue-50 rounded-lg border border-blue-200",children:(0,fn.jsxs)("p",{className:"text-sm text-blue-800",children:[(0,fn.jsx)("strong",{children:"Assigning to:"})," ",g.name]})}),(0,fn.jsxs)("div",{className:"flex space-x-3",children:[(0,fn.jsx)("button",{onClick:()=>{y(!1),f(null),A("")},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors",children:"Cancel"}),(0,fn.jsx)("button",{onClick:async()=>{if(0!==k.length&&g){L(!0);try{let t=0;for(const s of k)try{await gn.put("/api/photos/".concat(s),{leadId:g.id}),t++}catch(e){console.error("Error assigning photo ".concat(s,":"),e)}t>0?(S([]),f(null),y(!1),A(""),G()):alert("Failed to assign photos. Please try again.")}catch(e){console.error("Error assigning photos:",e),alert("Error assigning photos. Please try again.")}finally{L(!1)}}else alert("Please select photos and a lead")},disabled:!g||D,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center",children:D?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)("div",{className:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full mr-2"}),"Assigning..."]}):(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(gr,{className:"h-4 w-4 mr-2"}),"Assign Photos"]})})]})]})]})}),(0,fn.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,fn.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,fn.jsxs)("h2",{className:"text-lg font-semibold",children:[l?'Photos in "'.concat(l,'"'):"My Uploaded Photos"," (",ee.length,")"]}),!E&&ee.length>0&&(0,fn.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,fn.jsx)("input",{type:"checkbox",ref:M,checked:se,onChange:e=>te(e.target.checked),className:"w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 cursor-pointer",title:se?"Deselect all":ne?"All selected (some)":"Select all"}),(0,fn.jsx)("label",{className:"text-sm text-gray-700 cursor-pointer select-none",onClick:()=>te(!se),children:se?"Deselect All":"Select All"})]})]}),E?(0,fn.jsxs)("div",{className:"text-center py-12",children:[(0,fn.jsx)("div",{className:"animate-spin h-12 w-12 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),(0,fn.jsx)("p",{className:"text-gray-500",children:"Loading your photos..."})]}):0===ee.length?(0,fn.jsxs)("div",{className:"text-center py-12",children:[(0,fn.jsx)(Fr,{className:"h-16 w-16 mx-auto text-gray-300 mb-4"}),(0,fn.jsx)("p",{className:"text-gray-500",children:"No photos yet. Upload some photos to get started!"})]}):(0,fn.jsxs)("div",{className:"relative",ref:Y,children:[(0,fn.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",style:{minHeight:"400px"},children:[V.start>0&&(0,fn.jsx)("div",{style:{gridColumn:"1 / -1",height:"".concat(200*Math.ceil(V.start/q),"px")}}),ee.slice(V.start,V.end).map((e,t)=>{var s;const n=V.start+t,a=e.cloudinary_secure_url||e.cloudinary_url,r=k.includes(e.id);return(0,fn.jsxs)("div",{className:"relative group cursor-pointer border-2 rounded-lg overflow-hidden transition-all aspect-square bg-gray-100 ".concat(r?"border-blue-600 ring-2 ring-blue-300":"border-gray-200 hover:border-blue-400"),onClick:()=>{S(t=>t.includes(e.id)?t.filter(t=>t!==e.id):[...t,e.id])},children:[(0,fn.jsx)(gc,{src:a,alt:e.description||"Photo",size:"thumb",className:"w-full h-full object-cover",useBlur:!0,threshold:100,onError:e=>{e&&e.target&&e.target.style&&(e.target.style.display="none")}}),(0,fn.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-opacity flex items-center justify-center pointer-events-none",children:r&&(0,fn.jsx)("div",{className:"bg-blue-600 rounded-full p-2",children:(0,fn.jsx)(gr,{className:"h-6 w-6 text-white"})})}),(0,fn.jsx)("button",{onClick:t=>{t.stopPropagation(),(async e=>{if(window.confirm("Are you sure you want to delete this photo?"))try{await gn.delete("/api/photos/".concat(e)),G(!0),alert("Photo deleted successfully")}catch(t){console.error("Error deleting photo:",t),alert("Error deleting photo. Please try again.")}})(e.id)},className:"absolute top-2 right-2 bg-red-500 text-white rounded-full p-1.5 opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-600 z-10",title:"Delete photo",children:(0,fn.jsx)(cl,{className:"h-4 w-4"})}),e.lead_id&&(0,fn.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-blue-600 text-white text-xs p-1.5 text-center font-medium truncate z-10",children:(null===(s=e.leads)||void 0===s?void 0:s.name)||"Assigned"})]},"".concat(e.id,"-").concat(n))}),V.end<ee.length&&(0,fn.jsx)("div",{style:{gridColumn:"1 / -1",height:"".concat(200*Math.ceil((ee.length-V.end)/q),"px")}})]}),R&&(0,fn.jsx)("div",{ref:Q,style:{height:"20px"}}),B&&(0,fn.jsxs)("div",{className:"text-center py-4",children:[(0,fn.jsx)("div",{className:"animate-spin h-8 w-8 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-2"}),(0,fn.jsx)("p",{className:"text-gray-500 text-sm",children:"Loading more photos..."})]}),!R&&ee.length>0&&(0,fn.jsx)("div",{className:"text-center py-4",children:(0,fn.jsxs)("p",{className:"text-gray-400 text-sm",children:["All photos loaded (",ee.length," total)"]})})]})]})]})})},Hb=e=>{let{onSignatureChange:t,signature:s,height:n=100,small:r=!1,parentScale:l=1}=e;const o=(0,a.useRef)(null),i=(0,a.useRef)(null),[c,d]=(0,a.useState)(!1),[u,m]=(0,a.useState)(!!s),[h,p]=(0,a.useState)(null),[x,g]=(0,a.useState)(350),f=(0,a.useRef)(!1);(0,a.useEffect)(()=>{const e=()=>{if(i.current){const e=i.current.offsetWidth-10;g(Math.max(e,100))}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[r]),(0,a.useEffect)(()=>{const e=o.current;if(!e)return;const t=e.getContext("2d"),a=window.devicePixelRatio||1;if(e.width=x*a,e.height=n*a,e.style.width="".concat(x,"px"),e.style.height="".concat(n,"px"),t.scale(a,a),t.fillStyle="#ffffff",t.fillRect(0,0,x,n),t.strokeStyle="#1a1a2e",t.lineWidth=2,t.lineCap="round",t.lineJoin="round",p(t),s){const e=new Image;e.onload=()=>{t.drawImage(e,0,0,x,n),m(!0),f.current=!0},e.src=s}},[x,n]);const b=(0,a.useCallback)(e=>{const t=o.current.getBoundingClientRect(),s=l||1;return e.touches?{x:(e.touches[0].clientX-t.left)/s,y:(e.touches[0].clientY-t.top)/s}:{x:(e.clientX-t.left)/s,y:(e.clientY-t.top)/s}},[l]),y=(0,a.useCallback)(e=>{if(!h)return;e.preventDefault();const t=b(e);h.beginPath(),h.moveTo(t.x,t.y),d(!0)},[h,b]),v=(0,a.useCallback)(e=>{if(!c||!h)return;e.preventDefault();const t=b(e);h.lineTo(t.x,t.y),h.stroke(),f.current=!0,m(!0)},[c,h,b]),j=(0,a.useCallback)(()=>{if(!h)return;const e=c;h.closePath(),d(!1),e&&f.current&&o.current&&t(o.current.toDataURL("image/png"))},[h,c,t]),w=(0,a.useCallback)(()=>{c&&j()},[c,j]),N=(0,a.useCallback)(()=>{h&&(h.fillStyle="#ffffff",h.fillRect(0,0,x,n),m(!1),f.current=!1,t(null))},[h,x,n,t]);return(0,a.useEffect)(()=>{const e=o.current;if(e)return e.addEventListener("mousedown",y),e.addEventListener("mousemove",v),e.addEventListener("mouseup",j),e.addEventListener("mouseleave",w),e.addEventListener("touchstart",y,{passive:!1}),e.addEventListener("touchmove",v,{passive:!1}),e.addEventListener("touchend",j),()=>{e.removeEventListener("mousedown",y),e.removeEventListener("mousemove",v),e.removeEventListener("mouseup",j),e.removeEventListener("mouseleave",w),e.removeEventListener("touchstart",y),e.removeEventListener("touchmove",v),e.removeEventListener("touchend",j)}},[y,v,j,w]),(0,fn.jsxs)("div",{className:"relative w-full",ref:i,children:[(0,fn.jsx)("canvas",{ref:o,className:"border border-gray-300 cursor-crosshair touch-none bg-white block w-full",style:{height:"".concat(n,"px")}}),!u&&!r&&(0,fn.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:(0,fn.jsx)("span",{className:"text-gray-300 italic text-sm",children:"Sign here"})}),u&&(0,fn.jsx)("button",{type:"button",onClick:N,className:"absolute top-1 right-1 p-1.5 bg-gray-100 rounded hover:bg-gray-200",children:(0,fn.jsx)(qc,{className:"w-4 h-4 text-gray-500"})})]})},Yb=()=>{const{token:e}=J(),[t,s]=(0,a.useState)(!0),[n,r]=(0,a.useState)(null),[l,o]=(0,a.useState)(null),[i,c]=(0,a.useState)(null),[d,u]=(0,a.useState)(""),[m,h]=(0,a.useState)(!1),[p,x]=(0,a.useState)(!1),[g,f]=(0,a.useState)(null),[b,y]=(0,a.useState)(1),[v,j]=(0,a.useState)(1),[w,N]=(0,a.useState)("auto"),[k,S]=(0,a.useState)({main:null,notAgency:null,noCancel:null,passDetails:null,happyPurchase:null}),[C,_]=(0,a.useState)({}),E=(0,a.useRef)(null),T=(0,a.useRef)(null),P=(0,a.useRef)(null);(0,a.useEffect)(()=>{e&&(async()=>{try{s(!0);const t=await fetch("/api/contracts/verify/".concat(e)),n=await t.json();if(!t.ok)throw new Error(n.message||"Invalid contract link");o(n.contract),c(n.template),u(n.html||"")}catch(ty){r(ty.message)}finally{s(!1)}})()},[e]);const A=(0,a.useCallback)(e=>{if(!d)return"";const t=(new DOMParser).parseFromString(d,"text/html"),s=t.querySelectorAll(".page"),n=t.querySelector("style"),a=n?n.outerHTML:"";return s.length>=e?a+s[e-1].outerHTML:""},[d]);(0,a.useEffect)(()=>{if(!E.current||!d)return;const e=setTimeout(()=>{const e=E.current.querySelectorAll("[data-signature]"),t={};e.forEach(e=>{const s=e.getAttribute("data-signature");s&&(e.innerHTML="",t[s]=e)}),_(t)},50);return()=>clearTimeout(e)},[d,b]),(0,a.useEffect)(()=>{const e=()=>{if(P.current){const e=P.current.offsetWidth,t=Math.min(1,e/794);j(t)}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,a.useEffect)(()=>{const e=()=>{if(!T.current)return;const e=T.current.scrollHeight;N(Math.ceil(e*v))},t=setTimeout(e,100);return window.addEventListener("resize",e),()=>{clearTimeout(t),window.removeEventListener("resize",e)}},[v,d,b,C]);if(t)return(0,fn.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,fn.jsxs)("div",{className:"text-center",children:[(0,fn.jsx)(oc,{className:"w-12 h-12 text-gray-600 animate-spin mx-auto mb-4"}),(0,fn.jsx)("p",{className:"text-gray-600",children:"Loading contract..."})]})});if(n)return(0,fn.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center p-4",children:(0,fn.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-md text-center",children:[(0,fn.jsx)(Fc,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),(0,fn.jsx)("h1",{className:"text-xl font-bold text-gray-900 mb-2",children:"Unable to Load Contract"}),(0,fn.jsx)("p",{className:"text-gray-600 mb-4",children:n}),(0,fn.jsxs)("p",{className:"text-sm text-gray-500",children:["Contact ",(0,fn.jsx)("a",{href:"mailto:sales@edgetalent.co.uk",className:"text-blue-600 hover:underline",children:"sales@edgetalent.co.uk"})]})]})});if(p)return(0,fn.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center p-4",children:(0,fn.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-md text-center",children:[(0,fn.jsx)(zc,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),(0,fn.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Contract Signed!"}),(0,fn.jsx)("p",{className:"text-gray-600 mb-6",children:"Thank you. A confirmation email has been sent."}),g&&(0,fn.jsxs)("a",{href:g,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center space-x-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[(0,fn.jsx)(Ic,{className:"w-5 h-5"}),(0,fn.jsx)("span",{children:"Download Signed Contract"})]})]})});const D=(null===l||void 0===l?void 0:l.data)||{},L=Object.values(k).filter(Boolean).length,M=1===b?["main"]:["notAgency","noCancel","passDetails","happyPurchase"];return(0,fn.jsx)("div",{className:"min-h-screen bg-gray-800 py-2 px-1 sm:py-4 sm:px-4",children:(0,fn.jsxs)("div",{className:"max-w-4xl mx-auto",ref:P,children:[(0,fn.jsxs)("div",{className:"bg-white rounded-t-lg p-3 sm:p-4 flex items-center justify-between border-b",children:[(0,fn.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,fn.jsx)("h1",{className:"text-sm sm:text-lg font-bold text-gray-900 truncate",children:"Edge Talent Contract"}),(0,fn.jsx)("p",{className:"text-xs sm:text-sm text-gray-500 truncate",children:D.customerName})]}),(0,fn.jsxs)("div",{className:"text-right ml-2 flex-shrink-0",children:[(0,fn.jsxs)("p",{className:"text-xs sm:text-sm text-gray-500",children:["Signatures: ",L,"/5"]}),(0,fn.jsx)("div",{className:"w-20 sm:w-32 h-2 bg-gray-200 rounded-full mt-1",children:(0,fn.jsx)("div",{className:"h-2 bg-green-500 rounded-full transition-all",style:{width:"".concat(L/5*100,"%")}})})]})]}),(0,fn.jsxs)("div",{className:"bg-gray-100 flex border-b",children:[(0,fn.jsx)("button",{onClick:()=>y(1),className:"flex-1 py-2 sm:py-3 text-xs sm:text-sm text-center font-medium transition-colors ".concat(1===b?"bg-white text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:bg-gray-50"),children:"Page 1: Invoice"}),(0,fn.jsx)("button",{onClick:()=>y(2),className:"flex-1 py-2 sm:py-3 text-xs sm:text-sm text-center font-medium transition-colors ".concat(2===b?"bg-white text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:bg-gray-50"),children:"Page 2: Confirm"})]}),(0,fn.jsx)("div",{className:"bg-white shadow-2xl overflow-hidden",style:{height:"auto"!==w?"".concat(w,"px"):"auto"},children:(0,fn.jsxs)("div",{ref:T,style:{transform:"scale(".concat(v,")"),transformOrigin:"top left",width:"".concat(794,"px")},children:[(0,fn.jsx)("style",{children:'\n              [data-signature] {\n                cursor: pointer;\n                position: relative;\n                transition: outline 0.2s;\n              }\n              [data-signature]:hover {\n                outline: 3px solid #22c55e;\n                outline-offset: 2px;\n                border-radius: 4px;\n              }\n              [data-editable]:hover {\n                outline: none !important;\n              }\n              .page {\n                min-height: auto !important;\n                padding: 20px !important;\n              }\n              \n              /* Mobile Responsive Styles */\n              @media (max-width: 640px) {\n                /* Page 2: Stack confirmation rows vertically for usable signature areas */\n                [data-editable^="confirmation"] {\n                  flex-direction: column !important;\n                  gap: 8px !important;\n                  margin-bottom: 20px !important;\n                }\n                /* Make signature boxes full width with larger touch targets */\n                [data-editable^="confirmation"] > [data-signature] {\n                  width: 100% !important;\n                  min-height: 120px !important;\n                  height: 120px !important;\n                  order: 2;\n                  border: 2px solid #333 !important;\n                }\n                /* Text comes first (above signature) */\n                [data-editable^="confirmation"] > div:not([data-signature]) {\n                  order: 1;\n                  padding-top: 0 !important;\n                }\n                /* Reduce font size on mobile for better fit */\n                [data-editable^="confirmation"] p {\n                  font-size: 12px !important;\n                  line-height: 1.4 !important;\n                }\n                /* Page 2 header smaller on mobile */\n                .page > div:first-child p {\n                  font-size: 12px !important;\n                  margin-bottom: 5px !important;\n                }\n                /* Reduce padding on page 2 */\n                .page {\n                  padding: 15px !important;\n                }\n                /* Gap between confirmation boxes */\n                .page > div {\n                  gap: 15px !important;\n                }\n                /* Signature canvas fills container */\n                [data-signature] canvas {\n                  width: 100% !important;\n                  height: 100% !important;\n                }\n              }\n              \n              /* Desktop styles - larger signature boxes */\n              @media (min-width: 641px) {\n                [data-editable^="confirmation"] {\n                  flex-direction: row !important;\n                  gap: 25px !important;\n                }\n                [data-editable^="confirmation"] > [data-signature] {\n                  width: 180px !important;\n                  min-height: 90px !important;\n                  order: 0;\n                }\n                [data-editable^="confirmation"] > div:not([data-signature]) {\n                  order: 0;\n                  padding-top: 10px !important;\n                }\n              }\n            '}),(0,fn.jsx)("div",{ref:E,dangerouslySetInnerHTML:{__html:A(b)}})]})}),M.map(e=>{const t=C[e];if(!t)return null;const s="main"!==e,n=s?window.innerWidth<=640?120:90:80;return fe.createPortal((0,fn.jsxs)("div",{style:{position:"relative",height:"100%"},children:[!k[e]&&s&&(0,fn.jsx)("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",zIndex:1},children:(0,fn.jsx)("span",{style:{color:"#ccc",fontSize:window.innerWidth<=640?"16px":"14px",fontStyle:"italic"},children:"Sign Here"})}),(0,fn.jsx)(Hb,{onSignatureChange:t=>S(s=>He(He({},s),{},{[e]:t})),signature:k[e],height:n,small:s,parentScale:v})]}),t)}),(0,fn.jsxs)("div",{className:"bg-white rounded-b-lg p-3 sm:p-4 border-t flex flex-col sm:flex-row items-center justify-between gap-2",children:[(0,fn.jsx)("p",{className:"text-xs sm:text-sm text-gray-500",children:L<5?"".concat(5-L," signature(s) remaining"):"All signatures complete!"}),(0,fn.jsx)("button",{onClick:async()=>{const t=["main","notAgency","noCancel","passDetails","happyPurchase"].filter(e=>!k[e]);if(t.length>0)alert("Please complete all ".concat(t.length," remaining signature(s) before submitting."));else try{h(!0);const t=await fetch("/api/contracts/sign/".concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({signatures:k})}),s=await t.json();if(!t.ok)throw new Error(s.message||"Failed to submit signature");x(!0),f(s.pdfUrl)}catch(ty){alert(ty.message)}finally{h(!1)}},disabled:m||L<5,className:"w-full sm:w-auto px-6 py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2",children:m?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(oc,{className:"w-5 h-5 animate-spin"}),(0,fn.jsx)("span",{children:"Submitting..."})]}):(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(ac,{className:"w-5 h-5"}),(0,fn.jsx)("span",{children:"Submit Contract"})]})})]}),(0,fn.jsxs)("div",{className:"text-center text-xs text-gray-400 mt-4 px-2",children:[(0,fn.jsx)("p",{children:(null===i||void 0===i?void 0:i.footer_line1)||""}),(0,fn.jsx)("p",{children:(null===i||void 0===i?void 0:i.footer_line2)||""})]})]})})},Gb=e=>{let{value:t,onChange:s,rows:n=4,placeholder:r,showFontSize:l=!0}=e;const o=(0,a.useRef)(null),[i,c]=(0,a.useState)("normal"),d=(e,n)=>{const a=o.current;if(!a)return;const r=a.selectionStart,l=a.selectionEnd,i=t.substring(r,l),c=t.substring(0,r),d=t.substring(l);s(c+e+i+n+d),setTimeout(()=>{a.focus();const t=r+e.length+i.length+n.length;a.setSelectionRange(t,t)},0)},u=e=>{d("<".concat(e,">"),"</".concat(e,">"))};return(0,fn.jsxs)("div",{className:"border border-gray-300 rounded-lg overflow-hidden focus-within:ring-2 focus-within:ring-blue-500 focus-within:border-transparent",children:[(0,fn.jsxs)("div",{className:"bg-gray-50 border-b border-gray-200 px-2 py-1.5 flex items-center gap-1 flex-wrap",children:[l&&(0,fn.jsxs)("div",{className:"relative",children:[(0,fn.jsxs)("select",{value:i,onChange:e=>(e=>{c(e);const t=o.current;if(!t)return;t.selectionStart!==t.selectionEnd&&d('<span style="font-size: '.concat({small:"10px",normal:"14px",large:"18px",xlarge:"24px"}[e],'">'),"</span>")})(e.target.value),className:"appearance-none bg-white border border-gray-300 rounded px-2 py-1 text-xs pr-6 cursor-pointer hover:bg-gray-50 focus:outline-none focus:ring-1 focus:ring-blue-500",title:"Font Size",children:[(0,fn.jsx)("option",{value:"small",children:"Small"}),(0,fn.jsx)("option",{value:"normal",children:"Normal"}),(0,fn.jsx)("option",{value:"large",children:"Large"}),(0,fn.jsx)("option",{value:"xlarge",children:"X-Large"})]}),(0,fn.jsx)(ul,{className:"absolute right-1.5 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none",size:12})]}),(0,fn.jsx)("div",{className:"w-px h-5 bg-gray-300 mx-1"}),(0,fn.jsx)("button",{type:"button",onClick:()=>u("strong"),className:"p-1.5 rounded hover:bg-gray-200 transition-colors text-gray-700",title:"Bold (wraps in <strong>)",children:(0,fn.jsx)(mr,{size:14})}),(0,fn.jsx)("button",{type:"button",onClick:()=>u("em"),className:"p-1.5 rounded hover:bg-gray-200 transition-colors text-gray-700",title:"Italic (wraps in <em>)",children:(0,fn.jsx)(Ir,{size:14})}),(0,fn.jsx)("button",{type:"button",onClick:()=>u("u"),className:"p-1.5 rounded hover:bg-gray-200 transition-colors text-gray-700",title:"Underline (wraps in <u>)",children:(0,fn.jsx)(ml,{size:14})}),(0,fn.jsx)("div",{className:"w-px h-5 bg-gray-300 mx-1"}),(0,fn.jsx)("button",{type:"button",onClick:()=>d("<br/>",""),className:"px-2 py-1 rounded hover:bg-gray-200 transition-colors text-gray-600 text-xs font-medium",title:"Insert Line Break",children:"\u21b5 Break"})]}),(0,fn.jsx)("textarea",{ref:o,value:t||"",onChange:e=>s(e.target.value),rows:n,placeholder:r,className:"w-full px-3 py-2 text-sm focus:outline-none resize-none",style:{minHeight:24*n}}),(0,fn.jsxs)("div",{className:"bg-gray-50 border-t border-gray-200 px-3 py-1.5 text-xs text-gray-500",children:["Select text and click a format button. Use ",(0,fn.jsx)("code",{className:"bg-gray-200 px-1 rounded",children:"<strong>"})," for bold."]})]})},$b=()=>{const{user:e}=wn(),[t,s]=(0,a.useState)(!0),[n,r]=(0,a.useState)(!1),[l,o]=(0,a.useState)(!1),[i,c]=(0,a.useState)(null),[d,u]=(0,a.useState)(null),[m,h]=(0,a.useState)(1),[p,x]=(0,a.useState)(100),[g,f]=(0,a.useState)(""),[b,y]=(0,a.useState)("normal"),v=(0,a.useRef)(null),j=(0,a.useRef)(null),[w,N]=(0,a.useState)({company_name:"",company_website:"",company_address:"",form_title:"",form_subtitle:"",form_contact_info:"",terms_and_conditions:"",signature_instruction:"",footer_line1:"",footer_line2:"",confirmation1_text:"",confirmation2_text:"",confirmation3_text:"",confirmation4_text:"",image_permission_text:"",image_no_permission_text:"",payment_details_html:"",finance_payment_label:"",non_finance_payment_label:"",finance_deposit_label:"",finance_amount_label:"",finance_provider_text:"",finance_info_text:"",cash_initial_text:""}),[k,S]=(0,a.useState)(null),C={header:{label:"Header & Company Info",fields:["company_name","company_website","company_address"],page:1},title:{label:"Form Title & Instructions",fields:["form_title","form_subtitle","form_contact_info"],page:1},terms:{label:"Terms and Conditions",fields:["terms_and_conditions"],page:1},signature_instruction:{label:"Signature Instruction",fields:["signature_instruction"],page:1},image_permission:{label:"Image Permission Text",fields:["image_permission_text","image_no_permission_text"],page:1},footer:{label:"Footer",fields:["footer_line1","footer_line2"],page:1},confirmation1:{label:"Confirmation 1 - Not an Agency",fields:["confirmation1_text"],page:2},confirmation2:{label:"Confirmation 2 - No Cancellation",fields:["confirmation2_text"],page:2},confirmation3:{label:"Confirmation 3 - Pass Details",fields:["confirmation3_text"],page:2},confirmation4:{label:"Confirmation 4 - Happy with Purchase",fields:["confirmation4_text"],page:2},finance:{label:"Finance Payment Section",description:"These labels appear only when Finance payment is selected",fields:["finance_payment_label","non_finance_payment_label","finance_deposit_label","finance_amount_label","finance_provider_text","finance_info_text"],page:1},payment:{label:"Payment Section",fields:["cash_initial_text"],page:1}},_={company_name:"Company Name",company_website:"Website",company_address:"Address",form_title:"Form Title",form_subtitle:"Subtitle",form_contact_info:"Contact Info",terms_and_conditions:"Terms & Conditions",signature_instruction:"Signature Instruction",footer_line1:"Footer Line 1",footer_line2:"Footer Line 2",confirmation1_text:"Confirmation Text",confirmation2_text:"Confirmation Text",confirmation3_text:"Confirmation Text",confirmation4_text:"Confirmation Text",image_permission_text:"Permission Granted",image_no_permission_text:"Permission Denied",finance_payment_label:'Finance Payment Label (e.g., "DEPOSIT TODAY")',non_finance_payment_label:'Non-Finance Payment Label (e.g., "PAYMENT TODAY")',finance_deposit_label:'Deposit Row Label (e.g., "DEPOSIT PAID")',finance_amount_label:'Finance Amount Label (e.g., "FINANCE AMOUNT")',finance_provider_text:'Finance Provider Text (e.g., "FINANCE VIA PAYL8R")',finance_info_text:'Finance Info Text (e.g., "Complete docs before receipt")',cash_initial_text:"Cash Initial Text (viewer instruction for cash payments)"},E=(0,a.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"normal";try{const t=localStorage.getItem("token"),s=await fetch("/api/contract-templates/preview?mode=".concat(e),{headers:{Authorization:"Bearer ".concat(t)}});if(s.ok){const e=await s.json();f(e.html),N(e.template),S(e.template)}}catch(t){console.error("Error fetching contract preview:",t)}finally{s(!1)}},[]);(0,a.useEffect)(()=>{E(b)},[]),(0,a.useEffect)(()=>{E(b)},[b]),(0,a.useEffect)(()=>{const e=j.current;if(!e)return;const t=e=>{const t=e.target.closest("[data-editable]");if(t){const e=t.getAttribute("data-editable");C[e]&&(u(e),h(C[e].page))}};return e.addEventListener("click",t),()=>e.removeEventListener("click",t)},[g]),(0,a.useEffect)(()=>{const e=e=>{if(v.current&&!v.current.contains(e.target)){e.target.closest("[data-editable]")||u(null)}};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const T=(e,t)=>{N(s=>He(He({},s),{},{[e]:t})),o(!0),c(null)},P=async()=>{try{r(!0);const e=localStorage.getItem("token"),t=await fetch("/api/contract-templates",{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify(w)});if(t.ok){const e=await t.json();N(e.template),S(e.template),o(!1),c({type:"success",text:"Saved successfully!"}),setTimeout(()=>c(null),3e3),await E(b)}else{const e=await t.json();c({type:"error",text:e.message||"Failed to save"})}}catch(e){c({type:"error",text:"Error saving template"})}finally{r(!1)}};if("admin"!==(null===e||void 0===e?void 0:e.role))return(0,fn.jsx)("div",{className:"p-6 bg-gray-100 min-h-screen flex items-center justify-center",children:(0,fn.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[(0,fn.jsx)("h2",{className:"text-xl font-bold text-red-600",children:"Access Denied"}),(0,fn.jsx)("p",{className:"text-gray-600 mt-2",children:"Only administrators can edit contract templates."})]})});if(t)return(0,fn.jsx)("div",{className:"p-6 bg-gray-100 min-h-screen flex items-center justify-center",children:(0,fn.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})});return(0,fn.jsxs)("div",{className:"h-[calc(100vh-80px)] bg-gray-900 flex flex-col overflow-hidden",children:[(0,fn.jsx)("style",{children:"\n    [data-editable] {\n      cursor: pointer;\n      transition: outline 0.2s, background-color 0.2s;\n      border-radius: 4px;\n    }\n    [data-editable]:hover {\n      outline: 2px solid #3b82f6;\n      outline-offset: 4px;\n      background-color: rgba(59, 130, 246, 0.05);\n    }\n    [data-editable].active {\n      outline: 2px solid #2563eb;\n      outline-offset: 4px;\n      background-color: rgba(59, 130, 246, 0.1);\n    }\n  "}),(0,fn.jsxs)("div",{className:"bg-gray-800 border-b border-gray-700 px-4 py-3 flex items-center justify-between flex-shrink-0",children:[(0,fn.jsxs)("div",{className:"flex items-center gap-4",children:[(0,fn.jsx)("h1",{className:"text-white font-semibold text-lg",children:"Contract Editor"}),(0,fn.jsx)("div",{className:"h-6 w-px bg-gray-600"}),(0,fn.jsxs)("div",{className:"flex items-center gap-2 bg-gray-700 rounded-lg px-2 py-1",children:[(0,fn.jsx)("button",{onClick:()=>h(1),className:"px-3 py-1 rounded text-sm transition-colors ".concat(1===m?"bg-blue-500 text-white":"text-gray-300 hover:text-white"),children:"Page 1"}),(0,fn.jsx)("button",{onClick:()=>h(2),className:"px-3 py-1 rounded text-sm transition-colors ".concat(2===m?"bg-blue-500 text-white":"text-gray-300 hover:text-white"),children:"Page 2"})]}),(0,fn.jsxs)("div",{className:"flex items-center gap-1 bg-gray-700 rounded-lg px-2 py-1",children:[(0,fn.jsx)("button",{onClick:()=>x(Math.max(50,p-10)),className:"text-gray-300 hover:text-white p-1",children:(0,fn.jsx)(Nl,{size:16})}),(0,fn.jsxs)("span",{className:"text-gray-300 text-sm w-12 text-center",children:[p,"%"]}),(0,fn.jsx)("button",{onClick:()=>x(Math.min(150,p+10)),className:"text-gray-300 hover:text-white p-1",children:(0,fn.jsx)(wl,{size:16})})]}),(0,fn.jsx)("div",{className:"text-xs text-gray-400 ml-2",children:"Click highlighted sections to edit"}),(0,fn.jsx)("div",{className:"h-6 w-px bg-gray-600 ml-2"}),(0,fn.jsxs)("select",{value:d||"",onChange:e=>{e.target.value&&(u(e.target.value),h(C[e.target.value].page))},className:"bg-gray-700 text-gray-300 text-sm rounded px-2 py-1 border border-gray-600 focus:outline-none focus:ring-1 focus:ring-blue-500",children:[(0,fn.jsx)("option",{value:"",children:"Jump to section..."}),(0,fn.jsx)("optgroup",{label:"Page 1",children:Object.entries(C).filter(e=>{let[t,s]=e;return 1===s.page}).map(e=>{let[t,s]=e;return(0,fn.jsx)("option",{value:t,children:s.label},t)})}),(0,fn.jsx)("optgroup",{label:"Page 2",children:Object.entries(C).filter(e=>{let[t,s]=e;return 2===s.page}).map(e=>{let[t,s]=e;return(0,fn.jsx)("option",{value:t,children:s.label},t)})})]}),(0,fn.jsx)("div",{className:"h-6 w-px bg-gray-600 ml-2"}),(0,fn.jsxs)("div",{className:"flex items-center gap-1 bg-gray-700 rounded-lg px-1 py-1",children:[(0,fn.jsx)("button",{onClick:()=>y("normal"),className:"px-3 py-1 text-xs font-medium rounded transition-all ".concat("normal"===b?"bg-green-500 text-white":"text-gray-400 hover:text-white"),children:"Normal"}),(0,fn.jsx)("button",{onClick:()=>y("finance"),className:"px-3 py-1 text-xs font-medium rounded transition-all ".concat("finance"===b?"bg-blue-500 text-white":"text-gray-400 hover:text-white"),children:"Finance"}),(0,fn.jsx)("button",{onClick:()=>y("payl8r"),className:"px-3 py-1 text-xs font-medium rounded transition-all ".concat("payl8r"===b?"bg-purple-500 text-white":"text-gray-400 hover:text-white"),children:"Payl8er"})]})]}),(0,fn.jsxs)("div",{className:"flex items-center gap-3",children:[i&&(0,fn.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1 rounded-lg text-sm ".concat("success"===i.type?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"),children:["success"===i.type?(0,fn.jsx)(gr,{size:14}):(0,fn.jsx)(jl,{size:14}),i.text]}),l&&(0,fn.jsx)("span",{className:"text-yellow-400 text-sm",children:"Unsaved changes"}),(0,fn.jsxs)("button",{onClick:async()=>{if(window.confirm("Reset to default template? This cannot be undone."))try{r(!0);const e=localStorage.getItem("token"),t=await fetch("/api/contract-templates/reset",{method:"POST",headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){const e=await t.json();N(e.template),S(e.template),o(!1),u(null),c({type:"success",text:"Reset to defaults!"}),setTimeout(()=>c(null),3e3),await E(b)}}catch(e){c({type:"error",text:"Error resetting template"})}finally{r(!1)}},disabled:n,className:"px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-gray-300 rounded-lg text-sm flex items-center gap-2 transition-colors",children:[(0,fn.jsx)(el,{size:14}),"Reset"]}),(0,fn.jsxs)("button",{onClick:P,disabled:n||!l,className:"px-4 py-1.5 rounded-lg text-sm flex items-center gap-2 transition-colors ".concat(l?"bg-blue-500 hover:bg-blue-600 text-white":"bg-gray-700 text-gray-500 cursor-not-allowed"),children:[(0,fn.jsx)(tl,{size:14}),n?"Saving...":"Save Changes"]})]})]}),(0,fn.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,fn.jsx)("div",{className:"flex-1 overflow-auto p-8 bg-gray-900",style:{backgroundImage:"radial-gradient(circle at 1px 1px, #374151 1px, transparent 0)",backgroundSize:"20px 20px"},children:(0,fn.jsx)("div",{className:"flex items-center justify-center min-h-full",children:(0,fn.jsx)("div",{ref:j,className:"bg-white shadow-2xl transition-transform origin-top",style:{transform:"scale(".concat(p/100,")"),width:"210mm",minHeight:"297mm"},dangerouslySetInnerHTML:{__html:(e=>{if(!g)return"";const t=(new DOMParser).parseFromString(g,"text/html"),s=t.querySelectorAll(".page"),n=t.querySelector("style"),a=n?n.outerHTML:"";return s.length>=e?a+s[e-1].outerHTML:""})(m)}})})}),(0,fn.jsx)("div",{ref:v,className:"bg-white border-l border-gray-200 transition-all duration-300 flex flex-col ".concat(d?"w-96":"w-0"),style:{overflow:"hidden"},children:d&&C[d]&&(0,fn.jsxs)("div",{className:"flex flex-col h-full",children:[(0,fn.jsxs)("div",{className:"px-4 py-3 border-b border-gray-200 flex items-center justify-between bg-gray-50",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("h3",{className:"font-semibold text-gray-900",children:C[d].label}),(0,fn.jsx)("p",{className:"text-xs text-gray-500",children:"Click outside to close"})]}),(0,fn.jsx)("button",{onClick:()=>u(null),className:"p-1 hover:bg-gray-200 rounded transition-colors",children:(0,fn.jsx)(jl,{size:18})})]}),(0,fn.jsx)("div",{className:"flex-1 overflow-auto p-4 space-y-4",children:C[d].fields.map(e=>(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:_[e]}),"terms_and_conditions"===e?(0,fn.jsx)(Gb,{value:w[e]||"",onChange:t=>T(e,t),rows:12,placeholder:"Enter ".concat(_[e].toLowerCase(),"..."),showFontSize:!0}):e.startsWith("confirmation")||"signature_instruction"===e?(0,fn.jsx)(Gb,{value:w[e]||"",onChange:t=>T(e,t),rows:4,placeholder:"Enter ".concat(_[e].toLowerCase(),"..."),showFontSize:!0}):"image_permission_text"===e||"image_no_permission_text"===e?(0,fn.jsx)(Gb,{value:w[e]||"",onChange:t=>T(e,t),rows:2,placeholder:"Enter ".concat(_[e].toLowerCase(),"..."),showFontSize:!1}):(0,fn.jsx)("input",{type:"text",value:w[e]||"",onChange:t=>T(e,t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter ".concat(_[e].toLowerCase(),"...")})]},e))}),(0,fn.jsx)("div",{className:"px-4 py-3 border-t border-gray-200 bg-gray-50",children:(0,fn.jsxs)("button",{onClick:P,disabled:n||!l,className:"w-full py-2 rounded-lg text-sm font-medium flex items-center justify-center gap-2 transition-colors ".concat(l?"bg-blue-500 hover:bg-blue-600 text-white":"bg-gray-200 text-gray-400 cursor-not-allowed"),children:[(0,fn.jsx)(tl,{size:14}),n?"Saving...":"Save Changes"]})})]})})]}),(0,fn.jsxs)("div",{className:"bg-gray-800 border-t border-gray-700 px-4 py-2 flex items-center justify-center gap-4 flex-shrink-0",children:[(0,fn.jsx)("button",{onClick:()=>h(1),disabled:1===m,className:"p-2 rounded transition-colors ".concat(1===m?"text-gray-600":"text-gray-300 hover:text-white hover:bg-gray-700"),children:(0,fn.jsx)(br,{size:20})}),(0,fn.jsxs)("span",{className:"text-gray-300 text-sm",children:["Page ",m," of 2"]}),(0,fn.jsx)("button",{onClick:()=>h(2),disabled:2===m,className:"p-2 rounded transition-colors ".concat(2===m?"text-gray-600":"text-gray-300 hover:text-white hover:bg-gray-700"),children:(0,fn.jsx)(yr,{size:20})})]})]})},Qb=()=>{var e,t,s,n,r,l,o,i,c,d;const{user:u}=wn(),[m,h]=(0,a.useState)([]),[p,x]=(0,a.useState)(!0),[g,f]=(0,a.useState)(""),[b,y]=(0,a.useState)(!1),[v,j]=(0,a.useState)(!1),[w,N]=(0,a.useState)({name:"",email:"",client_id:"",client_secret:"",refresh_token:"",redirect_uri:"",display_name:"Edge Talent",is_default:!1}),[k,S]=(0,a.useState)({}),[C,_]=(0,a.useState)(!1),[E,T]=(0,a.useState)(null),[P,A]=(0,a.useState)(!1),[D,L]=(0,a.useState)(!1),[M,R]=(0,a.useState)(null),[F,I]=(0,a.useState)(!1),[O,B]=(0,a.useState)(null),[U,z]=(0,a.useState)({}),[V,W]=(0,a.useState)(!1);(0,a.useEffect)(()=>{"admin"===(null===u||void 0===u?void 0:u.role)&&q()},[u]);const q=async()=>{try{const e=await gn.get("/api/email-accounts");h(e.data)}catch(e){console.error("Error fetching email accounts:",e)}x(!1)},H=e=>{const{name:t,value:s,type:n,checked:a}=e.target;N(e=>He(He({},e),{},{[t]:"checkbox"===n?a:s})),k[t]&&S(e=>He(He({},e),{},{[t]:""}))},Y=()=>{y(!1),N({name:"",email:"",client_id:"",client_secret:"",refresh_token:"",redirect_uri:"",display_name:"Edge Talent",is_default:!1}),S({})},[G,$]=(0,a.useState)(!1),[Q,K]=(0,a.useState)(null),[J,X]=(0,a.useState)(!1),Z=m.filter(e=>e.name.toLowerCase().includes(g.toLowerCase())||e.email.toLowerCase().includes(g.toLowerCase()));return"admin"!==(null===u||void 0===u?void 0:u.role)?(0,fn.jsx)("div",{className:"text-center py-12",children:(0,fn.jsx)("p",{className:"text-gray-500",children:"Access denied. Admin privileges required."})}):p?(0,fn.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,fn.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):(0,fn.jsxs)("div",{className:"space-y-6",children:[(0,fn.jsxs)("div",{className:"flex justify-between items-center",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"Email Accounts"}),(0,fn.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Manage email accounts for sending messages"})]}),(0,fn.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,fn.jsxs)("button",{onClick:async()=>{X(!0),$(!0);try{const e=await gn.get("/api/email-accounts/preview-env");K(e.data)}catch(s){var e,t;console.error("Error loading preview:",s),K({error:(null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Failed to load preview"})}X(!1)},className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors flex items-center space-x-2",title:"Import accounts from server environment variables",children:[(0,fn.jsx)(Cr,{className:"h-4 w-4"}),(0,fn.jsx)("span",{children:"Import from Env"})]}),(0,fn.jsxs)("button",{onClick:()=>y(!0),className:"btn-primary flex items-center space-x-2",children:[(0,fn.jsx)(Zr,{className:"h-4 w-4"}),(0,fn.jsx)("span",{children:"Add Account"})]})]})]}),(0,fn.jsx)("div",{className:"flex flex-col sm:flex-row gap-4",children:(0,fn.jsxs)("div",{className:"relative flex-1",children:[(0,fn.jsx)(sl,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),(0,fn.jsx)("input",{type:"text",placeholder:"Search accounts...",className:"pl-10 pr-4 py-2 border border-gray-300 rounded-md w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:g,onChange:e=>f(e.target.value)})]})}),(0,fn.jsxs)("div",{className:"card",children:[(0,fn.jsx)("div",{className:"overflow-x-auto",children:(0,fn.jsxs)("table",{className:"min-w-full",children:[(0,fn.jsx)("thead",{children:(0,fn.jsxs)("tr",{className:"table-header",children:[(0,fn.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Account"}),(0,fn.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),(0,fn.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,fn.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Credentials"}),(0,fn.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,fn.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:Z.map(e=>(0,fn.jsxs)("tr",{className:"table-row",children:[(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("div",{className:"h-8 w-8 rounded-full bg-blue-500 flex items-center justify-center",children:(0,fn.jsx)(Wr,{className:"h-4 w-4 text-white"})}),(0,fn.jsxs)("div",{className:"ml-3",children:[(0,fn.jsxs)("div",{className:"text-sm font-medium text-gray-900 flex items-center",children:[e.name,e.is_default&&(0,fn.jsxs)("span",{className:"ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800",children:[(0,fn.jsx)(ol,{className:"h-3 w-3 mr-1"}),"Default"]})]}),(0,fn.jsx)("div",{className:"text-sm text-gray-500",children:e.display_name||"Edge Talent"})]})]})}),(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,fn.jsx)("div",{className:"text-sm text-gray-900",children:e.email})}),(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,fn.jsx)("span",{className:"status-badge ".concat(e.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.is_active?"Active":"Inactive"})}),(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,fn.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,fn.jsxs)("div",{className:"flex items-center space-x-2 flex-wrap gap-1",children:[(0,fn.jsxs)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs ".concat(e.hasClientId?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:["ID ",e.hasClientId?(0,fn.jsx)(gr,{className:"ml-1 h-3 w-3"}):(0,fn.jsx)(jl,{className:"ml-1 h-3 w-3"})]}),(0,fn.jsxs)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs ".concat(e.hasClientSecret?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:["Secret ",e.hasClientSecret?(0,fn.jsx)(gr,{className:"ml-1 h-3 w-3"}):(0,fn.jsx)(jl,{className:"ml-1 h-3 w-3"})]}),(0,fn.jsxs)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs ".concat(e.hasRefreshToken?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:["Token ",e.hasRefreshToken?(0,fn.jsx)(gr,{className:"ml-1 h-3 w-3"}):(0,fn.jsx)(jl,{className:"ml-1 h-3 w-3"})]})]}),(0,fn.jsx)("div",{className:"flex items-center",children:U[e.id]?(0,fn.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs ".concat(U[e.id].success?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:U[e.id].success?(0,fn.jsxs)(fn.Fragment,{children:["Connected ",(0,fn.jsx)(gr,{className:"ml-1 h-3 w-3"})]}):(0,fn.jsxs)(fn.Fragment,{children:[U[e.id].needsReauth?"Token Expired":"Failed",(0,fn.jsx)(jl,{className:"ml-1 h-3 w-3"})]})}):(0,fn.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs bg-gray-100 text-gray-600",children:"Not tested"})})]})}),(0,fn.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,fn.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,fn.jsx)("button",{onClick:()=>(async e=>{try{const t=await gn.get("/api/email-accounts/".concat(e,"/auth-url"));t.data.authUrl?window.location.href=t.data.authUrl:alert("Failed to get authorization URL")}catch(n){var t,s;console.error("Error starting authorization:",n),alert((null===(t=n.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||"Failed to start authorization")}})(e.id),className:"".concat(e.hasClientId?"text-purple-600 hover:text-purple-900":"text-gray-300 cursor-not-allowed"),title:e.hasClientId?"Authorize with Google":"Add Client ID first",disabled:!e.hasClientId,children:(0,fn.jsx)(Or,{className:"h-4 w-4"})}),(0,fn.jsx)("button",{onClick:()=>(async e=>{B(e);try{const t=await gn.post("/api/email-accounts/".concat(e,"/test"));t.data.success?(z(t=>He(He({},t),{},{[e]:{success:!0,testedAt:(new Date).toISOString()}})),alert("Connection successful!\nEmail: ".concat(t.data.email,"\nMessages: ").concat(t.data.messagesTotal))):(z(s=>He(He({},s),{},{[e]:{success:!1,error:t.data.error,needsReauth:t.data.needsReauth,testedAt:(new Date).toISOString()}})),alert("Connection failed: ".concat(t.data.error)))}catch(n){var t,s;console.error("Error testing email account:",n),z(t=>{var s,a;return He(He({},t),{},{[e]:{success:!1,error:(null===(s=n.response)||void 0===s||null===(a=s.data)||void 0===a?void 0:a.error)||"Failed to test connection",testedAt:(new Date).toISOString()}})}),alert((null===(t=n.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.error)||"Failed to test connection")}B(null)})(e.id),disabled:O===e.id,className:"text-green-600 hover:text-green-900 disabled:opacity-50",title:"Test Connection",children:O===e.id?(0,fn.jsx)(el,{className:"h-4 w-4 animate-spin"}):(0,fn.jsx)(el,{className:"h-4 w-4"})}),!e.is_default&&(0,fn.jsx)("button",{onClick:()=>(async e=>{try{await gn.post("/api/email-accounts/".concat(e,"/set-default")),await q(),alert("Default email account updated!")}catch(n){var t,s;console.error("Error setting default account:",n),alert((null===(t=n.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||"Failed to set default account")}})(e.id),className:"text-yellow-600 hover:text-yellow-900",title:"Set as Default",children:(0,fn.jsx)(ol,{className:"h-4 w-4"})}),(0,fn.jsx)("button",{onClick:()=>{return T({id:(t=e).id,name:t.name,email:t.email,client_id:"",client_secret:"",refresh_token:"",redirect_uri:t.redirect_uri||"",display_name:t.display_name||"Edge Talent",is_active:t.is_active,is_default:t.is_default}),void _(!0);var t},className:"text-blue-600 hover:text-blue-900",title:"Edit",children:(0,fn.jsx)(Er,{className:"h-4 w-4"})}),(0,fn.jsx)("button",{onClick:()=>{return t=e.id,R(t),void L(!0);var t},className:"".concat(e.is_default?"text-gray-300 cursor-not-allowed":"text-red-600 hover:text-red-900"),title:e.is_default?"Cannot delete default account":"Delete",disabled:e.is_default,children:(0,fn.jsx)(cl,{className:"h-4 w-4"})})]})})]},e.id))})]})}),0===Z.length&&(0,fn.jsxs)("div",{className:"text-center py-12",children:[(0,fn.jsx)(Wr,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,fn.jsx)("p",{className:"mt-2 text-gray-500",children:"No email accounts found"}),(0,fn.jsx)("p",{className:"text-sm text-gray-400",children:"Add an email account to get started"})]})]}),(0,fn.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,fn.jsx)("div",{className:"card",children:(0,fn.jsxs)("div",{className:"text-center",children:[(0,fn.jsx)("div",{className:"text-2xl font-semibold text-gray-900",children:m.length}),(0,fn.jsx)("div",{className:"text-sm text-gray-500",children:"Total Accounts"})]})}),(0,fn.jsx)("div",{className:"card",children:(0,fn.jsxs)("div",{className:"text-center",children:[(0,fn.jsx)("div",{className:"text-2xl font-semibold text-green-600",children:m.filter(e=>e.is_active).length}),(0,fn.jsx)("div",{className:"text-sm text-gray-500",children:"Active Accounts"})]})}),(0,fn.jsx)("div",{className:"card",children:(0,fn.jsxs)("div",{className:"text-center",children:[(0,fn.jsx)("div",{className:"text-2xl font-semibold text-blue-600",children:m.filter(e=>e.hasRefreshToken).length}),(0,fn.jsx)("div",{className:"text-sm text-gray-500",children:"Configured Accounts"})]})})]}),b&&(0,fn.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,fn.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto",children:[(0,fn.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,fn.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Add Email Account"}),(0,fn.jsx)("button",{onClick:Y,className:"text-gray-400 hover:text-gray-600",children:(0,fn.jsx)(jl,{className:"h-6 w-6"})})]}),(0,fn.jsxs)("form",{onSubmit:async e=>{e.preventDefault();const t=(()=>{const e={};return w.name.trim()||(e.name="Name is required"),w.email.trim()?/\S+@\S+\.\S+/.test(w.email)||(e.email="Email is invalid"):e.email="Email is required",e})();if(Object.keys(t).length>0)S(t);else{j(!0),S({});try{const e=await gn.post("/api/email-accounts",w);h(t=>[e.data.account,...t]),N({name:"",email:"",client_id:"",client_secret:"",refresh_token:"",redirect_uri:"",display_name:"Edge Talent",is_default:!1}),y(!1),alert("Email account created successfully!")}catch(a){var s,n;console.error("Error creating email account:",a);const e=(null===(s=a.response)||void 0===s||null===(n=s.data)||void 0===n?void 0:n.message)||"Failed to create email account";S({submit:e})}j(!1)}},className:"space-y-4",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Account Name *"}),(0,fn.jsx)("input",{type:"text",name:"name",value:w.name,onChange:H,className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ".concat(k.name?"border-red-500":"border-gray-300"),placeholder:"e.g., Hello Account, Diary Account"}),k.name&&(0,fn.jsx)("p",{className:"text-red-500 text-xs mt-1",children:k.name})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[(0,fn.jsx)(Wr,{className:"inline h-4 w-4 mr-2"}),"Email Address *"]}),(0,fn.jsx)("input",{type:"email",name:"email",value:w.email,onChange:H,className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ".concat(k.email?"border-red-500":"border-gray-300"),placeholder:"hello@edgetalent.co.uk"}),k.email&&(0,fn.jsx)("p",{className:"text-red-500 text-xs mt-1",children:k.email})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Display Name"}),(0,fn.jsx)("input",{type:"text",name:"display_name",value:w.display_name,onChange:H,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Edge Talent"})]}),(0,fn.jsx)("hr",{className:"my-4"}),(0,fn.jsx)("h3",{className:"text-sm font-medium text-gray-700",children:"OAuth Credentials (Optional)"}),(0,fn.jsx)("p",{className:"text-xs text-gray-500 mb-4",children:"Configure these settings to enable sending emails from this account."}),(0,fn.jsxs)("div",{children:[(0,fn.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[(0,fn.jsx)(Or,{className:"inline h-4 w-4 mr-2"}),"Google Client ID"]}),(0,fn.jsx)("input",{type:"text",name:"client_id",value:w.client_id,onChange:H,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"xxx.apps.googleusercontent.com"})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Client Secret"}),(0,fn.jsx)("input",{type:"password",name:"client_secret",value:w.client_secret,onChange:H,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter client secret"})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Refresh Token"}),(0,fn.jsx)("input",{type:"password",name:"refresh_token",value:w.refresh_token,onChange:H,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter refresh token"})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Redirect URI"}),(0,fn.jsx)("input",{type:"text",name:"redirect_uri",value:w.redirect_uri,onChange:H,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"https://your-domain/api/gmail/oauth2callback"})]}),(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("input",{type:"checkbox",name:"is_default",id:"is_default",checked:w.is_default,onChange:H,className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,fn.jsx)("label",{htmlFor:"is_default",className:"ml-2 block text-sm text-gray-700",children:"Set as default email account"})]}),k.submit&&(0,fn.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-3",children:(0,fn.jsx)("p",{className:"text-red-600 text-sm",children:k.submit})}),(0,fn.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,fn.jsx)("button",{type:"button",onClick:Y,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",children:"Cancel"}),(0,fn.jsx)("button",{type:"submit",disabled:v,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2",children:v?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),(0,fn.jsx)("span",{children:"Creating..."})]}):(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(Zr,{className:"h-4 w-4"}),(0,fn.jsx)("span",{children:"Create Account"})]})})]})]})]})}),C&&(0,fn.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,fn.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto",children:[(0,fn.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,fn.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Edit Email Account"}),(0,fn.jsx)("button",{onClick:()=>_(!1),className:"text-gray-400 hover:text-gray-600",children:(0,fn.jsx)(jl,{className:"h-6 w-6"})})]}),(0,fn.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),A(!0);try{await gn.put("/api/email-accounts/".concat(E.id),E);await q(),_(!1),T(null),alert("Email account updated successfully!")}catch(n){var t,s;console.error("Error updating email account:",n),alert((null===(t=n.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||"Failed to update email account")}A(!1)},className:"space-y-4",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Account Name"}),(0,fn.jsx)("input",{type:"text",name:"name",value:E.name,onChange:e=>T(t=>He(He({},t),{},{name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),(0,fn.jsx)("input",{type:"email",name:"email",value:E.email,onChange:e=>T(t=>He(He({},t),{},{email:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Display Name"}),(0,fn.jsx)("input",{type:"text",name:"display_name",value:E.display_name,onChange:e=>T(t=>He(He({},t),{},{display_name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,fn.jsx)("hr",{className:"my-4"}),(0,fn.jsx)("h3",{className:"text-sm font-medium text-gray-700",children:"Update OAuth Credentials"}),(0,fn.jsx)("p",{className:"text-xs text-gray-500 mb-2",children:"Credentials are hidden for security. Leave blank to keep existing."}),(0,fn.jsxs)("div",{className:"flex items-center space-x-2 mb-4 text-xs",children:[(0,fn.jsx)("span",{className:"text-gray-600",children:"Currently saved:"}),(0,fn.jsxs)("span",{className:null!==(e=m.find(e=>e.id===(null===E||void 0===E?void 0:E.id)))&&void 0!==e&&e.hasClientId?"text-green-600":"text-red-600",children:["ID ",null!==(t=m.find(e=>e.id===(null===E||void 0===E?void 0:E.id)))&&void 0!==t&&t.hasClientId?"\u2713":"\u2717"]}),(0,fn.jsxs)("span",{className:null!==(s=m.find(e=>e.id===(null===E||void 0===E?void 0:E.id)))&&void 0!==s&&s.hasClientSecret?"text-green-600":"text-red-600",children:["Secret ",null!==(n=m.find(e=>e.id===(null===E||void 0===E?void 0:E.id)))&&void 0!==n&&n.hasClientSecret?"\u2713":"\u2717"]}),(0,fn.jsxs)("span",{className:null!==(r=m.find(e=>e.id===(null===E||void 0===E?void 0:E.id)))&&void 0!==r&&r.hasRefreshToken?"text-green-600":"text-red-600",children:["Token ",null!==(l=m.find(e=>e.id===(null===E||void 0===E?void 0:E.id)))&&void 0!==l&&l.hasRefreshToken?"\u2713":"\u2717"]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Google Client ID"}),(0,fn.jsx)("input",{type:"text",name:"client_id",value:E.client_id,onChange:e=>T(t=>He(He({},t),{},{client_id:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Leave blank to keep existing"})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Client Secret"}),(0,fn.jsx)("input",{type:"password",name:"client_secret",value:E.client_secret,onChange:e=>T(t=>He(He({},t),{},{client_secret:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Leave blank to keep existing"})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Refresh Token"}),(0,fn.jsx)("input",{type:"password",name:"refresh_token",value:E.refresh_token,onChange:e=>T(t=>He(He({},t),{},{refresh_token:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Leave blank to keep existing"})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Redirect URI"}),(0,fn.jsx)("input",{type:"text",name:"redirect_uri",value:E.redirect_uri,onChange:e=>T(t=>He(He({},t),{},{redirect_uri:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,fn.jsxs)("div",{className:"flex items-center",children:[(0,fn.jsx)("input",{type:"checkbox",name:"is_active",id:"edit_is_active",checked:E.is_active,onChange:e=>T(t=>He(He({},t),{},{is_active:e.target.checked})),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,fn.jsx)("label",{htmlFor:"edit_is_active",className:"ml-2 block text-sm text-gray-700",children:"Account is active"})]}),(0,fn.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,fn.jsx)("button",{type:"button",onClick:()=>_(!1),className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",children:"Cancel"}),(0,fn.jsx)("button",{type:"submit",disabled:P,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2",children:P?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),(0,fn.jsx)("span",{children:"Updating..."})]}):(0,fn.jsx)("span",{children:"Update Account"})})]})]})]})}),D&&(0,fn.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,fn.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[(0,fn.jsxs)("div",{className:"text-center",children:[(0,fn.jsx)("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100",children:(0,fn.jsx)(cl,{className:"h-6 w-6 text-red-600"})}),(0,fn.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900 mt-4",children:"Delete Email Account"}),(0,fn.jsx)("div",{className:"mt-2 px-7 py-3",children:(0,fn.jsx)("p",{className:"text-sm text-gray-500",children:"Are you sure you want to delete this email account? Users assigned to this account will be unassigned."})})]}),(0,fn.jsxs)("div",{className:"mt-5 sm:mt-6 flex justify-center space-x-4",children:[(0,fn.jsx)("button",{type:"button",onClick:()=>L(!1),className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",children:"Cancel"}),(0,fn.jsx)("button",{type:"button",onClick:async()=>{if(M){I(!0);try{await gn.delete("/api/email-accounts/".concat(M)),h(e=>e.filter(e=>e.id!==M)),L(!1),R(null),alert("Email account deleted successfully!")}catch(s){var e,t;console.error("Error deleting email account:",s),alert((null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Failed to delete email account")}I(!1)}},disabled:F,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2",children:F?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),(0,fn.jsx)("span",{children:"Deleting..."})]}):(0,fn.jsx)("span",{children:"Delete Account"})})]})]})}),G&&(0,fn.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,fn.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto",children:[(0,fn.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,fn.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Import Email Accounts from Environment"}),(0,fn.jsx)("button",{onClick:()=>$(!1),className:"text-gray-400 hover:text-gray-600",children:(0,fn.jsx)(jl,{className:"h-6 w-6"})})]}),J?(0,fn.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,fn.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):null!==Q&&void 0!==Q&&Q.error?(0,fn.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:(0,fn.jsx)("p",{className:"text-red-600",children:Q.error})}):(0,fn.jsxs)("div",{className:"space-y-6",children:[(0,fn.jsx)("p",{className:"text-sm text-gray-600",children:"The following email accounts were found in your server environment variables and will be imported with their credentials:"}),(null===Q||void 0===Q?void 0:Q.primary)&&(0,fn.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,fn.jsxs)("h3",{className:"font-medium text-gray-900 mb-3 flex items-center",children:[(0,fn.jsx)(Wr,{className:"h-5 w-5 mr-2 text-blue-500"}),"Primary Account",Q.primary.exists&&(0,fn.jsx)("span",{className:"ml-2 text-xs bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded",children:"Already exists"})]}),(0,fn.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("span",{className:"text-gray-500",children:"Email:"}),(0,fn.jsx)("span",{className:"ml-2 font-mono",children:Q.primary.email||"Not configured"})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("span",{className:"text-gray-500",children:"Google Client ID:"}),(0,fn.jsxs)("span",{className:"ml-2 ".concat(Q.primary.hasClientId?"text-green-600":"text-red-600"),children:[Q.primary.hasClientId?(0,fn.jsx)(gr,{className:"inline h-4 w-4"}):(0,fn.jsx)(jl,{className:"inline h-4 w-4"}),Q.primary.hasClientId?" Configured":" Missing"]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("span",{className:"text-gray-500",children:"Client Secret:"}),(0,fn.jsxs)("span",{className:"ml-2 ".concat(Q.primary.hasClientSecret?"text-green-600":"text-red-600"),children:[Q.primary.hasClientSecret?(0,fn.jsx)(gr,{className:"inline h-4 w-4"}):(0,fn.jsx)(jl,{className:"inline h-4 w-4"}),Q.primary.hasClientSecret?" Configured":" Missing"]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("span",{className:"text-gray-500",children:"Refresh Token:"}),(0,fn.jsxs)("span",{className:"ml-2 ".concat(Q.primary.hasRefreshToken?"text-green-600":"text-red-600"),children:[Q.primary.hasRefreshToken?(0,fn.jsx)(gr,{className:"inline h-4 w-4"}):(0,fn.jsx)(jl,{className:"inline h-4 w-4"}),Q.primary.hasRefreshToken?" Configured":" Missing"]})]})]})]}),(null===Q||void 0===Q?void 0:Q.secondary)&&(0,fn.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,fn.jsxs)("h3",{className:"font-medium text-gray-900 mb-3 flex items-center",children:[(0,fn.jsx)(Wr,{className:"h-5 w-5 mr-2 text-purple-500"}),"Secondary Account",Q.secondary.exists&&(0,fn.jsx)("span",{className:"ml-2 text-xs bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded",children:"Already exists"})]}),(0,fn.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("span",{className:"text-gray-500",children:"Email:"}),(0,fn.jsx)("span",{className:"ml-2 font-mono",children:Q.secondary.email||"Not configured"})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("span",{className:"text-gray-500",children:"Google Client ID:"}),(0,fn.jsxs)("span",{className:"ml-2 ".concat(Q.secondary.hasClientId?"text-green-600":"text-red-600"),children:[Q.secondary.hasClientId?(0,fn.jsx)(gr,{className:"inline h-4 w-4"}):(0,fn.jsx)(jl,{className:"inline h-4 w-4"}),Q.secondary.hasClientId?" Configured":" Missing"]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("span",{className:"text-gray-500",children:"Client Secret:"}),(0,fn.jsxs)("span",{className:"ml-2 ".concat(Q.secondary.hasClientSecret?"text-green-600":"text-red-600"),children:[Q.secondary.hasClientSecret?(0,fn.jsx)(gr,{className:"inline h-4 w-4"}):(0,fn.jsx)(jl,{className:"inline h-4 w-4"}),Q.secondary.hasClientSecret?" Configured":" Missing"]})]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("span",{className:"text-gray-500",children:"Refresh Token:"}),(0,fn.jsxs)("span",{className:"ml-2 ".concat(Q.secondary.hasRefreshToken?"text-green-600":"text-red-600"),children:[Q.secondary.hasRefreshToken?(0,fn.jsx)(gr,{className:"inline h-4 w-4"}):(0,fn.jsx)(jl,{className:"inline h-4 w-4"}),Q.secondary.hasRefreshToken?" Configured":" Missing"]})]})]})]}),!(null!==Q&&void 0!==Q&&null!==(o=Q.primary)&&void 0!==o&&o.email)&&!(null!==Q&&void 0!==Q&&null!==(i=Q.secondary)&&void 0!==i&&i.email)&&(0,fn.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4",children:(0,fn.jsx)("p",{className:"text-yellow-800",children:"No email accounts found in environment variables."})}),(0,fn.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,fn.jsx)("h4",{className:"font-medium text-blue-900 mb-2",children:"Need to Re-authenticate?"}),(0,fn.jsx)("p",{className:"text-sm text-blue-800 mb-2",children:"If tokens are expired, visit these URLs to get new refresh tokens:"}),(0,fn.jsxs)("div",{className:"text-sm font-mono space-y-1",children:[(0,fn.jsxs)("div",{children:[(0,fn.jsx)("span",{className:"text-blue-600",children:"Primary:"})," /api/gmail/auth"]}),(0,fn.jsxs)("div",{children:[(0,fn.jsx)("span",{className:"text-blue-600",children:"Secondary:"})," /api/gmail/auth2"]})]})]})]}),(0,fn.jsxs)("div",{className:"flex justify-end space-x-3 pt-6 mt-6 border-t",children:[(0,fn.jsx)("button",{type:"button",onClick:()=>$(!1),className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",children:"Cancel"}),(0,fn.jsx)("button",{type:"button",onClick:async()=>{W(!0);try{var e,t,s;const n=await gn.post("/api/email-accounts/import-from-env");let a=n.data.message;(null===(e=n.data.imported)||void 0===e?void 0:e.length)>0&&(a+="\n\nImported:\n"+n.data.imported.map(e=>"- ".concat(e.email)).join("\n")),(null===(t=n.data.skipped)||void 0===t?void 0:t.length)>0&&(a+="\n\nSkipped (already exist):\n"+n.data.skipped.map(e=>"- ".concat(e.email)).join("\n")),(null===(s=n.data.errors)||void 0===s?void 0:s.length)>0&&(a+="\n\nErrors:\n"+n.data.errors.map(e=>"- ".concat(e.email,": ").concat(e.error)).join("\n")),alert(a),$(!1),await q()}catch(r){var n,a;console.error("Error importing from env:",r),alert((null===(n=r.response)||void 0===n||null===(a=n.data)||void 0===a?void 0:a.message)||"Failed to import accounts")}W(!1)},disabled:V||J||!(null!==Q&&void 0!==Q&&null!==(c=Q.primary)&&void 0!==c&&c.email)&&!(null!==Q&&void 0!==Q&&null!==(d=Q.secondary)&&void 0!==d&&d.email),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2",children:V?(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),(0,fn.jsx)("span",{children:"Importing..."})]}):(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsx)(Cr,{className:"h-4 w-4"}),(0,fn.jsx)("span",{children:"Import Accounts"})]})})]})]})})]})},Kb=function(e){void 0===e&&(e={});var t=e.window,s=void 0===t?document.defaultView:t,n=s.history;function a(){var e=s.location,t=e.pathname,a=e.search,r=e.hash,l=n.state||{};return[l.idx,Le({pathname:t,search:a,hash:r,state:l.usr||null,key:l.key||"default"})]}var r=null;s.addEventListener(Re,function(){if(r)u.call(r),r=null;else{var e=De.Pop,t=a(),s=t[0],n=t[1];if(u.length){if(null!=s){var l=i-s;l&&(r={action:e,location:n,retry:function(){f(-1*l)}},f(l))}}else g(e)}});var l=De.Pop,o=a(),i=o[0],c=o[1],d=Ie(),u=Ie();function m(e){return"string"===typeof e?e:Be(e)}function h(e,t){return void 0===t&&(t=null),Le(Ae({pathname:c.pathname,hash:"",search:""},"string"===typeof e?Ue(e):e,{state:t,key:Oe()}))}function p(e,t){return[{usr:e.state,key:e.key,idx:t},m(e)]}function x(e,t,s){return!u.length||(u.call({action:e,location:t,retry:s}),!1)}function g(e){l=e;var t=a();i=t[0],c=t[1],d.call({action:l,location:c})}function f(e){n.go(e)}null==i&&(i=0,n.replaceState(Ae({},n.state,{idx:i}),""));var b={get action(){return l},get location(){return c},createHref:m,push:function e(t,a){var r=De.Push,l=h(t,a);if(x(r,l,function(){e(t,a)})){var o=p(l,i+1),c=o[0],d=o[1];try{n.pushState(c,"",d)}catch(u){s.location.assign(d)}g(r)}},replace:function e(t,s){var a=De.Replace,r=h(t,s);if(x(a,r,function(){e(t,s)})){var l=p(r,i),o=l[0],c=l[1];n.replaceState(o,"",c),g(a)}},go:f,back:function(){f(-1)},forward:function(){f(1)},listen:function(e){return d.push(e)},block:function(e){var t=u.push(e);return 1===u.length&&s.addEventListener(Me,Fe),function(){t(),u.length||s.removeEventListener(Me,Fe)}}};return b}(),Jb=e=>{let{children:t}=e;const{isAuthenticated:s,loading:n}=wn();return n?(0,fn.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,fn.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):s?t:(0,fn.jsx)(me,{to:"/login"})},Xb=e=>{let{children:t}=e;const{isAuthenticated:s}=wn();return s?(0,fn.jsx)(me,{to:"/dashboard"}):t};const Zb=function(){return(0,fn.jsx)(Ka,{children:(0,fn.jsx)(jn,{children:(0,fn.jsx)(ke,{history:Kb,future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:(0,fn.jsx)("div",{className:"App",children:(0,fn.jsxs)(xe,{children:[(0,fn.jsx)(he,{path:"/login",element:(0,fn.jsx)(Xb,{children:(0,fn.jsx)(Rl,{})})}),(0,fn.jsx)(he,{path:"/book/:leadId",element:(0,fn.jsx)(Wb,{})}),(0,fn.jsx)(he,{path:"/sign-contract/:token",element:(0,fn.jsx)(Yb,{})}),(0,fn.jsx)(he,{path:"/*",element:(0,fn.jsx)(Jb,{children:(0,fn.jsx)($a,{children:(0,fn.jsx)(Ml,{children:(0,fn.jsxs)(xe,{children:[(0,fn.jsx)(he,{path:"/dashboard",element:(0,fn.jsx)(ki,{})}),(0,fn.jsx)(he,{path:"/leads",element:(0,fn.jsx)(Wi,{})}),(0,fn.jsx)(he,{path:"/leads/:id",element:(0,fn.jsx)(wc,{})}),(0,fn.jsx)(he,{path:"/users",element:(0,fn.jsx)(Nc,{})}),(0,fn.jsx)(he,{path:"/templates",element:(0,fn.jsx)(gd,{})}),(0,fn.jsx)(he,{path:"/contract-editor",element:(0,fn.jsx)($b,{})}),(0,fn.jsx)(he,{path:"/calendar",element:(0,fn.jsx)(pd,{})}),(0,fn.jsx)(he,{path:"/reports",element:(0,fn.jsx)(xd,{})}),(0,fn.jsx)(he,{path:"/bookers-templates",element:(0,fn.jsx)(fd,{})}),(0,fn.jsx)(he,{path:"/finance",element:(0,fn.jsx)(yd,{})}),(0,fn.jsx)(he,{path:"/sales",element:(0,fn.jsx)(wd,{})}),(0,fn.jsx)(he,{path:"/messages",element:(0,fn.jsx)(Nd,{})}),(0,fn.jsx)(he,{path:"/salesape",element:(0,fn.jsx)(zb,{})}),(0,fn.jsx)(he,{path:"/blocked-slots",element:(0,fn.jsx)(Vb,{})}),(0,fn.jsx)(he,{path:"/photographer",element:(0,fn.jsx)(qb,{})}),(0,fn.jsx)(he,{path:"/email-accounts",element:(0,fn.jsx)(Qb,{})}),(0,fn.jsx)(he,{path:"/",element:(0,fn.jsx)(me,{to:"/dashboard"})})]})})})})})]})})})})})};l.createRoot(document.getElementById("root")).render((0,fn.jsx)(a.StrictMode,{children:(0,fn.jsx)(Zb,{})}))})()})();
//# sourceMappingURL=main.25d032b5.js.map